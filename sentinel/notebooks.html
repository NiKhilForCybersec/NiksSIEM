<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notebooks | Microsoft Sentinel</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
            <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="content-hub.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Content Hub</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-connectors.html" class="sidebar-nav-link"><i class="fas fa-plug"></i><span>Data Connectors</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="dcr-dce-guide.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>DCR & DCE Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="event-hub.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Event Hub Integration</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-filter"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention & Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="kql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>KQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>KQL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>KQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="workbooks.html" class="sidebar-nav-link"><i class="fas fa-chart-bar"></i><span>Workbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="notebooks.html" class="sidebar-nav-link"><i class="fas fa-book-open"></i><span>Notebooks</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="analytics-rules.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Analytics Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="watchlists.html" class="sidebar-nav-link"><i class="fas fa-list-check"></i><span>Watchlists</span></a></li>
                    <li class="sidebar-nav-item"><a href="ueba.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                    <li class="sidebar-nav-item"><a href="hunting.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Hunting</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>Automation & Playbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-operations.html" class="sidebar-nav-link"><i class="fas fa-headset"></i><span>SOC Operations</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>RBAC & Permissions</span></a></li>
                    <li class="sidebar-nav-item"><a href="config-reference.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Configuration Reference</span></a></li>
                    <li class="sidebar-nav-item"><a href="devops.html" class="sidebar-nav-link"><i class="fas fa-code-branch"></i><span>Sentinel as Code</span></a></li>
                    <li class="sidebar-nav-item"><a href="advanced-operations.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>Advanced Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Sentinel</a>
                    <span class="separator">/</span>
                    <span class="current">Notebooks</span>
                </div>

                <h1><i class="fas fa-book-open"></i> Sentinel Notebooks</h1>
                <p class="lead">Master Jupyter Notebooks for advanced threat hunting, investigation, and machine learning in Microsoft Sentinel. Learn MSTICPy, Python integration, and notebook-based security analysis.</p>

                <!-- Notebooks Overview -->
                <h2><i class="fas fa-info-circle"></i> Notebooks Overview</h2>
                <div class="config-section">
                    <div class="arch-diagram">SENTINEL NOTEBOOKS EXPLAINED
═══════════════════════════════════════════════════════════════════

WHAT ARE SENTINEL NOTEBOOKS?
├── Jupyter Notebooks hosted in Azure Machine Learning
├── Python-based interactive analysis environment
├── Access to Sentinel data via KQL and APIs
├── Machine learning and visualization capabilities
└── Reusable, shareable investigation playbooks

WHEN TO USE NOTEBOOKS vs KQL:
┌─────────────────────────────────────────────────────────────────┐
│          KQL                  │         Notebooks               │
├───────────────────────────────┼─────────────────────────────────┤
│ Quick ad-hoc queries          │ Complex multi-step analysis     │
│ Simple aggregations           │ Machine learning                │
│ Dashboard visualizations      │ Custom visualizations           │
│ Analytics rules               │ Deep-dive investigations        │
│ Real-time hunting             │ Forensic timeline analysis      │
│ Built-in Sentinel features    │ External data integration       │
└───────────────────────────────┴─────────────────────────────────┘

KEY CAPABILITIES:
├── Query Sentinel data with Python + KQL
├── Integrate threat intelligence (VirusTotal, OTX, etc.)
├── Enrich data with external sources
├── Apply ML models for anomaly detection
├── Create custom visualizations
├── Automate complex investigations
└── Share analysis with team

NOTEBOOK TYPES IN SENTINEL:
├── Microsoft Templates (pre-built)
│   ├── Guided Investigation - Generic
│   ├── Entity Explorer - Account/Host/IP
│   ├── Credential Scan
│   └── Campaign Analysis
├── Community Notebooks (GitHub)
└── Custom Notebooks (your own)</div>
                </div>

                <!-- Setting Up Notebooks -->
                <h2><i class="fas fa-cog"></i> Setting Up Notebooks</h2>
                <div class="config-section">
                    <p><span class="console-path">Sentinel → Threat management → Notebooks</span></p>

                    <h4>Initial Configuration</h4>
                    <div class="arch-diagram">NOTEBOOK SETUP STEPS
═══════════════════════════════════════════════════════════════════

STEP 1: CREATE AZURE ML WORKSPACE
├── Navigate: Sentinel → Notebooks → Configure
├── Create new Azure ML workspace (or link existing)
├── Select region (same as Sentinel workspace recommended)
├── Standard pricing tier is sufficient
└── Wait for deployment (~5 minutes)

STEP 2: LAUNCH NOTEBOOK
├── Select a template notebook OR create new
├── Choose compute instance:
│   ├── Standard_DS3_v2 (recommended for most)
│   ├── Standard_DS11_v2 (for ML workloads)
│   └── Turn off when not in use (cost savings)
├── Kernel: Python 3.8 - AzureML
└── Wait for compute to start (~3 minutes)

STEP 3: AUTHENTICATE
├── First cell typically handles authentication
├── Uses Azure AD interactive login
├── Stores credentials for session
└── May prompt for device code login

STEP 4: CONFIGURE WORKSPACE
├── Set Sentinel workspace ID
├── Set tenant ID
├── Configure API keys for threat intel (optional)
└── Store in config file for reuse

COMPUTE SIZING:
├── Light analysis: Standard_DS3_v2 (4 vCPU, 14 GB)
├── ML workloads: Standard_DS11_v2 (2 vCPU, 14 GB, better memory/vCPU)
├── Heavy processing: Standard_DS12_v2 (4 vCPU, 28 GB)
└── Auto-shutdown: Enable to save costs</div>

                    <h4>Configuration File</h4>
                    <div class="arch-diagram">MSTICPYCONFIG.YAML EXAMPLE
═══════════════════════════════════════════════════════════════════

# ~/.msticpyconfig.yaml
AzureSentinel:
  Workspaces:
    Default:
      WorkspaceId: "your-workspace-id"
      TenantId: "your-tenant-id"
      SubscriptionId: "your-subscription-id"
      ResourceGroup: "your-resource-group"
      
TIProviders:
  VirusTotal:
    Args:
      ApiID: "your-vt-api-key"
    Primary: True
  OTX:
    Args:
      ApiID: "your-otx-api-key"
  AbuseIPDB:
    Args:
      ApiKey: "your-abuseipdb-key"

KeyVault:
  VaultName: "your-keyvault"
  TenantId: "your-tenant-id"
  Authority: "global"

# Load config in notebook:
from msticpy.common.pkg_config import refresh_config
refresh_config()</div>
                </div>

                <!-- MSTICPy Library -->
                <h2><i class="fas fa-python"></i> MSTICPy Library</h2>
                <div class="config-section">
                    <div class="arch-diagram">MSTICPY - MICROSOFT THREAT INTELLIGENCE PYTHON
═══════════════════════════════════════════════════════════════════

WHAT IS MSTICPY?
├── Python library for security investigations
├── Developed by Microsoft Security Research
├── Built-in Sentinel/Log Analytics integration
├── Threat intel lookups, visualizations, analysis tools
└── Open source: github.com/microsoft/msticpy

INSTALLATION:
pip install msticpy[all]
# or specific features:
pip install msticpy[azure]
pip install msticpy[ml]

KEY MODULES:
├── msticpy.data: Data providers (Sentinel, Splunk, MDE)
├── msticpy.sectools: Security tools (IP lookup, process tree)
├── msticpy.vis: Visualizations (timelines, matrices)
├── msticpy.analysis: Analysis tools (anomalies, clustering)
├── msticpy.transform: Data transformation
└── msticpy.context: Enrichment (TI, GeoIP)

BASIC USAGE:
import msticpy as mp
mp.init_notebook(namespace=globals())

# Query Sentinel
from msticpy.data import QueryProvider
qry_prov = QueryProvider("AzureSentinel")
qry_prov.connect()

# Run KQL query
df = qry_prov.exec_query("""
    SigninLogs
    | where TimeGenerated > ago(1h)
    | take 100
""")

# Use built-in queries
df = qry_prov.Azure.list_all_signins_geo(
    start="-1d",
    end="now"
)</div>

                    <h4>Common MSTICPy Operations</h4>
                    <div class="arch-diagram">MSTICPY COMMON OPERATIONS
═══════════════════════════════════════════════════════════════════

# 1. THREAT INTEL LOOKUPS
from msticpy.context.tilookup import TILookup
ti = TILookup()
ti.lookup_ioc("evil-domain.com")
ti.lookup_iocs(["1.2.3.4", "5.6.7.8"])

# 2. IP GEOLOCATION
from msticpy.context.geoip import GeoLiteLookup
geo = GeoLiteLookup()
geo.lookup_ip("8.8.8.8")

# 3. WHOIS LOOKUP
from msticpy.context.domain_utils import DomainValidator
dv = DomainValidator()
dv.whois("suspicious-domain.com")

# 4. PROCESS TREE VISUALIZATION
from msticpy.vis.process_tree import build_process_tree
process_tree = build_process_tree(
    df,
    schema=ProcSchema(
        process_name="ProcessName",
        process_id="ProcessId",
        parent_id="ParentProcessId",
        cmd_line="CommandLine"
    )
)

# 5. TIMELINE VISUALIZATION
from msticpy.vis.timeline import display_timeline
display_timeline(
    data=df,
    title="Activity Timeline",
    source_columns=["Account", "Activity"],
    time_column="TimeGenerated"
)

# 6. ANOMALY DETECTION
from msticpy.analysis.timeseries import timeseries_anomalies
anomalies = timeseries_anomalies(
    df,
    time_column="TimeGenerated",
    value_column="Count"
)</div>
                </div>

                <!-- Notebook Templates -->
                <h2><i class="fas fa-file-code"></i> Notebook Templates</h2>
                <div class="config-section">
                    <h4>Built-in Templates</h4>
                    <div class="arch-diagram">SENTINEL NOTEBOOK TEMPLATES
═══════════════════════════════════════════════════════════════════

GUIDED INVESTIGATION - GENERIC
├── Purpose: General incident investigation
├── Features:
│   ├── Query incident data
│   ├── Entity extraction
│   ├── Timeline visualization
│   ├── TI lookups
│   └── Pivot between entities
└── Best for: Starting point for any investigation

ENTITY EXPLORER - ACCOUNT
├── Purpose: Deep dive on user account
├── Features:
│   ├── Sign-in analysis
│   ├── Risky sign-ins
│   ├── Activity timeline
│   ├── Peer comparison
│   └── Related entities
└── Best for: Compromised account investigation

ENTITY EXPLORER - HOST
├── Purpose: Deep dive on host/device
├── Features:
│   ├── Process execution
│   ├── Network connections
│   ├── User activity
│   ├── Alerts on host
│   └── Vulnerabilities
└── Best for: Endpoint compromise investigation

ENTITY EXPLORER - IP ADDRESS
├── Purpose: Deep dive on IP address
├── Features:
│   ├── GeoIP information
│   ├── TI lookups
│   ├── Related connections
│   ├── Users from IP
│   └── Reputation history
└── Best for: Suspicious IP investigation

CREDENTIAL SCAN
├── Purpose: Detect exposed credentials
├── Features:
│   ├── Password spray detection
│   ├── Credential stuffing
│   ├── Breach exposure check
│   └── Account lockout analysis
└── Best for: Identity compromise hunting</div>

                    <h4>Custom Notebook Template</h4>
                    <div class="arch-diagram">CUSTOM INVESTIGATION NOTEBOOK TEMPLATE
═══════════════════════════════════════════════════════════════════

# Cell 1: Setup and Imports
import msticpy as mp
mp.init_notebook(namespace=globals())

from msticpy.data import QueryProvider
from msticpy.vis.timeline import display_timeline
from msticpy.context.tilookup import TILookup
import pandas as pd

# Cell 2: Authentication and Connection
qry_prov = QueryProvider("AzureSentinel")
qry_prov.connect()

# Cell 3: Define Investigation Parameters
investigation_params = {
    "incident_id": "12345",
    "timeframe": "-7d",
    "entities": ["user@company.com", "10.1.1.50"]
}

# Cell 4: Query Sentinel Data
query = f"""
SecurityIncident
| where IncidentNumber == {investigation_params['incident_id']}
| extend AlertIds = todynamic(AlertIds)
| mv-expand AlertIds
"""
incident_df = qry_prov.exec_query(query)

# Cell 5: Entity Analysis
# For each entity, perform analysis...

# Cell 6: Threat Intel Enrichment
ti = TILookup()
for entity in investigation_params['entities']:
    results = ti.lookup_ioc(entity)
    display(results)

# Cell 7: Timeline Visualization
display_timeline(
    data=activity_df,
    title="Investigation Timeline",
    time_column="TimeGenerated"
)

# Cell 8: Findings and Conclusions
# Document your findings here...</div>
                </div>

                <!-- Advanced Hunting with Notebooks -->
                <h2><i class="fas fa-crosshairs"></i> Advanced Hunting Patterns</h2>
                <div class="config-section">
                    <h4>ML-Based Anomaly Detection</h4>
                    <div class="arch-diagram">MACHINE LEARNING IN NOTEBOOKS
═══════════════════════════════════════════════════════════════════

# CLUSTERING FOR OUTLIER DETECTION
from sklearn.cluster import DBSCAN
from sklearn.preprocessing import StandardScaler

# Get data
query = """
SigninLogs
| where TimeGenerated > ago(7d)
| summarize 
    SigninCount = count(),
    DistinctIPs = dcount(IPAddress),
    DistinctLocations = dcount(Location),
    FailureRate = countif(ResultType != 0) * 1.0 / count()
    by UserPrincipalName
"""
df = qry_prov.exec_query(query)

# Prepare features
features = ['SigninCount', 'DistinctIPs', 'DistinctLocations', 'FailureRate']
X = StandardScaler().fit_transform(df[features])

# Detect outliers
clustering = DBSCAN(eps=0.5, min_samples=5).fit(X)
df['Cluster'] = clustering.labels_
outliers = df[df['Cluster'] == -1]  # Outliers have cluster -1

print(f"Found {len(outliers)} anomalous users")
display(outliers)

# TIME SERIES ANOMALY DETECTION
from msticpy.analysis.timeseries import timeseries_anomalies

# Get time series data
query = """
SigninLogs
| where TimeGenerated > ago(30d)
| summarize Count = count() by bin(TimeGenerated, 1h)
"""
ts_df = qry_prov.exec_query(query)

# Detect anomalies
anomalies = timeseries_anomalies(
    ts_df,
    time_column="TimeGenerated",
    value_column="Count",
    seasonal=True,
    period=24  # Daily seasonality
)
display(anomalies[anomalies['anomaly'] == True])</div>

                    <h4>Cross-Data-Source Correlation</h4>
                    <div class="arch-diagram">CROSS-SOURCE CORRELATION IN NOTEBOOKS
═══════════════════════════════════════════════════════════════════

# Correlate Sentinel data with external threat intel
import pandas as pd
import requests

# Get Sentinel data
sentinel_ips = qry_prov.exec_query("""
    CommonSecurityLog
    | where TimeGenerated > ago(24h)
    | distinct SourceIP
""")

# Enrich with threat intel
from msticpy.context.tilookup import TILookup
ti = TILookup()

enriched_data = []
for ip in sentinel_ips['SourceIP']:
    result = ti.lookup_ioc(ip)
    if result:
        enriched_data.append({
            'IP': ip,
            'IsMalicious': result.ioc_type,
            'Severity': result.severity,
            'Source': result.provider
        })

enriched_df = pd.DataFrame(enriched_data)
malicious_ips = enriched_df[enriched_df['IsMalicious'] == True]

# Correlate back to Sentinel events
if len(malicious_ips) > 0:
    ip_list = "','".join(malicious_ips['IP'].tolist())
    events = qry_prov.exec_query(f"""
        CommonSecurityLog
        | where TimeGenerated > ago(24h)
        | where SourceIP in ('{ip_list}')
        | summarize EventCount = count(), 
                    Devices = make_set(DeviceVendor)
            by SourceIP, DestinationIP
    """)</div>
                </div>

                <!-- Common Failures -->
                <h2><i class="fas fa-exclamation-triangle"></i> What Enterprises Usually Miss</h2>
                <div class="config-section">
                    <div class="arch-diagram">COMMON NOTEBOOK FAILURES AND SOLUTIONS
═══════════════════════════════════════════════════════════════════

❌ FAILURE 1: Leaving Compute Running
   Problem: Forgot to shut down Azure ML compute
   Impact: Unnecessary costs ($100+/month for idle compute)
   Solution: Enable auto-shutdown, set idle timeout

❌ FAILURE 2: No Config File
   Problem: Hardcoding workspace IDs and API keys
   Impact: Security risk, not portable
   Solution: Use msticpyconfig.yaml, store keys in Key Vault

❌ FAILURE 3: Not Using MSTICPy
   Problem: Writing everything from scratch
   Impact: Reinventing the wheel, slower analysis
   Solution: Learn MSTICPy - it has most features built-in

❌ FAILURE 4: Ignoring Built-in Templates
   Problem: Starting from blank notebook every time
   Impact: Inconsistent investigations, missed steps
   Solution: Start with Microsoft templates, customize

❌ FAILURE 5: No Version Control
   Problem: Notebooks saved only in Azure ML
   Impact: No history, hard to share, risk of loss
   Solution: Export to Git repository, use Git integration

❌ FAILURE 6: Large Dataset Queries
   Problem: Querying months of data without filters
   Impact: Slow queries, timeout errors, high costs
   Solution: Always use time filters, sample first

❌ FAILURE 7: No Error Handling
   Problem: Notebook crashes on API failure
   Impact: Lost work, frustration
   Solution: Use try/except, save intermediate results

❌ FAILURE 8: Not Documenting Findings
   Problem: Analysis in notebook but no conclusions
   Impact: Can't share findings, not actionable
   Solution: Add markdown cells with findings, export report

❌ FAILURE 9: Single User Notebooks
   Problem: Only one analyst uses notebooks
   Impact: Tribal knowledge, not scalable
   Solution: Train team, create shared templates

❌ FAILURE 10: Not Integrating with Workflow
   Problem: Notebooks isolated from SOC workflow
   Impact: Findings not in incidents, no automation
   Solution: Export findings to incidents via API</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: When would you use a Sentinel Notebook instead of KQL?</button>
                        <div class="qa-answer">
                            <p><strong>Use Notebooks for:</strong></p>
                            <ul>
                                <li><strong>Complex multi-step analysis:</strong> When investigation requires multiple queries with intermediate processing</li>
                                <li><strong>Machine learning:</strong> Clustering, anomaly detection, classification that KQL can't do</li>
                                <li><strong>External data integration:</strong> Correlating with threat intel APIs, external databases</li>
                                <li><strong>Custom visualizations:</strong> Process trees, network graphs, complex timelines</li>
                                <li><strong>Forensic investigations:</strong> Deep-dive analysis requiring documentation and reproducibility</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Stick with KQL for:</strong> Quick queries, dashboards, analytics rules, real-time hunting</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What is MSTICPy and why is it useful?</button>
                        <div class="qa-answer">
                            <p><strong>MSTICPy</strong> (Microsoft Threat Intelligence Python) is an open-source Python library designed for security investigations.</p>
                            <p style="margin-top: 12px;"><strong>Key features:</strong></p>
                            <ul>
                                <li><strong>Data providers:</strong> Query Sentinel, Splunk, MDE with simple Python</li>
                                <li><strong>Threat intel:</strong> Lookup IOCs across VirusTotal, OTX, AbuseIPDB, etc.</li>
                                <li><strong>Visualizations:</strong> Timelines, process trees, network graphs</li>
                                <li><strong>Analysis tools:</strong> Anomaly detection, time series analysis</li>
                                <li><strong>Enrichment:</strong> GeoIP, WHOIS, domain analysis</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Why use it:</strong> Saves hours of coding, standardized across analysts, maintained by Microsoft.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you use a notebook to investigate a compromised account?</button>
                        <div class="qa-answer">
                            <p><strong>Compromised account investigation workflow:</strong></p>
                            <ol>
                                <li><strong>Setup:</strong> Initialize MSTICPy, connect to Sentinel</li>
                                <li><strong>Gather context:</strong> Query IdentityInfo for user details (department, manager, roles)</li>
                                <li><strong>Authentication analysis:</strong>
                                    <ul>
                                        <li>Query SigninLogs for login patterns</li>
                                        <li>Identify unusual locations, devices, times</li>
                                        <li>Check for impossible travel</li>
                                    </ul>
                                </li>
                                <li><strong>Activity timeline:</strong> Build timeline of all user activity across data sources</li>
                                <li><strong>Threat intel enrichment:</strong> Lookup source IPs against TI providers</li>
                                <li><strong>Lateral movement:</strong> Check for access to other resources, accounts created</li>
                                <li><strong>Visualization:</strong> Create timeline chart showing attack progression</li>
                                <li><strong>Document:</strong> Add markdown cells summarizing findings</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you optimize notebook performance for large datasets?</button>
                        <div class="qa-answer">
                            <p><strong>Performance optimization strategies:</strong></p>
                            <ul>
                                <li><strong>Time filters:</strong> Always include TimeGenerated filter in KQL queries</li>
                                <li><strong>Sample first:</strong> Test queries with <code>| take 1000</code> before full run</li>
                                <li><strong>Project early:</strong> Select only needed columns to reduce data transfer</li>
                                <li><strong>Summarize in KQL:</strong> Aggregate in KQL before bringing to Python</li>
                                <li><strong>Batch lookups:</strong> Use <code>ti.lookup_iocs(list)</code> instead of looping</li>
                                <li><strong>Cache results:</strong> Save intermediate DataFrames to avoid re-querying</li>
                                <li><strong>Appropriate compute:</strong> Size Azure ML compute to workload</li>
                            </ul>
                            <div class="arch-diagram" style="margin: 10px 0;">// Bad: Pulls all data to Python
query = "SecurityEvent | where TimeGenerated > ago(7d)"

// Good: Aggregates in KQL first
query = """
SecurityEvent 
| where TimeGenerated > ago(7d)
| summarize Count = count() by Computer, Account
| where Count > 100
"""</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>
