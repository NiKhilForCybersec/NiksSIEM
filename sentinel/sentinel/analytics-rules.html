<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Rules | Sentinel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="content-hub.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Content Hub</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-connectors.html" class="sidebar-nav-link"><i class="fas fa-plug"></i><span>Data Connectors</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="dcr-dce-guide.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>DCR & DCE Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="event-hub.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Event Hub Integration</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-filter"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention & Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="kql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>KQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>KQL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>KQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="workbooks.html" class="sidebar-nav-link"><i class="fas fa-chart-bar"></i><span>Workbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="notebooks.html" class="sidebar-nav-link"><i class="fas fa-book-open"></i><span>Notebooks</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="analytics-rules.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Analytics Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="watchlists.html" class="sidebar-nav-link"><i class="fas fa-list-check"></i><span>Watchlists</span></a></li>
                    <li class="sidebar-nav-item"><a href="ueba.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                    <li class="sidebar-nav-item"><a href="hunting.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Hunting</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>Automation & Playbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-operations.html" class="sidebar-nav-link"><i class="fas fa-headset"></i><span>SOC Operations</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>RBAC & Permissions</span></a></li>
                    <li class="sidebar-nav-item"><a href="config-reference.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Configuration Reference</span></a></li>
                    <li class="sidebar-nav-item"><a href="devops.html" class="sidebar-nav-link"><i class="fas fa-code-branch"></i><span>Sentinel as Code</span></a></li>
                    <li class="sidebar-nav-item"><a href="advanced-operations.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>Advanced Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Sentinel</a>
                    <span class="separator">/</span>
                    <span class="current">Analytics Rules</span>
                </div>

                <h1><i class="fas fa-project-diagram"></i> Analytics Rules</h1>
                <p class="lead">Master Microsoft Sentinel detection rules. Learn rule types, creation workflows, entity mapping, alert grouping, and best practices for building effective detections.</p>

                <!-- Rule Types Overview -->
                <h2><i class="fas fa-layer-group"></i> Rule Types Overview</h2>
                <div class="config-section">
                    <p><span class="console-path">Sentinel → Configuration → Analytics</span></p>

                    <h4>Analytics Rule Types</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Type</th><th>Description</th><th>Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Scheduled</strong></td><td>KQL query runs on schedule</td><td>Custom detections, complex logic</td></tr>
                            <tr><td><strong>NRT (Near Real-Time)</strong></td><td>Runs every minute</td><td>Critical alerts, time-sensitive</td></tr>
                            <tr><td><strong>Microsoft Security</strong></td><td>Ingests M365 Defender alerts</td><td>Unified incident view</td></tr>
                            <tr><td><strong>Fusion</strong></td><td>ML-based correlation</td><td>Advanced attack detection</td></tr>
                            <tr><td><strong>ML Behavior Analytics</strong></td><td>Anomaly detection</td><td>UEBA, baseline deviations</td></tr>
                            <tr><td><strong>Threat Intelligence</strong></td><td>IOC matching</td><td>Known bad indicators</td></tr>
                            <tr><td><strong>Anomaly</strong></td><td>Built-in anomaly rules</td><td>Unusual patterns</td></tr>
                        </tbody>
                    </table>

                    <h4>Rule Type Selection</h4>
                    <div class="arch-diagram">When to Use Each Rule Type:

SCHEDULED RULES:
├── Complex queries with joins
├── Aggregations and thresholds
├── Custom detection logic
├── Flexible scheduling (5min - 14 days)
└── Most common rule type

NRT (NEAR REAL-TIME):
├── Critical security events
├── Simple, fast queries
├── No aggregations allowed
├── 1-minute detection latency
└── Limited to certain tables

MICROSOFT SECURITY:
├── M365 Defender alerts
├── Defender for Cloud alerts
├── Azure AD Identity Protection
├── Unified incident management
└── Automatic alert import

FUSION:
├── Multi-stage attack detection
├── Correlates signals across sources
├── ML-powered (no query needed)
├── Advanced persistent threats
└── Cannot be customized

ANOMALY:
├── Behavior baseline deviations
├── Pre-built anomaly types
├── Threshold tuning only
├── Good for UEBA scenarios
└── Requires baseline period</div>
                </div>

                <!-- Scheduled Rules Deep Dive -->
                <h2><i class="fas fa-clock"></i> Scheduled Rules Deep Dive</h2>
                <div class="config-section">
                    <h4>Rule Configuration</h4>
                    <div class="arch-diagram">Scheduled Rule Components:

1. GENERAL
   ├── Name: Descriptive, unique name
   ├── Description: What it detects, why it matters
   ├── Severity: Informational, Low, Medium, High
   ├── MITRE ATT&CK: Tactics and techniques
   └── Status: Enabled/Disabled

2. RULE LOGIC
   ├── KQL Query: Detection logic
   ├── Entity Mapping: Map fields to entities
   ├── Custom Details: Add context fields
   └── Alert Details: Dynamic alert title/description

3. SCHEDULING
   ├── Query Frequency: How often to run (5min - 14d)
   ├── Lookup Period: Time range to query
   ├── Start Running: Immediate or scheduled
   └── Suppress alerts: Group similar alerts

4. INCIDENT SETTINGS
   ├── Create Incidents: Yes/No
   ├── Grouping: Alert aggregation rules
   └── Re-open closed incidents: Optional

5. AUTOMATED RESPONSE
   ├── Playbooks: Attach automation
   └── Trigger on: Alert creation</div>

                    <h4>Query Best Practices</h4>
                    <div class="arch-diagram">// GOOD: Filter early, project needed fields
SecurityEvent
| where TimeGenerated > ago(1h)
| where EventID == 4625
| where AccountType == "User"
| summarize FailedAttempts = count() by TargetUserName, IpAddress
| where FailedAttempts > 10
| project TargetUserName, IpAddress, FailedAttempts

// BAD: Expensive operations first
SecurityEvent
| extend ParsedData = parse_json(EventData)
| where EventID == 4625  // Filter should be first!

// SCHEDULING ALIGNMENT
// Query frequency: 5 minutes
// Lookup period: 10 minutes (2x frequency for overlap)
// This ensures no events are missed

// DEDUPLICATION
// If rule might fire multiple times for same event:
| summarize arg_min(TimeGenerated, *) by UniqueField

// THRESHOLD TUNING
let threshold = 10;  // Easy to adjust
SecurityEvent
| where EventID == 4625
| summarize count() by TargetUserName
| where count_ > threshold</div>
                </div>

                <!-- Entity Mapping -->
                <h2><i class="fas fa-project-diagram"></i> Entity Mapping</h2>
                <div class="config-section">
                    <h4>Entity Types</h4>
                    <div class="arch-diagram">Sentinel Entity Types:

ACCOUNT:
├── Name: Username
├── AadUserId: Azure AD Object ID
├── UPNSuffix: Domain portion of UPN
├── Sid: Windows SID
└── NTDomain: Windows domain

HOST:
├── HostName: Computer name
├── DnsDomain: FQDN domain
├── AzureID: Azure resource ID
├── OMSAgentID: Log Analytics agent ID
└── OSFamily: Windows/Linux/macOS

IP:
├── Address: IP address
└── (Automatic geolocation enrichment)

URL:
├── Url: Full URL
└── (Automatic domain extraction)

FILE:
├── Name: Filename
├── Directory: Path
└── Hash: SHA256/SHA1/MD5

PROCESS:
├── ProcessId: PID
├── CommandLine: Full command
├── ElevationToken: Elevated/Limited
└── CreationTime: Start time

MAILBOX:
├── MailboxPrimaryAddress: Email
├── DisplayName: User display name
└── Upn: User principal name

CLOUD APPLICATION:
├── Name: App name
├── AppId: Application ID
└── InstanceName: Specific instance</div>

                    <h4>Entity Mapping Examples</h4>
                    <div class="arch-diagram">// Failed Login Detection with Entity Mapping
SecurityEvent
| where EventID == 4625
| where AccountType == "User"
| project 
    TimeGenerated,
    TargetUserName,      // Map to Account.Name
    TargetDomainName,    // Map to Account.NTDomain
    IpAddress,           // Map to IP.Address
    Computer,            // Map to Host.HostName
    LogonType

ENTITY MAPPING IN RULE:
Account:
  - Identifier: Name
    ColumnName: TargetUserName
  - Identifier: NTDomain
    ColumnName: TargetDomainName

Host:
  - Identifier: HostName
    ColumnName: Computer

IP:
  - Identifier: Address
    ColumnName: IpAddress

// Process Execution with Entity Mapping
SecurityEvent
| where EventID == 4688
| project
    TimeGenerated,
    Account = TargetUserName,
    Computer,
    NewProcessName,      // Map to Process.CommandLine
    ProcessId = NewProcessId,
    ParentProcessName,
    CommandLine

ENTITY MAPPING:
Account:
  - Identifier: Name
    ColumnName: Account

Host:
  - Identifier: HostName
    ColumnName: Computer

Process:
  - Identifier: ProcessId
    ColumnName: ProcessId
  - Identifier: CommandLine
    ColumnName: NewProcessName</div>
                </div>

                <!-- Alert Grouping -->
                <h2><i class="fas fa-object-group"></i> Alert Grouping & Incidents</h2>
                <div class="config-section">
                    <h4>Grouping Configuration</h4>
                    <div class="arch-diagram">Alert Grouping Options:

1. ENABLED/DISABLED
   ├── Enabled: Group alerts into incidents
   └── Disabled: Each alert = new incident

2. GROUP BY
   ├── Entities: Group by mapped entities
   ├── Alert details: Group by custom fields
   └── Time frame: Group within window

3. TIME WINDOW
   ├── 5 minutes to 24 hours
   └── Alerts within window grouped together

4. RE-OPEN CLOSED INCIDENTS
   ├── Enabled: New alerts re-open closed incident
   └── Disabled: Always create new incident

GROUPING STRATEGIES:

STRATEGY 1: Per Entity
// Group all alerts for same user
Group by: Account entity
Time window: 24 hours
Result: One incident per user per day

STRATEGY 2: Per Attack Chain
// Group related attack stages
Group by: Account + Host entities
Time window: 4 hours
Result: Track attack progression

STRATEGY 3: Per Source
// Group by attacker IP
Group by: IP entity
Time window: 1 hour
Result: Track attacker activity

STRATEGY 4: No Grouping
// Each alert is unique incident
Grouping: Disabled
Result: Maximum granularity</div>

                    <h4>Custom Details</h4>
                    <div class="arch-diagram">// Custom Details add context to alerts/incidents
SecurityEvent
| where EventID == 4625
| summarize 
    FailedAttempts = count(),
    TargetAccounts = make_set(TargetUserName, 10),
    SourceIPs = make_set(IpAddress, 10)
  by Computer, bin(TimeGenerated, 1h)
| where FailedAttempts > 20

CUSTOM DETAILS MAPPING:
Key: FailedLoginCount
Value: FailedAttempts

Key: TargetedUsers
Value: TargetAccounts

Key: AttackerIPs
Value: SourceIPs

// These appear in the incident details panel
// Useful for quick triage without re-running query

// Dynamic Alert Details (title/description)
Alert Name Format: 
"Brute Force Attack on {{Computer}} - {{FailedAttempts}} failures"

Alert Description Format:
"Detected {{FailedAttempts}} failed login attempts on host {{Computer}}. 
Targeted accounts: {{TargetAccounts}}. Source IPs: {{SourceIPs}}"</div>
                </div>

                <!-- NRT Rules -->
                <h2><i class="fas fa-bolt"></i> Near Real-Time (NRT) Rules</h2>
                <div class="config-section">
                    <h4>NRT Rule Characteristics</h4>
                    <div class="arch-diagram">NRT Rule Specifications:

TIMING:
├── Runs every 1 minute
├── No configurable schedule
├── ~1 minute detection latency
└── Processes events as they arrive

LIMITATIONS:
├── No aggregations (summarize, count, etc.)
├── No joins between tables
├── No time-based windowing
├── Simple filtering only
├── Limited to supported tables
└── Cannot use let statements

SUPPORTED TABLES:
├── SecurityEvent
├── WindowsEvent
├── Syslog
├── CommonSecurityLog
├── AzureActivity
├── SigninLogs
├── AuditLogs
└── (Check docs for full list)

USE CASES:
├── Critical file access
├── High-privilege account usage
├── Known malware hash detection
├── Specific attack signatures
└── Policy violations</div>

                    <h4>NRT Rule Examples</h4>
                    <div class="arch-diagram">// NRT: Critical Service Account Login
SecurityEvent
| where EventID == 4624
| where TargetUserName in ("svc_backup", "svc_admin", "domain_admin")
| where LogonType in (2, 10)  // Interactive or RDP
| project TimeGenerated, Computer, TargetUserName, IpAddress, LogonType

// NRT: Sensitive File Access
SecurityEvent
| where EventID == 4663
| where ObjectName has_any ("passwords", "credentials", "secret")
| project TimeGenerated, Computer, SubjectUserName, ObjectName, AccessMask

// NRT: Known Bad Hash Execution
DeviceFileEvents
| where SHA256 in ("abc123...", "def456...")
| project TimeGenerated, DeviceName, FileName, SHA256, InitiatingProcessFileName

// NRT: PowerShell Encoded Command
SecurityEvent
| where EventID == 4688
| where NewProcessName endswith "powershell.exe"
| where CommandLine contains "-enc" or CommandLine contains "-EncodedCommand"
| project TimeGenerated, Computer, Account, CommandLine</div>
                </div>

                <!-- Built-in Rules -->
                <h2><i class="fas fa-box"></i> Built-in Rule Templates</h2>
                <div class="config-section">
                    <h4>Rule Template Categories</h4>
                    <div class="arch-diagram">Built-in Rule Template Categories:

IDENTITY:
├── Suspicious sign-in activity
├── Impossible travel
├── MFA bypass attempts
├── Privileged account usage
└── Password spray detection

ENDPOINT:
├── Malware detection
├── Suspicious process execution
├── Persistence mechanisms
├── Credential dumping
└── Lateral movement

NETWORK:
├── Suspicious connections
├── Data exfiltration
├── C2 communication
├── DNS tunneling
└── Port scanning

CLOUD:
├── Azure resource changes
├── AWS/GCP suspicious activity
├── Cloud storage access
├── Privilege escalation
└── Service principal abuse

OFFICE 365:
├── Mail forwarding rules
├── Mass file downloads
├── Sharing external
├── Admin activity
└── eDiscovery abuse

THREAT INTELLIGENCE:
├── Known malicious IPs
├── Known malicious domains
├── Malware hashes
├── Threat actor TTPs
└── Emerging threats</div>

                    <h4>Enabling Templates</h4>
                    <div class="arch-diagram">Enabling Rule Templates:

PATH: Sentinel → Analytics → Rule Templates

STEPS:
1. Filter by data source or MITRE tactic
2. Review rule logic and description
3. Click "Create rule" to customize
4. Modify thresholds, entity mapping
5. Configure scheduling and grouping
6. Enable and monitor

CUSTOMIZATION OPTIONS:
├── Modify KQL query
├── Adjust thresholds
├── Change scheduling
├── Update entity mapping
├── Add custom details
├── Attach playbooks

BEST PRACTICES:
├── Review query before enabling
├── Understand data requirements
├── Test in dev environment first
├── Start with higher thresholds
├── Monitor false positive rate
└── Document customizations</div>
                </div>

                <!-- Detection Examples -->
                <h2><i class="fas fa-code"></i> Detection Rule Examples</h2>
                <div class="config-section">
                    <h4>Brute Force Detection</h4>
                    <div class="arch-diagram">// Brute Force Detection Rule
let FailureThreshold = 10;
let TimeWindow = 10m;

SigninLogs
| where TimeGenerated > ago(TimeWindow)
| where ResultType != 0  // Failed logins
| where ResultType != 50140  // Exclude lockout
| summarize 
    FailedAttempts = count(),
    SuccessfulAttempts = countif(ResultType == 0),
    DistinctUsers = dcount(UserPrincipalName),
    TargetUsers = make_set(UserPrincipalName, 10),
    ResultCodes = make_set(ResultType, 5)
  by IPAddress, Location, bin(TimeGenerated, TimeWindow)
| where FailedAttempts >= FailureThreshold
| extend 
    AlertTitle = strcat("Brute Force from ", IPAddress),
    AttackType = iff(DistinctUsers > 5, "Password Spray", "Brute Force")
| project 
    TimeGenerated,
    IPAddress,
    Location,
    FailedAttempts,
    DistinctUsers,
    TargetUsers,
    AttackType,
    AlertTitle

// Entity Mapping: IP (IPAddress)
// Custom Details: FailedAttempts, TargetUsers, AttackType
// Severity: High
// MITRE: T1110 (Brute Force)</div>

                    <h4>Privilege Escalation Detection</h4>
                    <div class="arch-diagram">// User Added to Privileged Group
let PrivilegedGroups = dynamic([
    "Domain Admins", "Enterprise Admins", "Schema Admins",
    "Administrators", "Account Operators", "Backup Operators"
]);

SecurityEvent
| where EventID == 4728 or EventID == 4732 or EventID == 4756
| where TargetUserName has_any (PrivilegedGroups) 
    or TargetSid startswith "S-1-5-21" and TargetSid endswith "-512"
| project 
    TimeGenerated,
    GroupName = TargetUserName,
    AddedUser = MemberName,
    AddedBy = SubjectUserName,
    Computer,
    EventID,
    GroupType = case(
        EventID == 4728, "Global Security Group",
        EventID == 4732, "Local Security Group",
        EventID == 4756, "Universal Security Group",
        "Unknown"
    )
| extend AlertSeverity = "High"

// Entity Mapping:
// Account (AddedUser) - the user being added
// Account (AddedBy) - the user who made the change
// Host (Computer)
// MITRE: T1078 (Valid Accounts), T1098 (Account Manipulation)</div>

                    <h4>Suspicious PowerShell</h4>
                    <div class="arch-diagram">// Suspicious PowerShell Activity
let SuspiciousPatterns = dynamic([
    "-enc", "-encodedcommand", "-e ", 
    "downloadstring", "downloadfile",
    "invoke-webrequest", "invoke-expression",
    "iex(", "iwr ", "bypass", "-nop",
    "hidden", "frombase64string"
]);

SecurityEvent
| where EventID == 4688
| where NewProcessName endswith "powershell.exe" 
    or NewProcessName endswith "pwsh.exe"
| where CommandLine has_any (SuspiciousPatterns)
| extend 
    EncodedCommand = CommandLine contains "-enc" or CommandLine contains "-e ",
    DownloadActivity = CommandLine has_any ("downloadstring", "downloadfile", "invoke-webrequest"),
    HiddenExecution = CommandLine contains "hidden" or CommandLine contains "-w hidden",
    BypassPolicy = CommandLine contains "bypass"
| project 
    TimeGenerated,
    Computer,
    Account = TargetUserName,
    ParentProcess = ParentProcessName,
    CommandLine,
    EncodedCommand,
    DownloadActivity,
    HiddenExecution,
    BypassPolicy
| extend 
    RiskScore = toint(EncodedCommand) + toint(DownloadActivity) + 
                toint(HiddenExecution) + toint(BypassPolicy)
| where RiskScore >= 2

// MITRE: T1059.001 (PowerShell)</div>
                </div>

                <!-- Rule Tuning -->
                <h2><i class="fas fa-sliders-h"></i> Rule Tuning</h2>
                <div class="config-section">
                    <div class="arch-diagram">Rule Tuning Best Practices:

1. START CONSERVATIVE
   ├── Higher thresholds initially
   ├── Shorter time windows
   ├── More specific filters
   └── Enable in "Report" mode first

2. MONITOR FALSE POSITIVES
   ├── Track FP rate per rule
   ├── Identify common exclusions
   ├── Document tuning decisions
   └── Review weekly

3. ADD EXCLUSIONS
   // Exclude known service accounts
   | where Account !in ("svc_backup", "svc_monitoring")
   
   // Exclude known IPs
   | where IPAddress !in ("10.0.0.1", "10.0.0.2")
   
   // Exclude known processes
   | where ProcessName !has "legitimate_tool"

4. USE ALLOWLISTS
   let AllowedUsers = externaldata(user:string)
       [@"https://storage.blob.core.windows.net/lists/allowed_users.csv"]
       with (format="csv");
   SigninLogs
   | where UserPrincipalName !in (AllowedUsers)

5. ADJUST THRESHOLDS
   // Start high, lower as you understand baseline
   let threshold = 50;  // Start
   let threshold = 20;  // After tuning
   let threshold = 10;  // Final

6. TIME-BASED EXCEPTIONS
   // Exclude scheduled maintenance windows
   | where not (dayofweek(TimeGenerated) == 0 and 
                datetime_part("hour", TimeGenerated) between (2 .. 6))</div>

                    <h4>Tuning Analysis Queries</h4>
                    <div class="arch-diagram">TUNING ANALYSIS KQL QUERIES
═══════════════════════════════════════════════════════════════════

// FALSE POSITIVE RATE BY RULE (Last 30 days)
SecurityIncident
| where TimeGenerated > ago(30d)
| where Status == "Closed"
| summarize 
    Total = count(),
    FalsePositives = countif(Classification == "FalsePositive"),
    TruePositives = countif(Classification == "TruePositive"),
    BenignPositives = countif(Classification == "BenignPositive")
    by Title
| extend FP_Rate = round(FalsePositives * 100.0 / Total, 1)
| where Total > 5
| order by FP_Rate desc

// IDENTIFY TOP FP PATTERNS FOR SPECIFIC RULE
let RuleName = "Suspicious Login Activity";
SecurityIncident
| where TimeGenerated > ago(30d)
| where Title == RuleName
| where Classification == "FalsePositive"
| mv-expand AlertIds
| join kind=inner (
    SecurityAlert
    | extend AlertId = SystemAlertId
) on $left.AlertIds == $right.AlertId
| extend Entities = todynamic(Entities)
| mv-expand Entities
| extend EntityType = tostring(Entities.Type),
         EntityValue = coalesce(
             tostring(Entities.HostName),
             tostring(Entities.Address),
             tostring(Entities.Name)
         )
| summarize FPCount = count() by EntityType, EntityValue
| order by FPCount desc
| take 20
// Use these to build exclusions

// RULE ALERT VOLUME OVER TIME
SecurityAlert
| where TimeGenerated > ago(30d)
| summarize AlertCount = count() by AlertName, bin(TimeGenerated, 1d)
| render timechart
// Look for spikes to investigate

// FIND COMMON VALUES TO EXCLUDE
let RuleName = "Brute Force Attack";
SecurityAlert
| where TimeGenerated > ago(7d)
| where AlertName == RuleName
| extend Entities = todynamic(Entities)
| mv-expand Entities
| where Entities.Type == "account"
| extend Account = tostring(Entities.Name)
| summarize AlertCount = count() by Account
| order by AlertCount desc
| take 20
// Accounts appearing frequently may be candidates for exclusion

// THRESHOLD ANALYSIS - Find optimal threshold
SecurityEvent
| where TimeGenerated > ago(7d)
| where EventID == 4625
| summarize FailedLogins = count() by TargetUserName, bin(TimeGenerated, 1h)
| summarize 
    P50 = percentile(FailedLogins, 50),
    P75 = percentile(FailedLogins, 75),
    P90 = percentile(FailedLogins, 90),
    P95 = percentile(FailedLogins, 95),
    P99 = percentile(FailedLogins, 99)
// Set threshold between P90-P99 to catch outliers</div>
                </div>

                <!-- Rule Lifecycle Management -->
                <h2><i class="fas fa-sync-alt"></i> Enterprise Rule Lifecycle Management</h2>
                <div class="config-section">
                    <h4>Detection Engineering Workflow</h4>
                    <div class="arch-diagram">RULE LIFECYCLE FRAMEWORK
═══════════════════════════════════════════════════════════════════

┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐
│ IDEATION │──▶│  BUILD   │──▶│   TEST   │──▶│  DEPLOY  │──▶│ OPERATE  │
└──────────┘   └──────────┘   └──────────┘   └──────────┘   └──────────┘
     │              │              │              │              │
     ▼              ▼              ▼              ▼              ▼
┌──────────────────────────────────────────────────────────────────────┐
│ • Threat intel  • Write KQL    • Dev workspace • Staged rollout  • Monitor FP  │
│ • Gap analysis  • Entity map   • Sample data   • Documentation   • Tune rules  │
│ • Use case doc  • Alert config • Peer review   • Change mgmt     • Track KPIs  │
│ • Prioritize    • Test queries • Validate      • Communicate     • Retire old  │
└──────────────────────────────────────────────────────────────────────┘

RULE STATES:
├── Draft: Under development, not deployed
├── Testing: Deployed in dev/test workspace
├── Pilot: Limited production deployment (silent mode)
├── Active: Full production deployment
├── Tuning: Under review for false positive reduction
├── Deprecated: Scheduled for retirement
└── Retired: Disabled, archived for reference</div>

                    <h4>Rule Development Decision Tree</h4>
                    <div class="arch-diagram">RULE TYPE SELECTION DECISION TREE
═══════════════════════════════════════════════════════════════════

START: What are you detecting?
│
├─► Known IOC (hash, IP, domain)?
│   └─► USE: Threat Intelligence Rule
│       • Automatic IOC matching
│       • No custom query needed
│
├─► Microsoft product alerts (Defender, Azure AD)?
│   └─► USE: Microsoft Security Rule
│       • Native alert import
│       • Unified incident management
│
├─► Time-critical event (< 1 min detection)?
│   │
│   ├─► Simple filter (no aggregation)?
│   │   └─► USE: NRT Rule
│   │       • 1-minute latency
│   │       • Limited query capability
│   │
│   └─► Complex query needed?
│       └─► USE: Scheduled Rule (5 min)
│           • Minimum schedule interval
│
├─► Anomaly from baseline?
│   └─► USE: Anomaly Rule
│       • UEBA scenarios
│       • Behavior deviation
│
├─► Multi-stage attack correlation?
│   └─► USE: Fusion Rule (built-in)
│       • ML-powered
│       • Cannot customize
│
└─► Custom detection logic?
    └─► USE: Scheduled Rule
        • Full KQL capability
        • Most flexible option</div>

                    <h4>Rule Governance Framework</h4>
                    <div class="arch-diagram">ENTERPRISE RULE GOVERNANCE
═══════════════════════════════════════════════════════════════════

RULE NAMING CONVENTION:
[Source]-[TacticCode]-[Description]-[Version]

Examples:
├── MSFT-TA0001-BruteForceDetection-v2
├── CUST-TA0003-SuspiciousPowerShell-v3
├── TI-TA0011-KnownC2Domain-v1
└── FUSION-MultiStageAttack (built-in)

REQUIRED DOCUMENTATION:
┌─────────────────────────────────────────────────────────────────┐
│ Rule Name:        [Standard naming convention]                   │
│ MITRE ATT&CK:     [Tactic(s) and Technique(s)]                  │
│ Data Sources:     [Required tables and connectors]              │
│ Description:      [What the rule detects]                       │
│ Business Impact:  [Why this matters to the organization]        │
│ False Positive:   [Known FP scenarios and mitigations]          │
│ Threshold Logic:  [Justification for threshold values]          │
│ Owner:            [Team/individual responsible]                 │
│ Last Review:      [Date of last review]                         │
│ Change History:   [Version history with changes]                │
└─────────────────────────────────────────────────────────────────┘

REVIEW CADENCE:
├── New rules: Weekly review for first month
├── Active rules: Quarterly review
├── High-FP rules: Weekly until stabilized
└── Deprecated rules: Archive after 90 days inactive</div>

                    <h4>Rule Performance Metrics</h4>
                    <div class="arch-diagram">// Rule Performance Dashboard Queries

// 1. Alert Volume by Rule (Last 30 Days)
SecurityAlert
| where TimeGenerated > ago(30d)
| summarize 
    AlertCount = count(),
    DistinctIncidents = dcount(SystemAlertId)
  by AlertName
| order by AlertCount desc

// 2. False Positive Rate by Rule
SecurityIncident
| where TimeGenerated > ago(30d)
| where Status == "Closed"
| summarize 
    TotalClosed = count(),
    FalsePositives = countif(Classification == "FalsePositive"),
    TruePositives = countif(Classification == "TruePositive"),
    BenignPositives = countif(Classification == "BenignPositive")
  by Title
| extend FP_Rate = round(100.0 * FalsePositives / TotalClosed, 1)
| order by FP_Rate desc

// 3. Mean Time to Triage by Rule
SecurityIncident
| where TimeGenerated > ago(30d)
| where Status != "New"
| extend MTTT = datetime_diff('minute', FirstModifiedTime, CreatedTime)
| summarize AvgMTTT = avg(MTTT), MedianMTTT = percentile(MTTT, 50) by Title
| order by AvgMTTT desc

// 4. Rule Execution Performance
// Check in Azure Monitor → Logic Apps runs (for scheduled rules)

PERFORMANCE TARGETS:
├── False Positive Rate: < 20% per rule
├── Alert-to-Incident Ratio: 5:1 or better (with grouping)
├── Mean Time to Triage: < 15 minutes for High severity
├── Rule Execution Time: < 30 seconds per run
└── Coverage: 80%+ of MITRE techniques relevant to org</div>
                </div>

                <!-- Common Failures -->
                <h2><i class="fas fa-exclamation-triangle"></i> What Enterprises Usually Miss</h2>
                <div class="config-section">
                    <div class="arch-diagram">COMMON ANALYTICS RULE FAILURES AND SOLUTIONS
═══════════════════════════════════════════════════════════════════

❌ FAILURE 1: Enabling All Templates Without Review
   Problem: Hundreds of rules enabled, most irrelevant to environment
   Impact: Alert fatigue, wasted resources, missed real threats
   Solution: Map templates to data sources, prioritize by threat model
   
❌ FAILURE 2: No Entity Mapping
   Problem: Alerts without proper entity extraction
   Impact: No investigation graph, manual correlation needed
   Solution: Map all relevant fields to entity types in every rule
   
❌ FAILURE 3: Poor Alert Grouping Strategy
   Problem: One alert = one incident, or over-aggressive grouping
   Impact: Thousands of incidents OR missed attack progression
   Solution: Group by entity + time window aligned to attack patterns
   
❌ FAILURE 4: Hardcoded Thresholds
   Problem: Thresholds don't account for environment baseline
   Impact: Too many or too few alerts
   Solution: Use variables, document threshold rationale, tune regularly
   
❌ FAILURE 5: No False Positive Tracking
   Problem: Rules trigger but FP rate unknown
   Impact: Can't prioritize tuning, analyst frustration
   Solution: Track FP rate per rule, prioritize tuning queue
   
❌ FAILURE 6: Ignoring Query Performance
   Problem: Complex queries with long execution times
   Impact: Delayed detection, resource exhaustion
   Solution: Optimize queries, use appropriate scheduling
   
❌ FAILURE 7: Missing MITRE Mapping
   Problem: Rules without ATT&CK mapping
   Impact: Can't measure coverage, can't prioritize gaps
   Solution: Map every rule to tactics/techniques
   
❌ FAILURE 8: No Rule Lifecycle Management
   Problem: Rules enabled and forgotten
   Impact: Stale detections, drift from threat landscape
   Solution: Quarterly review cycle, ownership assignment
   
❌ FAILURE 9: Duplicate Detection Logic
   Problem: Multiple rules detecting same thing
   Impact: Duplicate incidents, confusion, maintenance burden
   Solution: Consolidate overlapping rules, document coverage
   
❌ FAILURE 10: Not Testing Before Production
   Problem: Rules deployed directly to production
   Impact: Unexpected alert storms, broken queries
   Solution: Dev workspace testing, staged rollout</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What are the main analytics rule types in Sentinel?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Scheduled:</strong> Custom KQL queries on configurable schedule</li>
                                <li><strong>NRT:</strong> Near real-time (1 min), simple queries only</li>
                                <li><strong>Microsoft Security:</strong> Imports M365 Defender alerts</li>
                                <li><strong>Fusion:</strong> ML-based multi-stage attack detection</li>
                                <li><strong>Anomaly:</strong> Behavior baseline deviations</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is entity mapping and why is it important?</button>
                        <div class="qa-answer">
                            <p><strong>Entity mapping</strong> links query fields to Sentinel entity types (Account, Host, IP, etc.):</p>
                            <ul>
                                <li>Enables investigation graph visualization</li>
                                <li>Allows entity behavior analytics</li>
                                <li>Powers alert grouping by entity</li>
                                <li>Enriches incidents with entity context</li>
                            </ul>
                            <p>Map key fields like username, hostname, IP to appropriate entity types.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: When would you use NRT vs Scheduled rules?</button>
                        <div class="qa-answer">
                            <p><strong>NRT Rules:</strong></p>
                            <ul>
                                <li>Critical, time-sensitive detections</li>
                                <li>Simple filtering (no aggregations)</li>
                                <li>Need ~1 minute detection latency</li>
                            </ul>
                            <p><strong>Scheduled Rules:</strong></p>
                            <ul>
                                <li>Complex queries with joins, aggregations</li>
                                <li>Threshold-based detections</li>
                                <li>Flexible scheduling needs</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you tune a rule with high false positives?</button>
                        <div class="qa-answer">
                            <p>I follow a systematic tuning methodology:</p>
                            <ol>
                                <li><strong>Analyze FP patterns:</strong> Query closed incidents with FalsePositive classification, identify common characteristics</li>
                                <li><strong>Categorize exclusions:</strong>
                                    <ul>
                                        <li>Known-good users (service accounts, admins)</li>
                                        <li>Known-good IPs (internal infrastructure, vendors)</li>
                                        <li>Known-good processes (legitimate tools)</li>
                                        <li>Scheduled activities (maintenance windows)</li>
                                    </ul>
                                </li>
                                <li><strong>Implement exclusions:</strong> Use allowlists (external data or inline), add filters to query</li>
                                <li><strong>Adjust thresholds:</strong> Increase if too sensitive, consider time-based thresholds</li>
                                <li><strong>Document changes:</strong> Record what was excluded and why</li>
                                <li><strong>Monitor impact:</strong> Track FP rate after tuning to validate improvement</li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Key principle:</strong> Never exclude blindly - understand why something is a false positive before excluding it.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk me through creating a detection rule from scratch.</button>
                        <div class="qa-answer">
                            <p>I follow a detection engineering workflow:</p>
                            <ol>
                                <li><strong>Define the threat:</strong> What attack technique am I detecting? Map to MITRE ATT&CK.</li>
                                <li><strong>Identify data sources:</strong> What logs contain evidence of this activity? Ensure connectors are configured.</li>
                                <li><strong>Research the technique:</strong> How does the attack manifest? What are the indicators?</li>
                                <li><strong>Write the KQL query:</strong>
                                    <ul>
                                        <li>Start broad, narrow down</li>
                                        <li>Filter on time first for performance</li>
                                        <li>Add threshold logic</li>
                                        <li>Test against historical data</li>
                                    </ul>
                                </li>
                                <li><strong>Configure entity mapping:</strong> Map relevant fields to Account, Host, IP, etc.</li>
                                <li><strong>Set custom details:</strong> Include context fields for triage</li>
                                <li><strong>Configure scheduling:</strong> Frequency based on detection urgency, lookup period with overlap</li>
                                <li><strong>Set grouping:</strong> Group alerts into incidents appropriately</li>
                                <li><strong>Test in dev environment:</strong> Validate with sample malicious data</li>
                                <li><strong>Deploy and monitor:</strong> Enable in production, track FP rate</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you measure detection coverage and identify gaps?</button>
                        <div class="qa-answer">
                            <p>I approach coverage measurement systematically:</p>
                            <ol>
                                <li><strong>Map existing rules to MITRE:</strong>
                                    <ul>
                                        <li>Extract MITRE tags from all analytics rules</li>
                                        <li>Create coverage matrix by tactic/technique</li>
                                        <li>Visualize in workbook heatmap</li>
                                    </ul>
                                </li>
                                <li><strong>Prioritize relevant techniques:</strong>
                                    <ul>
                                        <li>Not all 200+ techniques are relevant</li>
                                        <li>Focus on techniques used against your industry</li>
                                        <li>Consider your technology stack (cloud vs. on-prem)</li>
                                    </ul>
                                </li>
                                <li><strong>Identify gaps:</strong> Compare coverage to prioritized techniques, flag missing detections</li>
                                <li><strong>Assess data source availability:</strong> Some gaps may be due to missing logs, not missing rules</li>
                                <li><strong>Build roadmap:</strong> Prioritize gap closure based on risk and feasibility</li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Metrics I track:</strong> % of prioritized techniques covered, detection-per-technique depth, data source coverage per technique</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle alert grouping to reduce incident volume?</button>
                        <div class="qa-answer">
                            <p>Alert grouping is critical for incident management scalability:</p>
                            <p><strong>Grouping strategies:</strong></p>
                            <ul>
                                <li><strong>By entity (most common):</strong> Group all alerts for same user or host within time window - tracks attack against single target</li>
                                <li><strong>By entity combination:</strong> Group by User + Host to track attack chain on specific system</li>
                                <li><strong>By source:</strong> Group by attacker IP to track campaign activity</li>
                                <li><strong>By rule:</strong> Group alerts from same rule - useful for correlation rules</li>
                            </ul>
                            <p><strong>Time window selection:</strong></p>
                            <ul>
                                <li>Short (1-4 hours): For active attacks requiring immediate response</li>
                                <li>Medium (4-24 hours): For related activities within a session</li>
                                <li>Long (24+ hours): For slow-moving threats or compliance</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Best practice:</strong> Enable "Re-open closed matching incidents" to avoid duplicate incidents for ongoing activity.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Describe your approach to detection engineering in an enterprise environment.</button>
                        <div class="qa-answer">
                            <p><strong>My detection engineering framework:</strong></p>
                            <ol>
                                <li><strong>Threat intelligence driven:</strong>
                                    <ul>
                                        <li>Monitor threat reports for relevant TTPs</li>
                                        <li>Prioritize detections based on active threats to industry</li>
                                        <li>Subscribe to vendor threat intel feeds</li>
                                    </ul>
                                </li>
                                <li><strong>Gap analysis:</strong>
                                    <ul>
                                        <li>Maintain MITRE coverage matrix</li>
                                        <li>Identify high-priority uncovered techniques</li>
                                        <li>Assess data source availability for gap closure</li>
                                    </ul>
                                </li>
                                <li><strong>Development process:</strong>
                                    <ul>
                                        <li>Use case documentation template</li>
                                        <li>Peer review of detection logic</li>
                                        <li>Testing with attack simulation</li>
                                        <li>Staged deployment (dev → pilot → prod)</li>
                                    </ul>
                                </li>
                                <li><strong>Continuous improvement:</strong>
                                    <ul>
                                        <li>Track FP rate per rule</li>
                                        <li>Quarterly rule review cycle</li>
                                        <li>Post-incident detection gap analysis</li>
                                    </ul>
                                </li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Metrics:</strong> Detection coverage %, FP rate, Mean time to detection, Rules per engineer</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you decide between NRT and Scheduled rules?</button>
                        <div class="qa-answer">
                            <p><strong>Decision factors:</strong></p>
                            <table class="styled-table">
                                <thead>
                                    <tr><th>Factor</th><th>NRT Rule</th><th>Scheduled Rule</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Detection latency</td><td>~1 minute</td><td>5 min - 14 days</td></tr>
                                    <tr><td>Query complexity</td><td>Simple filters only</td><td>Full KQL (joins, aggregations)</td></tr>
                                    <tr><td>Threshold logic</td><td>Not supported</td><td>Fully supported</td></tr>
                                    <tr><td>Cost</td><td>Higher (runs every minute)</td><td>Lower (configurable)</td></tr>
                                    <tr><td>Table support</td><td>Limited subset</td><td>All tables</td></tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px;"><strong>Use NRT when:</strong> Critical single-event detections (admin account usage, known malware hash, policy violation)</p>
                            <p><strong>Use Scheduled when:</strong> Pattern-based detection (brute force threshold), correlation across events, complex logic</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>