<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RBAC & Permissions | Microsoft Sentinel</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
            <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="content-hub.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Content Hub</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-connectors.html" class="sidebar-nav-link"><i class="fas fa-plug"></i><span>Data Connectors</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="dcr-dce-guide.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>DCR & DCE Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="event-hub.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Event Hub Integration</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-filter"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention & Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="kql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>KQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>KQL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>KQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="workbooks.html" class="sidebar-nav-link"><i class="fas fa-chart-bar"></i><span>Workbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="notebooks.html" class="sidebar-nav-link"><i class="fas fa-book-open"></i><span>Notebooks</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="analytics-rules.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Analytics Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="watchlists.html" class="sidebar-nav-link"><i class="fas fa-list-check"></i><span>Watchlists</span></a></li>
                    <li class="sidebar-nav-item"><a href="ueba.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                    <li class="sidebar-nav-item"><a href="hunting.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Hunting</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>Automation & Playbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-operations.html" class="sidebar-nav-link"><i class="fas fa-headset"></i><span>SOC Operations</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>RBAC & Permissions</span></a></li>
                    <li class="sidebar-nav-item"><a href="config-reference.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Configuration Reference</span></a></li>
                    <li class="sidebar-nav-item"><a href="devops.html" class="sidebar-nav-link"><i class="fas fa-code-branch"></i><span>Sentinel as Code</span></a></li>
                    <li class="sidebar-nav-item"><a href="advanced-operations.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>Advanced Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Sentinel</a>
                    <span class="separator">/</span>
                    <span class="current">RBAC & Permissions</span>
                </div>

                <h1><i class="fas fa-user-shield"></i> RBAC & Permissions</h1>
                <p class="lead">Master Microsoft Sentinel role-based access control. Learn built-in roles, custom roles, table-level RBAC, resource-context permissions, and multi-tenant access patterns.</p>

                <!-- RBAC Overview -->
                <h2><i class="fas fa-info-circle"></i> RBAC Overview</h2>
                <div class="config-section">
                    <div class="arch-diagram">SENTINEL RBAC FUNDAMENTALS
═══════════════════════════════════════════════════════════════════

RBAC LAYERS IN SENTINEL:
├── Azure RBAC (Subscription/Resource Group level)
│   └── Controls access to Sentinel workspace resource
├── Workspace-context RBAC
│   └── Controls what users can do in Sentinel
├── Resource-context RBAC
│   └── Controls access based on data source ownership
└── Table-level RBAC
    └── Controls access to specific data tables

KEY CONCEPTS:
├── Scope: Where the role is assigned (subscription/RG/resource)
├── Role: Set of permissions (built-in or custom)
├── Principal: Who gets the role (user/group/service principal)
└── Assignment: The binding of role to principal at scope

PERMISSION TYPES:
├── Data plane: Read/write log data (queries, incidents)
├── Control plane: Manage Sentinel configuration (rules, connectors)
└── Both: Most roles combine data + control plane access

PRINCIPLE OF LEAST PRIVILEGE:
┌─────────────────────────────────────────────────────────────────┐
│  Give users the MINIMUM permissions needed for their job        │
│                                                                  │
│  Tier 1 Analyst: Reader + limited responder                    │
│  Tier 2 Analyst: Reader + full responder                       │
│  Tier 3 / Hunt: Contributor (can create/modify rules)         │
│  SOC Manager: Contributor + reader on cost data                │
│  SIEM Admin: Contributor + workspace admin                     │
└─────────────────────────────────────────────────────────────────┘</div>
                </div>

                <!-- Built-in Roles -->
                <h2><i class="fas fa-id-badge"></i> Built-in Sentinel Roles</h2>
                <div class="config-section">
                    <h4>Sentinel-Specific Roles</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Role</th><th>Description</th><th>Key Permissions</th><th>Use For</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Microsoft Sentinel Reader</strong></td>
                                <td>View Sentinel data and configuration</td>
                                <td>View incidents, workbooks, rules, data</td>
                                <td>Tier 1 analysts, auditors, stakeholders</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Sentinel Responder</strong></td>
                                <td>Manage incidents (includes Reader)</td>
                                <td>Update/close incidents, run playbooks on incidents</td>
                                <td>SOC analysts who handle incidents</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Sentinel Contributor</strong></td>
                                <td>Full Sentinel management (includes Responder)</td>
                                <td>Create/edit rules, workbooks, playbooks, connectors</td>
                                <td>Detection engineers, Sentinel admins</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Sentinel Playbook Operator</strong></td>
                                <td>Run playbooks manually</td>
                                <td>Trigger playbooks, view playbook runs</td>
                                <td>Analysts who need to run specific playbooks</td>
                            </tr>
                            <tr>
                                <td><strong>Microsoft Sentinel Automation Contributor</strong></td>
                                <td>Add playbooks to automation rules</td>
                                <td>Attach playbooks to rules (not create playbooks)</td>
                                <td>Rule creators who attach existing playbooks</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Workspace Roles (Log Analytics)</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Role</th><th>Description</th><th>Sentinel Impact</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Log Analytics Reader</strong></td>
                                <td>View workspace data and settings</td>
                                <td>Query logs, view saved searches</td>
                            </tr>
                            <tr>
                                <td><strong>Log Analytics Contributor</strong></td>
                                <td>Manage workspace settings</td>
                                <td>Configure data collection, retention, tables</td>
                            </tr>
                            <tr>
                                <td><strong>Monitoring Metrics Publisher</strong></td>
                                <td>Publish metrics</td>
                                <td>Needed for custom metrics ingestion</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Role Permissions Matrix</h4>
                    <div class="arch-diagram">SENTINEL PERMISSIONS MATRIX
═══════════════════════════════════════════════════════════════════

                              Reader  Responder  Contributor  Playbook Op
                              ──────  ─────────  ───────────  ───────────
View incidents                  ✓        ✓           ✓            -
Update/close incidents          -        ✓           ✓            -
Run playbooks on incidents      -        ✓           ✓            ✓
View analytics rules            ✓        ✓           ✓            -
Create/edit analytics rules     -        -           ✓            -
View workbooks                  ✓        ✓           ✓            -
Create/edit workbooks           -        -           ✓            -
View hunting queries            ✓        ✓           ✓            -
Create/edit hunting queries     -        -           ✓            -
View data connectors            ✓        ✓           ✓            -
Configure data connectors       -        -           ✓            -
View watchlists                 ✓        ✓           ✓            -
Create/edit watchlists          -        -           ✓            -
Query log data                  ✓        ✓           ✓            -
View threat intel               ✓        ✓           ✓            -
Add threat intel indicators     -        -           ✓            -

ADDITIONAL ROLES NEEDED:
├── Logic App Contributor: Create/edit playbooks
├── Key Vault Secrets User: Access secrets in playbooks
└── Managed Identity Operator: Assign managed identity to playbooks</div>
                </div>

                <!-- Role Assignment Patterns -->
                <h2><i class="fas fa-users-cog"></i> Enterprise Role Assignment Patterns</h2>
                <div class="config-section">
                    <div class="arch-diagram">ENTERPRISE SOC ROLE ASSIGNMENT
═══════════════════════════════════════════════════════════════════

TIER 1 ANALYST (Junior SOC):
├── Microsoft Sentinel Reader
├── Microsoft Sentinel Responder
├── Log Analytics Reader
└── Scope: Sentinel resource group
Purpose: Triage incidents, basic investigation, escalate

TIER 2 ANALYST (Senior SOC):
├── Microsoft Sentinel Reader
├── Microsoft Sentinel Responder
├── Microsoft Sentinel Playbook Operator
├── Log Analytics Reader
└── Scope: Sentinel resource group
Purpose: Deep investigation, run playbooks, handle complex incidents

TIER 3 / THREAT HUNTER:
├── Microsoft Sentinel Contributor
├── Log Analytics Contributor
└── Scope: Sentinel resource group
Purpose: Create hunting queries, develop detections, threat research

DETECTION ENGINEER:
├── Microsoft Sentinel Contributor
├── Microsoft Sentinel Automation Contributor
├── Log Analytics Contributor
└── Scope: Sentinel resource group
Purpose: Create/tune analytics rules, manage automation

SIEM ADMINISTRATOR:
├── Microsoft Sentinel Contributor
├── Log Analytics Contributor
├── Logic App Contributor
├── Key Vault Administrator (for secrets)
└── Scope: Sentinel resource group + Logic Apps RG
Purpose: Full Sentinel management, playbook development

SOC MANAGER:
├── Microsoft Sentinel Reader
├── Cost Management Reader
├── Scope: Subscription (for cost visibility)
Purpose: Monitor operations, cost oversight, reporting

MSSP / EXTERNAL SOC:
├── Microsoft Sentinel Reader
├── Microsoft Sentinel Responder
├── Scope: Via Azure Lighthouse delegation
Purpose: External team incident handling with limited access</div>

                    <h4>Assignment via Azure Portal</h4>
                    <div class="arch-diagram">ROLE ASSIGNMENT STEPS
═══════════════════════════════════════════════════════════════════

PORTAL METHOD:
1. Navigate to: Resource Group containing Sentinel workspace
2. Click: Access control (IAM)
3. Click: + Add → Add role assignment
4. Select role: Microsoft Sentinel Responder
5. Select members: Choose user/group
6. Review + assign

CLI METHOD:
az role assignment create \
  --assignee "user@company.com" \
  --role "Microsoft Sentinel Responder" \
  --scope "/subscriptions/{sub-id}/resourceGroups/{rg-name}"

POWERSHELL METHOD:
New-AzRoleAssignment `
  -SignInName "user@company.com" `
  -RoleDefinitionName "Microsoft Sentinel Responder" `
  -ResourceGroupName "sentinel-rg"

BEST PRACTICES:
├── Assign to groups, not individuals
├── Use Azure AD groups synced from on-prem
├── Create groups per role (SG-Sentinel-Tier1, SG-Sentinel-Tier2)
├── Document all role assignments
└── Review assignments quarterly</div>
                </div>

                <!-- Resource-Context RBAC -->
                <h2><i class="fas fa-sitemap"></i> Resource-Context RBAC</h2>
                <div class="config-section">
                    <div class="arch-diagram">RESOURCE-CONTEXT RBAC EXPLAINED
═══════════════════════════════════════════════════════════════════

WHAT IS RESOURCE-CONTEXT?
├── Access control based on Azure resource ownership
├── Users see only data from resources they have access to
├── Alternative to workspace-level access
└── Useful for: App teams viewing their own logs

HOW IT WORKS:
┌─────────────────────────────────────────────────────────────────┐
│                     Sentinel Workspace                           │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐ │
│  │   VM Logs       │  │  App Logs       │  │  Network Logs   │ │
│  │   (Team A)      │  │  (Team B)       │  │  (Team C)       │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘ │
│                                                                  │
│  Team A: Reader on VM resource → sees only VM logs              │
│  Team B: Reader on App resource → sees only App logs            │
│  SOC: Reader on Workspace → sees all logs                       │
└─────────────────────────────────────────────────────────────────┘

ENABLING RESOURCE-CONTEXT:
1. Workspace access control mode: "Use resource or workspace permissions"
2. Assign roles on individual resources (VMs, storage accounts, etc.)
3. Users query through resource blade or resource-scoped queries

CONFIGURATION:
// Azure Portal
Workspace → Properties → Access control mode
Select: "Use resource or workspace permissions"

// ARM Template
{
  "properties": {
    "features": {
      "enableLogAccessUsingOnlyResourcePermissions": true
    }
  }
}

USE CASES:
├── App teams need access to their application logs
├── DevOps teams need access to their infrastructure logs
├── Compliance teams need access to specific audit logs
└── Business units need access to their own data only</div>
                </div>

                <!-- Table-Level RBAC -->
                <h2><i class="fas fa-table"></i> Table-Level RBAC</h2>
                <div class="config-section">
                    <div class="arch-diagram">TABLE-LEVEL ACCESS CONTROL
═══════════════════════════════════════════════════════════════════

WHAT IS TABLE-LEVEL RBAC?
├── Restrict access to specific tables in workspace
├── Some users can query SigninLogs but not SecurityEvent
├── Granular data segregation within shared workspace
└── Implemented via custom roles

CREATING TABLE-RESTRICTED CUSTOM ROLE:
{
  "Name": "Sentinel Analyst - Identity Only",
  "Description": "Access to identity-related tables only",
  "Actions": [
    "Microsoft.OperationalInsights/workspaces/read",
    "Microsoft.SecurityInsights/incidents/read",
    "Microsoft.SecurityInsights/incidents/write"
  ],
  "DataActions": [
    "Microsoft.OperationalInsights/workspaces/tables/SigninLogs/read",
    "Microsoft.OperationalInsights/workspaces/tables/AADNonInteractiveUserSignInLogs/read",
    "Microsoft.OperationalInsights/workspaces/tables/AuditLogs/read",
    "Microsoft.OperationalInsights/workspaces/tables/IdentityInfo/read"
  ],
  "NotDataActions": [],
  "AssignableScopes": [
    "/subscriptions/{subscription-id}"
  ]
}

COMMON TABLE GROUPINGS:
├── Identity tables: SigninLogs, AuditLogs, AAD*, IdentityInfo
├── Endpoint tables: SecurityEvent, DeviceEvents, DeviceProcessEvents
├── Network tables: CommonSecurityLog, Syslog, AzureNetworkAnalytics
├── Cloud tables: AzureActivity, AzureDiagnostics
└── Sentinel tables: SecurityIncident, SecurityAlert, BehaviorAnalytics

DEPLOYMENT:
// Create custom role
az role definition create --role-definition @identity-analyst-role.json

// Assign to user
az role assignment create \
  --assignee "identity-analyst@company.com" \
  --role "Sentinel Analyst - Identity Only" \
  --scope "/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.OperationalInsights/workspaces/{workspace}"</div>

                    <h4>Custom Role Examples</h4>
                    <div class="arch-diagram">CUSTOM ROLE EXAMPLES
═══════════════════════════════════════════════════════════════════

ROLE: INCIDENT VIEWER ONLY (No Log Access)
Purpose: View incidents without querying underlying data
{
  "Actions": [
    "Microsoft.SecurityInsights/incidents/read",
    "Microsoft.SecurityInsights/incidents/comments/read"
  ],
  "NotActions": [],
  "DataActions": [],  // No log query access
  "NotDataActions": []
}

ROLE: THREAT INTEL MANAGER
Purpose: Manage threat intelligence only
{
  "Actions": [
    "Microsoft.SecurityInsights/threatIntelligence/read",
    "Microsoft.SecurityInsights/threatIntelligence/write",
    "Microsoft.SecurityInsights/threatIntelligence/delete",
    "Microsoft.OperationalInsights/workspaces/read"
  ],
  "DataActions": [
    "Microsoft.OperationalInsights/workspaces/tables/ThreatIntelligenceIndicator/read"
  ]
}

ROLE: WORKBOOK DEVELOPER
Purpose: Create workbooks without full Sentinel access
{
  "Actions": [
    "Microsoft.Insights/workbooks/read",
    "Microsoft.Insights/workbooks/write",
    "Microsoft.OperationalInsights/workspaces/read"
  ],
  "DataActions": [
    "Microsoft.OperationalInsights/workspaces/query/*/read"  // All tables for queries
  ]
}

ROLE: READ-ONLY SECURITY AUDITOR
Purpose: Audit Sentinel configuration, no incident handling
{
  "Actions": [
    "Microsoft.SecurityInsights/*/read",
    "Microsoft.OperationalInsights/workspaces/read"
  ],
  "NotActions": [
    "Microsoft.SecurityInsights/incidents/write"  // Cannot modify incidents
  ],
  "DataActions": [
    "Microsoft.OperationalInsights/workspaces/query/*/read"
  ]
}</div>
                </div>

                <!-- Multi-Tenant & Lighthouse -->
                <h2><i class="fas fa-building"></i> Multi-Tenant & Azure Lighthouse</h2>
                <div class="config-section">
                    <div class="arch-diagram">AZURE LIGHTHOUSE FOR MULTI-TENANT SENTINEL
═══════════════════════════════════════════════════════════════════

WHAT IS AZURE LIGHTHOUSE?
├── Cross-tenant management capability
├── Manage customer Sentinel from your own tenant
├── No tenant switching required
├── Used by MSSPs and central SOC teams
└── Delegated access with specific role assignments

ARCHITECTURE:
┌─────────────────────────────────────────────────────────────────┐
│                    MANAGING TENANT (MSSP)                        │
│                                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  SOC Analyst │  │  SOC Analyst │  │ Threat Hunter│          │
│  │    (Tier 1)  │  │    (Tier 2)  │  │   (Tier 3)   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
         │                   │                    │
         └──────────Azure Lighthouse──────────────┘
                            │
    ┌───────────────────────┼───────────────────────┐
    ▼                       ▼                       ▼
┌─────────┐           ┌─────────┐           ┌─────────┐
│Customer │           │Customer │           │Customer │
│Tenant A │           │Tenant B │           │Tenant C │
│Sentinel │           │Sentinel │           │Sentinel │
└─────────┘           └─────────┘           └─────────┘

DELEGATION TEMPLATE:
{
  "principalId": "MSSP-SOC-Group-ObjectId",
  "principalIdDisplayName": "MSSP SOC Team",
  "roleDefinitionId": "Microsoft Sentinel Responder",
  "delegatedRoleDefinitionIds": []
}

CROSS-TENANT QUERIES:
// Query multiple customer workspaces
union 
  workspace('customer-a-workspace').SecurityIncident,
  workspace('customer-b-workspace').SecurityIncident,
  workspace('customer-c-workspace').SecurityIncident
| where Status == "New"
| summarize OpenIncidents = count() by TenantId</div>

                    <h4>Lighthouse Setup</h4>
                    <div class="arch-diagram">LIGHTHOUSE ONBOARDING STEPS
═══════════════════════════════════════════════════════════════════

STEP 1: CREATE DELEGATION TEMPLATE
// In managing tenant, create ARM template
{
  "mspOfferName": "MSSP Security Services",
  "mspOfferDescription": "Managed SOC services",
  "managedByTenantId": "{MSSP-tenant-id}",
  "authorizations": [
    {
      "principalId": "{SOC-Tier1-Group-Id}",
      "principalIdDisplayName": "SOC Tier 1 Analysts",
      "roleDefinitionId": "ab8e14d6-4a74-4a29-9ba8-549422addade"  // Sentinel Responder
    },
    {
      "principalId": "{SOC-Tier2-Group-Id}",
      "principalIdDisplayName": "SOC Tier 2 Analysts",
      "roleDefinitionId": "ab8e14d6-4a74-4a29-9ba8-549422addade"  // Sentinel Responder
    },
    {
      "principalId": "{Detection-Engineer-Group-Id}",
      "principalIdDisplayName": "Detection Engineers",
      "roleDefinitionId": "ab8e14d6-4a74-4a29-9ba8-549422addadf"  // Sentinel Contributor
    }
  ]
}

STEP 2: CUSTOMER DEPLOYS TEMPLATE
// In customer tenant
az deployment create \
  --location eastus \
  --template-file mssp-delegation.json \
  --parameters rgName=sentinel-rg

STEP 3: VERIFY DELEGATION
// In MSSP tenant, check delegated resources
az managedservices assignment list

BEST PRACTICES:
├── Use groups, not individual users in delegations
├── Assign minimum necessary roles
├── Document all delegations
├── Regular access review
└── Use separate groups per customer if needed</div>
                </div>

                <!-- Common Failures -->
                <h2><i class="fas fa-exclamation-triangle"></i> What Enterprises Usually Miss</h2>
                <div class="config-section">
                    <div class="arch-diagram">COMMON RBAC FAILURES AND SOLUTIONS
═══════════════════════════════════════════════════════════════════

❌ FAILURE 1: Everyone is Contributor
   Problem: All analysts have full Sentinel Contributor
   Impact: Accidental rule changes, no separation of duties
   Solution: Use Reader/Responder for most, Contributor for few

❌ FAILURE 2: Assigning to Users Not Groups
   Problem: Role assigned directly to user accounts
   Impact: Orphaned assignments, hard to audit, hard to manage
   Solution: Always assign to Azure AD security groups

❌ FAILURE 3: Ignoring Scope
   Problem: Subscription-level assignments when RG is sufficient
   Impact: Over-provisioned access
   Solution: Assign at narrowest scope (resource group)

❌ FAILURE 4: Forgetting Playbook Permissions
   Problem: Analyst can run playbook in Sentinel but playbook fails
   Impact: Playbook doesn't execute, no enrichment/response
   Solution: Grant managed identity permissions to target resources

❌ FAILURE 5: No Access Reviews
   Problem: Permissions granted but never reviewed
   Impact: Accumulated excess access over time
   Solution: Quarterly access reviews, use Azure AD access reviews

❌ FAILURE 6: Missing Log Analytics Role
   Problem: Sentinel role assigned but not Log Analytics Reader
   Impact: Cannot query log data
   Solution: Pair Sentinel roles with appropriate LA roles

❌ FAILURE 7: Shared Accounts
   Problem: Team shares a single analyst account
   Impact: No accountability, audit trail broken
   Solution: Individual accounts with group-based roles

❌ FAILURE 8: No Break-Glass Account
   Problem: All admins locked out (MFA issue, etc.)
   Impact: Cannot manage Sentinel during emergency
   Solution: Cloud-only emergency access account with Contributor

❌ FAILURE 9: Ignoring Resource-Context RBAC
   Problem: All data visible to all users
   Impact: Compliance issues, data exposure
   Solution: Enable resource-context for segregated access

❌ FAILURE 10: No Custom Roles for Special Cases
   Problem: Built-in roles don't fit specific needs
   Impact: Over-granting access to compensate
   Solution: Create custom roles for unique requirements</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What Sentinel roles would you assign to a Tier 1 SOC analyst?</button>
                        <div class="qa-answer">
                            <p><strong>Tier 1 Analyst roles:</strong></p>
                            <ul>
                                <li><strong>Microsoft Sentinel Reader:</strong> View incidents, rules, workbooks</li>
                                <li><strong>Microsoft Sentinel Responder:</strong> Update and close incidents</li>
                                <li><strong>Log Analytics Reader:</strong> Query log data for investigation</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Why not Contributor?</strong> Tier 1 should focus on incident handling, not configuration changes. Separation of duties prevents accidental rule modifications.</p>
                            <p style="margin-top: 12px;"><strong>Scope:</strong> Assign at resource group level containing Sentinel workspace.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you restrict analysts to only see specific tables?</button>
                        <div class="qa-answer">
                            <p><strong>Table-level RBAC implementation:</strong></p>
                            <ol>
                                <li><strong>Create custom role</strong> with specific DataActions for allowed tables:
                                    <div class="arch-diagram" style="margin: 10px 0;">"DataActions": [
    "Microsoft.OperationalInsights/workspaces/tables/SigninLogs/read",
    "Microsoft.OperationalInsights/workspaces/tables/AuditLogs/read"
]</div>
                                </li>
                                <li><strong>Do NOT include</strong> wildcard DataActions like <code>*/query/read</code></li>
                                <li><strong>Assign custom role</strong> to user/group at workspace scope</li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Use case:</strong> Identity team only sees AAD logs, not endpoint security events.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain Azure Lighthouse for Sentinel multi-tenant management.</button>
                        <div class="qa-answer">
                            <p><strong>Azure Lighthouse</strong> enables cross-tenant management without switching tenants.</p>
                            <p style="margin-top: 12px;"><strong>How it works:</strong></p>
                            <ul>
                                <li>Customer delegates their Sentinel workspace to managing tenant</li>
                                <li>MSSP users see delegated resources in their own Azure portal</li>
                                <li>Role assignments determine what MSSP can do</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Benefits:</strong></p>
                            <ul>
                                <li>Single pane of glass for multiple customers</li>
                                <li>Cross-workspace queries for correlation</li>
                                <li>No credential sharing with customers</li>
                                <li>Granular, revocable access</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between workspace-context and resource-context RBAC?</button>
                        <div class="qa-answer">
                            <table class="styled-table">
                                <thead>
                                    <tr><th>Aspect</th><th>Workspace-Context</th><th>Resource-Context</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Access scope</td><td>All data in workspace</td><td>Only data from owned resources</td></tr>
                                    <tr><td>Permission source</td><td>Workspace role assignment</td><td>Resource role assignment</td></tr>
                                    <tr><td>Use case</td><td>SOC team sees everything</td><td>App team sees only their logs</td></tr>
                                    <tr><td>Configuration</td><td>Default mode</td><td>Enable in workspace properties</td></tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px;"><strong>When to use resource-context:</strong> When non-SOC teams need access to their own telemetry without seeing other teams' data.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you ensure playbooks have proper permissions?</button>
                        <div class="qa-answer">
                            <p><strong>Playbook permission requirements:</strong></p>
                            <ol>
                                <li><strong>Managed Identity:</strong> Enable system-assigned managed identity on Logic App</li>
                                <li><strong>Sentinel access:</strong> Grant "Microsoft Sentinel Responder" to managed identity on Sentinel workspace</li>
                                <li><strong>Target resources:</strong> Grant permissions to resources playbook interacts with:
                                    <ul>
                                        <li>Azure AD: Directory.Read.All for user lookups</li>
                                        <li>MDE: Machine.Isolate for isolation actions</li>
                                        <li>Key Vault: Secrets User for API keys</li>
                                    </ul>
                                </li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Common mistake:</strong> Analyst has "run playbook" permission but playbook's managed identity lacks permissions → playbook fails silently.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>
