<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation | Sentinel | Nik's SIEM Compendium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
                <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Sentinel Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-connectors.html" class="nav-link"><i class="fas fa-plug"></i> Data Connectors</a>
                    <a href="dcr-dce-guide.html" class="nav-link"><i class="fas fa-cogs"></i> DCR & DCE Guide</a>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Ingestion Patterns</a>
                    <a href="event-hub.html" class="nav-link"><i class="fas fa-broadcast-tower"></i> Event Hub</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & Transform</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">KQL Query Language</div>
                    <a href="kql-fundamentals.html" class="nav-link"><i class="fas fa-terminal"></i> KQL Fundamentals</a>
                    <a href="kql-intermediate.html" class="nav-link"><i class="fas fa-layer-group"></i> KQL Intermediate</a>
                    <a href="kql-advanced.html" class="nav-link"><i class="fas fa-code"></i> KQL Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection & Response</div>
                    <a href="analytics-rules.html" class="nav-link"><i class="fas fa-project-diagram"></i> Analytics Rules</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-skull-crossbones"></i> Threat Intelligence</a>
                    <a href="automation.html" class="nav-link active"><i class="fas fa-robot"></i> Automation (Playbooks)</a>
                    <a href="content-hub.html" class="nav-link"><i class="fas fa-store"></i> Content Hub</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="workbooks.html" class="nav-link"><i class="fas fa-chart-bar"></i> Workbooks</a>
                    <a href="soc-operations.html" class="nav-link"><i class="fas fa-users"></i> SOC Operations</a>
                    <a href="enterprise-scenarios.html" class="nav-link"><i class="fas fa-building"></i> Enterprise Scenarios</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Sentinel</a><span class="separator">/</span>
                    <span class="current">Automation</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-robot"></i> Sentinel Automation</h1>
                <p class="lead">Microsoft Sentinel provides two automation mechanisms: Automation Rules for simple actions and Playbooks (Logic Apps) for complex workflows. Master both to build an efficient SOC.</p>

                <!-- AUTOMATION TYPES -->
                <h2><i class="fas fa-route"></i> Choosing the Right Automation</h2>
                
                <div class="decision-tree">
                    <div class="decision-node">
                        <div class="decision-node-question">What type of automation do you need?</div>
                    </div>
                    <div class="decision-paths">
                        <div class="decision-path">
                            <div class="decision-path-label yes">Simple Actions (No External Systems)</div>
                            <div class="decision-path-content">
                                <p style="color: #3fb950; font-weight: 600;">→ Automation Rule</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Change severity, assign owner, add tags, suppress, close incidents. No code required.</p>
                            </div>
                        </div>
                        <div class="decision-path">
                            <div class="decision-path-label no">Complex Workflow / External Integration</div>
                            <div class="decision-path-content">
                                <p style="color: #d29922; font-weight: 600;">→ Playbook (Logic App)</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">API calls, enrichment, Teams/email, block IP, disable user. Full workflow capability.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- COMPARISON -->
                <h2><i class="fas fa-balance-scale"></i> Automation Rules vs Playbooks</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1c3a5e; color: #58a6ff;"><i class="fas fa-list-check"></i></div>
                            <div class="comparison-item-title">Automation Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Built into Sentinel (no cost)</li>
                            <li><i class="fas fa-check"></i> Simple condition → action</li>
                            <li><i class="fas fa-check"></i> Change incident properties</li>
                            <li><i class="fas fa-check"></i> Assign, tag, close incidents</li>
                            <li><i class="fas fa-check"></i> Run playbooks as action</li>
                            <li><i class="fas fa-times"></i> No external API calls</li>
                            <li><i class="fas fa-times"></i> No complex logic</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-project-diagram"></i></div>
                            <div class="comparison-item-title">Playbooks (Logic Apps)</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Full workflow capability</li>
                            <li><i class="fas fa-check"></i> 400+ connectors</li>
                            <li><i class="fas fa-check"></i> External API integration</li>
                            <li><i class="fas fa-check"></i> Conditional logic, loops</li>
                            <li><i class="fas fa-check"></i> Enrichment & response</li>
                            <li><i class="fas fa-times"></i> Logic Apps cost</li>
                            <li><i class="fas fa-times"></i> More complex to build</li>
                        </ul>
                    </div>
                </div>

                <!-- AUTOMATION RULES -->
                <h2><i class="fas fa-list-check"></i> Automation Rules</h2>

                <div class="pipeline">
                    <div class="pipeline-stage" data-step="1">
                        <div class="pipeline-stage-title">Trigger</div>
                        <div class="pipeline-stage-desc">When rule fires</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li><strong>Incident created:</strong> New incident appears</li>
                                <li><strong>Incident updated:</strong> Any change to incident</li>
                                <li><strong>Alert created:</strong> New alert (before incident)</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="2">
                        <div class="pipeline-stage-title">Conditions</div>
                        <div class="pipeline-stage-desc">Filter criteria</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Analytics rule name</li>
                                <li>Severity level</li>
                                <li>Entity types present</li>
                                <li>Custom conditions</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="3">
                        <div class="pipeline-stage-title">Actions</div>
                        <div class="pipeline-stage-desc">What to do</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Change status</li>
                                <li>Change severity</li>
                                <li>Assign owner</li>
                                <li>Add tags</li>
                                <li>Run playbook</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <h3>Common Automation Rule Examples</h3>
                <div class="styled-table">
                    <table>
                        <thead>
                            <tr><th>Use Case</th><th>Condition</th><th>Action</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Auto-assign SOC team</strong></td>
                                <td>Severity = High or Critical</td>
                                <td>Assign to SOC-Tier2 group</td>
                            </tr>
                            <tr>
                                <td><strong>Tag cloud incidents</strong></td>
                                <td>Rule name contains "Azure"</td>
                                <td>Add tag "Cloud"</td>
                            </tr>
                            <tr>
                                <td><strong>Close false positives</strong></td>
                                <td>Rule = "Known FP Pattern"</td>
                                <td>Close as False Positive</td>
                            </tr>
                            <tr>
                                <td><strong>Escalate critical</strong></td>
                                <td>Severity = Critical</td>
                                <td>Run "Notify-OnCall" playbook</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- PLAYBOOKS -->
                <h2><i class="fas fa-project-diagram"></i> Playbooks (Logic Apps)</h2>

                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-sitemap"></i> Playbook Architecture</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box"><div class="flow-box-title">Trigger</div><div class="flow-box-subtitle">Incident/Alert</div></div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box primary"><div class="flow-box-title">Get Data</div><div class="flow-box-subtitle">Entities, context</div></div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box success"><div class="flow-box-title">Enrich</div><div class="flow-box-subtitle">TI, user info</div></div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box warning"><div class="flow-box-title">Decide</div><div class="flow-box-subtitle">Condition</div></div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box danger"><div class="flow-box-title">Respond</div><div class="flow-box-subtitle">Block, notify</div></div>
                    </div>
                </div>

                <h3>Example: IP Enrichment & Block Playbook</h3>
                <div class="code-block">
                    <div class="code-header"><i class="fas fa-code"></i> Playbook Logic (Pseudo-code)</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Trigger: When Sentinel incident is created</span>
<span style="color: #79c0ff;">TRIGGER</span>: Microsoft Sentinel Incident

<span style="color: #8b949e;">// Step 1: Get incident details and entities</span>
<span style="color: #79c0ff;">ACTION</span>: Get incident
<span style="color: #79c0ff;">ACTION</span>: Entities - Get IPs

<span style="color: #8b949e;">// Step 2: For each IP entity</span>
<span style="color: #f97583;">FOR EACH</span> IP in Entities:
    
    <span style="color: #8b949e;">// Step 3: Enrich with VirusTotal</span>
    <span style="color: #79c0ff;">ACTION</span>: VirusTotal - Get IP report
    
    <span style="color: #8b949e;">// Step 4: Check if malicious</span>
    <span style="color: #f97583;">CONDITION</span>: If malicious_votes > 5
        
        <span style="color: #8b949e;">// Step 5a: Block IP in firewall</span>
        <span style="color: #79c0ff;">ACTION</span>: Azure Firewall - Add to blocklist
        
        <span style="color: #8b949e;">// Step 5b: Add comment to incident</span>
        <span style="color: #79c0ff;">ACTION</span>: Add comment - "IP blocked: {IP}"
        
        <span style="color: #8b949e;">// Step 5c: Update incident severity</span>
        <span style="color: #79c0ff;">ACTION</span>: Update incident - Severity = High

<span style="color: #8b949e;">// Step 6: Send Teams notification</span>
<span style="color: #79c0ff;">ACTION</span>: Teams - Post message to SOC channel
</pre>
                </div>

                <!-- COMMON PLAYBOOKS -->
                <h2><i class="fas fa-puzzle-piece"></i> Common Playbook Patterns</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1c3a5e; color: #58a6ff;"><i class="fas fa-search-plus"></i></div>
                            <div class="comparison-item-title">Enrichment Playbooks</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-globe"></i> VirusTotal IP/Hash lookup</li>
                            <li><i class="fas fa-globe"></i> AbuseIPDB reputation</li>
                            <li><i class="fas fa-user"></i> Azure AD user details</li>
                            <li><i class="fas fa-server"></i> Asset lookup from CMDB</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d1a1a; color: #f85149;"><i class="fas fa-shield-alt"></i></div>
                            <div class="comparison-item-title">Response Playbooks</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-ban"></i> Block IP in firewall</li>
                            <li><i class="fas fa-user-slash"></i> Disable Azure AD user</li>
                            <li><i class="fas fa-laptop"></i> Isolate endpoint (MDE)</li>
                            <li><i class="fas fa-key"></i> Revoke user sessions</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-bell"></i></div>
                            <div class="comparison-item-title">Notification Playbooks</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fab fa-microsoft"></i> Teams channel alert</li>
                            <li><i class="fas fa-envelope"></i> Email to SOC manager</li>
                            <li><i class="fas fa-ticket-alt"></i> Create ServiceNow ticket</li>
                            <li><i class="fas fa-mobile-alt"></i> PagerDuty escalation</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #3d2a5e; color: #a371f7;"><i class="fas fa-sync"></i></div>
                            <div class="comparison-item-title">Sync Playbooks</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-sync"></i> Sync to SOAR platform</li>
                            <li><i class="fas fa-sync"></i> Update CMDB</li>
                            <li><i class="fas fa-sync"></i> Bi-directional ticketing</li>
                            <li><i class="fas fa-sync"></i> Threat intel sharing</li>
                        </ul>
                    </div>
                </div>

                <!-- ENTERPRISE EXAMPLE -->
                <div class="enterprise-example">
                    <div class="enterprise-example-header">
                        <i class="fas fa-building"></i>
                        <div class="enterprise-example-title">Enterprise Example: Automation Strategy</div>
                    </div>
                    <div class="enterprise-example-scenario">
                        <strong>Scenario:</strong> Financial services SOC with 200+ daily incidents needs automation to reduce analyst workload.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px;">
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #3fb950; margin-top: 0;">Automation Rules (15)</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                • Auto-assign by severity<br>
                                • Tag by data source<br>
                                • Close known FPs (5 rules)<br>
                                • Escalate critical to Tier 2<br>
                                • Suppress noisy rules
                            </p>
                        </div>
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #58a6ff; margin-top: 0;">Playbooks (12)</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                • IP enrichment (VT, AbuseIPDB)<br>
                                • User enrichment (Azure AD)<br>
                                • Block malicious IP<br>
                                • Disable compromised user<br>
                                • Teams notification<br>
                                • ServiceNow ticket sync
                            </p>
                        </div>
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #d29922; margin-top: 0;">Results</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                • 40% incidents auto-closed<br>
                                • 100% enriched automatically<br>
                                • MTTR reduced 60%<br>
                                • 2 FTE saved<br>
                                • 24/7 response capability
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question">Q: When would you use an automation rule vs a playbook?</button>
                        <div class="qa-answer">
                            <p><strong>Use Automation Rule when:</strong></p>
                            <ul>
                                <li>Simple property changes (status, severity, owner)</li>
                                <li>Adding tags based on conditions</li>
                                <li>Auto-closing known false positives</li>
                                <li>No external system integration needed</li>
                                <li>Want zero additional cost</li>
                            </ul>
                            <p><strong>Use Playbook when:</strong></p>
                            <ul>
                                <li>Need to call external APIs (enrichment, response)</li>
                                <li>Complex conditional logic required</li>
                                <li>Integration with ticketing, SOAR, or other tools</li>
                                <li>Automated response actions (block, disable)</li>
                                <li>Custom notifications to Teams/Slack/email</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: How do you handle playbook failures?</button>
                        <div class="qa-answer">
                            <p><strong>Error handling strategies:</strong></p>
                            <ul>
                                <li><strong>Configure retry:</strong> Set retry policy for transient failures</li>
                                <li><strong>Try-catch blocks:</strong> Use Scope actions with error handling</li>
                                <li><strong>Alert on failure:</strong> Send notification if playbook fails</li>
                                <li><strong>Logging:</strong> Log key steps for troubleshooting</li>
                                <li><strong>Fallback actions:</strong> Default action if primary fails</li>
                                <li><strong>Monitor runs:</strong> Review Logic Apps run history regularly</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
            <footer class="main-footer">
                <div class="footer-content">
                    <p>Nik's SIEM Compendium</p>
                </div>
            </footer>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) {
                    answer.style.display = 'block';
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
