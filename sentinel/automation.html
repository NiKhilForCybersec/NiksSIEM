<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automation & SOAR | Sentinel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="content-hub.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Content Hub</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-connectors.html" class="sidebar-nav-link"><i class="fas fa-plug"></i><span>Data Connectors</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="dcr-dce-guide.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>DCR & DCE Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="event-hub.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Event Hub Integration</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-filter"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention & Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="kql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>KQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>KQL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>KQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="workbooks.html" class="sidebar-nav-link"><i class="fas fa-chart-bar"></i><span>Workbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="notebooks.html" class="sidebar-nav-link"><i class="fas fa-book-open"></i><span>Notebooks</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="analytics-rules.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Analytics Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="watchlists.html" class="sidebar-nav-link"><i class="fas fa-list-check"></i><span>Watchlists</span></a></li>
                    <li class="sidebar-nav-item"><a href="ueba.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                    <li class="sidebar-nav-item"><a href="hunting.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Hunting</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>Automation & Playbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-operations.html" class="sidebar-nav-link"><i class="fas fa-headset"></i><span>SOC Operations</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>RBAC & Permissions</span></a></li>
                    <li class="sidebar-nav-item"><a href="config-reference.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Configuration Reference</span></a></li>
                    <li class="sidebar-nav-item"><a href="devops.html" class="sidebar-nav-link"><i class="fas fa-code-branch"></i><span>Sentinel as Code</span></a></li>
                    <li class="sidebar-nav-item"><a href="advanced-operations.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>Advanced Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Sentinel</a>
                    <span class="separator">/</span>
                    <span class="current">Automation</span>
                </div>

                <h1><i class="fas fa-robot"></i> Automation & SOAR</h1>
                <p class="lead">Master Microsoft Sentinel automation capabilities. Learn playbooks, automation rules, Logic Apps integration, and how to build automated security response workflows.</p>

                <!-- Automation Overview -->
                <h2><i class="fas fa-info-circle"></i> Automation Overview</h2>
                <div class="config-section">
                    <h4>Sentinel SOAR Capabilities</h4>
                    <div class="arch-diagram">Sentinel Automation Components:

AUTOMATION RULES:
├── Lightweight automation
├── No-code configuration
├── Triage and routing
├── Trigger playbooks
└── Incident management

PLAYBOOKS (Logic Apps):
├── Full workflow automation
├── Complex logic and conditions
├── External system integration
├── Custom response actions
└── Azure Logic Apps powered

USE CASES:
├── Auto-enrich incidents with context
├── Block malicious IPs/domains
├── Isolate compromised endpoints
├── Send notifications (email, Teams)
├── Create tickets (ServiceNow, Jira)
├── Gather threat intelligence
└── Orchestrate multi-step responses

SOAR WORKFLOW:
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│   Alert/Incident ──▶ Automation Rule ──▶ Playbook ──▶      │
│                          │                   │              │
│                          ▼                   ▼              │
│                     Triage Actions      Response Actions    │
│                     ├── Assign owner    ├── Enrich data    │
│                     ├── Set severity    ├── Block IOC      │
│                     ├── Add tags        ├── Isolate host   │
│                     └── Close if FP     ├── Notify team    │
│                                         └── Create ticket  │
│                                                             │
└─────────────────────────────────────────────────────────────┘</div>
                </div>

                <!-- Automation Rules -->
                <h2><i class="fas fa-cogs"></i> Automation Rules</h2>
                <div class="config-section">
                    <p><span class="console-path">Sentinel → Configuration → Automation → Automation rules</span></p>

                    <h4>Automation Rule Configuration</h4>
                    <div class="arch-diagram">Automation Rule Components:

TRIGGER:
├── When incident is created
├── When incident is updated
└── When alert is created

CONDITIONS (AND logic):
├── Analytic rule name
├── Incident provider
├── Incident severity
├── Incident status
├── Incident tactics
├── Entity type present
├── Tag contains
└── Custom conditions

ACTIONS:
├── Run playbook
├── Change status
├── Change severity
├── Assign owner
├── Add tags
└── Multiple actions (sequential)

EXPIRATION:
├── No expiration (default)
├── Specific date/time
└── Useful for temporary rules

EXAMPLE RULES:

1. AUTO-ASSIGN HIGH SEVERITY:
   Trigger: Incident created
   Condition: Severity = High
   Action: Assign to security-leads@company.com

2. AUTO-CLOSE FALSE POSITIVE:
   Trigger: Incident created
   Condition: Title contains "Known Scanner"
   Action: Close as False Positive

3. TRIGGER ENRICHMENT PLAYBOOK:
   Trigger: Incident created
   Condition: Any (no filter)
   Action: Run playbook "Enrich-Incident"

4. AUTO-TAG BY TACTIC:
   Trigger: Incident created
   Condition: Tactics contains "Initial Access"
   Action: Add tag "Tier1-Priority"</div>

                    <h4>Rule Ordering</h4>
                    <div class="arch-diagram">Automation Rule Ordering:

ORDER MATTERS:
├── Rules execute in order (1, 2, 3...)
├── Set order in rule configuration
├── Lower number = higher priority
└── All matching rules execute

BEST PRACTICES:
├── Put specific rules before general
├── Put closing rules at end
├── Group by incident type
└── Document rule dependencies

EXAMPLE ORDER:
1. Close known false positives (stop processing)
2. Assign high severity to tier 2
3. Assign medium severity to tier 1
4. Run enrichment playbook (all incidents)
5. Add default tags

STOP PROCESSING:
├── Not available in automation rules
├── All matching rules will execute
├── Design rules to not conflict
└── Use conditions to prevent overlap</div>
                </div>

                <!-- Playbooks -->
                <h2><i class="fas fa-book-open"></i> Playbooks (Logic Apps)</h2>
                <div class="config-section">
                    <p><span class="console-path">Sentinel → Configuration → Automation → Playbooks</span></p>

                    <h4>Playbook Architecture</h4>
                    <div class="arch-diagram">Playbook Architecture:

WHAT IS A PLAYBOOK:
├── Azure Logic App with Sentinel connector
├── Visual workflow designer
├── Hundreds of connectors available
├── Custom HTTP actions for any API
└── Runs in your Azure subscription

TRIGGER TYPES:
├── Microsoft Sentinel Incident (most common)
├── Microsoft Sentinel Alert
├── HTTP Request (manual/API trigger)
└── Recurrence (scheduled)

CONNECTOR CATEGORIES:
├── Microsoft Security: Sentinel, Defender, Azure AD
├── Productivity: Teams, Outlook, SharePoint
├── ITSM: ServiceNow, Jira, Zendesk
├── Threat Intel: VirusTotal, AbuseIPDB, OTX
├── Infrastructure: Azure, AWS, custom APIs
└── Communication: Slack, PagerDuty, Twilio

MANAGED IDENTITY:
├── System-assigned (recommended)
├── No credentials to manage
├── RBAC for Sentinel access
├── Required role: Sentinel Responder
└── Configure in Logic App settings</div>

                    <h4>Common Playbook Patterns</h4>
                    <div class="arch-diagram">Common Playbook Patterns:

1. INCIDENT ENRICHMENT:
   Trigger: Sentinel Incident
   ├── Get incident entities (IPs, Users, Hosts)
   ├── For each IP:
   │   ├── Query VirusTotal
   │   ├── Query AbuseIPDB
   │   └── Query Threat Intel
   ├── Add comment with findings
   └── Update incident tags

2. NOTIFICATION:
   Trigger: Sentinel Incident
   ├── Get incident details
   ├── Format message
   ├── Send Teams message to SOC channel
   ├── Send email to incident owner
   └── Post to Slack (optional)

3. TICKET CREATION:
   Trigger: Sentinel Incident
   ├── Get incident details
   ├── Create ServiceNow incident
   ├── Link ticket to Sentinel incident
   └── Add comment with ticket number

4. CONTAINMENT:
   Trigger: Sentinel Incident
   ├── Get entities (compromised hosts)
   ├── For each host:
   │   ├── Isolate via MDE API
   │   └── Disable user in Azure AD
   ├── Add containment comment
   └── Update incident status

5. IOC BLOCKING:
   Trigger: Sentinel Incident
   ├── Extract IOCs (IPs, domains, hashes)
   ├── Add to Sentinel Threat Intel
   ├── Block in firewall (Palo Alto API)
   ├── Add to Defender block list
   └── Document actions in incident</div>

                    <h4>Playbook Example: IP Enrichment</h4>
                    <div class="arch-diagram">IP Enrichment Playbook Steps:

1. TRIGGER: When Azure Sentinel incident is triggered

2. GET INCIDENT
   Action: Entities - Get IPs
   Incident ARM ID: @triggerBody()?['object']?['id']

3. FOR EACH IP
   Action: For each
   Select: @body('Entities_-_Get_IPs')?['IPs']

4. VIRUSTOTAL LOOKUP
   Action: HTTP
   Method: GET
   URI: https://www.virustotal.com/api/v3/ip_addresses/@{items('For_each')?['Address']}
   Headers: x-apikey: [VT API Key]

5. PARSE RESPONSE
   Action: Parse JSON
   Content: @body('HTTP')
   Schema: (VT response schema)

6. ADD COMMENT
   Action: Add comment to incident (V3)
   Incident ARM ID: @triggerBody()?['object']?['id']
   Message: 
     IP: @{items('For_each')?['Address']}
     VT Score: @{body('Parse_JSON')?['data']?['attributes']?['last_analysis_stats']?['malicious']}
     Country: @{body('Parse_JSON')?['data']?['attributes']?['country']}

7. UPDATE TAGS (if malicious)
   Condition: malicious_count > 5
   Action: Update incident - Add tag "Confirmed-Malicious"</div>
                </div>

                <!-- Sentinel Connectors -->
                <h2><i class="fas fa-plug"></i> Key Connectors</h2>
                <div class="config-section">
                    <h4>Sentinel-Specific Actions</h4>
                    <div class="arch-diagram">Microsoft Sentinel Connector Actions:

INCIDENT ACTIONS:
├── Get incident: Retrieve incident details
├── Update incident: Modify status, severity, owner
├── Add comment: Add investigation notes
├── Add task: Create tasks for analysts
├── Get entities: Extract IPs, users, hosts, etc.
└── List incidents: Query incidents

ALERT ACTIONS:
├── Get alert: Retrieve alert details
├── Update alert status
└── Add alert comment

WATCHLIST ACTIONS:
├── Get watchlist items
├── Add watchlist item
├── Delete watchlist item
└── Update watchlist item

THREAT INTELLIGENCE:
├── Create threat indicator
├── Get threat indicator
├── Update threat indicator
└── Delete threat indicator

EXAMPLE: Update Incident
Action: Update incident (V2)
├── Incident ARM ID: from trigger
├── Status: Active / Closed
├── Classification: True Positive / False Positive
├── Classification Reason: (dropdown)
├── Severity: High / Medium / Low / Informational
├── Owner: user@domain.com or Object ID
└── Tags: add or remove</div>

                    <h4>External Connectors</h4>
                    <div class="arch-diagram">Popular External Connectors:

MICROSOFT DEFENDER:
├── Microsoft Defender for Endpoint
│   ├── Isolate machine
│   ├── Run antivirus scan
│   ├── Collect investigation package
│   └── Stop and quarantine file
├── Microsoft Defender for Cloud Apps
│   ├── Disable user
│   ├── Require re-authentication
│   └── Suspend user

AZURE AD:
├── Get user
├── Disable/Enable account
├── Reset password
├── Revoke sessions
├── Get sign-in logs
└── Add to group

SERVICENOW:
├── Create incident
├── Update incident
├── Add work notes
├── Get incident details
└── Close incident

TEAMS/OUTLOOK:
├── Send adaptive card
├── Post message to channel
├── Send email
├── Create Teams meeting
└── Create Outlook event

VIRUSTOTAL:
├── Get IP report
├── Get domain report
├── Get file report
├── Scan file
└── Scan URL</div>
                </div>

                <!-- Best Practices -->
                <h2><i class="fas fa-check-double"></i> Best Practices</h2>
                <div class="config-section">
                    <div class="arch-diagram">Automation Best Practices:

DESIGN PRINCIPLES:
├── Start simple, iterate
├── Test in non-production first
├── Use managed identities
├── Implement error handling
├── Log all actions
└── Document thoroughly

SECURITY:
├── Use Key Vault for secrets
├── Minimum privilege access
├── Audit playbook runs
├── Review connector permissions
└── Secure HTTP endpoints

PERFORMANCE:
├── Use parallel branches for independent actions
├── Implement timeouts
├── Handle API rate limits
├── Use pagination for large datasets
└── Avoid infinite loops

ERROR HANDLING:
├── Configure run after (failure handling)
├── Use Try-Catch patterns (Scope actions)
├── Send alerts on playbook failures
├── Retry transient failures
└── Graceful degradation

NAMING CONVENTIONS:
├── Playbooks: Sentinel-[Action]-[Target]
│   Example: Sentinel-Enrich-IP
├── Automation Rules: AR-[Trigger]-[Action]
│   Example: AR-HighSev-AssignTier2
└── Use consistent prefixes for filtering

TESTING:
├── Test with sample incidents
├── Verify all paths (success/failure)
├── Check Logic App run history
├── Monitor for errors
└── Validate external integrations</div>
                </div>

                <!-- Enterprise Automation Framework -->
                <h2><i class="fas fa-project-diagram"></i> Enterprise Automation Framework</h2>
                <div class="config-section">
                    <h4>Automation Maturity Model</h4>
                    <div class="arch-diagram">SOAR MATURITY MODEL
═══════════════════════════════════════════════════════════════════

LEVEL 1: BASIC (Manual with Notifications)
├── Capabilities:
│   ├── Email/Teams notifications for incidents
│   ├── Basic incident assignment automation
│   └── Manual enrichment and response
├── Metrics: MTTR > 60 minutes
└── Goal: Get visibility, establish process

LEVEL 2: ENRICHMENT (Automated Context)
├── Capabilities:
│   ├── Auto-enrich IPs (VirusTotal, AbuseIPDB)
│   ├── Auto-enrich users (Azure AD risk, recent activity)
│   ├── Auto-add context comments to incidents
│   └── Auto-tagging based on entity types
├── Metrics: MTTR 30-60 minutes
└── Goal: Faster triage with context

LEVEL 3: TRIAGE (Automated Decisions)
├── Capabilities:
│   ├── Auto-close known false positives
│   ├── Auto-escalate based on enrichment results
│   ├── Auto-assign based on severity/type
│   └── Ticket creation in ITSM
├── Metrics: MTTR 15-30 minutes
└── Goal: Reduce analyst manual triage

LEVEL 4: RESPONSE (Automated Containment)
├── Capabilities:
│   ├── Auto-block malicious IPs at firewall
│   ├── Auto-disable compromised accounts
│   ├── Auto-isolate endpoints (with approval)
│   └── Auto-revoke sessions
├── Metrics: MTTR 5-15 minutes
└── Goal: Rapid containment

LEVEL 5: ORCHESTRATION (Full Automation)
├── Capabilities:
│   ├── End-to-end playbooks for common scenarios
│   ├── Approval workflows for high-impact actions
│   ├── Automated remediation and recovery
│   └── Self-healing security posture
├── Metrics: MTTR < 5 minutes for automated cases
└── Goal: Analyst focuses on complex threats only</div>

                    <h4>Automation Use Case Decision Tree</h4>
                    <div class="arch-diagram">AUTOMATION DECISION TREE
═══════════════════════════════════════════════════════════════════

START: New incident type identified
│
├─► Is this a known false positive pattern?
│   │
│   ├─► YES → Create Automation Rule to auto-close
│   │         • Add tag "AutoClosed-FP"
│   │         • Track for FP rate validation
│   │
│   └─► NO → Continue evaluation
│
├─► Does incident need enrichment?
│   │
│   ├─► YES → Build enrichment playbook
│   │         • IP lookup (VT, AbuseIPDB, TI)
│   │         • User lookup (AAD risk, sign-ins)
│   │         • Host lookup (MDE status, vulnerabilities)
│   │         • Add results as incident comment
│   │
│   └─► NO → Continue evaluation
│
├─► Does incident need notification?
│   │
│   ├─► YES → Add notification actions
│   │         • Teams channel for SOC
│   │         • Email for escalations
│   │         • SMS/PagerDuty for critical
│   │
│   └─► NO → Continue evaluation
│
├─► Does incident require containment action?
│   │
│   ├─► YES, and action is reversible/low-risk
│   │   └─► Auto-execute containment
│   │       • Block IP at firewall
│   │       • Disable user account
│   │       • Quarantine file
│   │
│   ├─► YES, but action is high-risk
│   │   └─► Require approval workflow
│   │       • Present evidence to analyst
│   │       • Wait for approval button
│   │       • Execute on approval
│   │
│   └─► NO → Manual response required
│
└─► Does incident need ticket creation?
    │
    ├─► YES → Auto-create ITSM ticket
    │         • Populate with incident details
    │         • Link to Sentinel incident
    │         • Set priority based on severity
    │
    └─► NO → Complete automation workflow</div>

                    <h4>Playbook Architecture Patterns</h4>
                    <div class="arch-diagram">ENTERPRISE PLAYBOOK PATTERNS
═══════════════════════════════════════════════════════════════════

PATTERN 1: ENRICHMENT PLAYBOOK
┌─────────────────────────────────────────────────────────────────┐
│ Trigger: Incident Created                                        │
│                                                                   │
│ ┌─────────────┐   ┌─────────────┐   ┌─────────────┐             │
│ │ Get Entities │──▶│  For Each   │──▶│ Add Comment │             │
│ │ (IPs, Users) │   │  Entity     │   │ with Results│             │
│ └─────────────┘   └──────┬──────┘   └─────────────┘             │
│                          │                                       │
│            ┌─────────────┼─────────────┐                        │
│            ▼             ▼             ▼                        │
│      ┌──────────┐  ┌──────────┐  ┌──────────┐                  │
│      │ VT Lookup│  │ AAD Risk │  │   TI     │                  │
│      └──────────┘  └──────────┘  │  Match   │                  │
│                                  └──────────┘                   │
└─────────────────────────────────────────────────────────────────┘

PATTERN 2: CONTAINMENT WITH APPROVAL
┌─────────────────────────────────────────────────────────────────┐
│ Trigger: Incident Created (High Severity)                        │
│                                                                   │
│ ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐      │
│ │ Enrich   │──▶│ Evaluate │──▶│  Send    │──▶│ Execute  │      │
│ │ Incident │   │  Risk    │   │ Approval │   │ Action   │      │
│ └──────────┘   └────┬─────┘   │  Request │   │ or Close │      │
│                     │         └────┬─────┘   └──────────┘      │
│              ┌──────┴──────┐       │                            │
│              ▼             ▼       ▼                            │
│         Low Risk      High Risk   Wait for                      │
│         Auto-close    Continue    Approval                      │
└─────────────────────────────────────────────────────────────────┘

PATTERN 3: MULTI-SYSTEM ORCHESTRATION
┌─────────────────────────────────────────────────────────────────┐
│ Trigger: Specific Alert Type                                     │
│                                                                   │
│ ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐      │
│ │ Sentinel │──▶│   MDE    │──▶│ Firewall │──▶│ServiceNow│      │
│ │ Incident │   │ Isolate  │   │  Block   │   │  Ticket  │      │
│ └──────────┘   └──────────┘   └──────────┘   └──────────┘      │
│                                                                   │
│ ┌──────────────────────────────────────────────────────────────┐│
│ │ Parallel: Teams Notification + Email to Manager               ││
│ └──────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘</div>
                </div>

                <!-- Common Failures -->
                <h2><i class="fas fa-exclamation-triangle"></i> What Enterprises Usually Miss</h2>
                <div class="config-section">
                    <div class="arch-diagram">COMMON AUTOMATION FAILURES AND SOLUTIONS
═══════════════════════════════════════════════════════════════════

❌ FAILURE 1: Automating Without Understanding
   Problem: Building playbooks before manual process is solid
   Impact: Automating bad processes, inconsistent results
   Solution: Perfect manual process first, then automate

❌ FAILURE 2: No Error Handling
   Problem: Playbooks fail silently, no notification
   Impact: Incidents not processed, missed threats
   Solution: Implement try-catch, failure notifications

❌ FAILURE 3: Hardcoded Credentials
   Problem: API keys stored in playbook configuration
   Impact: Security risk, credential rotation nightmare
   Solution: Use Azure Key Vault for all secrets

❌ FAILURE 4: Over-Automation Too Fast
   Problem: Auto-blocking IPs without validation
   Impact: Business disruption, false positive blocks
   Solution: Start with enrichment, add containment with approval

❌ FAILURE 5: No Playbook Testing
   Problem: Deploying playbooks without testing
   Impact: Production failures, unexpected behavior
   Solution: Test with sample incidents, verify all paths

❌ FAILURE 6: Ignoring API Rate Limits
   Problem: Calling VirusTotal 1000 times in a loop
   Impact: Rate limiting, playbook failures, delays
   Solution: Implement throttling, batch requests

❌ FAILURE 7: No Logging or Audit Trail
   Problem: No visibility into what automation did
   Impact: Can't troubleshoot, no compliance evidence
   Solution: Log all actions, use incident comments

❌ FAILURE 8: Automation Rule Conflicts
   Problem: Multiple rules with conflicting actions
   Impact: Unpredictable incident handling
   Solution: Design rule hierarchy, test ordering

❌ FAILURE 9: No Playbook Governance
   Problem: Anyone can create/modify playbooks
   Impact: Inconsistent quality, security risks
   Solution: Change management, code review, testing gates

❌ FAILURE 10: Not Measuring Automation Impact
   Problem: No metrics on automation effectiveness
   Impact: Can't justify investment, can't improve
   Solution: Track MTTR, auto-close rate, enrichment coverage</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between automation rules and playbooks?</button>
                        <div class="qa-answer">
                            <p><strong>Automation Rules:</strong></p>
                            <ul>
                                <li>Lightweight, no-code configuration</li>
                                <li>Triage actions: assign, tag, change severity, close</li>
                                <li>Can trigger playbooks</li>
                            </ul>
                            <p><strong>Playbooks:</strong></p>
                            <ul>
                                <li>Full Logic Apps workflows</li>
                                <li>Complex multi-step automation</li>
                                <li>External system integration</li>
                                <li>Custom response actions</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you authenticate playbooks to Sentinel?</button>
                        <div class="qa-answer">
                            <ol>
                                <li>Enable <strong>System-assigned managed identity</strong> on Logic App</li>
                                <li>Grant <strong>Microsoft Sentinel Responder</strong> role to the identity</li>
                                <li>Scope: Resource group containing Sentinel workspace</li>
                            </ol>
                            <p>This eliminates credential management and follows least-privilege principles.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Describe a playbook you would build for incident enrichment.</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Trigger:</strong> Sentinel incident created</li>
                                <li><strong>Get entities:</strong> Extract IPs, users, hosts</li>
                                <li><strong>For each IP:</strong> Query VirusTotal, AbuseIPDB</li>
                                <li><strong>For each user:</strong> Check Azure AD risk, recent sign-ins</li>
                                <li><strong>Add comment:</strong> Summarize findings in incident</li>
                                <li><strong>Update tags:</strong> Tag as "Enriched" or "High-Risk"</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle errors in playbooks?</button>
                        <div class="qa-answer">
                            <p><strong>Comprehensive error handling strategy:</strong></p>
                            <ol>
                                <li><strong>Configure Run After:</strong> Set actions to run on success, failure, or both</li>
                                <li><strong>Scope actions:</strong> Group actions in Scope for try-catch pattern</li>
                                <li><strong>Error notification:</strong> Send Teams/email on playbook failure</li>
                                <li><strong>Retry policies:</strong> Configure for transient failures (API timeouts)</li>
                                <li><strong>Graceful degradation:</strong> Continue with partial results if one enrichment fails</li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Example pattern:</strong></p>
                            <div class="arch-diagram" style="margin: 10px 0;">Scope: "Try Enrichment"
├── Action 1: Get VirusTotal report
├── Action 2: Get AbuseIPDB report
└── Action 3: Add results to incident

Scope: "Catch Errors" (Run after: Failed)
├── Add comment: "Enrichment failed - manual review needed"
├── Add tag: "Enrichment-Failed"
└── Send notification to SOC channel</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you design an enterprise SOAR implementation roadmap?</button>
                        <div class="qa-answer">
                            <p><strong>Phased SOAR implementation:</strong></p>
                            <ol>
                                <li><strong>Phase 1 - Foundation (Month 1-2):</strong>
                                    <ul>
                                        <li>Set up playbook development environment</li>
                                        <li>Implement Key Vault for secrets</li>
                                        <li>Create notification playbooks (Teams, email)</li>
                                        <li>Build basic automation rules for assignment</li>
                                    </ul>
                                </li>
                                <li><strong>Phase 2 - Enrichment (Month 3-4):</strong>
                                    <ul>
                                        <li>IP enrichment playbook (VT, AbuseIPDB, TI match)</li>
                                        <li>User enrichment playbook (AAD risk, recent activity)</li>
                                        <li>Auto-tagging based on enrichment results</li>
                                    </ul>
                                </li>
                                <li><strong>Phase 3 - Triage Automation (Month 5-6):</strong>
                                    <ul>
                                        <li>Auto-close known false positive patterns</li>
                                        <li>Auto-escalate high-risk incidents</li>
                                        <li>ITSM ticket creation (ServiceNow/Jira)</li>
                                    </ul>
                                </li>
                                <li><strong>Phase 4 - Containment (Month 7+):</strong>
                                    <ul>
                                        <li>Block malicious IPs (with approval workflow)</li>
                                        <li>Disable compromised accounts</li>
                                        <li>MDE isolation integration</li>
                                    </ul>
                                </li>
                            </ol>
                            <p style="margin-top: 12px;"><strong>Success metrics:</strong> MTTR reduction, analyst time savings, auto-close rate</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you secure playbooks and manage secrets?</button>
                        <div class="qa-answer">
                            <p><strong>Playbook security best practices:</strong></p>
                            <ol>
                                <li><strong>Managed Identity:</strong> Use system-assigned managed identity instead of service principals</li>
                                <li><strong>Key Vault:</strong> Store all API keys, credentials in Azure Key Vault
                                    <ul>
                                        <li>Reference secrets dynamically in playbooks</li>
                                        <li>Rotate credentials without playbook changes</li>
                                    </ul>
                                </li>
                                <li><strong>RBAC:</strong> Minimum privilege for playbook identity
                                    <ul>
                                        <li>Sentinel Responder for incident updates</li>
                                        <li>Scope to specific resource groups</li>
                                    </ul>
                                </li>
                                <li><strong>Network isolation:</strong> Use private endpoints for Logic Apps where possible</li>
                                <li><strong>Audit logging:</strong> Enable diagnostic logging for all Logic Apps</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What metrics do you track for SOAR effectiveness?</button>
                        <div class="qa-answer">
                            <p><strong>Key SOAR metrics:</strong></p>
                            <table class="styled-table">
                                <thead>
                                    <tr><th>Metric</th><th>Description</th><th>Target</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>MTTR (automated)</td><td>Time to resolve auto-handled incidents</td><td>< 5 minutes</td></tr>
                                    <tr><td>Auto-close rate</td><td>% incidents closed by automation</td><td>20-40%</td></tr>
                                    <tr><td>Enrichment coverage</td><td>% incidents with auto-enrichment</td><td>> 90%</td></tr>
                                    <tr><td>Playbook success rate</td><td>% playbook runs completing successfully</td><td>> 95%</td></tr>
                                    <tr><td>Analyst time saved</td><td>Hours saved per week by automation</td><td>Track trend</td></tr>
                                    <tr><td>Containment time</td><td>Time from detection to containment action</td><td>< 15 minutes</td></tr>
                                </tbody>
                            </table>
                            <p style="margin-top: 12px;"><strong>Measurement approach:</strong> Query SecurityIncident and AzureDiagnostics (Logic App runs) for metrics dashboard</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>