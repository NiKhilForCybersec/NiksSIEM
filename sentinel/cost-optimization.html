<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cost Optimization | Sentinel</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="content-hub.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Content Hub</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-connectors.html" class="sidebar-nav-link"><i class="fas fa-plug"></i><span>Data Connectors</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="dcr-dce-guide.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>DCR & DCE Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="event-hub.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Event Hub Integration</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-filter"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention & Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="kql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>KQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>KQL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="kql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>KQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="workbooks.html" class="sidebar-nav-link"><i class="fas fa-chart-bar"></i><span>Workbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="notebooks.html" class="sidebar-nav-link"><i class="fas fa-book-open"></i><span>Notebooks</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="analytics-rules.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Analytics Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="watchlists.html" class="sidebar-nav-link"><i class="fas fa-list-check"></i><span>Watchlists</span></a></li>
                    <li class="sidebar-nav-item"><a href="ueba.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                    <li class="sidebar-nav-item"><a href="hunting.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Hunting</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>Automation & Playbooks</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-operations.html" class="sidebar-nav-link"><i class="fas fa-headset"></i><span>SOC Operations</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>RBAC & Permissions</span></a></li>
                    <li class="sidebar-nav-item"><a href="config-reference.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Configuration Reference</span></a></li>
                    <li class="sidebar-nav-item"><a href="devops.html" class="sidebar-nav-link"><i class="fas fa-code-branch"></i><span>Sentinel as Code</span></a></li>
                    <li class="sidebar-nav-item"><a href="advanced-operations.html" class="sidebar-nav-link"><i class="fas fa-cogs"></i><span>Advanced Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Sentinel</a>
                    <span class="separator">/</span>
                    <span class="current">Cost Optimization</span>
                </div>

                <h1><i class="fas fa-dollar-sign"></i> Cost Optimization</h1>
                <p class="lead">Master Microsoft Sentinel cost management through strategic data tiering, commitment discounts, transformation rules, and continuous optimization. Enterprise deployments can reduce costs 40-70% with proper planning.</p>

                <!-- Sentinel Cost Model -->
                <h2><i class="fas fa-calculator"></i> Understanding Sentinel Cost Model</h2>
                <div class="config-section">
                    <p><span class="console-path">Azure Portal → Microsoft Sentinel → Settings → Pricing</span></p>

                    <h4>Cost Components Overview</h4>
                    <div class="arch-diagram">Sentinel Cost Structure:

┌─────────────────────────────────────────────────────────────────────────────┐
│                        SENTINEL BILLING COMPONENTS                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. DATA INGESTION (Primary Cost Driver - 60-80% of total)                 │
│     ├── Analytics Logs: Full query capability (~$2.46/GB PAYG)             │
│     ├── Basic Logs: Limited queries (~$0.50/GB)                            │
│     └── Archive Logs: Search jobs only (~$0.02/GB/month)                   │
│                                                                             │
│  2. DATA RETENTION                                                          │
│     ├── First 90 days: FREE (included)                                     │
│     ├── Interactive (90d-2yr): ~$0.10/GB/month                             │
│     └── Archive (up to 12yr): ~$0.02/GB/month                              │
│                                                                             │
│  3. SEARCH & QUERY                                                          │
│     ├── Analytics logs: Unlimited queries (included)                       │
│     ├── Basic logs: $0.006/GB scanned per query                            │
│     └── Archive search jobs: $0.006/GB + restore costs                     │
│                                                                             │
│  4. AUTOMATION                                                              │
│     ├── Logic Apps: Per execution (~$0.000025/action)                      │
│     ├── Playbook triggers: Per incident                                    │
│     └── Standard connectors: Minimal cost                                  │
│                                                                             │
│  5. OTHER COSTS                                                             │
│     ├── Data export: ~$0.05/GB (to storage/Event Hub)                      │
│     ├── UEBA: Included with Sentinel                                       │
│     └── Entity behavior: Included with Sentinel                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

KEY INSIGHT: Focus optimization on ingestion - it's 60-80% of total cost.</div>

                    <h4>Pay-As-You-Go vs Commitment Tiers</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Commitment Tier</th><th>Effective $/GB</th><th>Savings vs PAYG</th><th>Break-Even Daily GB</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Pay-As-You-Go</strong></td><td>~$2.46</td><td>Baseline</td><td>Any volume</td></tr>
                            <tr><td><strong>100 GB/day</strong></td><td>~$1.96</td><td>~20%</td><td>80+ GB/day</td></tr>
                            <tr><td><strong>200 GB/day</strong></td><td>~$1.72</td><td>~30%</td><td>140+ GB/day</td></tr>
                            <tr><td><strong>300 GB/day</strong></td><td>~$1.60</td><td>~35%</td><td>195+ GB/day</td></tr>
                            <tr><td><strong>400 GB/day</strong></td><td>~$1.52</td><td>~38%</td><td>245+ GB/day</td></tr>
                            <tr><td><strong>500 GB/day</strong></td><td>~$1.48</td><td>~40%</td><td>300+ GB/day</td></tr>
                            <tr><td><strong>1000 GB/day</strong></td><td>~$1.35</td><td>~45%</td><td>550+ GB/day</td></tr>
                            <tr><td><strong>2000 GB/day</strong></td><td>~$1.23</td><td>~50%</td><td>1000+ GB/day</td></tr>
                            <tr><td><strong>5000 GB/day</strong></td><td>~$1.11</td><td>~55%</td><td>2250+ GB/day</td></tr>
                        </tbody>
                    </table>
                    <p><em>Note: Prices are approximate and vary by region. Check Azure pricing calculator for current rates.</em></p>

                    <h4>Commitment Tier Selection Decision Tree</h4>
                    <div class="arch-diagram">Decision Tree: Choosing Commitment Tier

START: Calculate 30-day average daily ingestion
│
├── Average < 80 GB/day
│   └── ACTION: Stay on Pay-As-You-Go
│       └── Re-evaluate monthly as data grows
│
├── Average 80-140 GB/day
│   └── ACTION: Consider 100 GB/day tier
│       ├── If consistent: Commit to 100 GB
│       └── If variable: Stay PAYG, optimize first
│
├── Average 140-200 GB/day
│   └── ACTION: Evaluate 200 GB/day tier
│       ├── Calculate: (Avg × 30 × $1.72) vs (200 × 30 × $1.72)
│       └── If savings > 15%: Commit
│
├── Average 200-500 GB/day
│   └── ACTION: Right-size to appropriate tier
│       ├── 200-280 GB → 200 GB tier
│       ├── 280-350 GB → 300 GB tier  
│       ├── 350-430 GB → 400 GB tier
│       └── 430-550 GB → 500 GB tier
│
└── Average > 500 GB/day
    └── ACTION: Engage Microsoft for enterprise pricing
        ├── Request custom commitment tiers
        ├── Negotiate multi-year discounts
        └── Explore unified security bundles

CRITICAL: Always maintain 20% buffer below commitment
          - 100 GB tier → aim for 80 GB daily average
          - This protects against ingestion spikes</div>
                </div>

                <!-- Data Tiering Strategy -->
                <h2><i class="fas fa-layer-group"></i> Data Tiering Strategy</h2>
                <div class="config-section">
                    <h4>Log Tier Selection Framework</h4>
                    <div class="arch-diagram">Enterprise Data Tiering Decision Matrix:

┌────────────────────┬─────────────────┬─────────────────┬─────────────────┐
│    Data Type       │  Analytics Logs │   Basic Logs    │  Archive Tier   │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Security Events    │ Critical events │ Verbose events  │ Historical      │
│ (Windows/Linux)    │ (4624,4625,4688)│ (4663,5156,etc) │ (>90 days)      │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Firewall Logs      │ Denied traffic  │ Allowed traffic │ All traffic     │
│                    │ Alert triggers  │ Standard flows  │ (compliance)    │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ DNS Logs           │ Threat matches  │ Query logs      │ Full history    │
│                    │ Anomalies       │ (high volume)   │                 │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Proxy/Web Logs     │ Blocked URLs    │ Allowed traffic │ Historical      │
│                    │ Malware hits    │ Categories      │ (forensics)     │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Authentication     │ All auth events │ N/A             │ >90 days        │
│                    │ (critical)      │                 │                 │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Cloud Activity     │ Admin actions   │ Read operations │ Historical      │
│ (Azure/AWS/GCP)    │ Config changes  │ (if needed)     │                 │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Network Flow       │ Threat matches  │ Flow summaries  │ Full flows      │
│ (NetFlow/VPC)      │ Lateral movement│ (sampled)       │                 │
├────────────────────┼─────────────────┼─────────────────┼─────────────────┤
│ Application Logs   │ Errors/Security │ Info/Debug      │ Archive         │
│                    │ Access denied   │ (if needed)     │ (compliance)    │
└────────────────────┴─────────────────┴─────────────────┴─────────────────┘

COST IMPACT EXAMPLE (500 GB/day organization):
- Without tiering: 500 GB × $1.48 = $740/day = $22,200/month
- With tiering:
  - Analytics (200 GB): 200 × $1.48 = $296/day
  - Basic (250 GB): 250 × $0.50 = $125/day
  - Filtered (50 GB): $0
  - Total: $421/day = $12,630/month
  - SAVINGS: $9,570/month (43%)</div>

                    <h4>Basic Logs Configuration</h4>
                    <div class="arch-diagram">// Tables eligible for Basic Logs tier
// Configure via Azure Portal or ARM template

Recommended for Basic Logs:
├── ContainerLog (Kubernetes container stdout/stderr)
├── ContainerLogV2 (Enhanced container logs)
├── AppTraces (Application Insights traces)
├── AppDependencies (if high volume)
├── StorageBlobLogs (Azure Storage access)
├── AzureMetrics (if ingesting metrics)
├── Custom tables with:
│   ├── High volume (>10 GB/day)
│   ├── Infrequent queries
│   └── Simple search patterns

NOT Recommended for Basic Logs:
├── SecurityEvent (need full query)
├── SigninLogs (need joins/analytics)
├── AuditLogs (need correlation)
├── CommonSecurityLog (need threat detection)
└── Any table used in Analytics Rules</div>

                    <p><span class="console-path">Azure Portal → Log Analytics Workspace → Tables → Select Table → Configure → Log Plan</span></p>
                </div>

                <!-- Transformation Rules -->
                <h2><i class="fas fa-filter"></i> Data Transformation & Filtering</h2>
                <div class="config-section">
                    <h4>Ingestion-Time Transformations (DCR)</h4>
                    <p>Data Collection Rules allow filtering and transformation BEFORE data reaches Sentinel, reducing costs at ingestion.</p>

                    <div class="arch-diagram">// Example: Filter verbose Windows Security Events
// Applied via Data Collection Rule transformation

// BEFORE: All Event IDs ingested (expensive)
// AFTER: Only security-relevant events

source
| where EventID in (
    // Account Logon
    4624, 4625, 4648, 4768, 4769, 4771, 4776,
    // Account Management  
    4720, 4722, 4723, 4724, 4725, 4726, 4727, 4728, 4729, 4730, 4731, 4732, 4733, 4734, 4735, 4737, 4738, 4740, 4741, 4742, 4743, 4754, 4755, 4756, 4757, 4758,
    // Process Execution
    4688, 4689,
    // Privilege Use
    4672, 4673, 4674,
    // Policy Changes
    4704, 4705, 4706, 4707, 4713, 4715, 4716, 4717, 4718, 4719,
    // System Events
    4608, 4609, 4616, 4657,
    // Object Access (selective)
    4663, 4656, 4660, 4670
)
// Drop unnecessary fields to reduce size
| project-away 
    EventData,           // Often redundant with parsed fields
    RenderedDescription, // Large text field
    Source,              // Usually redundant
    EventSourceName      // Usually redundant</div>

                    <h4>Field Filtering Examples</h4>
                    <div class="arch-diagram">// CommonSecurityLog - Drop verbose fields
source
| project-away 
    AdditionalExtensions,    // Often empty or redundant
    FlexDate1,               // Rarely used
    FlexNumber1,
    FlexNumber2,
    FlexString1,
    FlexString2,
    DeviceCustomDate1,
    DeviceCustomDate2,
    DeviceCustomFloatingPoint1,
    DeviceCustomFloatingPoint2,
    DeviceCustomIPv6Address1,
    DeviceCustomIPv6Address2,
    DeviceCustomIPv6Address3,
    DeviceCustomNumber1,
    DeviceCustomNumber2,
    DeviceCustomNumber3,
    DeviceCustomString1,
    DeviceCustomString2,
    DeviceCustomString3,
    DeviceCustomString4,
    DeviceCustomString5,
    DeviceCustomString6,
    OldFileCreateTime,
    OldFileHash,
    OldFileID,
    OldFileName,
    OldFilePath,
    OldFilePermission,
    OldFileSize,
    OldFileType
| where DeviceAction != "Allow"  // Drop allowed traffic if not needed

// SAVINGS: 30-50% reduction in CommonSecurityLog volume</div>

                    <h4>Transformation Decision Tree</h4>
                    <div class="arch-diagram">Decision Tree: When to Apply Transformations

FOR EACH HIGH-VOLUME TABLE (>5 GB/day):
│
├── Q1: Are all Event IDs/records needed for detection?
│   ├── NO → Create allowlist of needed Event IDs
│   │        Filter at DCR level before ingestion
│   └── YES → Continue to Q2
│
├── Q2: Are all fields needed for queries/detection?
│   ├── NO → Identify unused fields via:
│   │        - Review analytics rules for field usage
│   │        - Check hunting queries
│   │        - Analyze workbook requirements
│   │        → Apply project-away transformation
│   └── YES → Continue to Q3
│
├── Q3: Can records be aggregated without losing value?
│   ├── YES → Use summarize at collection
│   │         Example: DNS queries per hour instead of each query
│   └── NO → Continue to Q4
│
├── Q4: Is data needed for real-time detection?
│   ├── NO → Consider Basic Logs tier
│   └── YES → Keep as Analytics Logs
│
└── Q5: How long is data needed for interactive queries?
    ├── < 90 days → Use default retention
    ├── 90 days - 2 years → Configure total retention
    └── > 2 years → Archive tier with search jobs</div>
                </div>

                <!-- Cost Monitoring -->
                <h2><i class="fas fa-chart-line"></i> Cost Monitoring & Governance</h2>
                <div class="config-section">
                    <h4>Essential Cost Monitoring Queries</h4>
                    <div class="arch-diagram">// Daily ingestion by table (cost driver identification)
Usage
| where TimeGenerated > ago(30d)
| where IsBillable == true
| summarize TotalGB = sum(Quantity) / 1000 by DataType, bin(TimeGenerated, 1d)
| order by TotalGB desc
| render timechart

// Top 10 tables by volume
Usage
| where TimeGenerated > ago(7d)
| where IsBillable == true
| summarize TotalGB = sum(Quantity) / 1000 by DataType
| top 10 by TotalGB
| render piechart

// Ingestion anomaly detection (cost spikes)
Usage
| where TimeGenerated > ago(30d)
| where IsBillable == true
| summarize DailyGB = sum(Quantity) / 1000 by bin(TimeGenerated, 1d)
| extend 
    AvgGB = avg(DailyGB),
    StdDev = stdev(DailyGB)
| extend Anomaly = DailyGB > (AvgGB + (2 * StdDev))
| where Anomaly == true

// Cost projection vs commitment tier
let commitment_gb = 200;  // Your commitment tier
let overage_rate = 2.46;  // PAYG rate for overage
let commitment_rate = 1.72;  // Your tier rate
Usage
| where TimeGenerated > ago(30d)
| where IsBillable == true
| summarize DailyGB = sum(Quantity) / 1000 by bin(TimeGenerated, 1d)
| extend 
    CommitmentCost = commitment_gb * commitment_rate,
    OverageGB = max_of(DailyGB - commitment_gb, 0),
    OverageCost = max_of(DailyGB - commitment_gb, 0) * overage_rate
| extend DailyCost = CommitmentCost + OverageCost
| summarize 
    TotalCost = sum(DailyCost),
    AvgDailyCost = avg(DailyCost),
    MaxDailyCost = max(DailyCost)</div>

                    <h4>Cost Alert Configuration</h4>
                    <div class="arch-diagram">Enterprise Cost Alerting Framework:

1. DAILY INGESTION THRESHOLD
   └── Alert when daily ingestion exceeds commitment tier + 10%
       Query: Usage | where IsBillable | summarize sum(Quantity)/1000
       Threshold: > (commitment_tier * 1.1)
       Action: Email SOC leads + Finance

2. TABLE VOLUME SPIKE
   └── Alert when any table increases > 50% day-over-day
       Query: Compare today vs yesterday by DataType
       Action: Investigate source, potential misconfiguration

3. NEW HIGH-VOLUME TABLE
   └── Alert when new table appears with > 1 GB/day
       Query: Detect tables not seen in prior 7 days
       Action: Review data value, consider filtering

4. COMMITMENT UTILIZATION
   └── Weekly report on commitment tier utilization
       Target: 80-95% utilization (not over, not wasteful)
       Action: Quarterly tier review meeting

5. COST ANOMALY
   └── Alert on statistical outliers (2+ std deviations)
       Action: Root cause investigation</div>

                    <h4>Azure Monitor Alert Rule Example</h4>
                    <div class="arch-diagram">// Create alert rule for cost spike detection
// Navigate: Azure Portal → Sentinel → Analytics → Create rule

Rule Name: "Daily Ingestion Exceeded Threshold"
Severity: High
Tactics: N/A (cost governance)

KQL Query:
Usage
| where TimeGenerated > ago(1d)
| where IsBillable == true
| summarize TotalGB = sum(Quantity) / 1000
| where TotalGB > 220  // Alert at 110% of 200GB tier

Scheduling:
- Run every: 24 hours
- Lookup data from: 1 day

Entity Mapping: None (cost alert)

Automated Response:
- Logic App: Send Teams notification to #siem-operations
- Email: siem-team@company.com, finance-alerts@company.com</div>
                </div>

                <!-- Enterprise Optimization Strategies -->
                <h2><i class="fas fa-building"></i> Enterprise Optimization Strategies</h2>
                <div class="config-section">
                    <h4>Phased Optimization Roadmap</h4>
                    <div class="arch-diagram">Enterprise Cost Optimization Phases:

PHASE 1: ASSESSMENT (Week 1-2)
├── Inventory all data sources and volumes
├── Identify top 10 cost-driving tables
├── Document current commitment tier (if any)
├── Calculate current cost per GB
└── Deliverable: Cost baseline report

PHASE 2: QUICK WINS (Week 3-4)
├── Implement Basic Logs for high-volume/low-query tables
├── Apply field filtering on verbose tables
├── Remove duplicate data sources
├── Disable unused data connectors
└── Target: 15-25% cost reduction

PHASE 3: STRUCTURAL OPTIMIZATION (Month 2)
├── Design ingestion-time transformations
├── Implement DCR-based filtering
├── Configure per-table retention policies
├── Evaluate commitment tier sizing
└── Target: Additional 10-20% reduction

PHASE 4: CONTINUOUS GOVERNANCE (Ongoing)
├── Weekly cost review meetings
├── Monthly commitment tier evaluation
├── Quarterly optimization sprints
├── Annual architecture review
└── Target: Maintain optimized state

TOTAL EXPECTED SAVINGS: 40-60% of baseline costs</div>

                    <h4>Multi-Workspace Cost Strategy</h4>
                    <div class="arch-diagram">Multi-Workspace Architecture for Cost Control:

┌─────────────────────────────────────────────────────────────────┐
│                    PRODUCTION WORKSPACE                          │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ HIGH-VALUE DATA (Analytics Tier)                            │ │
│  │ • Security events (filtered)                                │ │
│  │ • Authentication logs                                        │ │
│  │ • Threat intelligence matches                                │ │
│  │ • EDR alerts                                                 │ │
│  │ Commitment Tier: 200 GB/day                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              │
                    Cross-workspace queries
                              │
┌─────────────────────────────────────────────────────────────────┐
│                    OPERATIONAL WORKSPACE                         │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ HIGH-VOLUME DATA (Basic Logs / Lower Tier)                  │ │
│  │ • Network flow logs                                          │ │
│  │ • DNS query logs                                             │ │
│  │ • Proxy allowed traffic                                      │ │
│  │ • Container logs                                             │ │
│  │ Commitment Tier: 500 GB/day (lower rate)                     │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘

BENEFITS:
• Separate commitment tiers optimized for each workspace
• Security data gets premium treatment
• Operational data at bulk rates
• Cross-workspace queries maintain correlation capability
• Independent retention policies

WHEN TO USE:
• Total ingestion > 500 GB/day
• Clear separation between security and operational data
• Different compliance requirements per data type</div>

                    <h4>Defender Integration Cost Benefits</h4>
                    <div class="arch-diagram">Microsoft 365 Defender Integration Benefits:

FREE DATA INGESTION (with M365 E5 or equivalent):
├── Microsoft 365 Defender incidents
├── Microsoft 365 Defender alerts  
├── Advanced hunting data from:
│   ├── DeviceEvents
│   ├── DeviceFileEvents
│   ├── DeviceNetworkEvents
│   ├── DeviceProcessEvents
│   ├── EmailEvents
│   └── IdentityLogonEvents (partial)
└── Estimated value: 50-200 GB/day for large enterprises

COST OPTIMIZATION STRATEGY:
1. Enable bi-directional sync with M365 Defender
2. Use Defender portal for endpoint-specific hunting
3. Only sync incidents to Sentinel (not raw events)
4. Leverage Defender's 30-day retention for endpoint data
5. Import only correlated/enriched data to Sentinel

CALCULATION EXAMPLE:
Without integration: 150 GB/day × $1.48 = $6,660/month
With integration: 0 GB/day (free) = $0/month
SAVINGS: $6,660/month on endpoint telemetry alone</div>
                </div>

                <!-- What Enterprises Usually Miss -->
                <h2><i class="fas fa-exclamation-triangle"></i> What Enterprises Usually Miss</h2>
                <div class="config-section">
                    <div class="arch-diagram">Common Cost Optimization Failures:

1. INGESTION SPRAWL
   ✗ Enabling all connectors without volume assessment
   ✗ Not reviewing what data is actually being ingested
   → FIX: Audit connectors quarterly, disable unused sources

2. WRONG COMMITMENT TIER
   ✗ Committing based on peak instead of average
   ✗ Not accounting for seasonality/growth
   ✗ Over-committing and paying for unused capacity
   → FIX: Use 80th percentile of daily volume, review quarterly

3. IGNORING BASIC LOGS
   ✗ Keeping all data in Analytics tier by default
   ✗ Not identifying low-query tables
   → FIX: Review query patterns, move 40-60% to Basic Logs

4. NO TRANSFORMATION STRATEGY
   ✗ Ingesting raw data without filtering
   ✗ Not using DCR transformations
   → FIX: Filter at source, drop unused fields

5. DUPLICATE DATA SOURCES
   ✗ Same data from multiple connectors
   ✗ Native connector + Syslog/CEF duplicate
   → FIX: Audit data lineage, choose single source

6. RETENTION OVERKILL
   ✗ 7-year retention on all tables
   ✗ Not using archive tier for compliance
   → FIX: Per-table retention based on actual need

7. NO COST VISIBILITY
   ✗ No monitoring of daily ingestion
   ✗ No alerts on cost spikes
   ✗ Finance surprised by monthly bill
   → FIX: Implement cost dashboards and alerts

8. IGNORING FREE DATA
   ✗ Not leveraging M365 Defender integration
   ✗ Paying for data that could be free
   → FIX: Enable Defender data connector, use bi-directional sync

9. INEFFICIENT QUERIES
   ✗ Expensive queries on Basic Logs tables
   ✗ Full table scans in analytics rules
   → FIX: Optimize KQL, use time filters, add indexes

10. NO GOVERNANCE PROCESS
    ✗ No regular cost reviews
    ✗ No approval for new data sources
    ✗ No optimization ownership
    → FIX: Monthly cost review, data source approval workflow</div>
                </div>

                <!-- ROI Calculation -->
                <h2><i class="fas fa-chart-pie"></i> ROI Calculation Framework</h2>
                <div class="config-section">
                    <h4>Cost Optimization Business Case Template</h4>
                    <div class="arch-diagram">SENTINEL COST OPTIMIZATION BUSINESS CASE

CURRENT STATE:
├── Daily ingestion: [X] GB/day
├── Monthly cost: $[Y]
├── Commitment tier: [Current tier or PAYG]
├── Basic Logs usage: [Z]% of data
└── Known inefficiencies: [List]

PROPOSED OPTIMIZATIONS:
┌────────────────────────────────┬────────────┬────────────┐
│ Optimization                   │ Effort     │ Est. Save  │
├────────────────────────────────┼────────────┼────────────┤
│ Basic Logs migration           │ 2 weeks    │ 30-40%     │
│ DCR transformations            │ 3 weeks    │ 15-25%     │
│ Commitment tier right-sizing   │ 1 day      │ 10-20%     │
│ Duplicate source removal       │ 1 week     │ 5-15%      │
│ M365 Defender integration      │ 2 days     │ 10-30%     │
│ Retention policy optimization  │ 1 week     │ 5-10%      │
└────────────────────────────────┴────────────┴────────────┘

PROJECTED SAVINGS:
├── Conservative: 25-35% reduction
├── Moderate: 40-50% reduction  
└── Aggressive: 55-70% reduction

IMPLEMENTATION COST:
├── Engineering time: [X] hours × $[rate] = $[cost]
├── Testing/validation: [Y] hours
├── Potential detection gaps: [Risk assessment]
└── Total implementation cost: $[total]

PAYBACK PERIOD:
├── Monthly savings: $[amount]
├── Implementation cost: $[amount]
└── Payback: [X] months

RECOMMENDATION:
[Executive summary with recommended approach]</div>

                    <h4>Sample ROI Calculation</h4>
                    <div class="arch-diagram">EXAMPLE: Mid-Size Enterprise (500 endpoints, 50 servers)

BEFORE OPTIMIZATION:
├── Daily ingestion: 150 GB/day
├── Tier: 200 GB/day commitment ($1.72/GB)
├── Monthly cost: 200 × 30 × $1.72 = $10,320
├── Utilization: 75% (wasting 25%)
└── Basic Logs: 0%

AFTER OPTIMIZATION:
├── Analytics Logs: 80 GB/day (critical data)
├── Basic Logs: 50 GB/day (verbose logs)  
├── Filtered: 20 GB/day (removed at DCR)
├── Tier: 100 GB/day commitment ($1.96/GB)
└── Monthly cost breakdown:
    - Commitment: 100 × 30 × $1.96 = $5,880
    - Basic Logs: 50 × 30 × $0.50 = $750
    - Total: $6,630/month

SAVINGS:
├── Monthly: $10,320 - $6,630 = $3,690 (36% reduction)
├── Annual: $44,280
└── 3-year: $132,840

IMPLEMENTATION EFFORT:
├── 40 engineering hours × $150/hr = $6,000
├── Testing: 16 hours × $150/hr = $2,400
└── Total: $8,400

PAYBACK: $8,400 ÷ $3,690 = 2.3 months</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-user-tie"></i> Interview Questions & Answers</h2>
                <div class="config-section">
                    <h4>Q1: How would you approach cost optimization for a Sentinel deployment that has grown to 2TB/day?</h4>
                    <div class="arch-diagram">APPROACH:
First, I'd establish visibility with a 30-day ingestion analysis by table 
to identify the top cost drivers. At 2TB/day, you're likely looking at 
$50-70K/month, so even 20% optimization is significant.

My phased approach would be:

1. IMMEDIATE (Week 1):
   - Identify tables >100GB/day - usually 3-5 tables drive 80% of volume
   - Check for duplicate data sources (common with firewall/proxy logs)
   - Verify commitment tier is right-sized

2. SHORT-TERM (Weeks 2-4):
   - Implement Basic Logs for high-volume/low-query tables
   - Apply DCR transformations to filter verbose events
   - Target 30-40% reduction

3. MEDIUM-TERM (Month 2):
   - Consider multi-workspace architecture for separation
   - Optimize retention policies per table
   - Enable M365 Defender bi-directional sync

WHY THIS APPROACH:
Focus on high-impact changes first. At 2TB scale, moving 500GB to Basic 
Logs saves ~$500K/year. Quick wins build momentum for larger changes.

TRADE-OFFS:
- Basic Logs limits query capability - must validate detection coverage
- Aggressive filtering could create visibility gaps
- Multi-workspace adds operational complexity

VALIDATION:
Run parallel ingestion for 2 weeks before cutting over. Verify all 
analytics rules still fire correctly. Monitor for detection gaps.</div>

                    <h4>Q2: A security team complains that cost controls are blocking critical visibility. How do you balance cost and coverage?</h4>
                    <div class="arch-diagram">APPROACH:
This is a governance issue, not just a technical one. Cost and coverage 
decisions need to be made jointly with defined criteria.

I'd implement a tiered data classification framework:

TIER 1 - ALWAYS INGEST (No cost discussion):
- Authentication events (all)
- Security alerts from all tools
- Admin/privilege changes
- Malware detections

TIER 2 - FILTERED INGEST (Optimize, don't eliminate):
- Process execution (filter to suspicious patterns)
- Network connections (summarize or sample)
- File access (high-value paths only)

TIER 3 - ON-DEMAND (Basic Logs or external):
- Verbose debug logs
- Successful routine operations
- Performance metrics

For the specific complaint:
1. Understand exactly what visibility they feel is missing
2. Quantify the cost of that visibility
3. Present trade-off: "Full DNS logging is $X/month - here's what we get"
4. Let business decide with full cost context

WHY:
Security can't have unlimited budget, but cuts shouldn't be made in the 
dark. Transparent cost-per-capability discussions enable informed decisions.

VALIDATION:
Track detection efficacy metrics. If detections drop after optimization, 
we have data to justify re-enabling specific data sources.</div>

                    <h4>Q3: Explain the difference between Basic Logs and Analytics Logs and when you'd use each.</h4>
                    <div class="arch-diagram">APPROACH:
Basic Logs and Analytics Logs serve different purposes with significant 
cost differences (~80% cheaper for Basic).

ANALYTICS LOGS:
- Full KQL query capability
- 30-day interactive retention minimum
- Used in scheduled analytics rules
- Supports complex joins and correlations
- Cost: ~$2.46/GB (PAYG) to ~$1.11/GB (5TB tier)

USE FOR:
- Security events needed in detection rules
- Data requiring complex correlation
- High-frequency query tables
- Real-time alerting sources

BASIC LOGS:
- Limited query: simple filters, 8 concurrent queries
- 8-day interactive retention
- Cannot be used in analytics rules
- Query cost: $0.006/GB scanned
- Ingestion cost: ~$0.50/GB

USE FOR:
- High-volume operational data
- Forensic investigation (ad-hoc)
- Compliance retention requirements
- Debug/verbose logs
- Data queried <5 times per day

REAL-WORLD EXAMPLE:
Container logs (ContainerLogV2) at 100GB/day:
- Analytics: $148/day = $4,440/month
- Basic: $50/day = $1,500/month
- Savings: $2,940/month

If you query those logs 10 times/day for investigations:
10 queries × 100GB × $0.006 = $6/day additional
Still massive savings at $1,680/month vs $4,440

TRADE-OFFS:
- Can't alert on Basic Logs data
- Complex investigations slower
- 8-day retention before archive

VALIDATION:
Monitor query patterns for 30 days before migration. If table is queried
in analytics rules or >20 times daily, keep in Analytics tier.</div>

                    <h4>Q4: How do you handle cost spikes from a sudden increase in log volume?</h4>
                    <div class="arch-diagram">APPROACH:
Cost spikes need both immediate response and preventive controls.

IMMEDIATE RESPONSE (Within hours):
1. Identify the source via Usage table:
   Usage | where TimeGenerated > ago(1d) | summarize sum(Quantity) by DataType
   
2. Determine if spike is:
   - Legitimate (incident, new deployment, attack)
   - Misconfiguration (verbose logging enabled)
   - Attack (log flooding DoS)

3. If misconfiguration/attack:
   - Disable connector temporarily if safe
   - Apply emergency DCR filter
   - Contact source system owner

4. If legitimate:
   - Document for finance (unexpected but necessary)
   - Project ongoing cost impact
   - Evaluate if temporary or permanent increase

PREVENTIVE CONTROLS:
1. Set daily caps per table (Azure feature)
   - Pros: Hard cost control
   - Cons: Potential data loss

2. Implement ingestion alerts:
   - Warn at 80% of normal
   - Alert at 120% of normal
   - Critical at 150% of normal

3. Use DCR with volume limits:
   - Sample high-volume sources
   - Drop after threshold

4. Budget alerts in Azure Cost Management:
   - Alert finance and SOC at forecast thresholds

WHY:
Spikes are inevitable - new tool deployments, security incidents, 
misconfigurations. The goal is rapid detection and response.

TRADE-OFFS:
- Hard caps risk losing security data
- Aggressive filtering might miss attacks
- Balance: Alert early, act fast, document decisions

VALIDATION:
Monthly review of spike events, root causes, and response times. 
Improve detection time target: <4 hours for >50% spike.</div>

                    <h4>Q5: How would you architect Sentinel for a global enterprise with data residency requirements?</h4>
                    <div class="arch-diagram">APPROACH:
Global enterprises with data residency need multi-workspace architecture 
with careful cost and operational balance.

ARCHITECTURE:
┌─────────────────────────────────────────────────────────────────┐
│ REGIONAL WORKSPACES (Data stays in region)                     │
├─────────────┬─────────────┬─────────────┬─────────────────────┤
│ US East     │ EU West     │ UK South    │ Australia East      │
│ (Primary)   │ (GDPR)      │ (UK Data)   │ (AU Privacy)        │
├─────────────┼─────────────┼─────────────┼─────────────────────┤
│ Local data  │ Local data  │ Local data  │ Local data          │
│ Local rules │ Local rules │ Local rules │ Local rules         │
└─────────────┴─────────────┴─────────────┴─────────────────────┘
                              │
                    Aggregated alerts/incidents only
                              │
┌─────────────────────────────────────────────────────────────────┐
│ GLOBAL SOC WORKSPACE (Aggregation - alerts only)                │
│ - No raw data (compliant)                                       │
│ - Cross-region correlation rules                                │
│ - Global dashboards and reporting                               │
│ - Unified incident management                                   │
└─────────────────────────────────────────────────────────────────┘

COST OPTIMIZATION FOR MULTI-WORKSPACE:
1. Commitment tiers per region based on volume
2. Centralize Basic Logs in lowest-cost region if compliant
3. Use Lighthouse for central management (no data movement)
4. Aggregate only necessary data to global workspace

TRADE-OFFS:
- Higher operational complexity
- Some correlation limitations across regions
- Multiple commitment tiers may be less efficient than single large tier
- Requires clear data classification policy

COST COMPARISON:
Single workspace: Easier commitment tier, lower management
Multi-workspace: Compliance compliant, slightly higher total cost

WHY:
Data residency is non-negotiable for regulated industries. Design must 
prioritize compliance, then optimize cost within those constraints.

VALIDATION:
Legal/compliance review of architecture before implementation.
Data flow documentation for each region.
Regular audits of cross-region data movement.</div>

                    <h4>Q6: What metrics would you track to demonstrate the value of cost optimization efforts?</h4>
                    <div class="arch-diagram">APPROACH:
Track metrics that show both cost reduction AND maintained security posture.

COST METRICS:
1. Monthly total cost (absolute)
2. Cost per GB ingested
3. Cost per endpoint protected
4. Cost per incident investigated
5. Commitment tier utilization %
6. Basic Logs ratio (% of total)
7. Transformation savings (GB filtered)

SECURITY POSTURE METRICS (ensure optimization isn't hurting):
1. Detection coverage (MITRE ATT&CK %)
2. Mean time to detect (MTTD)
3. Alert volume (should stay stable if filtering correctly)
4. False positive rate
5. Hunting query success rate

OPERATIONAL METRICS:
1. Query performance (P95 response time)
2. Analytics rule execution time
3. Ingestion latency

DASHBOARD STRUCTURE:
┌────────────────────────────────────────────────────────────────┐
│ COST OPTIMIZATION DASHBOARD                                    │
├────────────────────────────────────────────────────────────────┤
│ Monthly Cost Trend                   │ Cost per GB Trend       │
│ [Line chart - 12 months]             │ [Line chart]            │
├────────────────────────────────────────────────────────────────┤
│ Top 10 Tables by Cost │ Tier Utilization │ Detection Coverage  │
│ [Bar chart]           │ [Gauge: 85%]     │ [MITRE heatmap]     │
├────────────────────────────────────────────────────────────────┤
│ Savings to Date: $XXX,XXX            │ Target: $XXX,XXX/year   │
└────────────────────────────────────────────────────────────────┘

REPORTING CADENCE:
- Weekly: Cost vs commitment utilization
- Monthly: Full dashboard review with stakeholders
- Quarterly: Optimization initiative review
- Annual: Budget planning with projections

WHY:
Numbers tell the story. Finance wants cost reduction, security wants 
coverage - tracking both builds trust and enables informed decisions.

TRADE-OFFS:
- Metrics overhead has its own cost
- Don't over-engineer dashboards
- Focus on actionable metrics</div>
                </div>

            </main>
            
            <footer class="main-footer">
                <p>&copy; 2024 Nik's SIEM Compendium. Built for security professionals.</p>
            </footer>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
    </script>
</body>
</html>
