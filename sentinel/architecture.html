<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture | Sentinel | Nik's SIEM Compendium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Sentinel Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link active"><i class="fas fa-sitemap"></i> Architecture</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-connectors.html" class="nav-link"><i class="fas fa-plug"></i> Data Connectors</a>
                    <a href="dcr-dce-guide.html" class="nav-link"><i class="fas fa-cogs"></i> DCR & DCE Guide</a>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Ingestion Patterns</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & Transform</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">KQL Query Language</div>
                    <a href="kql-fundamentals.html" class="nav-link"><i class="fas fa-terminal"></i> Fundamentals</a>
                    <a href="kql-intermediate.html" class="nav-link"><i class="fas fa-layer-group"></i> Intermediate</a>
                    <a href="kql-advanced.html" class="nav-link"><i class="fas fa-code"></i> Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection & Response</div>
                    <a href="analytics-rules.html" class="nav-link"><i class="fas fa-bell"></i> Analytics Rules</a>
                    <a href="automation.html" class="nav-link"><i class="fas fa-robot"></i> Automation</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-crosshairs"></i> Threat Intel</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="workbooks.html" class="nav-link"><i class="fas fa-chart-bar"></i> Workbooks</a>
                    <a href="content-hub.html" class="nav-link"><i class="fas fa-store"></i> Content Hub</a>
                    <a href="soc-operations.html" class="nav-link"><i class="fas fa-users-cog"></i> SOC Operations</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Sentinel</a><span class="separator">/</span>
                    <span class="current">Architecture</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-sitemap"></i> Microsoft Sentinel Architecture</h1>
                <p class="lead">Microsoft Sentinel is a cloud-native SIEM and SOAR solution built on Azure. Understanding its architecture helps with deployment planning, cost optimization, and integration design.</p>

                <!-- CORE COMPONENTS -->
                <h2><i class="fas fa-cubes"></i> Core Components</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1c3a5e; color: #58a6ff;"><i class="fas fa-database"></i></div>
                            <div class="comparison-item-title">Log Analytics Workspace</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Data storage layer</li>
                            <li><i class="fas fa-check"></i> KQL query engine</li>
                            <li><i class="fas fa-check"></i> Tables for each data type</li>
                            <li><i class="fas fa-check"></i> Retention configuration</li>
                            <li><i class="fas fa-info-circle"></i> Foundation for Sentinel</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-plug"></i></div>
                            <div class="comparison-item-title">Data Connectors</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Ingest data from sources</li>
                            <li><i class="fas fa-check"></i> Native Microsoft connectors</li>
                            <li><i class="fas fa-check"></i> AMA for syslog/CEF</li>
                            <li><i class="fas fa-check"></i> APIs for custom sources</li>
                            <li><i class="fas fa-info-circle"></i> Content Hub solutions</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d3a0d; color: #d29922;"><i class="fas fa-bell"></i></div>
                            <div class="comparison-item-title">Analytics Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Scheduled KQL queries</li>
                            <li><i class="fas fa-check"></i> NRT (near real-time) rules</li>
                            <li><i class="fas fa-check"></i> ML behavior analytics</li>
                            <li><i class="fas fa-check"></i> Fusion correlation</li>
                            <li><i class="fas fa-info-circle"></i> Create incidents</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #3d2a5e; color: #a371f7;"><i class="fas fa-robot"></i></div>
                            <div class="comparison-item-title">Automation</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Playbooks (Logic Apps)</li>
                            <li><i class="fas fa-check"></i> Automation rules</li>
                            <li><i class="fas fa-check"></i> Auto-enrichment</li>
                            <li><i class="fas fa-check"></i> Response actions</li>
                            <li><i class="fas fa-info-circle"></i> 200+ connectors</li>
                        </ul>
                    </div>
                </div>

                <!-- HIGH-LEVEL ARCHITECTURE -->
                <h2><i class="fas fa-project-diagram"></i> High-Level Architecture</h2>
                
                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-cloud"></i> Sentinel Data Flow</div>
                    
                    <!-- Data Sources -->
                    <div style="text-align: center; margin-bottom: 16px;">
                        <span style="color: #8b949e; font-size: 0.85rem; text-transform: uppercase;">Data Sources</span>
                    </div>
                    <div class="flow-row centered">
                        <div class="flow-box"><div class="flow-box-title">Microsoft 365</div><div class="flow-box-subtitle">Azure AD, Defender</div></div>
                        <div class="flow-box"><div class="flow-box-title">Azure</div><div class="flow-box-subtitle">Activity, Resources</div></div>
                        <div class="flow-box"><div class="flow-box-title">On-Premises</div><div class="flow-box-subtitle">Servers, Network</div></div>
                        <div class="flow-box"><div class="flow-box-title">Third Party</div><div class="flow-box-subtitle">AWS, Okta, etc.</div></div>
                    </div>
                    
                    <div class="flow-arrow down">↓ ↓ ↓ ↓</div>
                    
                    <!-- Ingestion Layer -->
                    <div style="text-align: center; margin: 16px 0;">
                        <span style="color: #8b949e; font-size: 0.85rem; text-transform: uppercase;">Ingestion Layer</span>
                    </div>
                    <div class="flow-row centered">
                        <div class="flow-box success"><div class="flow-box-title">Native Connectors</div><div class="flow-box-subtitle">Service-to-Service</div></div>
                        <div class="flow-box success"><div class="flow-box-title">AMA + DCR</div><div class="flow-box-subtitle">Syslog/CEF</div></div>
                        <div class="flow-box success"><div class="flow-box-title">Logs Ingestion API</div><div class="flow-box-subtitle">Custom Sources</div></div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <!-- Storage Layer -->
                    <div class="flow-row centered">
                        <div class="flow-box primary" style="min-width: 400px;">
                            <div class="flow-box-title">Log Analytics Workspace</div>
                            <div class="flow-box-subtitle">Tables: SecurityEvent, Syslog, SigninLogs, Custom_CL</div>
                        </div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <!-- Analysis Layer -->
                    <div style="text-align: center; margin: 16px 0;">
                        <span style="color: #8b949e; font-size: 0.85rem; text-transform: uppercase;">Microsoft Sentinel</span>
                    </div>
                    <div class="flow-row centered">
                        <div class="flow-box warning"><div class="flow-box-title">Analytics Rules</div><div class="flow-box-subtitle">Detection</div></div>
                        <div class="flow-box purple"><div class="flow-box-title">Incidents</div><div class="flow-box-subtitle">Investigation</div></div>
                        <div class="flow-box danger"><div class="flow-box-title">Playbooks</div><div class="flow-box-subtitle">Response</div></div>
                        <div class="flow-box"><div class="flow-box-title">Workbooks</div><div class="flow-box-subtitle">Dashboards</div></div>
                    </div>
                </div>

                <!-- WORKSPACE DESIGN -->
                <h2><i class="fas fa-drafting-compass"></i> Workspace Design Patterns</h2>
                
                <div class="decision-tree">
                    <div class="decision-node">
                        <div class="decision-node-question">How many Log Analytics Workspaces do you need?</div>
                    </div>
                    <div class="decision-paths">
                        <div class="decision-path">
                            <div class="decision-path-label yes">Single Workspace (Recommended)</div>
                            <div class="decision-path-content">
                                <p style="color: #3fb950; font-weight: 600;">→ Most organizations</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Simpler management, unified detection, better correlation. Use RBAC for access control.</p>
                            </div>
                        </div>
                        <div class="decision-path">
                            <div class="decision-path-label no">Multiple Workspaces</div>
                            <div class="decision-path-content">
                                <p style="color: #d29922; font-weight: 600;">→ Special requirements only</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Data residency, strict isolation, separate billing, MSPs.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="styled-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Pattern</th>
                                <th>When to Use</th>
                                <th>Considerations</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Single Workspace</strong></td>
                                <td>Most enterprises, single region</td>
                                <td>Best correlation, simplest management</td>
                            </tr>
                            <tr>
                                <td><strong>Regional Workspaces</strong></td>
                                <td>Data residency requirements (GDPR)</td>
                                <td>Cross-workspace queries needed, complex</td>
                            </tr>
                            <tr>
                                <td><strong>Tenant per Customer (MSSP)</strong></td>
                                <td>Managed security service providers</td>
                                <td>Azure Lighthouse for central management</td>
                            </tr>
                            <tr>
                                <td><strong>Dev/Test + Production</strong></td>
                                <td>Rule testing, cost separation</td>
                                <td>Minimal data in dev, full in prod</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- DATA TIERS -->
                <h2><i class="fas fa-layer-group"></i> Data Retention Tiers</h2>
                
                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-clock"></i> Log Analytics Data Lifecycle</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box success" style="min-width: 180px;">
                            <div class="flow-box-title">Analytics Logs</div>
                            <div class="flow-box-subtitle">Full KQL, 30-730 days</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box warning" style="min-width: 180px;">
                            <div class="flow-box-title">Basic Logs</div>
                            <div class="flow-box-subtitle">Limited KQL, 8 days</div>
                        </div>
                        <span class="flow-arrow">→</span>
                        <div class="flow-box purple" style="min-width: 180px;">
                            <div class="flow-box-title">Archive Tier</div>
                            <div class="flow-box-subtitle">Search jobs, 7 years</div>
                        </div>
                    </div>
                </div>

                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-bolt"></i></div>
                            <div class="comparison-item-title">Analytics Logs</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Full KQL query capabilities</li>
                            <li><i class="fas fa-check"></i> Real-time analytics rules</li>
                            <li><i class="fas fa-check"></i> Interactive investigations</li>
                            <li><i class="fas fa-dollar-sign"></i> Highest cost tier</li>
                            <li><i class="fas fa-clock"></i> 30-730 day retention</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d3a0d; color: #d29922;"><i class="fas fa-coins"></i></div>
                            <div class="comparison-item-title">Basic Logs</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> 8x cheaper than Analytics</li>
                            <li><i class="fas fa-times"></i> Limited KQL (no joins)</li>
                            <li><i class="fas fa-times"></i> No analytics rules</li>
                            <li><i class="fas fa-check"></i> Search for known data</li>
                            <li><i class="fas fa-clock"></i> 8-day interactive + archive</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #3d2a5e; color: #a371f7;"><i class="fas fa-archive"></i></div>
                            <div class="comparison-item-title">Archive Tier</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Cheapest storage</li>
                            <li><i class="fas fa-times"></i> No direct queries</li>
                            <li><i class="fas fa-check"></i> Search jobs (async)</li>
                            <li><i class="fas fa-check"></i> Restore to Analytics</li>
                            <li><i class="fas fa-clock"></i> Up to 7 years</li>
                        </ul>
                    </div>
                </div>

                <!-- DCR/DCE ARCHITECTURE -->
                <h2><i class="fas fa-stream"></i> Data Collection Architecture</h2>
                
                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-project-diagram"></i> DCR/DCE Data Flow</div>
                    
                    <div class="flow-row">
                        <div class="flow-box"><div class="flow-box-title">Syslog Source</div><div class="flow-box-subtitle">Firewall</div></div>
                        <div class="flow-box"><div class="flow-box-title">Custom App</div><div class="flow-box-subtitle">REST API</div></div>
                        <div class="flow-box"><div class="flow-box-title">Azure VM</div><div class="flow-box-subtitle">Windows/Linux</div></div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box success"><div class="flow-box-title">Azure Monitor Agent</div><div class="flow-box-subtitle">On VMs</div></div>
                        <div class="flow-box warning"><div class="flow-box-title">Logs Ingestion API</div><div class="flow-box-subtitle">HTTP POST</div></div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box purple" style="min-width: 300px;">
                            <div class="flow-box-title">Data Collection Endpoint (DCE)</div>
                            <div class="flow-box-subtitle">Regional ingestion endpoint</div>
                        </div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box danger" style="min-width: 300px;">
                            <div class="flow-box-title">Data Collection Rule (DCR)</div>
                            <div class="flow-box-subtitle">Transform (KQL) → Route → Destination</div>
                        </div>
                    </div>
                    
                    <div class="flow-arrow down">↓</div>
                    
                    <div class="flow-row centered">
                        <div class="flow-box primary" style="min-width: 300px;">
                            <div class="flow-box-title">Log Analytics Workspace</div>
                            <div class="flow-box-subtitle">Target Table(s)</div>
                        </div>
                    </div>
                </div>

                <!-- ENTERPRISE EXAMPLE -->
                <div class="enterprise-example">
                    <div class="enterprise-example-header">
                        <i class="fas fa-building"></i>
                        <div class="enterprise-example-title">Enterprise Example: Healthcare Organization (HIPAA)</div>
                    </div>
                    <div class="enterprise-example-scenario">
                        <strong>Scenario:</strong> Healthcare system with 5,000 employees, Azure-heavy infrastructure, HIPAA compliance, 24/7 SOC.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-top: 16px;">
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #3fb950; margin-top: 0;">Workspace Design</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                <strong>Pattern:</strong> Single workspace<br>
                                <strong>Region:</strong> East US 2 (primary)<br>
                                <strong>Retention:</strong> 2 years (HIPAA)<br>
                                <strong>Access:</strong> RBAC by team
                            </p>
                        </div>
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #58a6ff; margin-top: 0;">Data Sources</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                <strong>Microsoft:</strong> Azure AD, M365, MDE<br>
                                <strong>Network:</strong> Palo Alto via AMA<br>
                                <strong>Apps:</strong> Epic EMR via API<br>
                                <strong>Volume:</strong> ~150GB/day
                            </p>
                        </div>
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #d29922; margin-top: 0;">Cost Optimization</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                <strong>Commitment:</strong> 200GB/day tier<br>
                                <strong>Basic Logs:</strong> Network flow data<br>
                                <strong>Free tier:</strong> Azure Activity<br>
                                <strong>Archive:</strong> After 90 days
                            </p>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px; padding: 12px; background: #161b22; border-radius: 8px;">
                        <p style="color: #8b949e; font-size: 0.85rem; margin: 0;">
                            <strong style="color: #3fb950;">Architecture Decisions:</strong><br>
                            • <strong>Single workspace:</strong> Better correlation, simpler HIPAA audit, RBAC sufficient for access control<br>
                            • <strong>2-year retention:</strong> HIPAA requires 6 years for some data - using archive tier for cost savings<br>
                            • <strong>Basic Logs for flow data:</strong> High volume, rarely queried except for specific investigations<br>
                            • <strong>Native Microsoft connectors:</strong> Azure AD, MDE alerts free, bi-directional sync
                        </p>
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question">Q: What is the relationship between Log Analytics and Microsoft Sentinel?</button>
                        <div class="qa-answer">
                            <p><strong>Log Analytics Workspace:</strong></p>
                            <ul>
                                <li>Azure Monitor service for log storage and queries</li>
                                <li>Provides the data platform (tables, KQL engine)</li>
                                <li>Can exist without Sentinel (for IT ops monitoring)</li>
                            </ul>
                            <p><strong>Microsoft Sentinel:</strong></p>
                            <ul>
                                <li>Security layer built ON TOP of Log Analytics</li>
                                <li>Adds: Analytics rules, incidents, SOAR, threat hunting</li>
                                <li>Requires Log Analytics Workspace as foundation</li>
                                <li>"Enable Sentinel" = add security features to existing workspace</li>
                            </ul>
                            <p><strong>Key point:</strong> You pay for Log Analytics (data storage) + Sentinel (security features) separately.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: How do you reduce Sentinel costs?</button>
                        <div class="qa-answer">
                            <p><strong>Cost optimization strategies:</strong></p>
                            <ul>
                                <li><strong>Commitment tiers:</strong> 100GB/day+ gets 30-50% discount</li>
                                <li><strong>Basic Logs:</strong> 8x cheaper for high-volume, low-query data</li>
                                <li><strong>DCR filtering:</strong> Drop non-security events before ingestion</li>
                                <li><strong>Free data sources:</strong> Azure Activity, M365 Defender alerts</li>
                                <li><strong>Archive tier:</strong> Move old data to cheap storage</li>
                                <li><strong>Right-size retention:</strong> Don't keep Analytics tier longer than needed</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
            <footer class="main-footer">
                <div class="footer-content">
                    <p>Nik's SIEM Compendium</p>
                </div>
            </footer>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) {
                    answer.style.display = 'block';
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
