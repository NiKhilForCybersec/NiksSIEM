<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phishing Analysis | SOC Operations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <main class="main-content">
            <a href="../index.html" class="back-home"><i class="fas fa-arrow-left"></i> Nik's SIEM</a>
            
            <div class="breadcrumb">
                <a href="../index.html">Home</a>
                <span class="separator">/</span>
                <a href="index.html">SOC Operations</a>
                <span class="separator">/</span>
                <span class="current">Phishing Analysis</span>
            </div>

<h1><i class="fas fa-fish"></i> Phishing Analysis</h1>
                <p class="lead">Analyze and respond to phishing attacks effectively. Learn email header analysis, URL investigation, attachment handling, and response procedures.</p>

                <!-- Phishing Overview -->
                <h2><i class="fas fa-info-circle"></i> Phishing Overview</h2>
                <div class="config-section">
                    <h4>Phishing Types</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Type</th><th>Description</th><th>Target</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Mass Phishing</strong></td><td>Generic, broad campaigns</td><td>Anyone</td></tr>
                            <tr><td><strong>Spear Phishing</strong></td><td>Targeted, personalized</td><td>Specific individuals</td></tr>
                            <tr><td><strong>Whaling</strong></td><td>Executive targeting</td><td>C-suite, leadership</td></tr>
                            <tr><td><strong>BEC</strong></td><td>Business Email Compromise</td><td>Finance, HR</td></tr>
                            <tr><td><strong>Vishing</strong></td><td>Voice phishing</td><td>Phone users</td></tr>
                            <tr><td><strong>Smishing</strong></td><td>SMS phishing</td><td>Mobile users</td></tr>
                        </tbody>
                    </table>

                    <h4>Common Phishing Goals</h4>
                    <ul style="color: #8b949e;">
                        <li><strong>Credential Theft:</strong> Steal login credentials</li>
                        <li><strong>Malware Delivery:</strong> Install malicious software</li>
                        <li><strong>Financial Fraud:</strong> Wire transfers, gift cards</li>
                        <li><strong>Data Theft:</strong> Exfiltrate sensitive data</li>
                        <li><strong>Initial Access:</strong> Foothold for larger attack</li>
                    </ul>
                </div>

                <!-- Email Header Analysis -->
                <h2><i class="fas fa-envelope"></i> Email Header Analysis</h2>
                <div class="config-section">
                    <h4>Key Headers to Examine</h4>
                    <div class="code-block">Critical Email Headers:

From:
- Display name vs actual address
- Spoofed display names common

Return-Path:
- Where bounces go
- Should match From domain

Received:
- Shows email path (read bottom to top)
- First "Received" = originating server
- Check for suspicious hops

X-Originating-IP:
- Original sender IP
- Useful for geolocation

Authentication-Results:
- SPF: pass/fail
- DKIM: pass/fail
- DMARC: pass/fail

Message-ID:
- Unique identifier
- Suspicious if missing or malformed</div>

                    <h4>Reading Received Headers</h4>
                    <div class="code-block">Received Headers (read bottom-up):

Received: from mail.company.com (10.0.0.5) 
  by exchange.target.com with SMTP; 
  Mon, 15 Jan 2024 10:30:00 -0500    ← Final hop (your server)

Received: from smtp.sender.com (192.168.1.100)
  by mail.company.com with ESMTP;
  Mon, 15 Jan 2024 10:29:55 -0500    ← Intermediate

Received: from attacker.evil.com (203.0.113.50)
  by smtp.sender.com with SMTP;
  Mon, 15 Jan 2024 10:29:50 -0500    ← Origin (suspicious!)

Analysis:
- Origin IP: 203.0.113.50
- Claims to be from legitimate domain
- But originates from attacker.evil.com</div>

                    <h4>SPF/DKIM/DMARC Analysis</h4>
                    <div class="code-block">Authentication Results:

SPF (Sender Policy Framework):
- Checks if sending IP is authorized
- pass = IP authorized for domain
- fail = IP not authorized (spoofed)
- softfail = Not authorized, don't reject

DKIM (DomainKeys Identified Mail):
- Cryptographic signature
- pass = Signature valid
- fail = Signature invalid or missing

DMARC (Domain-based Message Authentication):
- Policy combining SPF + DKIM
- pass = SPF and/or DKIM pass, aligned
- fail = Neither passed or not aligned

Red Flags:
- SPF fail + legitimate-looking sender
- No DKIM signature
- DMARC fail on major brand</div>
                </div>

                <!-- URL Analysis -->
                <h2><i class="fas fa-link"></i> URL Analysis</h2>
                <div class="config-section">
                    <div class="warning-box">
                        <strong>⚠️ Safety First:</strong> Never click suspicious URLs directly. Use sandboxed tools and defanged URLs for analysis.
                    </div>

                    <h4>URL Red Flags</h4>
                    <div class="code-block">Suspicious URL Indicators:

Domain Issues:
- Misspelled brands (micros0ft.com)
- Extra words (microsoft-login.com)
- Suspicious TLDs (.xyz, .top, .work)
- IP addresses instead of domains
- Very long subdomains

Path/Query Issues:
- Encoded characters (%20, %3D)
- Base64 strings
- Email address in URL
- Random strings

URL Shorteners:
- bit.ly, tinyurl, etc.
- Hide true destination
- Expand before analysis

Examples:
Bad:  http://microsoft-secure-login.com/verify
Bad:  http://192.168.1.1/office365/login.php
Bad:  https://login.microsoft.com.evil.com/
Good: https://login.microsoftonline.com/</div>

                    <h4>URL Analysis Tools</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Tool</th><th>Purpose</th><th>URL</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>VirusTotal</td><td>URL reputation</td><td>virustotal.com</td></tr>
                            <tr><td>URLScan.io</td><td>URL scanning, screenshots</td><td>urlscan.io</td></tr>
                            <tr><td>URLhaus</td><td>Malware URL database</td><td>urlhaus.abuse.ch</td></tr>
                            <tr><td>PhishTank</td><td>Phishing URL database</td><td>phishtank.com</td></tr>
                            <tr><td>Any.Run</td><td>Interactive sandbox</td><td>any.run</td></tr>
                            <tr><td>Hybrid Analysis</td><td>File/URL sandbox</td><td>hybrid-analysis.com</td></tr>
                        </tbody>
                    </table>

                    <h4>Defanging URLs</h4>
                    <div class="code-block">Defanging for Safe Sharing:

Original: https://malicious.com/payload.exe
Defanged: hxxps://malicious[.]com/payload[.]exe

Replacements:
- http → hxxp
- https → hxxps
- . → [.]
- @ → [@]

Tools:
- CyberChef "Defang URL" recipe
- Online defangers
- Manual replacement</div>
                </div>

                <!-- Attachment Analysis -->
                <h2><i class="fas fa-paperclip"></i> Attachment Analysis</h2>
                <div class="config-section">
                    <div class="warning-box">
                        <strong>⚠️ Never open suspicious attachments on production systems!</strong> Use isolated VMs or sandbox services.
                    </div>

                    <h4>Dangerous File Types</h4>
                    <div class="code-block">High-Risk Extensions:

Executable:
.exe, .dll, .scr, .bat, .cmd, .ps1, .vbs, .js

Office with Macros:
.docm, .xlsm, .pptm, .dotm

Archives (may contain above):
.zip, .rar, .7z, .iso, .img

Scripts:
.hta, .wsf, .jar, .py

Double Extensions (deceptive):
invoice.pdf.exe
document.docx.js

Tricks:
- Right-to-left override (RTLO)
- Hidden extensions
- Password-protected archives</div>

                    <h4>Static Analysis</h4>
                    <div class="code-block">Without Executing:

File Hash:
- Get MD5, SHA256
- Check VirusTotal, Malware Bazaar

Strings Analysis:
- Extract readable strings
- Look for URLs, IPs, commands
- strings malware.exe | grep http

Office Documents:
- Check for macros (olevba)
- Extract embedded objects
- Look for auto-execute

PDF Analysis:
- Check for JavaScript
- Look for embedded files
- Tools: pdf-parser, pdfid

Tools:
- VirusTotal
- Malware Bazaar
- olevba (oletools)
- pdfid, pdf-parser
- PEStudio (for executables)</div>

                    <h4>Dynamic Analysis (Sandbox)</h4>
                    <div class="code-block">Sandbox Analysis:

Services:
- Any.Run (interactive)
- Hybrid Analysis
- Joe Sandbox
- Cuckoo (self-hosted)

What to Look For:
- Network connections (C2)
- File system changes
- Registry modifications
- Process creation
- Dropped files

Behavioral Indicators:
- Contacts external IP
- Creates persistence
- Modifies system files
- Spawns suspicious processes</div>
                </div>

                <!-- Analysis Workflow -->
                <h2><i class="fas fa-tasks"></i> Phishing Analysis Workflow</h2>
                <div class="config-section">
                    <div class="code-block">Phishing Analysis Checklist:

□ INITIAL TRIAGE
  □ Who reported it?
  □ How many recipients?
  □ Did anyone click/interact?

□ HEADER ANALYSIS
  □ Check From vs Return-Path
  □ Analyze Received headers
  □ Check SPF/DKIM/DMARC
  □ Note originating IP

□ CONTENT ANALYSIS
  □ Urgency/fear tactics?
  □ Grammar/spelling errors?
  □ Mismatched branding?
  □ Unusual request?

□ URL ANALYSIS
  □ Defang all URLs
  □ Check in VirusTotal
  □ Scan with URLScan.io
  □ Note true destination

□ ATTACHMENT ANALYSIS
  □ Get file hash
  □ Check VirusTotal
  □ Sandbox if needed
  □ Document findings

□ SCOPE ASSESSMENT
  □ Search for similar emails
  □ Identify all recipients
  □ Check for clicks/submissions

□ RESPONSE
  □ Block sender/domain
  □ Block URLs
  □ Remove from mailboxes
  □ Notify affected users</div>
                </div>

                <!-- Response Actions -->
                <h2><i class="fas fa-shield-alt"></i> Response Actions</h2>
                <div class="config-section">
                    <h4>Immediate Actions</h4>
                    <div class="code-block">If Phishing Confirmed:

1. CONTAIN
   - Block sender address
   - Block sender domain (if malicious)
   - Block URLs in proxy/firewall
   - Block file hash

2. ERADICATE
   - Remove from all mailboxes
   - Purge from quarantine
   - Clear browser cache if clicked

3. ASSESS
   - Who received the email?
   - Who clicked/opened?
   - Any credentials entered?

4. REMEDIATE
   - Reset passwords if credentials stolen
   - Scan endpoints if attachments opened
   - Review for compromise indicators

5. COMMUNICATE
   - Notify affected users
   - Send awareness reminder
   - Update leadership if significant</div>

                    <h4>Email Removal Commands</h4>
                    <div class="code-block">Microsoft 365 (Compliance Search):

# Create search
New-ComplianceSearch -Name "Phishing Removal" `
  -ExchangeLocation All `
  -ContentMatchQuery 'subject:"Urgent Invoice" AND from:attacker@evil.com'

# Start search
Start-ComplianceSearch -Identity "Phishing Removal"

# Preview results
Get-ComplianceSearchAction -Identity "Phishing Removal_Preview"

# Delete (Hard Delete)
New-ComplianceSearchAction -SearchName "Phishing Removal" `
  -Purge -PurgeType HardDelete</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk through how you analyze a reported phishing email.</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Get the email:</strong> Original with headers (not forwarded)</li>
                                <li><strong>Analyze headers:</strong> Check From, Return-Path, Received, authentication</li>
                                <li><strong>Examine content:</strong> Look for urgency, errors, suspicious requests</li>
                                <li><strong>Check URLs:</strong> Defang, scan in VT/URLScan</li>
                                <li><strong>Analyze attachments:</strong> Hash check, sandbox if needed</li>
                                <li><strong>Determine scope:</strong> How many received, who clicked</li>
                                <li><strong>Take action:</strong> Block, remove, notify</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What are the key indicators of a phishing email?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Sender:</strong> Spoofed domain, suspicious address</li>
                                <li><strong>Authentication:</strong> SPF/DKIM/DMARC failures</li>
                                <li><strong>Content:</strong> Urgency, threats, too-good offers</li>
                                <li><strong>Links:</strong> Mismatched URLs, suspicious domains</li>
                                <li><strong>Attachments:</strong> Unexpected files, dangerous types</li>
                                <li><strong>Request:</strong> Credentials, money, sensitive data</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: A user clicked a phishing link and entered credentials. What do you do?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Reset password immediately</strong></li>
                                <li><strong>Revoke active sessions</strong></li>
                                <li><strong>Enable MFA if not present</strong></li>
                                <li><strong>Check for mailbox rules</strong> (auto-forwarding)</li>
                                <li><strong>Review sign-in logs</strong> for unauthorized access</li>
                                <li><strong>Scan endpoint</strong> for malware</li>
                                <li><strong>Monitor account</strong> for suspicious activity</li>
                            </ol>
                        </div>
                    </div>
                </div>

        </main>
    </div>
    <script>
        // Q&A toggle functionality
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) { answer.style.display = 'block'; }
            });
        });
    </script>
</body>
</html>