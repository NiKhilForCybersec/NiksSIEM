<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Use Cases | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Splunk Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                    <a href="es-overview.html" class="nav-link"><i class="fas fa-shield-alt"></i> Enterprise Security</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Data Ingestion</a>
                    <a href="forwarders.html" class="nav-link"><i class="fas fa-share"></i> Forwarders</a>
                    <a href="custom-log-onboarding.html" class="nav-link"><i class="fas fa-file-import"></i> Custom Onboarding</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & Fields</a>
                    <a href="data-models.html" class="nav-link"><i class="fas fa-cubes"></i> Data Models & CIM</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">SPL Query Language</div>
                    <a href="spl-fundamentals.html" class="nav-link"><i class="fas fa-terminal"></i> SPL Fundamentals</a>
                    <a href="spl-intermediate.html" class="nav-link"><i class="fas fa-code"></i> SPL Intermediate</a>
                    <a href="spl-advanced.html" class="nav-link"><i class="fas fa-rocket"></i> SPL Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Security Operations</div>
                    <a href="correlation-searches.html" class="nav-link"><i class="fas fa-project-diagram"></i> Correlation Searches</a>
                    <a href="notable-events.html" class="nav-link"><i class="fas fa-exclamation-triangle"></i> Notable Events</a>
                    <a href="risk-based-alerting.html" class="nav-link"><i class="fas fa-chart-line"></i> Risk-Based Alerting</a>
                    <a href="threat-hunting.html" class="nav-link"><i class="fas fa-crosshairs"></i> Threat Hunting</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-skull-crossbones"></i> Threat Intelligence</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Administration</div>
                    <a href="administration.html" class="nav-link"><i class="fas fa-cog"></i> Administration</a>
                    <a href="apps-tas.html" class="nav-link"><i class="fas fa-puzzle-piece"></i> Apps & Add-ons</a>
                    <a href="dashboards.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboards</a>
                    <a href="retention-tiers.html" class="nav-link"><i class="fas fa-archive"></i> Storage Tiers</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Splunk</a><span class="separator">/</span>
                    <span class="current">Security Use Cases</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-shield-alt"></i> Security Use Cases</h1>
                <p class="lead">Production-ready SPL queries for common security monitoring scenarios. Each use case includes the query, explanation, and guidance for implementation.</p>

                <!-- Authentication Monitoring -->
                <h2><i class="fas fa-sign-in-alt"></i> Authentication Monitoring</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1110</span> Brute Force Detection</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4625
| bin _time span=10m
| stats count as failed_attempts, 
        dc(TargetUserName) as targeted_accounts,
        values(TargetUserName) as accounts 
        by src_ip, _time
| where failed_attempts > 10 OR targeted_accounts > 3
| eval attack_type = case(
    targeted_accounts > 5 AND failed_attempts > 20, "Credential Stuffing",
    targeted_accounts == 1 AND failed_attempts > 10, "Brute Force - Single Account",
    targeted_accounts > 1, "Password Spraying",
    1=1, "Multiple Failed Logins"
)
| table _time, src_ip, attack_type, failed_attempts, targeted_accounts, accounts</div>
                    <p style="color: #8b949e; margin-top: 12px;"><strong>Explanation:</strong> Groups failed logins by source IP in 10-minute windows. Triggers on >10 failures or >3 targeted accounts. Classifies attack type based on pattern.</p>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1078</span> Successful Login After Multiple Failures</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode IN (4625, 4624)
| eval status = if(EventCode=4625, "failure", "success")
| stats 
    count(eval(status="failure")) as failures,
    count(eval(status="success")) as successes,
    latest(_time) as last_event
    by src_ip, TargetUserName
| where failures > 5 AND successes > 0
| eval risk = if(failures > 20, "High", if(failures > 10, "Medium", "Low"))
| table src_ip, TargetUserName, failures, successes, risk, last_event</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1078</span> After-Hours Authentication</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4624 Logon_Type IN (2, 10)
| eval hour = strftime(_time, "%H")
| eval day = strftime(_time, "%w")
| where (hour < "06" OR hour > "20") OR (day = "0" OR day = "6")
| eval time_context = case(
    day = "0" OR day = "6", "Weekend",
    hour < "06", "Early Morning",
    hour > "20", "Late Night"
)
| stats count by TargetUserName, Workstation_Name, src_ip, time_context
| sort - count</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1078</span> Impossible Travel Detection</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4624
| iplocation src_ip
| sort TargetUserName, _time
| streamstats current=f last(City) as prev_city, last(lat) as prev_lat, 
              last(lon) as prev_lon, last(_time) as prev_time by TargetUserName
| eval time_diff_hours = (_time - prev_time) / 3600
| eval distance_km = round(3959 * acos(
    sin(lat * 3.14159/180) * sin(prev_lat * 3.14159/180) + 
    cos(lat * 3.14159/180) * cos(prev_lat * 3.14159/180) * 
    cos((lon - prev_lon) * 3.14159/180)
) * 1.60934, 0)
| eval speed_kmh = round(distance_km / time_diff_hours, 0)
| where speed_kmh > 800 AND distance_km > 500
| table _time, TargetUserName, prev_city, City, distance_km, time_diff_hours, speed_kmh</div>
                </div>

                <!-- Malware Detection -->
                <h2><i class="fas fa-bug"></i> Malware Detection</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1059.001</span> PowerShell Encoded Commands</h3>
                    <div class="code-block">index=sysmon EventCode=1 
    (Image="*powershell.exe" OR Image="*pwsh.exe")
    (CommandLine="*-enc*" OR CommandLine="*-EncodedCommand*" OR CommandLine="*-e *")
| eval encoded_length = len(mvindex(split(CommandLine, " "), -1))
| where encoded_length > 100
| table _time, host, User, CommandLine, ParentImage, encoded_length
| sort - encoded_length</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1059.001</span> PowerShell Download Cradle</h3>
                    <div class="code-block">index=sysmon EventCode=1 
    (Image="*powershell.exe" OR Image="*pwsh.exe")
    (CommandLine="*Net.WebClient*" OR CommandLine="*DownloadString*" OR 
     CommandLine="*DownloadFile*" OR CommandLine="*Invoke-WebRequest*" OR
     CommandLine="*iwr *" OR CommandLine="*wget *" OR CommandLine="*curl *" OR
     CommandLine="*Start-BitsTransfer*" OR CommandLine="*Invoke-RestMethod*")
| rex field=CommandLine "(?i)(https?://[^\s\"']+)" as download_url
| table _time, host, User, CommandLine, download_url, ParentImage
| sort - _time</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1218</span> LOLBin Abuse</h3>
                    <div class="code-block">index=sysmon EventCode=1
    (Image="*certutil.exe" OR Image="*mshta.exe" OR Image="*regsvr32.exe" OR
     Image="*rundll32.exe" OR Image="*msiexec.exe" OR Image="*cmstp.exe" OR
     Image="*wmic.exe" OR Image="*installutil.exe" OR Image="*regasm.exe")
    (CommandLine="*http*" OR CommandLine="*ftp*" OR CommandLine="*\\\\*" OR
     CommandLine="*-decode*" OR CommandLine="*/i:*" OR CommandLine="*scrobj*")
| eval technique = case(
    match(Image, "certutil"), "Certutil download/decode",
    match(Image, "mshta"), "MSHTA script execution",
    match(Image, "regsvr32"), "Regsvr32 COM scriptlet",
    match(Image, "wmic"), "WMIC remote execution",
    1=1, "LOLBin abuse"
)
| table _time, host, User, Image, CommandLine, technique, ParentImage</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1055</span> Suspicious Process Injection Indicators</h3>
                    <div class="code-block">index=sysmon EventCode=8
| where SourceImage != TargetImage
| eval suspicious = if(
    match(TargetImage, "(?i)(lsass|services|svchost|winlogon|csrss)"), "High", "Medium")
| where NOT match(SourceImage, "(?i)(mcafee|symantec|defender|crowdstrike)")
| stats count by SourceImage, TargetImage, suspicious
| where count > 1
| sort - suspicious, - count</div>
                </div>

                <!-- Lateral Movement -->
                <h2><i class="fas fa-arrows-alt"></i> Lateral Movement Detection</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1021.002</span> SMB Lateral Movement</h3>
                    <div class="code-block">index=firewall dest_port=445
| where NOT cidrmatch("0.0.0.0/0", src_ip) AND cidrmatch("10.0.0.0/8", dest_ip)
| stats dc(dest_ip) as unique_targets, 
        values(dest_ip) as targets,
        count as connection_count 
        by src_ip
| where unique_targets > 5
| sort - unique_targets
| eval alert = if(unique_targets > 20, "Critical", if(unique_targets > 10, "High", "Medium"))</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1021.001</span> RDP Connection Monitoring</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4624 Logon_Type=10
| stats 
    count as rdp_connections,
    dc(Workstation_Name) as unique_sources,
    values(Workstation_Name) as sources 
    by TargetUserName
| where rdp_connections > 10 OR unique_sources > 5
| table TargetUserName, rdp_connections, unique_sources, sources

// Also check for RDP to non-standard ports
index=firewall dest_port!=3389 application=rdp
| stats count by src_ip, dest_ip, dest_port</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1047</span> WMI Remote Execution</h3>
                    <div class="code-block">index=sysmon EventCode=1 
    Image="*wmic.exe" CommandLine="*/node:*"
| rex field=CommandLine "/node:(?<target_host>\S+)"
| stats count by host, User, target_host, CommandLine
| table _time, host, User, target_host, CommandLine

// WMI process spawning
index=sysmon EventCode=1 ParentImage="*WmiPrvSE.exe"
| where Image IN ("*cmd.exe", "*powershell.exe", "*cscript.exe", "*wscript.exe")
| table _time, host, User, ParentImage, Image, CommandLine</div>
                </div>

                <!-- Persistence Detection -->
                <h2><i class="fas fa-anchor"></i> Persistence Detection</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1547.001</span> Registry Run Key Modification</h3>
                    <div class="code-block">index=sysmon EventCode=13 
    (TargetObject="*\\CurrentVersion\\Run*" OR 
     TargetObject="*\\CurrentVersion\\RunOnce*")
    EventType=SetValue
| rex field=TargetObject "\\\\(?<key_name>[^\\\\]+)$"
| where NOT match(Details, "(?i)(microsoft|windows|vmware|crowdstrike)")
| table _time, host, User, TargetObject, key_name, Details, Image
| sort - _time</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1053.005</span> Scheduled Task Creation</h3>
                    <div class="code-block">index=sysmon EventCode=1 Image="*schtasks.exe" CommandLine="*/create*"
| rex field=CommandLine "/tn\s+\"?(?<task_name>[^\"\/]+)"
| rex field=CommandLine "/tr\s+\"?(?<task_action>[^\"]+)"
| where NOT match(task_name, "(?i)(microsoft|windows|adobe|google)")
| table _time, host, User, task_name, task_action, CommandLine
| sort - _time

// Also check Windows Event Log
index=security sourcetype=WinEventLog:Security EventCode=4698
| table _time, host, SubjectUserName, TaskName, TaskContent</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1543.003</span> Service Creation</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4697
| where NOT match(ServiceFileName, "(?i)(microsoft|windows|system32)")
| table _time, host, SubjectUserName, ServiceName, ServiceFileName, ServiceType

// Via sc.exe
index=sysmon EventCode=1 Image="*sc.exe" CommandLine="*create*"
| rex field=CommandLine "binPath=\s*\"?(?<binary_path>[^\"]+)"
| table _time, host, User, CommandLine, binary_path</div>
                </div>

                <!-- Data Exfiltration -->
                <h2><i class="fas fa-cloud-upload-alt"></i> Data Exfiltration Detection</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1048</span> Large Data Transfer</h3>
                    <div class="code-block">index=firewall direction=outbound
| where NOT cidrmatch("10.0.0.0/8", dest_ip)
| bin _time span=1h
| stats sum(bytes_out) as total_bytes by src_ip, dest_ip, _time
| where total_bytes > 104857600
| eval MB_transferred = round(total_bytes/1048576, 2)
| sort - MB_transferred
| table _time, src_ip, dest_ip, MB_transferred</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1567</span> Cloud Storage Upload</h3>
                    <div class="code-block">index=proxy 
    (url="*dropbox.com*" OR url="*drive.google.com*" OR url="*onedrive.live.com*" OR
     url="*mega.nz*" OR url="*box.com*" OR url="*wetransfer.com*")
    (http_method=POST OR http_method=PUT)
| stats sum(bytes_out) as total_bytes, count as upload_count by src_ip, user, url
| where total_bytes > 10485760
| eval MB_uploaded = round(total_bytes/1048576, 2)
| table src_ip, user, url, upload_count, MB_uploaded
| sort - MB_uploaded</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1041</span> DNS Tunneling Detection</h3>
                    <div class="code-block">index=dns 
| eval query_length = len(query)
| where query_length > 50
| rex field=query "\.(?<domain>[^\.]+\.[^\.]+)$"
| stats 
    count as query_count,
    avg(query_length) as avg_length,
    dc(query) as unique_queries
    by src_ip, domain
| where query_count > 100 AND avg_length > 40
| eval suspicion = case(
    avg_length > 60 AND unique_queries > 1000, "High - Likely DNS Tunnel",
    avg_length > 50, "Medium - Investigate",
    1=1, "Low"
)
| table src_ip, domain, query_count, avg_length, unique_queries, suspicion</div>
                </div>

                <!-- Credential Access -->
                <h2><i class="fas fa-key"></i> Credential Access Detection</h2>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1003.001</span> LSASS Access</h3>
                    <div class="code-block">index=sysmon EventCode=10 TargetImage="*lsass.exe"
| where NOT match(SourceImage, "(?i)(csrss|wininit|svchost|mrt|defender)")
| stats count by SourceImage, SourceUser, GrantedAccess, host
| eval risk = case(
    match(GrantedAccess, "0x1FFFFF"), "Critical - Full Access",
    match(GrantedAccess, "0x1010"), "High - Read Memory",
    1=1, "Medium"
)
| sort - risk
| table host, SourceImage, SourceUser, GrantedAccess, risk, count</div>
                </div>

                <div class="usecase-card">
                    <h3><span class="mitre-tag">T1558.003</span> Kerberoasting Detection</h3>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4769 
    Ticket_Encryption_Type=0x17
| stats count by Client_Address, Service_Name, Account_Name
| where count > 5
| table Client_Address, Account_Name, Service_Name, count
| sort - count</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you detect credential stuffing vs brute force?</button>
                        <div class="qa-answer">
                            <p><strong>Key difference:</strong> Credential stuffing targets many accounts with few attempts each; brute force targets few accounts with many attempts.</p>
                            <div class="code-block">// Credential Stuffing Pattern
| stats dc(user) as unique_users, count as attempts by src_ip
| where unique_users > 10 AND attempts/unique_users < 3

// Brute Force Pattern
| stats dc(user) as unique_users, count as attempts by src_ip
| where unique_users <= 3 AND attempts > 20</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you reduce false positives in security alerts?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Whitelist known good:</strong> Exclude legitimate automation, service accounts</li>
                                <li><strong>Add context:</strong> Correlate with asset criticality, user role</li>
                                <li><strong>Tune thresholds:</strong> Adjust based on baseline analysis</li>
                                <li><strong>Time context:</strong> Consider business hours, maintenance windows</li>
                                <li><strong>Multi-stage detection:</strong> Require multiple indicators before alerting</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>