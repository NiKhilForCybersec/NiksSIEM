<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Use Cases | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="shared-styles.css">
    <link rel="stylesheet" href="../assets/css/main.css">


</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
        <!-- Sidebar -->
        <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo"><i class="fas fa-terminal"></i><span>Splunk Reference</span></a>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Certifications</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="power-user-certification.html" class="sidebar-nav-link"><i class="fas fa-user-graduate" style="color:#7ce38b"></i>Power User</a></li>
                        <li class="sidebar-nav-item"><a href="admin-certification.html" class="sidebar-nav-link"><i class="fas fa-user-cog" style="color:#f0883e"></i>Admin</a></li>
                        <li class="sidebar-nav-item"><a href="es-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-shield-alt" style="color:#8957e5"></i>ES Admin</a></li>
                        <li class="sidebar-nav-item"><a href="cloud-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-cloud" style="color:#39c5cf"></i>Cloud Admin</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Learning</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="when-to-use-what.html" class="sidebar-nav-link"><i class="fas fa-map-signs" style="color:#f0883e"></i>When to Use What</a></li>
                        <li class="sidebar-nav-item"><a href="spl-practice-questions.html" class="sidebar-nav-link"><i class="fas fa-tasks" style="color:#58a6ff"></i>Practice MCQs</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced-mcqs.html" class="sidebar-nav-link"><i class="fas fa-brain" style="color:#a371f7"></i>Advanced MCQs</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Reference</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-code"></i>SPL Fundamentals</a></li>
                        <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-layer-group"></i>SPL Intermediate</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i>SPL Advanced</a></li>
                        <li class="sidebar-nav-item"><a href="knowledge-objects.html" class="sidebar-nav-link"><i class="fas fa-lightbulb"></i>Knowledge Objects</a></li>
                        <li class="sidebar-nav-item"><a href="data-models.html" class="sidebar-nav-link"><i class="fas fa-cubes"></i>Data Models</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Administration</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i>Architecture</a></li>
                        <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i>Data Ingestion</a></li>
                        <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-share-alt"></i>Forwarders</a></li>
                        <li class="sidebar-nav-item"><a href="clustering-ha.html" class="sidebar-nav-link"><i class="fas fa-network-wired"></i>Clustering & HA</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Enterprise Security</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i>ES Overview</a></li>
                        <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-search-plus"></i>Correlation Searches</a></li>
                        <li class="sidebar-nav-item"><a href="risk-based-alerting.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i>Risk-Based Alerting</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Resources</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="lab-exercises.html" class="sidebar-nav-link"><i class="fas fa-flask"></i>Lab Exercises</a></li>
                        <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i>Troubleshooting</a></li>
                    </ul>
                </div>
            </div>
        </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Splunk</a>
                    <span class="separator">/</span>
                    <span class="current">Security Usecases</span>
                </div>

                <h1><i class="fas fa-lightbulb"></i> Security Use Cases</h1>
                <p class="lead">Comprehensive library of Splunk security use cases mapped to MITRE ATT&CK. Learn detection logic, implementation steps, and tuning strategies for enterprise security monitoring.</p>

                <!-- Use Case Framework -->
                <h2><i class="fas fa-sitemap"></i> Use Case Development Framework</h2>
                <div class="config-section">
                    <h4>Use Case Lifecycle</h4>
                    <div class="arch-diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USE CASE DEVELOPMENT LIFECYCLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PHASE 1           PHASE 2           PHASE 3           PHASE 4             â”‚
â”‚  REQUIREMENTS      DEVELOPMENT       DEPLOYMENT        OPERATIONS          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Identify â”‚     â”‚ Design   â”‚     â”‚ Test in  â”‚     â”‚ Monitor  â”‚          â”‚
â”‚  â”‚ Threat   â”‚â”€â”€â”€â”€â–¶â”‚ Detectionâ”‚â”€â”€â”€â”€â–¶â”‚ Lab/Dev  â”‚â”€â”€â”€â”€â–¶â”‚ FP Rate  â”‚          â”‚
â”‚  â”‚ Scenario â”‚     â”‚ Logic    â”‚     â”‚          â”‚     â”‚          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                â”‚                â”‚                â”‚                 â”‚
â”‚       â–¼                â–¼                â–¼                â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Map to   â”‚     â”‚ Write    â”‚     â”‚ Tune     â”‚     â”‚ Review   â”‚          â”‚
â”‚  â”‚ MITRE    â”‚â”€â”€â”€â”€â–¶â”‚ SPL      â”‚â”€â”€â”€â”€â–¶â”‚ Thresholdâ”‚â”€â”€â”€â”€â–¶â”‚ Quarterlyâ”‚          â”‚
â”‚  â”‚ ATT&CK   â”‚     â”‚ Query    â”‚     â”‚          â”‚     â”‚          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚                â”‚                â”‚                â”‚                 â”‚
â”‚       â–¼                â–¼                â–¼                â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Identify â”‚     â”‚ Create   â”‚     â”‚ Deploy   â”‚     â”‚ Retire   â”‚          â”‚
â”‚  â”‚ Data     â”‚â”€â”€â”€â”€â–¶â”‚ Notable  â”‚â”€â”€â”€â”€â–¶â”‚ to       â”‚â”€â”€â”€â”€â–¶â”‚ Outdated â”‚          â”‚
â”‚  â”‚ Sources  â”‚     â”‚ Event    â”‚     â”‚ Prod     â”‚     â”‚          â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</div>

                    <h4>Use Case Documentation Template</h4>
                    <div class="arch-diagram">USE CASE DOCUMENTATION:

METADATA:
â”œâ”€â”€ Use Case ID: UC-AUTH-001
â”œâ”€â”€ Name: Brute Force Authentication Attack
â”œâ”€â”€ Description: Detects multiple failed logins followed by success
â”œâ”€â”€ MITRE ATT&CK: T1110 (Brute Force)
â”œâ”€â”€ Data Sources: Authentication logs, Windows Security Events
â”œâ”€â”€ Severity: High
â””â”€â”€ Status: Production

DETECTION LOGIC:
â”œâ”€â”€ Threshold: >10 failed logins in 5 minutes
â”œâ”€â”€ Followed by: Successful login within 10 minutes
â”œâ”€â”€ Scope: Per user, per source IP
â””â”€â”€ Exclusions: Service accounts, known scanners

RESPONSE PLAYBOOK:
â”œâ”€â”€ Tier 1: Verify user, check source IP reputation
â”œâ”€â”€ Tier 2: Contact user, review account activity
â”œâ”€â”€ Escalation: Disable account if confirmed compromise
â””â”€â”€ Documentation: Incident ticket required

TUNING HISTORY:
â”œâ”€â”€ v1.0: Initial deployment, threshold 5 failures
â”œâ”€â”€ v1.1: Increased to 10, too many FPs from password resets
â””â”€â”€ v1.2: Added exclusion for helpdesk IP range</div>
                </div>

                <!-- Authentication Use Cases -->
                <h2><i class="fas fa-key"></i> Authentication Use Cases</h2>
                <div class="config-section">
                    <h4>UC-AUTH-001: Brute Force Detection</h4>
                    <div class="arch-diagram">USE CASE: Brute Force Authentication Attack
MITRE: T1110 - Brute Force
DATA MODEL: Authentication

DETECTION LOGIC:
| tstats summariesonly=true count from datamodel=Authentication 
    where Authentication.action=failure 
    by Authentication.user, Authentication.src, _time span=5m
| where count > 10
| join type=inner Authentication.user 
    [| tstats summariesonly=true count from datamodel=Authentication 
       where Authentication.action=success 
       by Authentication.user, Authentication.src, _time span=15m]
| table _time, Authentication.user, Authentication.src, count

CORRELATION SEARCH CONFIG:
â”œâ”€â”€ Schedule: Every 5 minutes
â”œâ”€â”€ Time Range: -15 minutes
â”œâ”€â”€ Throttling: Per user, per src, 1 hour
â””â”€â”€ Notable Event: Yes, Severity High

TUNING CONSIDERATIONS:
â”œâ”€â”€ Exclude service accounts
â”œâ”€â”€ Exclude known vulnerability scanners
â”œâ”€â”€ Adjust threshold based on environment
â””â”€â”€ Consider geographic anomalies</div>

                    <h4>UC-AUTH-002: Impossible Travel</h4>
                    <div class="arch-diagram">USE CASE: Impossible Travel Detection
MITRE: T1078 - Valid Accounts
DATA MODEL: Authentication

DETECTION LOGIC:
| tstats summariesonly=true latest(_time) as latest_time 
    earliest(_time) as earliest_time 
    values(Authentication.src) as sources 
    dc(Authentication.src) as source_count 
    from datamodel=Authentication 
    where Authentication.action=success 
    by Authentication.user
| where source_count > 1
| eval time_diff_hours = (latest_time - earliest_time) / 3600
| where time_diff_hours < 2
| iplocation sources
| eval distance = ... (calculate geographic distance)
| where distance > 500 AND time_diff_hours < (distance / 500)
| table user, sources, time_diff_hours, distance

IMPLEMENTATION NOTES:
â”œâ”€â”€ Requires GeoIP lookup
â”œâ”€â”€ VPN connections may cause false positives
â”œâ”€â”€ Consider excluding mobile users
â””â”€â”€ Integrate with identity provider data</div>

                    <h4>UC-AUTH-003: Password Spray</h4>
                    <div class="arch-diagram">USE CASE: Password Spray Attack
MITRE: T1110.003 - Password Spraying
DATA MODEL: Authentication

DETECTION LOGIC:
| tstats summariesonly=true dc(Authentication.user) as user_count 
    count as attempt_count 
    from datamodel=Authentication 
    where Authentication.action=failure 
    by Authentication.src, _time span=10m
| where user_count > 10 AND attempt_count > 20
| eval spray_ratio = user_count / attempt_count
| where spray_ratio > 0.5
| table _time, Authentication.src, user_count, attempt_count, spray_ratio

KEY INDICATORS:
â”œâ”€â”€ Many unique users targeted
â”œâ”€â”€ Single or few source IPs
â”œâ”€â”€ Short time window
â”œâ”€â”€ Similar failure reasons (wrong password)
â””â”€â”€ Often targets common usernames</div>
                </div>

                <!-- Endpoint Use Cases -->
                <h2><i class="fas fa-desktop"></i> Endpoint Use Cases</h2>
                <div class="config-section">
                    <h4>UC-END-001: Suspicious PowerShell</h4>
                    <div class="arch-diagram">USE CASE: Suspicious PowerShell Execution
MITRE: T1059.001 - PowerShell
DATA MODEL: Endpoint

DETECTION LOGIC:
| tstats summariesonly=true count from datamodel=Endpoint.Processes 
    where Processes.process_name="powershell.exe" OR Processes.process_name="pwsh.exe"
    by Processes.dest, Processes.user, Processes.process, Processes.parent_process
| search Processes.process IN ("*-enc*", "*-encodedcommand*", "*downloadstring*", 
    "*invoke-expression*", "*iex*", "*bypass*", "*hidden*", "*noprofile*")
| table _time, Processes.dest, Processes.user, Processes.process, Processes.parent_process

SEVERITY MATRIX:
â”œâ”€â”€ Encoded + Download: Critical
â”œâ”€â”€ Encoded only: High
â”œâ”€â”€ Download only: Medium
â”œâ”€â”€ Bypass/Hidden: Medium
â””â”€â”€ Base64 in command: High

EXCLUSIONS:
â”œâ”€â”€ Known IT management tools
â”œâ”€â”€ Software deployment systems
â”œâ”€â”€ Signed Microsoft scripts
â””â”€â”€ Documented automation</div>

                    <h4>UC-END-002: Living Off the Land</h4>
                    <div class="arch-diagram">USE CASE: LOLBin Abuse Detection
MITRE: T1218 - System Binary Proxy Execution
DATA MODEL: Endpoint

DETECTION LOGIC:
| tstats summariesonly=true count from datamodel=Endpoint.Processes 
    where Processes.process_name IN ("certutil.exe", "mshta.exe", "regsvr32.exe", 
        "rundll32.exe", "wmic.exe", "cscript.exe", "wscript.exe", "bitsadmin.exe",
        "msiexec.exe", "installutil.exe", "regasm.exe", "regsvcs.exe")
    by Processes.dest, Processes.user, Processes.process_name, 
       Processes.process, Processes.parent_process
| search Processes.process IN ("*http*", "*ftp*", "*/c*", "*-e*", "*-decode*", 
    "*script:*", "*dll:*", "*//e:*")
| table _time, Processes.dest, Processes.user, Processes.process_name, Processes.process

LOLBIN-SPECIFIC PATTERNS:
â”œâ”€â”€ certutil: -decode, -urlcache, -split
â”œâ”€â”€ mshta: http://, javascript:, vbscript:
â”œâ”€â”€ regsvr32: /s /n /u /i:http
â”œâ”€â”€ rundll32: javascript:, http://
â”œâ”€â”€ wmic: /node:, process call create
â””â”€â”€ bitsadmin: /transfer, /addfile</div>

                    <h4>UC-END-003: Persistence Mechanisms</h4>
                    <div class="arch-diagram">USE CASE: Registry Persistence Detection
MITRE: T1547.001 - Registry Run Keys
DATA MODEL: Endpoint

DETECTION LOGIC:
| tstats summariesonly=true count from datamodel=Endpoint.Registry 
    where Registry.registry_path IN ("*\\CurrentVersion\\Run*", 
        "*\\CurrentVersion\\RunOnce*", "*\\CurrentVersion\\RunServices*",
        "*\\Winlogon\\Shell*", "*\\Winlogon\\Userinit*")
    AND Registry.action IN ("created", "modified")
    by Registry.dest, Registry.user, Registry.registry_path, 
       Registry.registry_value_name, Registry.registry_value_data
| table _time, Registry.dest, Registry.user, Registry.registry_path, 
        Registry.registry_value_name, Registry.registry_value_data

OTHER PERSISTENCE LOCATIONS:
â”œâ”€â”€ Scheduled Tasks: EventCode=4698
â”œâ”€â”€ Services: EventCode=7045
â”œâ”€â”€ Startup Folder: file creation monitoring
â”œâ”€â”€ WMI Subscriptions: WMI event logs
â””â”€â”€ DLL Search Order: process monitoring</div>
                </div>

                <!-- Network Use Cases -->
                <h2><i class="fas fa-network-wired"></i> Network Use Cases</h2>
                <div class="config-section">
                    <h4>UC-NET-001: Beaconing Detection</h4>
                    <div class="arch-diagram">USE CASE: C2 Beaconing Detection
MITRE: T1071 - Application Layer Protocol
DATA MODEL: Network_Traffic

DETECTION LOGIC:
index=firewall OR index=proxy
| bin _time span=1h
| stats count as connections 
    dc(dest_port) as unique_ports 
    avg(bytes_out) as avg_bytes 
    stdev(bytes_out) as stdev_bytes
    by src_ip, dest_ip, _time
| where connections > 20 
    AND unique_ports < 3 
    AND stdev_bytes < (avg_bytes * 0.2)
| table src_ip, dest_ip, connections, avg_bytes, stdev_bytes

BEACONING INDICATORS:
â”œâ”€â”€ Regular time intervals (Â±10% variance)
â”œâ”€â”€ Consistent packet sizes
â”œâ”€â”€ Low port diversity
â”œâ”€â”€ Persistent over hours/days
â””â”€â”€ Unusual destination (rare domain/IP)

ADVANCED DETECTION:
| stats count by src_ip, dest_ip, _time span=1m
| streamstats window=60 avg(count) as avg_rate stdev(count) as std_rate by src_ip, dest_ip
| where std_rate < 1  // Very consistent rate</div>

                    <h4>UC-NET-002: Data Exfiltration</h4>
                    <div class="arch-diagram">USE CASE: Large Data Transfer Detection
MITRE: T1048 - Exfiltration Over Alternative Protocol
DATA MODEL: Network_Traffic

DETECTION LOGIC:
| tstats summariesonly=true sum(All_Traffic.bytes_out) as total_bytes 
    from datamodel=Network_Traffic 
    by All_Traffic.src, All_Traffic.dest, _time span=1h
| where total_bytes > 100000000  // 100 MB
| lookup threat_intel dest as All_Traffic.dest OUTPUT threat_score
| where threat_score > 50 OR isnotnull(threat_score)
| table _time, All_Traffic.src, All_Traffic.dest, total_bytes, threat_score

EXFILTRATION INDICATORS:
â”œâ”€â”€ Unusual upload volume
â”œâ”€â”€ Transfer to cloud storage
â”œâ”€â”€ DNS tunneling (high query volume)
â”œâ”€â”€ After-hours transfers
â””â”€â”€ Compressed/encrypted streams</div>

                    <h4>UC-NET-003: Lateral Movement</h4>
                    <div class="arch-diagram">USE CASE: Internal Lateral Movement
MITRE: T1021 - Remote Services
DATA MODEL: Network_Traffic

DETECTION LOGIC:
| tstats summariesonly=true count dc(All_Traffic.dest) as dest_count 
    from datamodel=Network_Traffic 
    where All_Traffic.dest_port IN (445, 135, 3389, 5985, 5986, 22)
    AND All_Traffic.src_category="workstation"
    by All_Traffic.src, _time span=1h
| where dest_count > 5
| table _time, All_Traffic.src, dest_count

LATERAL MOVEMENT PATTERNS:
â”œâ”€â”€ SMB (445): File shares, PsExec
â”œâ”€â”€ RPC (135): WMI, DCOM
â”œâ”€â”€ RDP (3389): Remote desktop
â”œâ”€â”€ WinRM (5985/5986): PowerShell remoting
â”œâ”€â”€ SSH (22): Linux/Unix access
â””â”€â”€ Workstation-to-workstation unusual</div>
                </div>

                <!-- Use Case Priority Matrix -->
                <h2><i class="fas fa-th"></i> Use Case Priority Matrix</h2>
                <div class="config-section">
                    <div class="arch-diagram">USE CASE PRIORITY MATRIX:

TIER 1 - CRITICAL (Deploy First):
â”œâ”€â”€ UC-AUTH-001: Brute Force Detection
â”œâ”€â”€ UC-AUTH-003: Password Spray
â”œâ”€â”€ UC-END-001: Suspicious PowerShell
â”œâ”€â”€ UC-END-002: LOLBin Abuse
â”œâ”€â”€ UC-NET-001: C2 Beaconing
â””â”€â”€ UC-MAL-001: Known Malware Hashes

TIER 2 - HIGH (Deploy Second):
â”œâ”€â”€ UC-AUTH-002: Impossible Travel
â”œâ”€â”€ UC-END-003: Persistence Mechanisms
â”œâ”€â”€ UC-NET-002: Data Exfiltration
â”œâ”€â”€ UC-NET-003: Lateral Movement
â”œâ”€â”€ UC-PRIV-001: Privilege Escalation
â””â”€â”€ UC-CRED-001: Credential Dumping

TIER 3 - MEDIUM (Enhance Coverage):
â”œâ”€â”€ UC-RECON-001: Network Scanning
â”œâ”€â”€ UC-EVADE-001: Log Tampering
â”œâ”€â”€ UC-EVADE-002: Security Tool Disable
â”œâ”€â”€ UC-CLOUD-001: Cloud Config Changes
â””â”€â”€ UC-IAM-001: Permission Changes

IMPLEMENTATION TIMELINE:
â”œâ”€â”€ Month 1: Tier 1 use cases
â”œâ”€â”€ Month 2-3: Tier 2 use cases
â”œâ”€â”€ Month 4-6: Tier 3 use cases
â””â”€â”€ Ongoing: Tuning and optimization</div>
                </div>

                <!-- Decision Trees -->
                <h2><i class="fas fa-project-diagram"></i> Use Case Decision Trees</h2>
                <div class="config-section">
                    <h3>Decision Tree: Use Case Prioritization</h3>
                    <div class="arch-diagram">WHICH USE CASES TO IMPLEMENT FIRST?
â”‚
â”œâ”€ Data availability assessment:
â”‚   â”‚
â”‚   â”œâ”€ What data do you have TODAY?
â”‚   â”‚   â”œâ”€ Windows Event Logs? â†’ Authentication, Endpoint use cases
â”‚   â”‚   â”œâ”€ Network Firewall/Proxy? â†’ Network use cases
â”‚   â”‚   â”œâ”€ Cloud logs (O365, AWS)? â†’ Cloud use cases
â”‚   â”‚   â””â”€ EDR telemetry? â†’ Advanced endpoint use cases
â”‚   â”‚
â”‚   â””â”€ Prioritize: Use cases matching available data
â”‚
â”œâ”€ Threat landscape assessment:
â”‚   â”‚
â”‚   â”œâ”€ What threats are most likely?
â”‚   â”‚   â”œâ”€ Financially motivated? â†’ Ransomware, BEC
â”‚   â”‚   â”œâ”€ Nation state? â†’ APT persistence, espionage
â”‚   â”‚   â”œâ”€ Insider threat? â†’ Data exfil, privilege abuse
â”‚   â”‚   â””â”€ Industry-specific? â†’ Compliance-driven
â”‚   â”‚
â”‚   â””â”€ Prioritize: Use cases matching threat profile
â”‚
â”œâ”€ Implementation effort:
â”‚   â”‚
â”‚   â”œâ”€ TIER 1 (Quick wins - 1-2 hours each):
â”‚   â”‚   â”œâ”€ Brute force authentication
â”‚   â”‚   â”œâ”€ Impossible travel
â”‚   â”‚   â”œâ”€ Known bad IP/domain
â”‚   â”‚   â””â”€ Admin account usage
â”‚   â”‚
â”‚   â”œâ”€ TIER 2 (Medium effort - 4-8 hours each):
â”‚   â”‚   â”œâ”€ Password spray
â”‚   â”‚   â”œâ”€ Lateral movement
â”‚   â”‚   â”œâ”€ Suspicious PowerShell
â”‚   â”‚   â””â”€ Data exfiltration
â”‚   â”‚
â”‚   â””â”€ TIER 3 (Complex - days to weeks):
â”‚       â”œâ”€ Beaconing detection
â”‚       â”œâ”€ UEBA baselines
â”‚       â”œâ”€ Custom ML models
â”‚       â””â”€ APT TTP chains
â”‚
â””â”€ RECOMMENDED ORDER:
    â”œâ”€ Week 1-2: All Tier 1 use cases
    â”œâ”€ Month 1-2: Tier 2 aligned with top threats
    â””â”€ Month 3+: Tier 3 based on maturity</div>

                    <h3>Decision Tree: Detection Logic Selection</h3>
                    <div class="arch-diagram">WHAT DETECTION APPROACH FOR THIS USE CASE?
â”‚
â”œâ”€ Do you have known-bad indicators?
â”‚   â”‚
â”‚   â”œâ”€ YES (IOCs, signatures)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ SIGNATURE-BASED DETECTION
â”‚   â”‚       â”œâ”€ Threat intel lookup joins
â”‚   â”‚       â”œâ”€ Hash/IP/domain matching
â”‚   â”‚       â””â”€ Fast, low false positives
â”‚   â”‚
â”‚   â””â”€ NO (behavioral detection needed)
â”‚       â”‚
â”‚       â””â”€ Continue to behavioral options...
â”‚
â”œâ”€ Can you define a simple threshold?
â”‚   â”‚
â”‚   â”œâ”€ YES (e.g., >10 failures)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ THRESHOLD-BASED DETECTION
â”‚   â”‚       â”œâ”€ Count-based alerting
â”‚   â”‚       â”œâ”€ Easy to implement and tune
â”‚   â”‚       â””â”€ Risk: Static thresholds miss slow attacks
â”‚   â”‚
â”‚   â””â”€ NO (need relative comparison)
â”‚       â”‚
â”‚       â””â”€ Continue to statistical options...
â”‚
â”œâ”€ Is behavior consistent over time?
â”‚   â”‚
â”‚   â”œâ”€ YES (stable baseline exists)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ BASELINE-ANOMALY DETECTION
â”‚   â”‚       â”œâ”€ Compare to historical average
â”‚   â”‚       â”œâ”€ Z-score or percentile deviation
â”‚   â”‚       â””â”€ Good for login times, data volumes
â”‚   â”‚
â”‚   â””â”€ NO (highly variable)
â”‚       â”‚
â”‚       â””â”€ PEER-GROUP COMPARISON
â”‚           â”œâ”€ Compare user to similar users
â”‚           â”œâ”€ Requires good user grouping
â”‚           â””â”€ Expensive to compute
â”‚
â””â”€ Last resort: RULE CHAINING
    â”œâ”€ Multiple conditions in sequence
    â”œâ”€ "A followed by B within timeframe"
    â””â”€ Most complex but catches sophisticated attacks</div>

                    <h3>Decision Tree: Use Case Tuning</h3>
                    <div class="arch-diagram">USE CASE GENERATING TOO MANY ALERTS?
â”‚
â”œâ”€ What type of false positives?
â”‚   â”‚
â”‚   â”œâ”€ Known-good activity?
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ ADD EXCLUSIONS
â”‚   â”‚       â”œâ”€ Service accounts to whitelist
â”‚   â”‚       â”œâ”€ Scanner IPs to ignore
â”‚   â”‚       â”œâ”€ Scheduled task times
â”‚   â”‚       â””â”€ Document all exclusions!
â”‚   â”‚
â”‚   â”œâ”€ Threshold too sensitive?
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ ADJUST THRESHOLDS
â”‚   â”‚       â”œâ”€ Analyze alert distribution
â”‚   â”‚       â”œâ”€ Set threshold at 95th percentile
â”‚   â”‚       â””â”€ Consider time-based adjustment
â”‚   â”‚
â”‚   â””â”€ Wrong detection logic?
â”‚       â”‚
â”‚       â””â”€ REDESIGN USE CASE
â”‚           â”œâ”€ Add more conditions
â”‚           â”œâ”€ Require corroborating evidence
â”‚           â””â”€ Consider risk-based scoring
â”‚
â”œâ”€ FP rate target:
â”‚   â”‚
â”‚   â”œâ”€ Critical alerts: &lt;1% FP rate
â”‚   â”œâ”€ High alerts: &lt;5% FP rate
â”‚   â””â”€ Medium alerts: &lt;20% FP rate
â”‚
â””â”€ Tuning process:
    â”œâ”€ Week 1: Deploy in audit mode
    â”œâ”€ Week 2: Analyze all alerts, document patterns
    â”œâ”€ Week 3: Implement exclusions
    â”œâ”€ Week 4: Enable alerting
    â””â”€ Monthly: Review and refine</div>
                </div>

                <!-- What Enterprises Usually Miss -->
                <h2><i class="fas fa-exclamation-circle"></i> What Enterprises Usually Miss</h2>
                <div class="enterprise-gaps">
                    <div class="gap-grid">
                        <div class="gap-category critical">
                            <h4>ğŸ”´ Critical Gaps</h4>
                            <ul>
                                <li><strong>No use case documentation:</strong> SPL exists but no description of what it detects or why</li>
                                <li><strong>Outdated exclusions:</strong> Whitelists from 3 years ago with departed employees</li>
                                <li><strong>Copy-paste detections:</strong> Downloaded from Splunkbase but never tested in environment</li>
                                <li><strong>No MITRE mapping:</strong> Can't answer "what techniques can we detect?"</li>
                                <li><strong>Alert fatigue:</strong> 500+ alerts/day, analysts ignoring critical ones</li>
                            </ul>
                        </div>
                        <div class="gap-category warning">
                            <h4><i class="fas fa-exclamation-triangle"></i> Operational Gaps</h4>
                            <ul>
                                <li><strong>No playbooks:</strong> Alert fires but analyst doesn't know investigation steps</li>
                                <li><strong>Missing enrichment:</strong> IP alerts with no WHOIS, user alerts with no HR context</li>
                                <li><strong>Static thresholds:</strong> Same threshold for 100-user branch and 10,000-user HQ</li>
                                <li><strong>No lifecycle management:</strong> Rules created but never reviewed or retired</li>
                                <li><strong>Siloed development:</strong> Multiple analysts creating duplicate use cases</li>
                            </ul>
                        </div>
                        <div class="gap-category info">
                            <h4><i class="fas fa-info-circle"></i> Coverage Gaps</h4>
                            <ul>
                                <li><strong>Only authentication:</strong> 50 login rules, zero network or endpoint detection</li>
                                <li><strong>Missing cloud:</strong> On-prem covered but O365/AWS blind spots</li>
                                <li><strong>No lateral movement:</strong> Detect initial access but miss post-compromise</li>
                                <li><strong>Signature-only:</strong> Known-bad IOCs but no behavioral detection</li>
                                <li><strong>No insider threat:</strong> External threats covered, internal actors ignored</li>
                            </ul>
                        </div>
                        <div class="gap-category best-practice">
                            <h4><i class="fas fa-check-circle"></i> Best Practices Often Ignored</h4>
                            <ul>
                                <li><strong>Test with red team:</strong> Validate use cases catch actual attacks</li>
                                <li><strong>Measure detection rate:</strong> What % of incidents were alerted on?</li>
                                <li><strong>Quarterly review:</strong> Retire low-value, tune noisy, add new coverage</li>
                                <li><strong>Risk-based alerting:</strong> Context determines urgency, not just rule</li>
                                <li><strong>Use case library:</strong> Central catalog of all detections with metadata</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- MITRE ATT&CK COVERAGE MATRIX -->
                <h2><i class="fas fa-th"></i> MITRE ATT&CK Coverage Matrix</h2>
                <div class="config-section">
                    <p>Track detection coverage against MITRE ATT&CK framework. Essential for identifying gaps and demonstrating security maturity.</p>

                    <div class="info-box info-box-info">
                        <h4><i class="fas fa-store"></i> Sobeys Priority Techniques</h4>
                        <p>Based on retail threat landscape and regulatory requirements, prioritize these techniques:</p>
                        <ul>
                            <li><strong>T1566 (Phishing):</strong> Primary initial access vector targeting store employees</li>
                            <li><strong>T1078 (Valid Accounts):</strong> Credential theft for POS systems and SAP</li>
                            <li><strong>T1486 (Data Encrypted):</strong> Ransomware threat to store operations</li>
                            <li><strong>T1565 (Data Manipulation):</strong> POS fraud and inventory manipulation</li>
                        </ul>
                    </div>

                    <div class="arch-diagram">
SOBEYS MITRE ATT&CK COVERAGE STATUS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INITIAL ACCESS (TA0001)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Technique                    â”‚ Status â”‚ Data Src  â”‚ Detection ID            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ T1566.001 - Spearphishing    â”‚ âœ…     â”‚ O365      â”‚ UC-IA-001              â”‚
â”‚ T1566.002 - Spearphishing    â”‚ âœ…     â”‚ Proofpointâ”‚ UC-IA-002              â”‚
â”‚ T1078 - Valid Accounts       â”‚ âœ…     â”‚ AD/Azure  â”‚ UC-AUTH-001 to 005     â”‚
â”‚ T1190 - Exploit Public App   â”‚ âš ï¸     â”‚ WAF/IDS   â”‚ Partial - web only     â”‚
â”‚ T1133 - External RDP/VPN     â”‚ âœ…     â”‚ VPN logs  â”‚ UC-IA-003              â”‚
â”‚ T1195 - Supply Chain         â”‚ âŒ     â”‚ N/A       â”‚ Gap - Need vendor data â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EXECUTION (TA0002)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1059.001 - PowerShell       â”‚ âœ…     â”‚ Sysmon    â”‚ UC-END-001             â”‚
â”‚ T1059.003 - Windows Cmd      â”‚ âœ…     â”‚ Sysmon    â”‚ UC-END-002             â”‚
â”‚ T1059.005 - VBScript         â”‚ âœ…     â”‚ Sysmon    â”‚ UC-END-003             â”‚
â”‚ T1059.006 - Python           â”‚ âš ï¸     â”‚ Sysmon    â”‚ Partial                â”‚
â”‚ T1204 - User Execution       â”‚ âœ…     â”‚ EDR       â”‚ UC-END-004             â”‚
â”‚ T1218 - LOLBins              â”‚ âœ…     â”‚ Sysmon    â”‚ UC-END-005             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PERSISTENCE (TA0003)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1053 - Scheduled Task       â”‚ âœ…     â”‚ Windows   â”‚ UC-PER-001             â”‚
â”‚ T1136 - Create Account       â”‚ âœ…     â”‚ AD        â”‚ UC-PER-002             â”‚
â”‚ T1543 - Create Service       â”‚ âœ…     â”‚ Windows   â”‚ UC-PER-003             â”‚
â”‚ T1547 - Registry Run Keys    â”‚ âœ…     â”‚ Sysmon    â”‚ UC-PER-004             â”‚
â”‚ T1078 - Valid Accounts       â”‚ âœ…     â”‚ AD        â”‚ UC-AUTH-*              â”‚
â”‚ T1505.003 - Web Shell        â”‚ âš ï¸     â”‚ IIS/Web   â”‚ Gap - Need file mon    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PRIVILEGE ESCALATION (TA0004)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1068 - Exploit for Priv Esc â”‚ âš ï¸     â”‚ EDR       â”‚ Partial - IOC based    â”‚
â”‚ T1078 - Valid Accounts       â”‚ âœ…     â”‚ AD        â”‚ UC-PRIV-001            â”‚
â”‚ T1134 - Access Token Manip   â”‚ âš ï¸     â”‚ Sysmon    â”‚ Gap - High FP rate     â”‚
â”‚ T1548 - Abuse Elevation      â”‚ âœ…     â”‚ Sysmon    â”‚ UC-PRIV-002            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEFENSE EVASION (TA0005)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1027 - Obfuscated Files     â”‚ âœ…     â”‚ Sysmon    â”‚ UC-EVA-001             â”‚
â”‚ T1055 - Process Injection    â”‚ âœ…     â”‚ Sysmon    â”‚ UC-EVA-002             â”‚
â”‚ T1070 - Indicator Removal    â”‚ âœ…     â”‚ Windows   â”‚ UC-EVA-003             â”‚
â”‚ T1036 - Masquerading         â”‚ âœ…     â”‚ Sysmon    â”‚ UC-EVA-004             â”‚
â”‚ T1562 - Impair Defenses      â”‚ âœ…     â”‚ EDR/AV    â”‚ UC-EVA-005             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CREDENTIAL ACCESS (TA0006)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1003 - Credential Dumping   â”‚ âœ…     â”‚ Sysmon    â”‚ UC-CRED-001            â”‚
â”‚ T1110 - Brute Force          â”‚ âœ…     â”‚ AD/Auth   â”‚ UC-AUTH-001            â”‚
â”‚ T1555 - Credentials in Files â”‚ âš ï¸     â”‚ Sysmon    â”‚ Partial                â”‚
â”‚ T1558 - Kerberoasting        â”‚ âœ…     â”‚ AD        â”‚ UC-CRED-002            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LATERAL MOVEMENT (TA0008)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1021.001 - RDP              â”‚ âœ…     â”‚ Windows   â”‚ UC-LAT-001             â”‚
â”‚ T1021.002 - SMB              â”‚ âœ…     â”‚ Zeek/Win  â”‚ UC-LAT-002             â”‚
â”‚ T1021.006 - WinRM            â”‚ âœ…     â”‚ Windows   â”‚ UC-LAT-003             â”‚
â”‚ T1047 - WMI                  â”‚ âœ…     â”‚ Sysmon    â”‚ UC-LAT-004             â”‚
â”‚ T1570 - Lateral Tool Transferâ”‚ âš ï¸     â”‚ Network   â”‚ Gap - Need DLP        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COLLECTION (TA0009) & EXFILTRATION (TA0010)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1005 - Data from Local      â”‚ âš ï¸     â”‚ DLP       â”‚ Gap - Need DLP data    â”‚
â”‚ T1039 - Network Share Drive  â”‚ âš ï¸     â”‚ Windows   â”‚ Partial                â”‚
â”‚ T1048 - Exfil Over Alt Proto â”‚ âœ…     â”‚ Firewall  â”‚ UC-EXFIL-001           â”‚
â”‚ T1567 - Exfil to Cloud       â”‚ âš ï¸     â”‚ Proxy     â”‚ Partial                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IMPACT (TA0040)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ T1486 - Data Encrypted       â”‚ âœ…     â”‚ EDR       â”‚ UC-IMP-001 (Critical)  â”‚
â”‚ T1490 - Inhibit Recovery     â”‚ âœ…     â”‚ Windows   â”‚ UC-IMP-002             â”‚
â”‚ T1565 - Data Manipulation    â”‚ âœ…     â”‚ POS/SAP   â”‚ UC-RETAIL-* (Custom)   â”‚
â”‚ T1529 - System Shutdown      â”‚ âœ…     â”‚ Windows   â”‚ UC-IMP-003             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

COVERAGE SUMMARY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Full Coverage:    42 techniques (65%)
âš ï¸ Partial Coverage: 15 techniques (23%)
âŒ No Coverage:       8 techniques (12%)

Priority Gaps to Address:
1. T1195 - Supply Chain (Need vendor security integration)
2. T1505.003 - Web Shell (Need file integrity monitoring)
3. T1005 - Data Collection (Need DLP integration)
4. T1567 - Cloud Exfiltration (Need CASB data)
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Generate MITRE Coverage Report</span>
                        </div>
                        <pre><code>` Query to generate MITRE coverage report from correlation searches `
| rest /services/saved/searches splunk_server=local
| search action.correlationsearch.enabled=1
| rex field=action.correlationsearch.annotations "mitre_attack\":\"(?&lt;mitre_techniques&gt;[^\"]+)\""
| mvexpand mitre_techniques
| stats 
    count as detection_count,
    values(title) as detections
    by mitre_techniques
| lookup mitre_attack_techniques.csv technique_id as mitre_techniques 
    OUTPUT technique_name, tactic
| eval coverage_status = case(
    detection_count >= 3, "Full",
    detection_count >= 1, "Partial",
    1=1, "None"
)
| table mitre_techniques, technique_name, tactic, detection_count, coverage_status, detections
| sort tactic, mitre_techniques</code></pre>
                    </div>
                </div>

                <!-- SOBEYS-SPECIFIC DETECTION USE CASES -->
                <h2><i class="fas fa-store"></i> Sobeys-Specific Detection Use Cases</h2>
                <div class="config-section">
                    <p>Custom detections tailored to Sobeys' retail environment, POS systems, SAP infrastructure, and regulatory requirements.</p>

                    <h3>UC-RETAIL-001: POS Malware Indicators</h3>
                    <div class="arch-diagram">
USE CASE: Point-of-Sale Malware Detection
MITRE: T1005 - Data from Local System (modified for POS context)
PRIORITY: CRITICAL
DATA SOURCES: CrowdStrike EDR, Sysmon on POS Controllers

THREAT CONTEXT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
POS malware (PoSeidon, RawPOS, etc.) scrapes card data from memory.
Sobeys has 10,000+ POS terminals across 1,500+ stores.
PCI-DSS requires detection and response capabilities.

DETECTION LOGIC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
index=crowdstrike sourcetype=crowdstrike:events:endpoint
    event_simpleName IN ("ProcessRollup2", "SyntheticProcessRollup2")
    ComputerName="POS-*"
| eval suspicious_indicators = mvappend(
    if(match(CommandLine, "(?i)(mimikatz|gsecdump|wce\.exe|procdump)"), "CRED_DUMP_TOOL", null()),
    if(match(CommandLine, "(?i)(lsass|chrome\.exe.*--memory)"), "MEMORY_ACCESS", null()),
    if(ParentBaseFileName IN ("services.exe","svchost.exe") AND 
       NOT match(FileName, "(?i)(splunk|crowd|defender)"), "SUSPICIOUS_PARENT", null()),
    if(match(CommandLine, "(?i)(-enc|-encoded|base64)"), "ENCODED_CMD", null())
)
| where isnotnull(suspicious_indicators)
| eval risk_score = case(
    mvcount(suspicious_indicators) >= 3, 100,
    match(mvjoin(suspicious_indicators,","), "CRED_DUMP_TOOL"), 95,
    match(mvjoin(suspicious_indicators,","), "MEMORY_ACCESS"), 90,
    mvcount(suspicious_indicators) >= 2, 80,
    1=1, 70
)
| stats 
    count as indicator_count,
    values(suspicious_indicators) as all_indicators,
    max(risk_score) as risk_score,
    latest(_time) as last_seen
    by ComputerName, FileName, CommandLine
| where risk_score >= 80
| lookup store_info.csv hostname as ComputerName OUTPUT store_id, store_name, region
| table last_seen, store_id, store_name, ComputerName, FileName, CommandLine, all_indicators, risk_score

RESPONSE PLAYBOOK:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. IMMEDIATE (< 5 min): Isolate POS terminal via CrowdStrike
2. Notify store manager and LP team
3. Check for card data in transit (network logs)
4. Escalate to IR team and PCI team
5. Preserve forensic evidence
6. Coordinate with card brands if breach confirmed
                    </div>

                    <h3>UC-RETAIL-002: Unauthorized SAP Critical Transaction</h3>
                    <div class="arch-diagram">
USE CASE: SAP Critical T-Code Execution by Unauthorized User
MITRE: T1078 - Valid Accounts
PRIORITY: HIGH
DATA SOURCES: SAP Security Audit Log (SM21)

THREAT CONTEXT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAP handles inventory, vendor payments, pricing - all high-value targets.
Unauthorized access to critical T-codes = fraud or data theft.
SOX compliance requires monitoring of sensitive transactions.

CRITICAL T-CODES FOR RETAIL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ SE16/SE16N - Direct table access (data theft)
â€¢ SU01 - User administration (privilege escalation)
â€¢ FB60 - Vendor invoice posting (payment fraud)
â€¢ MM01 - Material master (pricing manipulation)
â€¢ XK01/XK02 - Vendor master (vendor fraud)
â€¢ SA38/SE38 - ABAP execution (code execution)
â€¢ PFCG - Role administration (privilege escalation)

DETECTION LOGIC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
index=sap_security sourcetype=sap:security_audit
    tcode IN ("SE16", "SE16N", "SU01", "SU10", "PFCG", "SA38", "SE38", 
              "FB60", "F110", "MM01", "XK01", "XK02", "SM21", "ST01")
| lookup sap_authorized_tcodes.csv user, tcode OUTPUT authorized
| where isnull(authorized) OR authorized="NO"
| eval risk_score = case(
    tcode IN ("SE16", "SE16N"), 95,    ` Direct table access - critical `
    tcode IN ("SU01", "SU10", "PFCG"), 90,    ` User/role admin `
    tcode IN ("SA38", "SE38"), 85,     ` Code execution `
    tcode IN ("FB60", "F110"), 80,     ` Payment transactions `
    1=1, 70
)
| lookup sap_users.csv user OUTPUT department, job_title, manager
| stats 
    count as execution_count,
    values(tcode) as tcodes_used,
    max(risk_score) as risk_score,
    latest(_time) as last_execution
    by user, client, terminal
| where risk_score >= 70
| table last_execution, user, department, client, tcodes_used, execution_count, risk_score

INVESTIGATION STEPS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Verify user's role should NOT have access to this T-code
2. Check what data was accessed (SM21 details, table accessed)
3. Determine if data was exported (download action)
4. Review user's recent SAP activity pattern
5. Contact user's manager if suspicious
                    </div>

                    <h3>UC-RETAIL-003: Store Network Segmentation Violation</h3>
                    <div class="arch-diagram">
USE CASE: PCI Network Segmentation Bypass
MITRE: T1021 - Remote Services
PRIORITY: CRITICAL
DATA SOURCES: Palo Alto Firewall, Cisco Switch Logs

THREAT CONTEXT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
PCI-DSS requires network segmentation of cardholder data environment (CDE).
Store networks should be isolated from corporate and between stores.
Segmentation violation = compliance failure and potential breach.

NETWORK ZONES AT SOBEYS STORES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ POS_VLAN (10.x.1.0/24) - POS terminals, card readers
â€¢ STORE_VLAN (10.x.2.0/24) - Back office PCs, label printers
â€¢ PHARMACY_VLAN (10.x.3.0/24) - Pharmacy systems (additional HIPAA)
â€¢ GUEST_VLAN (10.x.4.0/24) - Customer WiFi (fully isolated)
â€¢ MGMT_VLAN (10.x.0.0/24) - Network devices, cameras

ALLOWED FLOWS:
â€¢ POS â†’ Payment gateway (external)
â€¢ POS â†’ HQ (Splunk forwarder)
â€¢ STORE â†’ Corporate apps
â€¢ PHARMACY â†’ Pharmacy apps + POS flows

DETECTION LOGIC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
index=pan_traffic sourcetype=pan:traffic action=allowed
| rex field=src_ip "10\.(?&lt;store_num&gt;\d+)\.(?&lt;src_zone_num&gt;\d+)\."
| rex field=dest_ip "10\.(?&lt;dest_store&gt;\d+)\.(?&lt;dest_zone_num&gt;\d+)\."
| eval src_zone = case(
    src_zone_num=1, "POS",
    src_zone_num=2, "STORE",
    src_zone_num=3, "PHARMACY",
    src_zone_num=4, "GUEST",
    src_zone_num=0, "MGMT",
    1=1, "UNKNOWN"
)
| eval dest_zone = case(
    dest_zone_num=1, "POS",
    dest_zone_num=2, "STORE",
    dest_zone_num=3, "PHARMACY",
    dest_zone_num=4, "GUEST",
    dest_zone_num=0, "MGMT",
    1=1, "EXTERNAL"
)
` Flag cross-zone traffic that shouldn't exist `
| eval violation = case(
    src_zone="POS" AND dest_zone IN ("STORE", "PHARMACY", "GUEST"), "POS_LATERAL",
    src_zone="GUEST" AND dest_zone!="EXTERNAL", "GUEST_ESCAPE",
    store_num != dest_store AND dest_zone!="EXTERNAL", "CROSS_STORE",
    1=1, null()
)
| where isnotnull(violation)
| eval risk_score = case(
    violation="POS_LATERAL", 95,
    violation="GUEST_ESCAPE", 90,
    violation="CROSS_STORE", 85,
    1=1, 75
)
| stats count as violation_count, sum(bytes) as bytes_transferred,
        dc(dest_ip) as unique_destinations
    by store_num, src_zone, dest_zone, violation
| where violation_count > 0
| lookup store_info.csv store_num OUTPUT store_name, region
| table store_num, store_name, src_zone, dest_zone, violation, 
        violation_count, bytes_transferred, risk_score
| sort -risk_score

RESPONSE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Block traffic immediately at firewall
2. Investigate source device for compromise
3. Audit firewall rules for misconfiguration
4. Document for PCI compliance evidence
5. Report to CISO if confirmed breach
                    </div>

                    <h3>UC-RETAIL-004: Voila Delivery Order Fraud</h3>
                    <div class="arch-diagram">
USE CASE: E-commerce Order Fraud Detection
MITRE: T1565 - Data Manipulation
PRIORITY: HIGH
DATA SOURCES: Voila Order System, Payment Gateway

THREAT CONTEXT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Voila (Sobeys e-commerce) processes thousands of orders daily.
Fraud patterns: stolen payment cards, refund abuse, promo code abuse.
Direct financial loss + chargeback costs.

DETECTION LOGIC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
index=ecommerce sourcetype=sobeys:voila:order
| eval order_value = total_amount
| eval is_high_value = if(order_value > 300, 1, 0)
| eval is_new_customer = if(customer_orders_count <= 1, 1, 0)
| eval is_rush_delivery = if(delivery_type="EXPRESS", 1, 0)
| eval address_mismatch = if(billing_address != delivery_address, 1, 0)
| eval is_gift_card = if(match(items, "(?i)gift.?card"), 1, 0)

` Calculate fraud score `
| eval fraud_indicators = is_high_value + is_new_customer + is_rush_delivery + 
                          address_mismatch + (is_gift_card * 2)
| eval fraud_score = case(
    fraud_indicators >= 5, 95,
    fraud_indicators >= 4, 85,
    fraud_indicators >= 3, 75,
    fraud_indicators >= 2, 60,
    1=1, 30
)
| where fraud_score >= 60

` Velocity checks `
| eventstats 
    count as orders_last_hour,
    dc(order_id) as unique_orders,
    sum(total_amount) as total_value_last_hour
    by payment_card_last4, delivery_address
    
| eval velocity_risk = case(
    orders_last_hour > 3, 30,
    total_value_last_hour > 1000, 25,
    1=1, 0
)
| eval final_fraud_score = fraud_score + velocity_risk
| where final_fraud_score >= 75

| table _time, order_id, customer_email, payment_card_last4, order_value,
        is_new_customer, is_rush_delivery, address_mismatch, is_gift_card,
        orders_last_hour, final_fraud_score
| sort -final_fraud_score

RESPONSE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Score 90+: Hold order, manual review required
Score 75-90: Flag for review, may proceed with verification call
Score 60-75: Flag for post-delivery review
                    </div>

                    <h3>UC-RETAIL-005: Employee Termination - Access Not Removed</h3>
                    <div class="arch-diagram">
USE CASE: Terminated Employee Still Has Active Access
MITRE: T1078 - Valid Accounts
PRIORITY: CRITICAL
DATA SOURCES: HR System (Workday), AD, SAP, POS

THREAT CONTEXT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Sobeys has 130,000+ employees with high turnover in retail.
Delayed offboarding = unauthorized access risk.
Insider threat from disgruntled terminated employees.

DETECTION LOGIC:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
` Get terminated employees from HR feed `
| inputlookup employee_hr.csv 
| where employment_status="TERMINATED" 
| eval term_date_epoch = strptime(termination_date, "%Y-%m-%d")
| where term_date_epoch < relative_time(now(), "-1d")
| fields employee_id, employee_name, termination_date, term_date_epoch, 
         last_store, department

` Join with recent access `
| join type=left employee_id 
    [search (index=security sourcetype=WinEventLog:Security EventCode=4624) OR
            (index=sap_security) OR
            (index=pos_transactions) earliest=-7d
     | eval employee_id = coalesce(user, sap_user, cashier_id)
     | stats 
         count as access_count,
         latest(_time) as last_access,
         values(index) as systems_accessed,
         dc(src_ip) as unique_sources
         by employee_id]

| where access_count > 0 AND last_access > term_date_epoch

| eval days_since_termination = round((now() - term_date_epoch) / 86400, 0)
| eval risk_score = case(
    days_since_termination > 30, 100,
    days_since_termination > 7, 95,
    days_since_termination > 1, 90,
    1=1, 80
)
| table employee_id, employee_name, termination_date, days_since_termination,
        last_access, access_count, systems_accessed, risk_score
| sort -risk_score

IMMEDIATE ACTIONS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Disable AD account IMMEDIATELY
2. Disable SAP user
3. Revoke POS system access
4. Revoke badge access
5. Investigate what was accessed post-termination
6. Escalate to HR and Legal if data accessed
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you develop a security use case in Splunk?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Requirements:</strong> Identify threat, map to MITRE, identify data sources</li>
                                <li><strong>Development:</strong> Design detection logic, write SPL query, create notable event</li>
                                <li><strong>Deployment:</strong> Test in dev, tune thresholds, deploy to production</li>
                                <li><strong>Operations:</strong> Monitor FP rate, review quarterly, retire when outdated</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you detect brute force attacks?</button>
                        <div class="qa-answer">
                            <p>Look for multiple failed authentications followed by success:</p>
                            <ul>
                                <li>>10 failed logins in 5 minutes from same source</li>
                                <li>Followed by successful login</li>
                                <li>Use Authentication data model with tstats</li>
                                <li>Exclude service accounts and known scanners</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between brute force and password spray?</button>
                        <div class="qa-answer">
                            <p><strong>Brute Force:</strong> Many passwords against one user</p>
                            <p><strong>Password Spray:</strong> One password against many users</p>
                            <p>Password spray is harder to detect per-user but visible when looking at source IP targeting many users.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you detect C2 beaconing?</button>
                        <div class="qa-answer">
                            <ul>
                                <li>Look for regular time intervals between connections</li>
                                <li>Consistent packet sizes (low standard deviation)</li>
                                <li>Low port diversity</li>
                                <li>Persistent connections over hours/days</li>
                                <li>Unusual or rare destination IPs/domains</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>