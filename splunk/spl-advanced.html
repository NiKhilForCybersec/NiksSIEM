<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPL Advanced | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">

    <style>
        /* Decision Tree Styles */
        .decision-tree {
            padding: 20px;
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            border-radius: 12px;
            border: 1px solid #30363d;
            margin: 20px 0;
        }
        .decision-node {
            background: #21262d;
            border: 2px solid #30363d;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 10px auto;
            max-width: 400px;
            text-align: center;
        }
        .decision-node h4 {
            color: #e6edf3;
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        .decision-node small {
            color: #8b949e;
            font-size: 12px;
        }
        .decision-arrow {
            text-align: center;
            color: #58a6ff;
            font-size: 20px;
            margin: 5px 0;
        }
        .decision-branches {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        .decision-branch {
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            min-width: 200px;
            max-width: 300px;
        }
        .decision-branch.yes { border-color: #238636; }
        .decision-branch.no { border-color: #f85149; }
        .branch-label {
            display: block;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
            color: #8b949e;
            font-size: 12px;
        }
        .decision-outcome {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
        }
        .decision-outcome i {
            font-size: 24px;
            margin-bottom: 8px;
            display: block;
        }
        .decision-outcome strong {
            display: block;
            margin-bottom: 5px;
        }
        .decision-outcome small {
            opacity: 0.9;
            font-size: 11px;
        }

        /* Flow Diagram Styles */
        .flow-diagram {
            padding: 20px;
            background: linear-gradient(135deg, #161b22 0%, #0d1117 100%);
            border-radius: 12px;
            border: 1px solid #30363d;
            margin: 20px 0;
        }
        .flow-step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            background: #21262d;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #58a6ff;
        }
        .flow-icon {
            width: 40px;
            height: 40px;
            background: rgba(88, 166, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #58a6ff;
            flex-shrink: 0;
        }
        .flow-content h4 {
            margin: 0 0 10px 0;
            color: #e6edf3;
            font-size: 14px;
        }
        .flow-content ul {
            margin: 0;
            padding-left: 20px;
            color: #8b949e;
        }
        .flow-content li {
            margin: 5px 0;
            font-size: 13px;
        }
        .flow-arrow {
            text-align: center;
            color: #58a6ff;
            font-size: 20px;
            margin: 5px 0;
        }

        /* Enhanced Gap Cards */
        .enterprise-gap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .gap-card {
            background: #21262d;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #30363d;
        }
        .gap-card h4 {
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        .gap-card ul {
            margin: 0;
            padding-left: 20px;
        }
        .gap-card li {
            margin: 8px 0;
            color: #8b949e;
            font-size: 13px;
        }
        .gap-card li strong {
            color: #e6edf3;
        }
        .gap-critical { border-left: 4px solid #f85149; }
        .gap-warning { border-left: 4px solid #d29922; }
        .gap-info { border-left: 4px solid #58a6ff; }
        .gap-best-practice { border-left: 4px solid #238636; }

        /* Quick Reference Cards */
        .quick-ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .quick-ref-card {
            background: linear-gradient(135deg, #21262d 0%, #161b22 100%);
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .quick-ref-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        .quick-ref-card h4 {
            color: #58a6ff;
            margin: 0 0 10px 0;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .quick-ref-card p {
            color: #8b949e;
            margin: 0;
            font-size: 13px;
            line-height: 1.5;
        }
    </style>

</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
        <!-- Sidebar -->
        <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="apps-tas.html" class="sidebar-nav-link"><i class="fas fa-puzzle-piece"></i><span>Apps & TAs</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-paper-plane"></i><span>Forwarders</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Parsing & Props/Transforms</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Index & Retention</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>SPL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>SPL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>SPL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-models.html" class="sidebar-nav-link"><i class="fas fa-cubes"></i><span>Data Models & CIM</span></a></li>
                    <li class="sidebar-nav-item"><a href="knowledge-objects.html" class="sidebar-nav-link"><i class="fas fa-brain"></i><span>Knowledge Objects</span></a></li>
                    <li class="sidebar-nav-item"><a href="dashboards.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i><span>Dashboards</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Enterprise Security</span></a></li>
                    <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-project-diagram"></i><span>Correlation Searches</span></a></li>
                    <li class="sidebar-nav-item"><a href="notable-events.html" class="sidebar-nav-link"><i class="fas fa-bell"></i><span>Notable Events</span></a></li>
                    <li class="sidebar-nav-item"><a href="risk-based-alerting.html" class="sidebar-nav-link"><i class="fas fa-exclamation-triangle"></i><span>Risk-Based Alerting</span></a></li>
                    <li class="sidebar-nav-item"><a href="alerting-actions.html" class="sidebar-nav-link"><i class="fas fa-bolt"></i><span>Alerting & Actions</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation & Intel -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation & Intel</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="soar.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>SOAR</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                </ul>
            </div>
            
            <!-- Operations -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Operations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i><span>Troubleshooting</span></a></li>
                    <li class="sidebar-nav-item"><a href="performance-tuning.html" class="sidebar-nav-link"><i class="fas fa-tachometer-alt"></i><span>Performance Tuning</span></a></li>
                    <li class="sidebar-nav-item"><a href="monitoring-console.html" class="sidebar-nav-link"><i class="fas fa-heartbeat"></i><span>Monitoring Console</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="administration.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Administration</span></a></li>
                    <li class="sidebar-nav-item"><a href="security-rbac.html" class="sidebar-nav-link"><i class="fas fa-users-cog"></i><span>Security & RBAC</span></a></li>
                    <li class="sidebar-nav-item"><a href="clustering-ha.html" class="sidebar-nav-link"><i class="fas fa-server"></i><span>Clustering & HA</span></a></li>
                </ul>
            </div>
            
            <!-- Deployment -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Deployment</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="splunk-cloud.html" class="sidebar-nav-link"><i class="fas fa-cloud"></i><span>Splunk Cloud</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Splunk</a>
                    <span class="separator">/</span>
                    <span class="current">Spl Advanced</span>
                </div>

                <h1><i class="fas fa-code"></i> SPL Advanced Techniques</h1>
                <p class="lead">Master advanced SPL techniques for complex security analysis including subsearches, joins, transactions, macros, and performance optimization.</p>

                <!-- SUBSEARCHES -->
                <h2><i class="fas fa-search-plus"></i> Subsearches</h2>
                
                <div class="info-box">
                    <h4><i class="fas fa-lightbulb"></i> What are Subsearches?</h4>
                    <p>Subsearches are searches within searches, enclosed in square brackets <code>[ ]</code>. The inner search runs first, and its results are used to filter the outer search.</p>
                </div>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Subsearch Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Basic subsearch - Find events from users who had failed logins</span>
<span style="color: #79c0ff;">index</span>=security <span style="color: #79c0ff;">sourcetype</span>=WinEventLog:Security EventCode=4624
[<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=security EventCode=4625 earliest=-1h
 | <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> user
 | <span style="color: #f97583;">where</span> count > 5
 | <span style="color: #f97583;">fields</span> user]

<span style="color: #8b949e;">// Subsearch with return command - more efficient</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4624
[<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=security EventCode=4625 earliest=-1h
 | <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> user
 | <span style="color: #f97583;">where</span> count > 5
 | <span style="color: #f97583;">return</span> 100 user]

<span style="color: #8b949e;">// Subsearch to find IPs with failed logins, then find all activity</span>
<span style="color: #79c0ff;">index</span>=network
[<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=security EventCode=4625
 | <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> src_ip
 | <span style="color: #f97583;">where</span> count > 10
 | <span style="color: #f97583;">rename</span> src_ip <span style="color: #f97583;">as</span> src
 | <span style="color: #f97583;">fields</span> src]

<span style="color: #8b949e;">// Format subsearch for IN clause</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4624
[<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=threat_intel
 | <span style="color: #f97583;">fields</span> bad_ip
 | <span style="color: #f97583;">rename</span> bad_ip <span style="color: #f97583;">as</span> src_ip
 | <span style="color: #f97583;">format</span>]
</pre>
                </div>

                <div class="info-box" style="border-color: #d29922;">
                    <h4><i class="fas fa-exclamation-triangle" style="color: #d29922;"></i> Subsearch Limitations</h4>
                    <ul>
                        <li><strong>Time limit:</strong> 60 seconds by default</li>
                        <li><strong>Result limit:</strong> 10,000 results by default</li>
                        <li><strong>Memory:</strong> Limited memory allocation</li>
                        <li><strong>Performance:</strong> Runs before outer search completes</li>
                    </ul>
                    <p>For large datasets, consider using <code>join</code> or <code>lookup</code> instead.</p>
                </div>

                <!-- JOINS -->
                <h2><i class="fas fa-link"></i> Join Operations</h2>

                <div class="decision-tree">
                    <div class="decision-node">
                        <div class="decision-node-question">Which join type do you need?</div>
                    </div>
                    <div class="decision-paths">
                        <div class="decision-path">
                            <div class="decision-path-label yes">Match Required in Both</div>
                            <div class="decision-path-content">
                                <p style="color: #3fb950; font-weight: 600;">→ inner join (default)</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Only returns rows where key exists in both datasets.</p>
                            </div>
                        </div>
                        <div class="decision-path">
                            <div class="decision-path-label no">Keep All from Left</div>
                            <div class="decision-path-content">
                                <p style="color: #d29922; font-weight: 600;">→ left join</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Keep all rows from left, match from right where possible.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Join Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Inner join - combine security events with asset info</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">as</span> FailedLogins <span style="color: #f97583;">by</span> dest
| <span style="color: #f97583;">join</span> type=inner dest
    [<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=assets
     | <span style="color: #f97583;">table</span> dest, owner, criticality, department]
| <span style="color: #f97583;">table</span> dest, FailedLogins, owner, criticality, department

<span style="color: #8b949e;">// Left join - keep all events, enrich where possible</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4624
| <span style="color: #f97583;">join</span> type=left user
    [<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=identity
     | <span style="color: #f97583;">table</span> user, department, manager, vip_status]
| <span style="color: #f97583;">fillnull</span> value=<span style="color: #a5d6ff;">"Unknown"</span> department

<span style="color: #8b949e;">// Outer join - all records from both sides</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> src_ip
| <span style="color: #f97583;">join</span> type=outer src_ip
    [<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=threat_intel
     | <span style="color: #f97583;">table</span> src_ip, threat_category, confidence]

<span style="color: #8b949e;">// Join with max results</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #f97583;">join</span> type=inner max=0 src_ip
    [<span style="color: #f97583;">search</span> <span style="color: #79c0ff;">index</span>=network
     | <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">sum</span>(bytes) <span style="color: #f97583;">as</span> total_bytes <span style="color: #f97583;">by</span> src_ip]
</pre>
                </div>

                <div class="styled-table">
                    <table>
                        <thead>
                            <tr><th>Join Type</th><th>Description</th><th>Use Case</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>inner</strong></td><td>Only matching rows</td><td>Correlate events that must exist in both</td></tr>
                            <tr><td><strong>left</strong></td><td>All left + matching right</td><td>Enrich events with optional context</td></tr>
                            <tr><td><strong>outer</strong></td><td>All rows from both sides</td><td>Full picture of both datasets</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- LOOKUPS -->
                <h2><i class="fas fa-book"></i> Lookups</h2>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Lookup Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Basic lookup - enrich with static data</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #f97583;">lookup</span> user_info.csv user <span style="color: #f97583;">OUTPUT</span> department, manager, vip_status
| <span style="color: #f97583;">table</span> _time, user, src_ip, department, manager, vip_status

<span style="color: #8b949e;">// Lookup with case-insensitive matching</span>
<span style="color: #79c0ff;">index</span>=security
| <span style="color: #f97583;">lookup</span> case(false) user_info.csv user <span style="color: #f97583;">OUTPUT</span> department

<span style="color: #8b949e;">// Lookup for threat intelligence</span>
<span style="color: #79c0ff;">index</span>=network
| <span style="color: #f97583;">lookup</span> threat_ips.csv src_ip <span style="color: #f97583;">OUTPUTNEW</span> threat_category, confidence
| <span style="color: #f97583;">where</span> <span style="color: #79c0ff;">isnotnull</span>(threat_category)
| <span style="color: #f97583;">table</span> _time, src_ip, dest_ip, threat_category, confidence

<span style="color: #8b949e;">// Automatic lookup (defined in transforms.conf)</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
<span style="color: #8b949e;">// asset_lookup automatically adds asset_criticality field</span>
| <span style="color: #f97583;">table</span> _time, user, dest, asset_criticality

<span style="color: #8b949e;">// Input lookup - use lookup as data source</span>
| <span style="color: #f97583;">inputlookup</span> threat_ips.csv
| <span style="color: #f97583;">where</span> confidence > 80
| <span style="color: #f97583;">table</span> src_ip, threat_category

<span style="color: #8b949e;">// Output lookup - save results to lookup file</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> src_ip
| <span style="color: #f97583;">where</span> count > 100
| <span style="color: #f97583;">outputlookup</span> suspicious_ips.csv
</pre>
                </div>

                <!-- TRANSACTIONS -->
                <h2><i class="fas fa-exchange-alt"></i> Transactions</h2>

                <div class="info-box">
                    <h4><i class="fas fa-lightbulb"></i> When to Use Transaction</h4>
                    <p>Use <code>transaction</code> when you need to:</p>
                    <ul>
                        <li>Group events that share a common field value</li>
                        <li>Track session start/end events</li>
                        <li>Calculate duration between related events</li>
                        <li>Identify event sequences</li>
                    </ul>
                </div>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Transaction Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Basic transaction - group by session ID</span>
<span style="color: #79c0ff;">index</span>=web
| <span style="color: #f97583;">transaction</span> session_id
| <span style="color: #f97583;">table</span> session_id, duration, eventcount

<span style="color: #8b949e;">// Transaction with start/end conditions</span>
<span style="color: #79c0ff;">index</span>=security <span style="color: #79c0ff;">sourcetype</span>=WinEventLog:Security
| <span style="color: #f97583;">transaction</span> user startswith=<span style="color: #a5d6ff;">"EventCode=4624"</span> endswith=<span style="color: #a5d6ff;">"EventCode=4634"</span>
| <span style="color: #f97583;">eval</span> session_duration_minutes = duration / 60
| <span style="color: #f97583;">table</span> user, Computer, session_duration_minutes, eventcount

<span style="color: #8b949e;">// Transaction with max span (timeout)</span>
<span style="color: #79c0ff;">index</span>=security EventCode <span style="color: #f97583;">IN</span> (4624, 4625)
| <span style="color: #f97583;">transaction</span> user maxspan=30m maxpause=5m
| <span style="color: #f97583;">search</span> eventcount > 10
| <span style="color: #f97583;">table</span> user, eventcount, duration

<span style="color: #8b949e;">// Transaction for attack chain detection</span>
<span style="color: #79c0ff;">index</span>=security
| <span style="color: #f97583;">transaction</span> Computer maxspan=1h
    startswith=(<span style="color: #a5d6ff;">"EventCode=4625"</span>)
    endswith=(<span style="color: #a5d6ff;">"EventCode=4672"</span>)
| <span style="color: #f97583;">where</span> eventcount > 1
| <span style="color: #f97583;">eval</span> attack_chain = <span style="color: #79c0ff;">if</span>(<span style="color: #79c0ff;">match</span>(_raw, <span style="color: #a5d6ff;">"4625.*4624.*4672"</span>), <span style="color: #a5d6ff;">"Brute Force -> Priv Esc"</span>, <span style="color: #a5d6ff;">"Unknown"</span>)
| <span style="color: #f97583;">table</span> Computer, user, attack_chain, duration, eventcount

<span style="color: #8b949e;">// Transaction with multiple fields</span>
<span style="color: #79c0ff;">index</span>=network
| <span style="color: #f97583;">transaction</span> src_ip, dest_ip maxspan=10m
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">sum</span>(bytes) <span style="color: #f97583;">as</span> total_bytes, <span style="color: #79c0ff;">avg</span>(duration) <span style="color: #f97583;">as</span> avg_session
  <span style="color: #f97583;">by</span> src_ip, dest_ip
</pre>
                </div>

                <div class="info-box" style="border-color: #d29922;">
                    <h4><i class="fas fa-exclamation-triangle" style="color: #d29922;"></i> Transaction Performance Warning</h4>
                    <p><code>transaction</code> is memory-intensive. For better performance:</p>
                    <ul>
                        <li>Use <code>stats</code> with <code>earliest()</code> and <code>latest()</code> when possible</li>
                        <li>Always specify <code>maxspan</code> and <code>maxpause</code></li>
                        <li>Filter data before using transaction</li>
                    </ul>
                </div>

                <!-- TSTATS -->
                <h2><i class="fas fa-tachometer-alt"></i> tstats - Accelerated Data Model Queries</h2>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> tstats Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Basic tstats - count authentication events</span>
| <span style="color: #f97583;">tstats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">from</span> datamodel=Authentication
  <span style="color: #f97583;">where</span> Authentication.action=failure
  <span style="color: #f97583;">by</span> Authentication.src, Authentication.user

<span style="color: #8b949e;">// tstats with time binning</span>
| <span style="color: #f97583;">tstats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">from</span> datamodel=Authentication
  <span style="color: #f97583;">where</span> Authentication.action=failure
  <span style="color: #f97583;">by</span> _time, Authentication.src
  span=1h

<span style="color: #8b949e;">// tstats with prestats for chart</span>
| <span style="color: #f97583;">tstats</span> prestats=t <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">from</span> datamodel=Authentication
  <span style="color: #f97583;">by</span> _time, Authentication.action
  span=1d
| <span style="color: #f97583;">timechart</span> span=1d <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> Authentication.action

<span style="color: #8b949e;">// tstats on Network Traffic model</span>
| <span style="color: #f97583;">tstats</span> <span style="color: #79c0ff;">sum</span>(All_Traffic.bytes) <span style="color: #f97583;">as</span> total_bytes
  <span style="color: #f97583;">from</span> datamodel=Network_Traffic.All_Traffic
  <span style="color: #f97583;">where</span> All_Traffic.dest_port=443
  <span style="color: #f97583;">by</span> All_Traffic.src, All_Traffic.dest

<span style="color: #8b949e;">// tstats on Endpoint model</span>
| <span style="color: #f97583;">tstats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">from</span> datamodel=Endpoint.Processes
  <span style="color: #f97583;">where</span> Processes.process_name=<span style="color: #a5d6ff;">"powershell.exe"</span>
  <span style="color: #f97583;">by</span> Processes.dest, Processes.user, Processes.parent_process_name

<span style="color: #8b949e;">// Converting tstats results (rename fields)</span>
| <span style="color: #f97583;">tstats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">from</span> datamodel=Authentication
  <span style="color: #f97583;">where</span> Authentication.action=failure
  <span style="color: #f97583;">by</span> Authentication.src, Authentication.user
| <span style="color: #f97583;">rename</span> Authentication.* <span style="color: #f97583;">as</span> *
| <span style="color: #f97583;">where</span> count > 10
</pre>
                </div>

                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-check"></i></div>
                            <div class="comparison-item-title">tstats Advantages</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-bolt"></i> 10-100x faster than raw search</li>
                            <li><i class="fas fa-bolt"></i> Uses pre-computed summaries</li>
                            <li><i class="fas fa-bolt"></i> Great for dashboards</li>
                            <li><i class="fas fa-bolt"></i> Works on indexed fields</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d1a1a; color: #f85149;"><i class="fas fa-times"></i></div>
                            <div class="comparison-item-title">tstats Limitations</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-times"></i> Requires accelerated data models</li>
                            <li><i class="fas fa-times"></i> Only indexed/accelerated fields</li>
                            <li><i class="fas fa-times"></i> Limited aggregation functions</li>
                            <li><i class="fas fa-times"></i> Cannot access raw events</li>
                        </ul>
                    </div>
                </div>

                <!-- MACROS -->
                <h2><i class="fas fa-code-branch"></i> Search Macros</h2>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Macro Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Using a macro (backticks)</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4625
| <span style="color: #79c0ff;">`drop_dm_object_name("Authentication")`</span>
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> src, user

<span style="color: #8b949e;">// Macro with arguments</span>
<span style="color: #79c0ff;">`security_events(4625)`</span>
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">by</span> src_ip

<span style="color: #8b949e;">// Common ES macros</span>
<span style="color: #79c0ff;">`notable`</span>                          <span style="color: #8b949e;">// Notable events index</span>
<span style="color: #79c0ff;">`risk_index`</span>                       <span style="color: #8b949e;">// Risk events index</span>
<span style="color: #79c0ff;">`datamodel("Authentication", "Authentication")`</span>
<span style="color: #79c0ff;">`cim_Network_Traffic_indexes`</span>      <span style="color: #8b949e;">// Network traffic indexes</span>

<span style="color: #8b949e;">// Creating macro in macros.conf:</span>
<span style="color: #8b949e;">// [security_events(1)]</span>
<span style="color: #8b949e;">// args = eventcode</span>
<span style="color: #8b949e;">// definition = index=security sourcetype=WinEventLog:Security EventCode=$eventcode$</span>

<span style="color: #8b949e;">// [failed_logins]</span>
<span style="color: #8b949e;">// definition = index=security EventCode=4625</span>
</pre>
                </div>

                <!-- EVAL FUNCTIONS -->
                <h2><i class="fas fa-calculator"></i> Advanced eval Functions</h2>

                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-code"></i> Advanced eval Examples</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Coalesce - first non-null value</span>
| <span style="color: #f97583;">eval</span> user = <span style="color: #79c0ff;">coalesce</span>(user, Account_Name, src_user, <span style="color: #a5d6ff;">"Unknown"</span>)

<span style="color: #8b949e;">// Null handling</span>
| <span style="color: #f97583;">eval</span> has_user = <span style="color: #79c0ff;">if</span>(<span style="color: #79c0ff;">isnull</span>(user), <span style="color: #a5d6ff;">"No"</span>, <span style="color: #a5d6ff;">"Yes"</span>)
| <span style="color: #f97583;">eval</span> user = <span style="color: #79c0ff;">if</span>(<span style="color: #79c0ff;">isnotnull</span>(user), user, <span style="color: #a5d6ff;">"N/A"</span>)

<span style="color: #8b949e;">// Multi-value field operations</span>
| <span style="color: #f97583;">eval</span> domain = <span style="color: #79c0ff;">mvindex</span>(<span style="color: #79c0ff;">split</span>(user, <span style="color: #a5d6ff;">"\\"</span>), 0)
| <span style="color: #f97583;">eval</span> username = <span style="color: #79c0ff;">mvindex</span>(<span style="color: #79c0ff;">split</span>(user, <span style="color: #a5d6ff;">"\\"</span>), 1)
| <span style="color: #f97583;">eval</span> ip_count = <span style="color: #79c0ff;">mvcount</span>(ip_list)
| <span style="color: #f97583;">eval</span> all_ips = <span style="color: #79c0ff;">mvjoin</span>(ip_list, <span style="color: #a5d6ff;">", "</span>)

<span style="color: #8b949e;">// JSON parsing</span>
| <span style="color: #f97583;">eval</span> json_data = <span style="color: #79c0ff;">spath</span>(_raw, <span style="color: #a5d6ff;">"user.name"</span>)
| <span style="color: #f97583;">eval</span> all_fields = <span style="color: #79c0ff;">json_extract</span>(_raw, <span style="color: #a5d6ff;">"$.data"</span>)

<span style="color: #8b949e;">// CIDR matching</span>
| <span style="color: #f97583;">eval</span> is_internal = <span style="color: #79c0ff;">if</span>(<span style="color: #79c0ff;">cidrmatch</span>(<span style="color: #a5d6ff;">"10.0.0.0/8"</span>, src_ip) OR <span style="color: #79c0ff;">cidrmatch</span>(<span style="color: #a5d6ff;">"172.16.0.0/12"</span>, src_ip), <span style="color: #a5d6ff;">"Yes"</span>, <span style="color: #a5d6ff;">"No"</span>)

<span style="color: #8b949e;">// Time calculations</span>
| <span style="color: #f97583;">eval</span> hour = <span style="color: #79c0ff;">strftime</span>(_time, <span style="color: #a5d6ff;">"%H"</span>)
| <span style="color: #f97583;">eval</span> day_of_week = <span style="color: #79c0ff;">strftime</span>(_time, <span style="color: #a5d6ff;">"%A"</span>)
| <span style="color: #f97583;">eval</span> is_business_hours = <span style="color: #79c0ff;">if</span>(hour >= 9 AND hour < 17 AND <span style="color: #79c0ff;">NOT match</span>(day_of_week, <span style="color: #a5d6ff;">"Saturday|Sunday"</span>), <span style="color: #a5d6ff;">"Yes"</span>, <span style="color: #a5d6ff;">"No"</span>)
| <span style="color: #f97583;">eval</span> epoch = <span style="color: #79c0ff;">strptime</span>(date_field, <span style="color: #a5d6ff;">"%Y-%m-%d %H:%M:%S"</span>)

<span style="color: #8b949e;">// Regex operations</span>
| <span style="color: #f97583;">eval</span> is_admin = <span style="color: #79c0ff;">if</span>(<span style="color: #79c0ff;">match</span>(user, <span style="color: #a5d6ff;">"(?i)admin|root|system"</span>), 1, 0)
| <span style="color: #f97583;">rex</span> field=_raw <span style="color: #a5d6ff;">"user=(?<extracted_user>\w+)"</span>

<span style="color: #8b949e;">// Mathematical functions</span>
| <span style="color: #f97583;">eval</span> log_bytes = <span style="color: #79c0ff;">log</span>(bytes, 10)
| <span style="color: #f97583;">eval</span> rounded = <span style="color: #79c0ff;">round</span>(percentage, 2)
| <span style="color: #f97583;">eval</span> absolute = <span style="color: #79c0ff;">abs</span>(value)

<span style="color: #8b949e;">// Type conversion</span>
| <span style="color: #f97583;">eval</span> numeric_value = <span style="color: #79c0ff;">tonumber</span>(string_value)
| <span style="color: #f97583;">eval</span> string_value = <span style="color: #79c0ff;">tostring</span>(numeric_value, <span style="color: #a5d6ff;">"commas"</span>)
</pre>
                </div>

                <!-- SECURITY USE CASES -->
                <h2><i class="fas fa-shield-alt"></i> Advanced Security Use Cases</h2>

                <h3>Use Case 1: Attack Chain Detection</h3>
                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-link"></i> Multi-Stage Attack Detection</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect: Failed Logins -> Success -> Privilege Escalation</span>
<span style="color: #79c0ff;">index</span>=security <span style="color: #79c0ff;">sourcetype</span>=WinEventLog:Security
    EventCode <span style="color: #f97583;">IN</span> (4625, 4624, 4672, 4673)
| <span style="color: #f97583;">eval</span> event_type = <span style="color: #79c0ff;">case</span>(
    EventCode==4625, <span style="color: #a5d6ff;">"1_FailedLogin"</span>,
    EventCode==4624, <span style="color: #a5d6ff;">"2_SuccessLogin"</span>,
    EventCode==4672, <span style="color: #a5d6ff;">"3_SpecialPriv"</span>,
    EventCode==4673, <span style="color: #a5d6ff;">"4_PrivilegeUse"</span>
)
| <span style="color: #f97583;">transaction</span> Computer, Account_Name maxspan=1h
| <span style="color: #f97583;">where</span> eventcount >= 3
| <span style="color: #f97583;">search</span> <span style="color: #a5d6ff;">"1_FailedLogin"</span> AND <span style="color: #a5d6ff;">"2_SuccessLogin"</span> AND (<span style="color: #a5d6ff;">"3_SpecialPriv"</span> OR <span style="color: #a5d6ff;">"4_PrivilegeUse"</span>)
| <span style="color: #f97583;">eval</span> attack_chain = <span style="color: #a5d6ff;">"Brute Force -> Compromise -> Privilege Escalation"</span>
| <span style="color: #f97583;">table</span> Computer, Account_Name, attack_chain, duration, eventcount
| <span style="color: #f97583;">sort</span> - eventcount
</pre>
                </div>

                <h3>Use Case 2: Lateral Movement Detection</h3>
                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-network-wired"></i> Lateral Movement Patterns</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect users logging into multiple systems in short time</span>
<span style="color: #79c0ff;">index</span>=security EventCode=4624 Logon_Type <span style="color: #f97583;">IN</span> (3, 10)
| <span style="color: #f97583;">bucket</span> _time span=30m
| <span style="color: #f97583;">stats</span> 
    dc(Computer) <span style="color: #f97583;">as</span> unique_hosts,
    values(Computer) <span style="color: #f97583;">as</span> hosts_accessed,
    earliest(_time) <span style="color: #f97583;">as</span> first_login,
    latest(_time) <span style="color: #f97583;">as</span> last_login
  <span style="color: #f97583;">by</span> Account_Name, _time, Source_Network_Address
| <span style="color: #f97583;">where</span> unique_hosts > 5
| <span style="color: #f97583;">eval</span> risk_score = unique_hosts * 10
| <span style="color: #f97583;">eval</span> risk_level = <span style="color: #79c0ff;">case</span>(
    unique_hosts >= 20, <span style="color: #a5d6ff;">"Critical"</span>,
    unique_hosts >= 10, <span style="color: #a5d6ff;">"High"</span>,
    unique_hosts >= 5, <span style="color: #a5d6ff;">"Medium"</span>,
    <span style="color: #79c0ff;">true</span>(), <span style="color: #a5d6ff;">"Low"</span>
)
| <span style="color: #f97583;">table</span> Account_Name, Source_Network_Address, unique_hosts, 
       hosts_accessed, risk_level, risk_score
| <span style="color: #f97583;">sort</span> - unique_hosts
</pre>
                </div>

                <h3>Use Case 3: DNS Exfiltration Detection</h3>
                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-globe"></i> DNS Tunneling Detection</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect DNS tunneling via unusual query patterns</span>
<span style="color: #79c0ff;">index</span>=dns
| <span style="color: #f97583;">eval</span> query_length = <span style="color: #79c0ff;">len</span>(query)
| <span style="color: #f97583;">eval</span> subdomain_count = <span style="color: #79c0ff;">mvcount</span>(<span style="color: #79c0ff;">split</span>(query, <span style="color: #a5d6ff;">"."</span>))
| <span style="color: #f97583;">eval</span> entropy = <span style="color: #79c0ff;">mvcount</span>(<span style="color: #79c0ff;">split</span>(query, <span style="color: #a5d6ff;">""</span>)) / query_length
| <span style="color: #f97583;">stats</span> 
    <span style="color: #79c0ff;">count</span> <span style="color: #f97583;">as</span> query_count,
    <span style="color: #79c0ff;">avg</span>(query_length) <span style="color: #f97583;">as</span> avg_query_length,
    <span style="color: #79c0ff;">max</span>(query_length) <span style="color: #f97583;">as</span> max_query_length,
    dc(query) <span style="color: #f97583;">as</span> unique_queries,
    values(query) <span style="color: #f97583;">as</span> sample_queries
  <span style="color: #f97583;">by</span> src_ip, query_type
| <span style="color: #f97583;">where</span> avg_query_length > 50 OR query_count > 1000
| <span style="color: #f97583;">eval</span> suspicion_score = (avg_query_length / 10) + (query_count / 100)
| <span style="color: #f97583;">eval</span> is_suspicious = <span style="color: #79c0ff;">if</span>(suspicion_score > 20, <span style="color: #a5d6ff;">"Yes"</span>, <span style="color: #a5d6ff;">"No"</span>)
| <span style="color: #f97583;">where</span> is_suspicious = <span style="color: #a5d6ff;">"Yes"</span>
| <span style="color: #f97583;">table</span> src_ip, query_count, avg_query_length, unique_queries, 
       sample_queries, suspicion_score
</pre>
                </div>

                <h3>Use Case 4: Anomaly Detection with Stats</h3>
                <div class="arch-diagram">
                    <div class="code-header"><i class="fas fa-chart-line"></i> Statistical Anomaly Detection</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect users with unusual data transfer volumes</span>
<span style="color: #79c0ff;">index</span>=network
| <span style="color: #f97583;">stats</span> <span style="color: #79c0ff;">sum</span>(bytes_out) <span style="color: #f97583;">as</span> total_bytes <span style="color: #f97583;">by</span> user
| <span style="color: #f97583;">eventstats</span> 
    <span style="color: #79c0ff;">avg</span>(total_bytes) <span style="color: #f97583;">as</span> avg_bytes,
    <span style="color: #79c0ff;">stdev</span>(total_bytes) <span style="color: #f97583;">as</span> stdev_bytes
| <span style="color: #f97583;">eval</span> z_score = (total_bytes - avg_bytes) / stdev_bytes
| <span style="color: #f97583;">eval</span> is_anomaly = <span style="color: #79c0ff;">if</span>(z_score > 3, <span style="color: #a5d6ff;">"Yes"</span>, <span style="color: #a5d6ff;">"No"</span>)
| <span style="color: #f97583;">where</span> is_anomaly = <span style="color: #a5d6ff;">"Yes"</span>
| <span style="color: #f97583;">eval</span> total_GB = <span style="color: #79c0ff;">round</span>(total_bytes / 1073741824, 2)
| <span style="color: #f97583;">eval</span> deviation = <span style="color: #79c0ff;">round</span>(z_score, 2) . <span style="color: #a5d6ff;">" standard deviations above mean"</span>
| <span style="color: #f97583;">table</span> user, total_GB, z_score, deviation
| <span style="color: #f97583;">sort</span> - z_score
</pre>
                </div>

                <!-- PERFORMANCE OPTIMIZATION -->
                <h2><i class="fas fa-tachometer-alt"></i> Performance Optimization</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-check"></i></div>
                            <div class="comparison-item-title">Do This</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Specify index and sourcetype</li>
                            <li><i class="fas fa-check"></i> Use time range early</li>
                            <li><i class="fas fa-check"></i> Filter before stats/join</li>
                            <li><i class="fas fa-check"></i> Use tstats for data models</li>
                            <li><i class="fas fa-check"></i> Limit fields with | fields</li>
                            <li><i class="fas fa-check"></i> Use indexed fields in filters</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d1a1a; color: #f85149;"><i class="fas fa-times"></i></div>
                            <div class="comparison-item-title">Avoid This</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-times"></i> index=* searches</li>
                            <li><i class="fas fa-times"></i> Leading wildcards (*value)</li>
                            <li><i class="fas fa-times"></i> Large transactions without limits</li>
                            <li><i class="fas fa-times"></i> Unnecessary subsearches</li>
                            <li><i class="fas fa-times"></i> Multiple regex on same field</li>
                            <li><i class="fas fa-times"></i> Searching all time</li>
                        </ul>
                    </div>
                </div>

                <!-- ENTERPRISE EXAMPLE -->
                <div class="enterprise-example">
                    <div class="enterprise-example-header">
                        <i class="fas fa-building"></i>
                        <div class="enterprise-example-title">Enterprise Example: Advanced Threat Detection Dashboard</div>
                    </div>
                    <div class="enterprise-example-scenario">
                        <strong>Scenario:</strong> Building a real-time threat detection dashboard processing 500GB/day across 20,000 endpoints.
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #3fb950; margin-top: 0;">Optimized Query Pattern</h4>
<pre style="color: #8b949e; font-size: 0.85rem; margin: 0;">
| tstats count from datamodel=Authentication
  where Authentication.action=failure
  by Authentication.src, Authentication.user
| rename Authentication.* as *
| where count > threshold
| lookup user_info.csv user OUTPUT department
| eval risk = count * 10</pre>
                        </div>
                        <div style="background: #0d1117; border-radius: 8px; padding: 16px;">
                            <h4 style="color: #58a6ff; margin-top: 0;">Performance Results</h4>
                            <p style="color: #8b949e; font-size: 0.85rem;">
                                <strong>Query Time:</strong> 2-5 seconds<br>
                                <strong>Data Scanned:</strong> Accelerated summaries only<br>
                                <strong>Refresh:</strong> Every 5 minutes<br>
                                <strong>Memory:</strong> Minimal with tstats
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Decision Trees -->
                <h2><i class="fas fa-project-diagram"></i> Advanced SPL Decision Trees</h2>
                
                <div class="config-section">
                    <h3>Decision Tree: Join vs Subsearch vs Lookup Selection</h3>
                    <div class="arch-diagram">
Decision Tree: Correlating Data from Multiple Sources
════════════════════════════════════════════════════════

START: Need to combine data from multiple sources?
│
├──► Is enrichment data STATIC (changes rarely)?
│   ├──► YES: File-based reference data?
│   │   └──► USE: lookup
│   │       • lookup asset_info ip as src OUTPUT owner, criticality
│   │       • Best for: asset lists, threat feeds, user directories
│   │       • Performance: Excellent (file-based, cached)
│   │
│   └──► NO: Dynamic from Splunk index? → Continue
│
├──► Is the secondary data SMALL (&lt;10K results)?
│   ├──► YES: Need simple filtering?
│   │   └──► USE: subsearch
│   │       • index=main [search index=threats | fields ip]
│   │       • Returns values as filter criteria
│   │       • Timeout: 60 seconds, 10K row limit
│   │
│   └──► NO: Large dataset → Continue
│
├──► Need FULL correlation of two datasets?
│   ├──► Can you restructure as stats?
│   │   └──► USE: append + stats (preferred)
│   │       • | append [search index=other] | stats values(*) by key
│   │       • Much faster than join
│   │
│   └──► Must preserve row structure?
│       └──► USE: join (last resort)
│           • | join type=left user [search index=hr]
│           • Memory intensive, avoid in production alerts
│           • Consider: Can lookup table be created instead?
│
└──► Complex time-based correlation?
    └──► USE: transaction or streamstats
        • For session correlation: transaction
        • For running calculations: streamstats
                    </div>

                    <h3>Decision Tree: Subsearch Optimization</h3>
                    <div class="arch-diagram">
Decision Tree: Optimizing Subsearch Performance
═══════════════════════════════════════════════════

START: Subsearch is slow or timing out
│
├──► CHECK 1: Does subsearch return &gt;10K results?
│   ├──► YES: Subsearch is wrong approach
│   │   └──► ALTERNATIVES:
│   │       • Convert to lookup table (generate daily)
│   │       • Use append + stats pattern
│   │       • Restructure as single search with eventstats
│   │
│   └──► NO → Continue
│
├──► CHECK 2: Is subsearch taking &gt;30 seconds?
│   ├──► YES: Optimize the inner search
│   │   └──► FIX:
│   │       • Add index= and sourcetype= constraints
│   │       • Narrow time range
│   │       • Pre-filter before dedup/table
│   │
│   └──► NO → Continue
│
├──► CHECK 3: Are you using return vs format?
│   ├──► Using format (default)?
│   │   └──► Consider return for large lists:
│   │       • [search ... | return 10000 $user]
│   │       • More efficient than default format
│   │
│   └──► Using return appropriately → Continue
│
├──► CHECK 4: Multiple subsearches in one query?
│   └──► YES: Significant performance hit
│       └──► FIX:
│           • Combine into single subsearch where possible
│           • Move to lookup tables
│           • Consider summary indexing approach
│
└──► Still slow?
    └──► Consider architecture change:
        • Pre-computed lookup (scheduled search → outputlookup)
        • Summary index for frequently accessed data
        • Data model acceleration
                    </div>

                    <h3>Decision Tree: Stats Function Selection</h3>
                    <div class="arch-diagram">
Decision Tree: Choosing the Right Stats Function
═══════════════════════════════════════════════════

START: What aggregation do you need?
│
├──► COUNTING
│   ├──► Count all events?
│   │   └──► USE: count
│   │       • stats count by user
│   │
│   ├──► Count unique values?
│   │   └──► USE: dc (distinct count)
│   │       • stats dc(src_ip) as unique_sources by user
│   │
│   └──► Count with conditions?
│       └──► USE: count(eval(...))
│           • stats count(eval(status="error")) as errors by host
│
├──► COLLECTING VALUES
│   ├──► All unique values?
│   │   └──► USE: values
│   │       • stats values(action) as all_actions by user
│   │       • Alphabetically sorted, deduped
│   │
│   ├──► All values preserving duplicates?
│   │   └──► USE: list
│   │       • stats list(action) as action_sequence by session
│   │       • Preserves order and duplicates
│   │
│   └──► First or last value?
│       └──► USE: first / last / latest / earliest
│           • stats earliest(_time) as first_seen by user
│
├──► NUMERIC CALCULATIONS
│   ├──► Sum of values?
│   │   └──► USE: sum
│   │       • stats sum(bytes) as total_bytes by user
│   │
│   ├──► Average?
│   │   └──► USE: avg
│   │       • stats avg(response_time) as mean_time by server
│   │
│   ├──► Median (50th percentile)?
│   │   └──► USE: median or perc50
│   │       • stats median(duration) as typical_duration
│   │
│   └──► Percentiles?
│       └──► USE: perc&lt;N&gt; or exactperc&lt;N&gt;
│           • stats perc95(response_time) as p95 by endpoint
│
└──► COMBINING AGGREGATIONS
    └──► USE: Multiple in one stats
        • stats count, sum(bytes), avg(duration), values(action) by user
        • More efficient than multiple stats commands
                    </div>
                </div>

                <!-- What Enterprises Usually Miss -->
                <h2><i class="fas fa-exclamation-circle"></i> What Enterprises Usually Miss</h2>
                
                <div class="config-section">
                    <div class="warning-box">
                        <h4><i class="fas fa-exclamation-triangle"></i> Advanced SPL Anti-Patterns in Production</h4>
                        <p>Common mistakes that cause performance issues, memory exhaustion, and incorrect results in enterprise environments:</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 16px;">
                        <div style="background: #161b22; padding: 16px; border-radius: 8px; border-left: 3px solid #f85149;">
                            <h4 style="color: #f85149; margin-top: 0;">🔴 Subsearch Abuse</h4>
                            <ul style="color: #8b949e; font-size: 0.9rem;">
                                <li><strong>Nested subsearches:</strong> [search ... [search ...]] causes exponential slowdown</li>
                                <li><strong>Large result sets:</strong> Subsearch returns 10K+ results, silently truncated</li>
                                <li><strong>Timeout ignorance:</strong> Default 60s timeout, searches fail silently</li>
                                <li><strong>No field limiting:</strong> Returning all fields when only one needed</li>
                                <li><strong>Wrong use case:</strong> Using subsearch when lookup is appropriate</li>
                            </ul>
                        </div>
                        <div style="background: #161b22; padding: 16px; border-radius: 8px; border-left: 3px solid #d29922;">
                            <h4 style="color: #d29922; margin-top: 0;">🟡 Join Misconceptions</h4>
                            <ul style="color: #8b949e; font-size: 0.9rem;">
                                <li><strong>Default is inner join:</strong> Missing data when expecting left join</li>
                                <li><strong>Memory consumption:</strong> Right-side dataset loaded into memory</li>
                                <li><strong>Subsearch limits apply:</strong> Right side has 50K row limit</li>
                                <li><strong>Performance cliff:</strong> Works on 100 rows, fails on 100K</li>
                                <li><strong>Better alternatives:</strong> 90% of joins can be replaced with stats</li>
                            </ul>
                        </div>
                        <div style="background: #161b22; padding: 16px; border-radius: 8px; border-left: 3px solid #58a6ff;">
                            <h4 style="color: #58a6ff; margin-top: 0;">🔵 Eval Gotchas</h4>
                            <ul style="color: #8b949e; font-size: 0.9rem;">
                                <li><strong>Null field handling:</strong> Calculations fail silently on null fields</li>
                                <li><strong>Type coercion:</strong> String "100" vs number 100 behavior differences</li>
                                <li><strong>Case functions:</strong> case() vs coalesce() vs if() misuse</li>
                                <li><strong>Time functions:</strong> strftime/strptime timezone confusion</li>
                                <li><strong>Regex in eval:</strong> match() vs like() vs regex performance</li>
                            </ul>
                        </div>
                        <div style="background: #161b22; padding: 16px; border-radius: 8px; border-left: 3px solid #3fb950;">
                            <h4 style="color: #3fb950; margin-top: 0;">🟢 Enterprise Best Practices Ignored</h4>
                            <ul style="color: #8b949e; font-size: 0.9rem;">
                                <li><strong>No macro usage:</strong> Complex logic repeated instead of centralized</li>
                                <li><strong>Missing lookups:</strong> Hardcoded lists that should be maintainable lookups</li>
                                <li><strong>No eventtypes:</strong> Repeated filter logic instead of saved eventtypes</li>
                                <li><strong>Ignoring tstats:</strong> Using raw search when accelerated models exist</li>
                                <li><strong>No search macros:</strong> Threshold values hardcoded instead of configurable</li>
                            </ul>
                        </div>
                    </div>

                    <h4 style="margin-top: 24px;"><i class="fas fa-check-circle"></i> Advanced SPL Quality Checklist</h4>
                    <div class="arch-diagram">
BEFORE PRODUCTION DEPLOYMENT
════════════════════════════════════════════

PERFORMANCE
□ Tested with production data volumes (not just sample data)
□ Job Inspector reviewed for bottlenecks
□ No subsearches returning &gt;5K results
□ No joins on large datasets (use lookup/stats instead)
□ tstats used where data models available
□ Parallel processing considered (map command for parallelization)

LOGIC & CORRECTNESS
□ Null value handling tested
□ Edge cases validated (empty results, single result, max results)
□ Multi-value field handling correct
□ Time zone handling verified
□ Case sensitivity accounted for

MAINTAINABILITY
□ Complex logic extracted to macros
□ Reference data in lookups (not hardcoded)
□ Comments explain non-obvious logic
□ Thresholds in macros or lookups for easy tuning
□ Follows team naming conventions

OPERATIONALIZATION
□ Tested at scheduled time (not just ad-hoc)
□ Alerting thresholds baselined
□ Known false positive patterns documented
□ Runbook exists for each alert generated
                    </div>
                </div>

                <!-- INTERVIEW QUESTIONS -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question">Q: When would you use join vs subsearch vs lookup?</button>
                        <div class="qa-answer">
                            <p><strong>Subsearch:</strong></p>
                            <ul>
                                <li>Quick filtering based on another search</li>
                                <li>Small result sets (&lt;10,000 results)</li>
                                <li>Simple OR conditions</li>
                            </ul>
                            <p><strong>Join:</strong></p>
                            <ul>
                                <li>Combining two datasets on common key</li>
                                <li>Need multiple fields from second dataset</li>
                                <li>More control over join type (inner/left/outer)</li>
                            </ul>
                            <p><strong>Lookup:</strong></p>
                            <ul>
                                <li>Enriching with static/reference data</li>
                                <li>Fastest option for small files</li>
                                <li>Can be automatic (auto-lookup)</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: How do you optimize a slow Splunk search?</button>
                        <div class="qa-answer">
                            <p><strong>Step-by-step optimization:</strong></p>
                            <ol>
                                <li><strong>Check the Job Inspector:</strong> Identify slow components</li>
                                <li><strong>Add index/sourcetype:</strong> Always specify these</li>
                                <li><strong>Reduce time range:</strong> Smallest range needed</li>
                                <li><strong>Move filters early:</strong> WHERE before STATS</li>
                                <li><strong>Use tstats:</strong> If using data models</li>
                                <li><strong>Avoid wildcards:</strong> Especially leading wildcards</li>
                                <li><strong>Limit fields:</strong> Use | fields to reduce data</li>
                                <li><strong>Consider summary indexing:</strong> For repeated queries</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: Explain the difference between stats and eventstats</button>
                        <div class="qa-answer">
                            <p><strong>stats:</strong></p>
                            <ul>
                                <li>Aggregates and collapses rows</li>
                                <li>Output is one row per group</li>
                                <li>Removes original events</li>
                            </ul>
                            <p><strong>eventstats:</strong></p>
                            <ul>
                                <li>Adds aggregation as new field</li>
                                <li>Keeps all original events</li>
                                <li>Useful for comparing events to averages</li>
                            </ul>
                            <p><strong>Example:</strong></p>
                            <pre style="background: #0d1117; padding: 8px; border-radius: 4px; color: #f0f6fc;">// Add user's total to each event
| eventstats sum(bytes) as user_total by user
| eval percent_of_total = (bytes / user_total) * 100</pre>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: What are data models and why are they important for ES?</button>
                        <div class="qa-answer">
                            <p><strong>Data Models:</strong></p>
                            <ul>
                                <li>Normalized schemas for different data types</li>
                                <li>CIM (Common Information Model) standard</li>
                                <li>Enable vendor-agnostic searches</li>
                            </ul>
                            <p><strong>Importance for ES:</strong></p>
                            <ul>
                                <li>Correlation searches use data models</li>
                                <li>Accelerated for fast dashboards</li>
                                <li>OOTB content depends on proper mapping</li>
                                <li>tstats only works on accelerated models</li>
                            </ul>
                            <p><strong>Key Data Models:</strong> Authentication, Network_Traffic, Endpoint, Malware, Web</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain how you'd use streamstats for anomaly detection.</button>
                        <div class="qa-answer">
                            <p><strong>Approach:</strong> streamstats calculates running statistics that enable real-time baseline comparison.</p>
                            <div class="arch-diagram">index=web sourcetype=access_combined
| bucket _time span=5m
| stats count as requests by _time, clientip
| streamstats window=24 avg(requests) as baseline stdev(requests) as stdev by clientip
| eval upper_bound = baseline + (3 * stdev)
| eval lower_bound = baseline - (3 * stdev)  
| where requests > upper_bound OR requests < lower_bound
| eval anomaly_type = if(requests > upper_bound, "spike", "drop")
| table _time, clientip, requests, baseline, anomaly_type</div>
                            <p><strong>Why this works:</strong></p>
                            <ul>
                                <li>window=24 means last 24 data points (2 hours at 5-min buckets)</li>
                                <li>3 standard deviations catches ~99.7% of normal variance</li>
                                <li>Baseline is per-clientip, so each user has their own normal</li>
                            </ul>
                            <p><strong>Trade-offs:</strong> streamstats is memory-intensive; for very large datasets, consider pre-aggregating or using summary indexing.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk me through debugging a complex SPL search that's returning wrong results.</button>
                        <div class="qa-answer">
                            <p><strong>My debugging methodology:</strong></p>
                            <ol>
                                <li><strong>Isolate the pipeline:</strong> Run each command one at a time
                                    <div class="arch-diagram">// Start here
index=security EventCode=4625 earliest=-1h
// Then add one command at a time
| stats count by src_ip, user
// Check results, then add next
| where count > 5</div>
                                </li>
                                <li><strong>Check field existence:</strong> Verify fields exist before using
                                    <div class="arch-diagram">| fieldsummary | where count > 0</div>
                                </li>
                                <li><strong>Watch for null handling:</strong> Add explicit checks
                                    <div class="arch-diagram">| where isnotnull(src_ip) AND src_ip != ""</div>
                                </li>
                                <li><strong>Check case sensitivity:</strong> Splunk is case-sensitive by default
                                    <div class="arch-diagram">| eval user_lower = lower(user) | where user_lower = "admin"</div>
                                </li>
                                <li><strong>Examine multi-value fields:</strong> Use mvexpand if needed
                                    <div class="arch-diagram">| mvexpand users | where users = "admin"</div>
                                </li>
                            </ol>
                            <p><strong>Common culprits:</strong> Field extraction failures, time zone issues, subsearch truncation, join type mismatch.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you build a search to detect lateral movement?</button>
                        <div class="qa-answer">
                            <p><strong>Detection approach:</strong> Correlate authentication events to identify users accessing many unique hosts in short time.</p>
                            <div class="arch-diagram">index=security (EventCode=4624 OR EventCode=4648)
| bucket _time span=1h
| stats dc(dest) as unique_hosts values(dest) as hosts by _time, user, src
| where unique_hosts > 10
| lookup user_baseline.csv user OUTPUT normal_host_count
| eval deviation = unique_hosts - normal_host_count
| where deviation > 5 OR isnull(normal_host_count)
| eval risk_score = case(
    unique_hosts > 50, 100,
    unique_hosts > 25, 75,
    unique_hosts > 10, 50,
    true(), 25)
| table _time, user, src, unique_hosts, normal_host_count, deviation, risk_score, hosts</div>
                            <p><strong>Why this design:</strong></p>
                            <ul>
                                <li>4624 = successful logon, 4648 = explicit credentials (runas/psexec)</li>
                                <li>Baseline comparison catches abnormal behavior per-user</li>
                                <li>New users (null baseline) flagged for review</li>
                                <li>Risk scoring enables prioritization in SOC</li>
                            </ul>
                            <p><strong>Tuning needed:</strong> Adjust thresholds based on your environment. IT admins legitimately access many hosts.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain map command and when you'd use it.</button>
                        <div class="qa-answer">
                            <p><strong>map command:</strong> Runs a search for each result of a previous search - essentially a for-each loop.</p>
                            <div class="arch-diagram">// Find top 10 users with failed logins, then get details for each
index=security EventCode=4625 earliest=-24h
| top 10 user
| map maxsearches=10 search="search index=security EventCode=4625 user=$user$ | stats count by src_ip | head 5"</div>
                            <p><strong>When to use:</strong></p>
                            <ul>
                                <li>When you need to run a search per entity (user, IP, host)</li>
                                <li>When subsearch won't work due to result limits</li>
                                <li>When each iteration needs different parameters</li>
                            </ul>
                            <p><strong>Caution:</strong></p>
                            <ul>
                                <li>Can be slow - runs searches sequentially</li>
                                <li>Default maxsearches=10, max is 100</li>
                                <li>Consider alternatives: stats with values(), or summary indexing</li>
                            </ul>
                            <p><strong>Real use case:</strong> Investigating incidents where you need to pivot from IOCs to find all affected systems.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle time zone issues in SPL?</button>
                        <div class="qa-answer">
                            <p><strong>Common time zone challenges:</strong></p>
                            <ul>
                                <li><strong>_time field:</strong> Always stored in epoch (UTC)</li>
                                <li><strong>Display:</strong> Converted to user's timezone in UI</li>
                                <li><strong>Source data:</strong> May have timezone embedded or not</li>
                            </ul>
                            <p><strong>Converting time zones in SPL:</strong></p>
                            <div class="arch-diagram">// Convert _time to specific timezone for display
| eval local_time = strftime(_time, "%Y-%m-%d %H:%M:%S %Z")

// Parse a string with timezone info
| eval parsed_time = strptime(timestamp_field, "%Y-%m-%d %H:%M:%S %z")

// Force timezone on a raw timestamp
| eval utc_time = strptime(local_timestamp . " EST", "%Y-%m-%d %H:%M:%S %Z")

// Compare events across timezones
| eval normalized_hour = tonumber(strftime(_time, "%H"))</div>
                            <p><strong>Best practice:</strong> Configure timezone at indexing time via props.conf TZ setting. Fixing timezone at search time is expensive.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Describe a scenario where you optimized a slow correlation search.</button>
                        <div class="qa-answer">
                            <p><strong>Scenario:</strong> Brute force detection was taking 45 minutes, needed to run every 5 minutes.</p>
                            <p><strong>Original search (slow):</strong></p>
                            <div class="arch-diagram">index=* EventCode=4625
| transaction user maxspan=10m
| where eventcount > 10
| join user [search index=hr | table user, department]</div>
                            <p><strong>Problems identified:</strong></p>
                            <ul>
                                <li>index=* scanning everything</li>
                                <li>transaction is memory-intensive</li>
                                <li>join adds unnecessary overhead</li>
                            </ul>
                            <p><strong>Optimized search (fast):</strong></p>
                            <div class="arch-diagram">| tstats count from datamodel=Authentication.Failed_Authentication 
    where nodename=Authentication.Failed_Authentication by _time span=10m, Authentication.user, Authentication.src
| rename Authentication.* as *
| where count > 10
| lookup hr_info.csv user OUTPUT department</div>
                            <p><strong>Results:</strong> 45 min → 8 seconds. The key was using tstats on accelerated data model and replacing join with lookup.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you implement a SPL-based threat hunting workflow?</button>
                        <div class="qa-answer">
                            <p><strong>Structured hunting approach:</strong></p>
                            <ol>
                                <li><strong>Hypothesis-driven search:</strong>
                                    <div class="arch-diagram">// Hypothesis: Attackers using encoded PowerShell
index=endpoint process_name=powershell.exe
| rex field=command_line "(?i)(-enc|-encodedcommand)\s+(?&lt;encoded_cmd&gt;[A-Za-z0-9+/=]+)"
| where len(encoded_cmd) > 50
| eval decoded = base64decode(encoded_cmd)
| table _time, host, user, decoded</div>
                                </li>
                                <li><strong>Baseline normal:</strong>
                                    <div class="arch-diagram">// Establish what's normal
index=endpoint process_name=*
| stats count by process_name, parent_process
| sort - count
| head 100</div>
                                </li>
                                <li><strong>Find outliers:</strong>
                                    <div class="arch-diagram">// Rare parent-child relationships
index=endpoint
| stats count by parent_process, process_name
| eventstats sum(count) as total_for_parent by parent_process
| eval ratio = count/total_for_parent
| where ratio < 0.01 AND count > 5  // Rare but recurring</div>
                                </li>
                            </ol>
                            <p><strong>Workflow:</strong> Document findings in lookup tables, convert successful hunts to correlation searches, track coverage via MITRE ATT&CK.</p>
                        </div>
                    </div>
                </div>

                

                </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>