<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPL Fundamentals | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <style>
        .config-section { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin: 16px 0; }
        .code-block { background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 16px; margin: 12px 0; font-family: 'Fira Code', monospace; font-size: 0.85rem; overflow-x: auto; white-space: pre; }
        .cmd-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 16px; margin: 12px 0; }
        .cmd-name { color: #3fb950; font-weight: 700; font-size: 1.1rem; }
        .cmd-syntax { background: #21262d; padding: 8px 12px; border-radius: 4px; font-family: monospace; margin: 8px 0; display: block; }
    </style>
</head>
<body>
    <div class="app-container">
                                                                                <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Splunk Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                    <a href="es-overview.html" class="nav-link"><i class="fas fa-shield-alt"></i> Enterprise Security</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Data Ingestion</a>
                    <a href="forwarders.html" class="nav-link"><i class="fas fa-share"></i> Forwarders</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & Indexing</a>
                    <a href="apps-tas.html" class="nav-link"><i class="fas fa-puzzle-piece"></i> Apps & TAs</a>
                    <a href="data-models.html" class="nav-link"><i class="fas fa-cubes"></i> Data Models (CIM)</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">SPL Query Language</div>
                    <a href="spl-fundamentals.html" class="nav-link active"><i class="fas fa-terminal"></i> SPL Fundamentals</a>
                    <a href="spl-intermediate.html" class="nav-link"><i class="fas fa-layer-group"></i> SPL Intermediate</a>
                    <a href="spl-advanced.html" class="nav-link"><i class="fas fa-code"></i> SPL Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">ES Detection</div>
                    <a href="correlation-searches.html" class="nav-link"><i class="fas fa-project-diagram"></i> Correlation Searches</a>
                    <a href="notable-events.html" class="nav-link"><i class="fas fa-exclamation-triangle"></i> Notable Events</a>
                    <a href="risk-based-alerting.html" class="nav-link"><i class="fas fa-chart-line"></i> Risk-Based Alerting</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-skull-crossbones"></i> Threat Intelligence</a>
                    <a href="soar.html" class="nav-link"><i class="fas fa-robot"></i> SOAR Integration</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="dashboards.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboards</a>
                    <a href="retention-tiers.html" class="nav-link"><i class="fas fa-archive"></i> Retention & Storage</a>
                    <a href="troubleshooting.html" class="nav-link"><i class="fas fa-wrench"></i> Troubleshooting</a>
                    <a href="enterprise-scenarios.html" class="nav-link"><i class="fas fa-building"></i> Enterprise Scenarios</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Splunk</a><span class="separator">/</span>
                    <span class="current">SPL Fundamentals</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-search"></i> SPL Fundamentals</h1>
                <p class="lead">Master the Search Processing Language (SPL) - Splunk's powerful query language for searching, transforming, and visualizing machine data.</p>

                <!-- SPL Pipeline Concept -->
                <h2><i class="fas fa-stream"></i> The SPL Pipeline</h2>
                <div class="config-section">
                    <p>SPL operates as a <strong>pipeline</strong> where data flows through commands separated by pipes (<code>|</code>). Each command transforms the data before passing it to the next.</p>
                    
                    <div class="code-block">index=security sourcetype=linux_secure failed
| stats count by src_ip
| sort - count
| head 10</div>

                    <p style="color: #8b949e; margin-top: 16px;"><strong>Pipeline breakdown:</strong></p>
                    <ol style="color: #8b949e;">
                        <li><strong>Search:</strong> <code>index=security sourcetype=linux_secure failed</code> - retrieves raw events</li>
                        <li><strong>Transform:</strong> <code>stats count by src_ip</code> - aggregates events</li>
                        <li><strong>Sort:</strong> <code>sort - count</code> - orders results descending</li>
                        <li><strong>Limit:</strong> <code>head 10</code> - returns top 10 results</li>
                    </ol>
                </div>

                <!-- Basic Search -->
                <h2><i class="fas fa-search"></i> Basic Search Syntax</h2>
                <div class="config-section">
                    <h4>Index and Sourcetype</h4>
                    <div class="code-block"># Always specify index for better performance
index=main

# Specify sourcetype to narrow results
index=security sourcetype=WinEventLog:Security

# Multiple indexes
index=security OR index=network

# Wildcard in index name
index=sec*</div>

                    <h4>Time Range</h4>
                    <div class="code-block"># Relative time (most common)
index=security earliest=-24h          # Last 24 hours
index=security earliest=-7d latest=-1d  # 7 days ago to 1 day ago
index=security earliest=-1h@h         # Last hour, snap to hour

# Absolute time
index=security earliest="01/15/2024:00:00:00" latest="01/15/2024:23:59:59"

# Real-time (streaming)
index=security earliest=rt-5m latest=rt  # Real-time last 5 minutes</div>

                    <h4>Keywords and Phrases</h4>
                    <div class="code-block"># Simple keyword (case-insensitive)
index=security failed

# Exact phrase (use quotes)
index=security "authentication failure"

# Multiple keywords (implicit AND)
index=security failed password

# Boolean operators
index=security (failed OR failure) AND password
index=security failed NOT admin</div>

                    <h4>Field Searches</h4>
                    <div class="code-block"># Exact field value
index=security src_ip=192.168.1.100

# Field with wildcard
index=security user=admin*

# Field not equal
index=security action!=allowed

# Field exists
index=security src_ip=*

# Field does not exist
index=security NOT src_ip=*

# Numeric comparison
index=security bytes>1000000
index=security status>=400 status<500</div>
                </div>

                <!-- Essential Commands -->
                <h2><i class="fas fa-terminal"></i> Essential Commands</h2>

                <!-- stats -->
                <div class="cmd-card">
                    <span class="cmd-name">stats</span> - Aggregate statistics
                    <span class="cmd-syntax">stats &lt;function&gt;(field) [as alias] [by field1, field2]</span>
                    <div class="code-block"># Count events
index=security | stats count

# Count by field
index=security | stats count by src_ip

# Multiple aggregations
index=security | stats count, avg(duration), max(bytes) by user

# Distinct count
index=security | stats dc(src_ip) as unique_ips by user

# Common functions: count, sum, avg, min, max, dc (distinct count), 
# values, list, first, last, earliest, latest</div>
                </div>

                <!-- table -->
                <div class="cmd-card">
                    <span class="cmd-name">table</span> - Display specific fields as columns
                    <span class="cmd-syntax">table field1, field2, field3</span>
                    <div class="code-block"># Select specific fields
index=security | table _time, src_ip, user, action

# Rename while displaying (use 'as')
index=security | table _time, src_ip as "Source IP", user as "Username"</div>
                </div>

                <!-- fields -->
                <div class="cmd-card">
                    <span class="cmd-name">fields</span> - Include or exclude fields (for performance)
                    <span class="cmd-syntax">fields [+|-] field1, field2</span>
                    <div class="code-block"># Keep only these fields (improves performance)
index=security | fields _time, src_ip, user, action

# Remove specific fields
index=security | fields - _raw, _indextime, punct

# Include fields (explicit)
index=security | fields + src_ip, dst_ip</div>
                </div>

                <!-- eval -->
                <div class="cmd-card">
                    <span class="cmd-name">eval</span> - Create or modify fields with expressions
                    <span class="cmd-syntax">eval field_name = expression</span>
                    <div class="code-block"># Create new field
index=network | eval MB = bytes / 1048576

# Conditional logic
index=security | eval severity = if(status>=500, "high", "low")

# Multiple conditions with case
index=security | eval risk = case(
    status>=500, "critical",
    status>=400, "high",
    status>=300, "medium",
    1=1, "low"
)

# String manipulation
index=security | eval domain = lower(domain)
index=security | eval short_user = substr(user, 1, 10)

# Combine fields
index=security | eval full_path = src_ip . ":" . src_port

# Null coalescing
index=security | eval user = coalesce(user, src_user, "unknown")</div>
                </div>

                <!-- where -->
                <div class="cmd-card">
                    <span class="cmd-name">where</span> - Filter results using eval expressions
                    <span class="cmd-syntax">where &lt;eval-expression&gt;</span>
                    <div class="code-block"># Numeric comparison
index=security | stats count by src_ip | where count > 100

# String functions
index=security | where like(user, "admin%")
index=security | where match(user, "^svc_")

# Null checks
index=security | where isnotnull(src_ip)

# Multiple conditions
index=security | where count > 100 AND user != "system"

# cidrmatch for IP ranges
index=security | where cidrmatch("10.0.0.0/8", src_ip)</div>
                </div>

                <!-- sort -->
                <div class="cmd-card">
                    <span class="cmd-name">sort</span> - Order results
                    <span class="cmd-syntax">sort [+|-] field1, [+|-] field2</span>
                    <div class="code-block"># Ascending (default)
index=security | stats count by user | sort count

# Descending (use -)
index=security | stats count by user | sort - count

# Multiple fields
index=security | stats count by user, src_ip | sort - count, user

# Limit results
index=security | stats count by user | sort - count limit=10</div>
                </div>

                <!-- rex -->
                <div class="cmd-card">
                    <span class="cmd-name">rex</span> - Extract fields using regex
                    <span class="cmd-syntax">rex field=source_field "(?&lt;new_field&gt;pattern)"</span>
                    <div class="code-block"># Extract from _raw (default)
index=security | rex "user=(?<username>\w+)"

# Extract from specific field
index=security | rex field=url "\/(?<endpoint>[^\/\?]+)"

# Extract multiple fields
index=security | rex "src=(?<src_ip>\d+\.\d+\.\d+\.\d+).*dst=(?<dst_ip>\d+\.\d+\.\d+\.\d+)"

# Mode=sed for substitution
index=security | rex mode=sed field=user "s/DOMAIN\\///"</div>
                </div>

                <!-- rename -->
                <div class="cmd-card">
                    <span class="cmd-name">rename</span> - Rename fields
                    <span class="cmd-syntax">rename old_field as new_field</span>
                    <div class="code-block"># Single rename
index=security | rename src_ip as "Source IP"

# Multiple renames
index=security | rename src_ip as source, dst_ip as destination

# Rename with wildcard
index=security | rename *_ip as *_address</div>
                </div>

                <!-- dedup -->
                <div class="cmd-card">
                    <span class="cmd-name">dedup</span> - Remove duplicate events
                    <span class="cmd-syntax">dedup [count] field1, field2</span>
                    <div class="code-block"># Remove duplicates by single field
index=security | dedup src_ip

# Keep first N occurrences
index=security | dedup 5 user

# Multiple fields
index=security | dedup src_ip, dst_ip, dst_port

# Sort before dedup to control which event is kept
index=security | sort - _time | dedup user</div>
                </div>

                <!-- Security-Specific Examples -->
                <h2><i class="fas fa-shield-alt"></i> Security Analysis Examples</h2>
                <div class="config-section">
                    <h4>Failed Login Analysis</h4>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4625
| stats count by src_ip, user, Failure_Reason
| where count > 5
| sort - count
| table src_ip, user, count, Failure_Reason</div>

                    <h4>Successful Logins After Failed Attempts</h4>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode IN (4625, 4624)
| stats 
    count(eval(EventCode=4625)) as failed,
    count(eval(EventCode=4624)) as success,
    earliest(_time) as first_attempt,
    latest(_time) as last_attempt
    by src_ip, user
| where failed > 3 AND success > 0
| eval duration = round((last_attempt - first_attempt) / 60, 2)
| table src_ip, user, failed, success, duration</div>

                    <h4>Outbound Traffic Analysis</h4>
                    <div class="code-block">index=firewall direction=outbound
| stats sum(bytes_out) as total_bytes, dc(dst_ip) as unique_dests by src_ip
| eval MB = round(total_bytes/1048576, 2)
| where MB > 100 OR unique_dests > 50
| sort - MB
| table src_ip, MB, unique_dests</div>

                    <h4>Process Execution Timeline</h4>
                    <div class="code-block">index=endpoint sourcetype=sysmon EventCode=1
| search host="SUSPICIOUS-HOST"
| table _time, ParentImage, Image, CommandLine, User
| sort _time</div>

                    <h4>DNS Query Analysis</h4>
                    <div class="code-block">index=dns
| stats count by query, query_type
| where count < 5  // Rare queries
| sort - count
| rex field=query "\.(?<tld>[^\.]+)$"
| table query, tld, query_type, count</div>
                </div>

                <!-- Time Functions -->
                <h2><i class="fas fa-clock"></i> Time Functions</h2>
                <div class="config-section">
                    <div class="code-block"># Format time for display
| eval formatted_time = strftime(_time, "%Y-%m-%d %H:%M:%S")

# Extract time components
| eval hour = strftime(_time, "%H")
| eval day_of_week = strftime(_time, "%A")
| eval month = strftime(_time, "%B")

# Parse time from string
| eval event_time = strptime(timestamp_field, "%Y-%m-%dT%H:%M:%S")

# Time math
| eval time_diff = now() - _time
| eval hours_ago = round(time_diff / 3600, 2)

# Bucket time for grouping
| bucket _time span=1h
| stats count by _time</div>
                </div>

                <!-- String Functions -->
                <h2><i class="fas fa-font"></i> String Functions</h2>
                <div class="config-section">
                    <div class="code-block"># Case conversion
| eval lower_user = lower(user)
| eval upper_user = upper(user)

# Substring
| eval first_char = substr(user, 1, 1)
| eval domain = substr(email, indexOf(email, "@") + 1)

# Length
| eval name_length = len(user)

# Trim whitespace
| eval clean_user = trim(user)
| eval clean_user = ltrim(rtrim(user))

# Replace
| eval clean_path = replace(file_path, "\\", "/")

# Split and index
| eval domain_parts = split(domain, ".")
| eval tld = mvindex(domain_parts, -1)

# Concatenation
| eval full_name = first_name . " " . last_name
| eval log_entry = src_ip . " -> " . dst_ip . ":" . dst_port</div>
                </div>

                <!-- Multivalue Functions -->
                <h2><i class="fas fa-list"></i> Multivalue Functions</h2>
                <div class="config-section">
                    <div class="code-block"># Create multivalue field
| stats values(src_ip) as all_ips by user

# Count multivalue items
| eval ip_count = mvcount(all_ips)

# Get specific index (0-based)
| eval first_ip = mvindex(all_ips, 0)
| eval last_ip = mvindex(all_ips, -1)

# Join multivalue to string
| eval ip_list = mvjoin(all_ips, ", ")

# Filter multivalue
| eval internal_ips = mvfilter(match(all_ips, "^10\."))

# Expand multivalue to separate events
| mvexpand all_ips

# Deduplicate multivalue
| eval unique_ips = mvdedup(all_ips)

# Sort multivalue
| eval sorted_ips = mvsort(all_ips)</div>
                </div>

                <!-- Lookup -->
                <h2><i class="fas fa-table"></i> Lookups</h2>
                <div class="config-section">
                    <h4>Using Lookups</h4>
                    <div class="code-block"># Basic lookup (automatic field matching)
index=security | lookup user_info user OUTPUT department, manager

# Explicit field mapping
index=security | lookup asset_db ip as src_ip OUTPUT hostname, owner, criticality

# Inputlookup (search a lookup directly)
| inputlookup threat_intel.csv | where threat_type="malware"

# Outputlookup (save results to lookup)
index=security | stats count by src_ip | outputlookup ip_counts.csv</div>

                    <h4>Subsearch with Lookup</h4>
                    <div class="code-block"># Filter using lookup values
index=firewall src_ip IN [| inputlookup blocked_ips.csv | fields ip]

# Add context from another search
index=security 
| join src_ip [search index=assets | fields ip, hostname, owner]</div>
                </div>

                <!-- Common Patterns -->
                <h2><i class="fas fa-puzzle-piece"></i> Common SOC Patterns</h2>
                <div class="config-section">
                    <h4>Top N Analysis</h4>
                    <div class="code-block">index=firewall | top 10 src_ip by action
index=security | rare user  // Opposite of top</div>

                    <h4>Timechart for Trends</h4>
                    <div class="code-block">index=security EventCode=4625 
| timechart span=1h count by src_ip</div>

                    <h4>Percentage Calculation</h4>
                    <div class="code-block">index=firewall 
| stats count as total, count(eval(action="blocked")) as blocked
| eval block_rate = round(blocked*100/total, 2) . "%"</div>

                    <h4>First/Last Seen</h4>
                    <div class="code-block">index=security 
| stats earliest(_time) as first_seen, latest(_time) as last_seen by src_ip
| eval first_seen = strftime(first_seen, "%Y-%m-%d %H:%M")
| eval last_seen = strftime(last_seen, "%Y-%m-%d %H:%M")</div>
                </div>

                <!-- Performance Tips -->
                <h2><i class="fas fa-tachometer-alt"></i> Performance Optimization</h2>
                <div class="config-section">
                    <table class="styled-table">
                        <thead>
                            <tr><th>Tip</th><th>Why</th><th>Example</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Always specify index</td>
                                <td>Limits data scanned</td>
                                <td><code>index=security</code> not <code>index=*</code></td>
                            </tr>
                            <tr>
                                <td>Use shortest time range</td>
                                <td>Less data to process</td>
                                <td><code>earliest=-1h</code> vs <code>earliest=-7d</code></td>
                            </tr>
                            <tr>
                                <td>Filter early</td>
                                <td>Reduces pipeline volume</td>
                                <td>Put specific filters before stats</td>
                            </tr>
                            <tr>
                                <td>Use fields command</td>
                                <td>Reduces data transfer</td>
                                <td><code>| fields src_ip, user</code></td>
                            </tr>
                            <tr>
                                <td>Avoid wildcards at start</td>
                                <td>Can't use index</td>
                                <td><code>user=admin*</code> not <code>user=*admin</code></td>
                            </tr>
                            <tr>
                                <td>Use tstats for indexed fields</td>
                                <td>10-100x faster</td>
                                <td><code>| tstats count where index=security</code></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Interview Q&A -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain how the SPL pipeline works.</button>
                        <div class="qa-answer">
                            <p>SPL uses a <strong>pipeline architecture</strong> where:</p>
                            <ol>
                                <li>The search command retrieves raw events from indexes</li>
                                <li>Each subsequent command (separated by <code>|</code>) transforms the data</li>
                                <li>Output from one command becomes input to the next</li>
                                <li>Commands are categorized as:
                                    <ul>
                                        <li><strong>Streaming:</strong> Process events one at a time (eval, rex, where)</li>
                                        <li><strong>Transforming:</strong> Process all events together (stats, timechart)</li>
                                        <li><strong>Generating:</strong> Create events (inputlookup, makeresults)</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between stats and eventstats?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>stats:</strong> Aggregates events into summary rows, reducing result count
                                    <div class="code-block">| stats count by user  // Returns one row per user</div>
                                </li>
                                <li><strong>eventstats:</strong> Adds aggregated values to each event without reducing rows
                                    <div class="code-block">| eventstats count as total by user  // All events retained, total added</div>
                                </li>
                            </ul>
                            <p>Use eventstats when you need to compare individual events to group statistics.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you optimize a slow Splunk search?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Check Job Inspector:</strong> Identify where time is spent</li>
                                <li><strong>Specify index:</strong> Never use <code>index=*</code></li>
                                <li><strong>Narrow time range:</strong> Shortest range possible</li>
                                <li><strong>Filter early:</strong> Most restrictive conditions first</li>
                                <li><strong>Use fields command:</strong> Limit fields in pipeline</li>
                                <li><strong>Use tstats:</strong> For accelerated data models</li>
                                <li><strong>Avoid leading wildcards:</strong> <code>*admin</code> is slow</li>
                                <li><strong>Consider summary indexing:</strong> For repeated searches</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Write a search to find brute force attacks.</button>
                        <div class="qa-answer">
                            <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4625
| bucket _time span=10m
| stats count as failed_logins by _time, src_ip, user
| where failed_logins > 5
| sort - failed_logins
| table _time, src_ip, user, failed_logins</div>
                            <p style="margin-top: 12px;">This search:</p>
                            <ul>
                                <li>Finds failed logins (4625) from Windows Security logs</li>
                                <li>Groups into 10-minute buckets</li>
                                <li>Counts failures per source IP and user</li>
                                <li>Filters for more than 5 failures (threshold)</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>

                <!-- More Transforming Commands -->
                <h2><i class="fas fa-exchange-alt"></i> Additional Transforming Commands</h2>

                <div class="cmd-card">
                    <span class="cmd-name">timechart</span> - Time-series aggregation
                    <span class="cmd-syntax">timechart [span=time] function(field) [by split_field]</span>
                    <div class="code-block"># Count over time
index=security | timechart count

# With time span
index=security | timechart span=1h count by action

# Multiple metrics
index=firewall | timechart span=15m avg(bytes) max(bytes) by direction

# Limit split values
index=security | timechart span=1h count by user limit=10 useother=false</div>
                </div>

                <div class="cmd-card">
                    <span class="cmd-name">chart</span> - Create charts with custom axes
                    <span class="cmd-syntax">chart function(field) [over row_field] [by column_field]</span>
                    <div class="code-block"># Row and column split
index=firewall | chart count over src_ip by action

# With aggregation function
index=security | chart avg(response_time) over endpoint by method</div>
                </div>

                <div class="cmd-card">
                    <span class="cmd-name">transaction</span> - Group related events
                    <span class="cmd-syntax">transaction field [startswith=...] [endswith=...] [maxspan=time]</span>
                    <div class="code-block"># Group by session
index=web | transaction session_id maxspan=30m

# With start/end conditions
index=security | transaction user startswith="login" endswith="logout" maxspan=8h

# Access transaction fields
index=web | transaction session_id | where duration > 300 | table session_id, eventcount, duration</div>
                </div>

                <div class="cmd-card">
                    <span class="cmd-name">streamstats</span> - Running statistics
                    <span class="cmd-syntax">streamstats function(field) [as alias] [by field]</span>
                    <div class="code-block"># Running count
index=security | streamstats count as running_total

# Running average
index=firewall | streamstats avg(bytes) as avg_bytes window=10

# Time-window stats
index=security | streamstats time_window=5m count as events_5min by src_ip

# Detect velocity (events per time)
index=security 
| streamstats time_window=1m count as rate by src_ip
| where rate > 100</div>
                </div>

                <div class="cmd-card">
                    <span class="cmd-name">eventstats</span> - Add stats without reducing rows
                    <span class="cmd-syntax">eventstats function(field) [as alias] [by field]</span>
                    <div class="code-block"># Add total to each event
index=security | eventstats count as total_events

# Compare event to average
index=firewall 
| eventstats avg(bytes) as avg_bytes by src_ip
| eval deviation = bytes - avg_bytes
| where deviation > avg_bytes * 2

# Percentage of total
index=security 
| stats count by action
| eventstats sum(count) as total
| eval percentage = round(count*100/total, 2)</div>
                </div>

                <!-- Advanced Eval Functions -->
                <h2><i class="fas fa-calculator"></i> Advanced Eval Functions</h2>
                <div class="config-section">
                    <h4>Comparison Functions</h4>
                    <div class="code-block"># If-else
| eval status = if(code >= 400, "error", "ok")

# Case (multiple conditions)
| eval severity = case(
    code >= 500, "critical",
    code >= 400, "error",
    code >= 300, "warning",
    true(), "info"
)

# Coalesce (first non-null)
| eval user = coalesce(username, src_user, account_name, "unknown")

# Null handling
| eval has_user = if(isnull(user), "no", "yes")
| where isnotnull(src_ip)</div>

                    <h4>Mathematical Functions</h4>
                    <div class="code-block"># Basic math
| eval total = price * quantity
| eval percentage = round(part / total * 100, 2)

# Rounding
| eval rounded = round(value, 2)
| eval floored = floor(value)
| eval ceiled = ceiling(value)

# Absolute value
| eval abs_diff = abs(expected - actual)

# Power and logarithm
| eval squared = pow(value, 2)
| eval log_value = log(value, 10)

# Random (for sampling)
| eval random_num = random()
| where random_num < 0.1  // 10% sample</div>

                    <h4>Network Functions</h4>
                    <div class="code-block"># CIDR matching
| where cidrmatch("10.0.0.0/8", src_ip)
| eval is_internal = if(cidrmatch("10.0.0.0/8", src_ip) OR cidrmatch("172.16.0.0/12", src_ip) OR cidrmatch("192.168.0.0/16", src_ip), "yes", "no")

# IP to integer (for sorting)
| eval ip_int = tonumber(replace(src_ip, "\.", ""))</div>

                    <h4>Type Conversion</h4>
                    <div class="code-block"># String to number
| eval num_value = tonumber(string_field)

# Number to string
| eval str_value = tostring(number_field)

# Format numbers
| eval formatted = tostring(bytes, "commas")  // 1,234,567
| eval hex_value = tostring(number, "hex")    // 0x1234</div>
                </div>

                <!-- Regular Expressions -->
                <h2><i class="fas fa-asterisk"></i> Regular Expressions in SPL</h2>
                <div class="config-section">
                    <h4>rex Command Examples</h4>
                    <div class="code-block"># Extract IP address
| rex "(?<ip_addr>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"

# Extract email components
| rex field=email "(?<user>[^@]+)@(?<domain>.+)"

# Extract with named groups
| rex "user=(?<username>\w+)\s+action=(?<action>\w+)"

# Non-capturing groups
| rex "(?:https?:\/\/)?(?<domain>[^\/]+)"

# Sed mode for replacement
| rex mode=sed field=message "s/password=\S+/password=REDACTED/g"</div>

                    <h4>match and like Functions</h4>
                    <div class="code-block"># match (regex)
| where match(user, "^admin")
| where match(email, "@company\.com$")
| where match(url, "(?i)login|auth|password")  // Case insensitive

# like (SQL-style wildcards)
| where like(user, "svc_%")
| where like(hostname, "%-prod-%")</div>

                    <h4>Common Regex Patterns for Security</h4>
                    <div class="code-block"># IPv4 Address
(?<ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})

# IPv6 Address (simplified)
(?<ipv6>[0-9a-fA-F:]+)

# Email
(?<email>[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})

# URL
(?<url>https?:\/\/[^\s]+)

# Windows Path
(?<path>[A-Za-z]:\\[^\s]+)

# Base64 (potential encoded payload)
(?<b64>[A-Za-z0-9+\/]{50,}={0,2})

# MD5 Hash
(?<md5>[a-fA-F0-9]{32})

# SHA256 Hash
(?<sha256>[a-fA-F0-9]{64})</div>
                </div>

                <!-- Subsearches -->
                <h2><i class="fas fa-code-branch"></i> Subsearches</h2>
                <div class="config-section">
                    <p>Subsearches run first and their results are used by the outer search.</p>

                    <div class="code-block"># Find IPs with failed logins, then get all their activity
index=firewall src_ip IN [
    search index=security EventCode=4625 earliest=-1h
    | stats count by src_ip
    | where count > 5
    | fields src_ip
]

# Using return command (more efficient)
index=firewall src_ip IN [
    search index=security EventCode=4625 earliest=-1h
    | stats count by src_ip
    | where count > 5
    | return 100 src_ip
]

# Append results from another search
index=security user=admin
| append [search index=vpn user=admin]
| sort _time</div>

                    <h4>Subsearch Limitations</h4>
                    <ul style="color: #8b949e;">
                        <li>Default timeout: 60 seconds</li>
                        <li>Maximum results: 10,000 (use <code>return</code> to control)</li>
                        <li>Consider <code>join</code> for larger datasets</li>
                    </ul>
                </div>

                <!-- Join Command -->
                <h2><i class="fas fa-link"></i> Joining Data</h2>
                <div class="config-section">
                    <div class="code-block"># Basic join
index=security 
| join src_ip [search index=assets | fields ip, hostname, owner]
| table _time, src_ip, hostname, owner, action

# Left join (keep all from main search)
index=security 
| join type=left src_ip [search index=threat_intel | fields ip, threat_type]

# Outer join
index=security 
| join type=outer src_ip [search index=assets]

# Join on multiple fields
index=network 
| join src_ip, dst_ip [search index=flows]</div>

                    <h4>Alternative to Join: stats + eventstats</h4>
                    <div class="code-block"># Often more efficient than join
index=security OR index=assets
| stats 
    values(action) as actions,
    values(hostname) as hostname,
    values(owner) as owner
    by src_ip</div>
                </div>

                <!-- More Security Examples -->
                <h2><i class="fas fa-user-secret"></i> Advanced Security Searches</h2>
                <div class="config-section">
                    <h4>Lateral Movement Detection</h4>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode=4624 Logon_Type=3
| stats dc(Workstation_Name) as hosts_accessed by Account_Name
| where hosts_accessed > 5
| sort - hosts_accessed</div>

                    <h4>Data Exfiltration Detection</h4>
                    <div class="code-block">index=firewall direction=outbound
| bucket _time span=1h
| stats sum(bytes_sent) as hourly_bytes by _time, src_ip
| eventstats avg(hourly_bytes) as avg, stdev(hourly_bytes) as stdev by src_ip
| where hourly_bytes > avg + (3 * stdev)
| eval MB = round(hourly_bytes/1048576, 2)</div>

                    <h4>PowerShell Encoded Command Detection</h4>
                    <div class="code-block">index=endpoint sourcetype=sysmon EventCode=1
| where process_name="powershell.exe"
| where match(CommandLine, "(?i)-enc|-encodedcommand")
| table _time, host, User, CommandLine
| rex field=CommandLine "-[eE]nc[odedcommand]*\s+(?<encoded>\S+)"</div>

                    <h4>Account Enumeration</h4>
                    <div class="code-block">index=security sourcetype=WinEventLog:Security EventCode IN (4625, 4624)
| transaction src_ip maxspan=10m
| where eventcount > 20
| eval unique_users = mvcount(mvdedup(TargetUserName))
| where unique_users > 10
| table _time, src_ip, unique_users, eventcount</div>
                </div>

            </main>
        </div>
    </div>
    <script>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>
