<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPL When to Use What | Complete Decision Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="shared-styles.css">
    <style>
        :root {
            --bg-primary: #0d1117; --bg-secondary: #161b22; --bg-tertiary: #21262d;
            --border-color: #30363d; --text-primary: #c9d1d9; --text-secondary: #8b949e;
            --accent-green: #238636; --accent-green-light: #7ce38b; --accent-orange: #f0883e;
            --accent-purple: #8957e5; --accent-blue: #58a6ff; --accent-cyan: #39c5cf; --accent-red: #da3633;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.7; }
        .app-container { display: flex; min-height: 100vh; }
        
        /* Sidebar Styles */
        .sidebar { width: 280px; background: var(--bg-secondary); border-right: 1px solid var(--border-color); position: fixed; height: 100vh; overflow-y: auto; z-index: 100; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border-color); background: linear-gradient(135deg, #1a472a 0%, var(--bg-secondary) 100%); }
        .sidebar-logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--accent-green-light); font-weight: 700; font-size: 1.1em; }
        .sidebar-content { padding: 16px 12px; }
        .sidebar-section { margin-bottom: 24px; }
        .sidebar-section-title { color: var(--text-secondary); font-size: 0.7em; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 8px; padding-left: 12px; font-weight: 600; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav-item { margin: 2px 0; }
        .sidebar-nav-link { display: flex; align-items: center; gap: 10px; padding: 10px 12px; color: var(--text-secondary); text-decoration: none; border-radius: 8px; font-size: 0.85em; transition: all 0.2s; }
        .sidebar-nav-link:hover { background: var(--bg-tertiary); color: var(--text-primary); }
        .sidebar-nav-link.active { background: linear-gradient(135deg, var(--accent-orange), #d2691e); color: white; }
        .sidebar-nav-link i { width: 18px; text-align: center; }
        
        /* Main Content */
        .main-wrapper { margin-left: 280px; flex: 1; }
        .main-content { max-width: 1200px; margin: 0 auto; padding: 32px; }
        
        h1 { color: var(--accent-green-light); margin-bottom: 16px; font-size: 2em; }
        h2 { color: var(--accent-blue); margin: 40px 0 20px; padding-bottom: 10px; border-bottom: 2px solid var(--border-color); }
        h3 { color: var(--accent-orange); margin: 28px 0 14px; }
        h4 { color: var(--accent-cyan); margin: 20px 0 12px; }
        .lead { font-size: 1.1em; color: var(--text-secondary); margin-bottom: 24px; }
        code { background: var(--bg-secondary); padding: 3px 8px; border-radius: 6px; color: #79c0ff; font-family: 'Consolas', monospace; }
        pre { background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto; margin: 12px 0; border: 1px solid var(--border-color); }
        pre code { background: none; padding: 0; }
        
        /* Decision Cards */
        .decision-section { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; margin: 24px 0; overflow: hidden; }
        .decision-header { background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary)); padding: 16px 20px; border-bottom: 1px solid var(--border-color); }
        .decision-header h3 { margin: 0; color: var(--accent-blue); display: flex; align-items: center; gap: 10px; }
        .decision-content { padding: 20px; }
        
        /* Quick Reference Tables */
        .quick-ref { background: linear-gradient(135deg, #1a472a, var(--bg-secondary)); border: 2px solid var(--accent-green); border-radius: 10px; padding: 20px; margin: 16px 0; }
        .quick-ref h4 { color: var(--accent-green-light); margin: 0 0 14px 0; }
        .quick-ref table { width: 100%; border-collapse: collapse; }
        .quick-ref th, .quick-ref td { padding: 10px 14px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .quick-ref th { color: var(--accent-cyan); font-weight: 600; }
        
        /* Comparison Grid */
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 16px 0; }
        .comparison-card { background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; }
        .comparison-card h5 { margin: 0 0 10px 0; display: flex; align-items: center; gap: 8px; }
        .comparison-card.good { border-color: var(--accent-green); }
        .comparison-card.good h5 { color: var(--accent-green-light); }
        .comparison-card.bad { border-color: var(--accent-red); }
        .comparison-card.bad h5 { color: var(--accent-red); }
        
        /* Example Box */
        .example-box { background: #0d1117; border-radius: 8px; padding: 16px; margin: 12px 0; border-left: 4px solid var(--accent-green); }
        .example-box.wrong { border-left-color: var(--accent-red); }
        .example-box .title { color: var(--accent-green-light); font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .example-box.wrong .title { color: var(--accent-red); }
        .example-box .explanation { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.9em; }
        
        /* Alert Boxes */
        .alert { padding: 14px 18px; border-radius: 8px; margin: 14px 0; }
        .alert-danger { background: linear-gradient(135deg, #3d1a1a, var(--bg-secondary)); border: 1px solid var(--accent-red); }
        .alert-warning { background: linear-gradient(135deg, #3d2a1a, var(--bg-secondary)); border: 1px solid var(--accent-orange); }
        .alert-success { background: linear-gradient(135deg, #1a3d1a, var(--bg-secondary)); border: 1px solid var(--accent-green); }
        .alert-info { background: linear-gradient(135deg, #1a2a3d, var(--bg-secondary)); border: 1px solid var(--accent-blue); }
        
        .badge { display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.75em; font-weight: 600; }
        .badge-green { background: var(--accent-green); color: white; }
        .badge-red { background: var(--accent-red); color: white; }
        .badge-blue { background: var(--accent-blue); color: white; }
        .badge-orange { background: var(--accent-orange); color: white; }
        
        /* Mobile */
        .mobile-menu-toggle { display: none; position: fixed; top: 16px; left: 16px; z-index: 200; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); padding: 12px; border-radius: 8px; cursor: pointer; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.open { transform: translateX(0); }
            .main-wrapper { margin-left: 0; }
            .mobile-menu-toggle { display: block; }
            .comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo"><i class="fas fa-terminal"></i><span>Splunk Reference</span></a>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Certifications</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="power-user-certification.html" class="sidebar-nav-link"><i class="fas fa-user-graduate" style="color:#7ce38b"></i>Power User</a></li>
                        <li class="sidebar-nav-item"><a href="admin-certification.html" class="sidebar-nav-link"><i class="fas fa-user-cog" style="color:#f0883e"></i>Admin</a></li>
                        <li class="sidebar-nav-item"><a href="es-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-shield-alt" style="color:#8957e5"></i>ES Admin</a></li>
                        <li class="sidebar-nav-item"><a href="cloud-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-cloud" style="color:#39c5cf"></i>Cloud Admin</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Learning</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="when-to-use-what.html" class="sidebar-nav-link"><i class="fas fa-map-signs" style="color:#f0883e"></i>When to Use What</a></li>
                        <li class="sidebar-nav-item"><a href="spl-practice-questions.html" class="sidebar-nav-link"><i class="fas fa-tasks" style="color:#58a6ff"></i>Practice MCQs</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced-mcqs.html" class="sidebar-nav-link"><i class="fas fa-brain" style="color:#a371f7"></i>Advanced MCQs</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Reference</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-code"></i>SPL Fundamentals</a></li>
                        <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-layer-group"></i>SPL Intermediate</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i>SPL Advanced</a></li>
                        <li class="sidebar-nav-item"><a href="knowledge-objects.html" class="sidebar-nav-link"><i class="fas fa-lightbulb"></i>Knowledge Objects</a></li>
                        <li class="sidebar-nav-item"><a href="data-models.html" class="sidebar-nav-link"><i class="fas fa-cubes"></i>Data Models</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Administration</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i>Architecture</a></li>
                        <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i>Data Ingestion</a></li>
                        <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-share-alt"></i>Forwarders</a></li>
                        <li class="sidebar-nav-item"><a href="clustering-ha.html" class="sidebar-nav-link"><i class="fas fa-network-wired"></i>Clustering & HA</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Enterprise Security</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i>ES Overview</a></li>
                        <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-search-plus"></i>Correlation Searches</a></li>
                        <li class="sidebar-nav-item"><a href="risk-based-alerting.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i>Risk-Based Alerting</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Resources</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="lab-exercises.html" class="sidebar-nav-link"><i class="fas fa-flask"></i>Lab Exercises</a></li>
                        <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i>Troubleshooting</a></li>
                    </ul>
                </div>
            </div>
        </aside>

        <div class="main-wrapper">
            <main class="main-content">
                <h1><i class="fas fa-map-signs"></i> SPL: When to Use What</h1>
                <p class="lead">The definitive guide to choosing the right SPL command. Real examples showing exactly WHEN and WHY to use each command.</p>

                <!-- MASTER CHEAT SHEET -->
                <div class="quick-ref">
                    <h4><i class="fas fa-star"></i> Master Quick Reference</h4>
                    <table>
                        <tr><th style="width:40%">I need to...</th><th>Use This</th></tr>
                        <tr><td>Filter with wildcards</td><td><code>| search status=fail*</code></td></tr>
                        <tr><td>Compare two fields</td><td><code>| where sent > received</code></td></tr>
                        <tr><td>Count unique values</td><td><code>| stats dc(user)</code></td></tr>
                        <tr><td>List unique values</td><td><code>| stats values(status)</code></td></tr>
                        <tr><td>Get most recent per user</td><td><code>| dedup user sortby -_time</code></td></tr>
                        <tr><td>Get value from latest event</td><td><code>| stats latest(field)</code></td></tr>
                        <tr><td>Running total</td><td><code>| streamstats sum(bytes)</code></td></tr>
                        <tr><td>Add average to each event</td><td><code>| eventstats avg(x)</code></td></tr>
                        <tr><td>Time-series chart</td><td><code>| timechart span=1h count</code></td></tr>
                        <tr><td>Multiple conditions</td><td><code>| eval x=case(a,1,b,2,1=1,0)</code></td></tr>
                        <tr><td>First non-null value</td><td><code>| eval x=coalesce(a,b,"default")</code></td></tr>
                        <tr><td>Format time as string</td><td><code>| eval d=strftime(_time,"%Y-%m-%d")</code></td></tr>
                        <tr><td>Complete yesterday</td><td><code>earliest=-1d@d latest=@d</code></td></tr>
                    </table>
                </div>

                <!-- SEARCH VS WHERE -->
                <h2 id="search-where"><i class="fas fa-filter"></i> search vs where</h2>
                
                <div class="quick-ref">
                    <h4>Quick Decision</h4>
                    <table>
                        <tr><th>Feature</th><th>search</th><th>where</th></tr>
                        <tr><td>Wildcards</td><td><span class="badge badge-green">✓ Yes</span></td><td><span class="badge badge-red">✗ No</span></td></tr>
                        <tr><td>Field-to-field compare</td><td><span class="badge badge-red">✗ No</span></td><td><span class="badge badge-green">✓ Yes</span></td></tr>
                        <tr><td>Functions in filter</td><td><span class="badge badge-red">✗ No</span></td><td><span class="badge badge-green">✓ Yes</span></td></tr>
                        <tr><td>Equality syntax</td><td><code>=</code> single</td><td><code>==</code> double</td></tr>
                    </table>
                </div>

                <h3>Example 1: Wildcard Matching</h3>
                <div class="comparison">
                    <div class="comparison-card good">
                        <h5><i class="fas fa-check"></i> CORRECT - search supports wildcards</h5>
                        <pre><code>index=main | search status=fail*</code></pre>
                    </div>
                    <div class="comparison-card bad">
                        <h5><i class="fas fa-times"></i> WRONG - where doesn't support wildcards</h5>
                        <pre><code>index=main | where status=fail*  ❌</code></pre>
                    </div>
                </div>

                <h3>Example 2: Comparing Two Fields</h3>
                <div class="comparison">
                    <div class="comparison-card good">
                        <h5><i class="fas fa-check"></i> CORRECT - where can compare fields</h5>
                        <pre><code>index=network | where bytes_sent > bytes_received</code></pre>
                    </div>
                    <div class="comparison-card bad">
                        <h5><i class="fas fa-times"></i> WRONG - search can't compare fields</h5>
                        <pre><code>index=network | search bytes_sent > bytes_received  ❌</code></pre>
                    </div>
                </div>

                <div class="alert alert-danger">
                    <strong>⚠️ EXAM TRAP:</strong> <code>where</code> uses <code>==</code> (double equals)!<br>
                    ❌ <code>| where status=200</code> — This is ASSIGNMENT, not comparison!<br>
                    ✓ <code>| where status==200</code> — Correct comparison
                </div>

                <!-- STATS FUNCTIONS -->
                <h2 id="stats"><i class="fas fa-calculator"></i> count vs dc vs values vs list</h2>
                
                <div class="quick-ref">
                    <h4>Quick Decision</h4>
                    <table>
                        <tr><th>I need...</th><th>Use</th><th>Example Result</th></tr>
                        <tr><td>Total events</td><td><code>count</code></td><td>1000</td></tr>
                        <tr><td>Events with field value</td><td><code>count(field)</code></td><td>950 (non-null only)</td></tr>
                        <tr><td>Unique count</td><td><code>dc(field)</code></td><td>42</td></tr>
                        <tr><td>Unique values list</td><td><code>values(field)</code></td><td>[200, 404, 500]</td></tr>
                        <tr><td>All values (with duplicates)</td><td><code>list(field)</code></td><td>[200, 200, 404, 200]</td></tr>
                    </table>
                </div>

                <h3>Example: Security - Count Unique Failed Users</h3>
                <div class="comparison">
                    <div class="comparison-card good">
                        <h5><i class="fas fa-check"></i> CORRECT - dc() for unique count</h5>
                        <pre><code>index=auth action=failed 
| stats dc(user) as unique_users_failed</code></pre>
                        <p style="color:var(--text-secondary);">Result: 42 unique users</p>
                    </div>
                    <div class="comparison-card bad">
                        <h5><i class="fas fa-times"></i> WRONG - count() gives total events</h5>
                        <pre><code>index=auth action=failed 
| stats count(user) as users</code></pre>
                        <p style="color:var(--text-secondary);">Result: 1500 total failures (not unique!)</p>
                    </div>
                </div>

                <!-- EARLIEST/LATEST VS FIRST/LAST -->
                <h2 id="time-func"><i class="fas fa-clock"></i> earliest/latest vs first/last</h2>
                
                <div class="alert alert-danger">
                    <strong>CRITICAL DIFFERENCE:</strong>
                    <ul style="margin:10px 0 0 20px;">
                        <li><code>earliest()/latest()</code> — Based on <code>_time</code> ✓ RELIABLE</li>
                        <li><code>first()/last()</code> — Based on processing order ✗ UNRELIABLE</li>
                    </ul>
                </div>

                <h3>Example: Get User's Most Recent Login IP</h3>
                <div class="comparison">
                    <div class="comparison-card good">
                        <h5><i class="fas fa-check"></i> CORRECT - latest() uses _time</h5>
                        <pre><code>index=auth action=login 
| stats latest(src_ip) as last_login_ip by user</code></pre>
                    </div>
                    <div class="comparison-card bad">
                        <h5><i class="fas fa-times"></i> RISKY - last() uses processing order</h5>
                        <pre><code>index=auth action=login 
| stats last(src_ip) as last_login_ip by user  ⚠️</code></pre>
                    </div>
                </div>

                <!-- STATS VS EVENTSTATS VS STREAMSTATS -->
                <h2 id="aggregation"><i class="fas fa-layer-group"></i> stats vs eventstats vs streamstats</h2>
                
                <div class="quick-ref">
                    <h4>Quick Decision</h4>
                    <table>
                        <tr><th>Command</th><th>Output</th><th>Use When</th></tr>
                        <tr><td><code>stats</code></td><td>Only aggregated results</td><td>Just need summary</td></tr>
                        <tr><td><code>eventstats</code></td><td>Original events + aggregate</td><td>Compare event to group total</td></tr>
                        <tr><td><code>streamstats</code></td><td>Running calculation</td><td>Running totals, moving avg</td></tr>
                    </table>
                </div>

                <h3>Example: Find Events Above Average</h3>
                <div class="example-box">
                    <div class="title"><i class="fas fa-check-circle"></i> Use eventstats - keeps events AND adds average</div>
                    <pre><code>index=web 
| eventstats avg(response_time) as avg_rt
| where response_time > avg_rt</code></pre>
                    <div class="explanation">eventstats adds the average to EACH event, so you can compare.</div>
                </div>

                <h3>Example: Running Total</h3>
                <div class="example-box">
                    <div class="title"><i class="fas fa-check-circle"></i> Use streamstats for cumulative</div>
                    <pre><code>index=network | sort _time
| streamstats sum(bytes) as running_total</code></pre>
                </div>

                <!-- TIME MODIFIERS -->
                <h2 id="time-mod"><i class="fas fa-calendar"></i> Time Modifiers Explained</h2>
                
                <div class="quick-ref">
                    <h4>Snap-to (@) - Assume it's Wednesday 3:45 PM</h4>
                    <table>
                        <tr><th>Modifier</th><th>Result</th></tr>
                        <tr><td><code>@d</code></td><td>Wednesday 00:00 (midnight today)</td></tr>
                        <tr><td><code>-1d@d</code></td><td>Tuesday 00:00 (midnight yesterday)</td></tr>
                        <tr><td><code>@w0</code></td><td>Last Sunday 00:00</td></tr>
                        <tr><td><code>@w1</code></td><td>Last Monday 00:00</td></tr>
                        <tr><td><code>@mon</code></td><td>1st of month 00:00</td></tr>
                    </table>
                </div>

                <div class="alert alert-success">
                    <strong>MEMORIZE:</strong> Complete yesterday = <code>earliest=-1d@d latest=@d</code>
                </div>

                <div class="example-box wrong">
                    <div class="title"><i class="fas fa-exclamation-triangle"></i> Common Mistake</div>
                    <pre><code># This does NOT give complete yesterday!
earliest=-1d latest=now  ❌
# This gives 24 hours ago to now, not midnight to midnight</code></pre>
                </div>

                <!-- DEDUP -->
                <h2 id="dedup"><i class="fas fa-filter"></i> dedup - Getting Most Recent</h2>
                
                <div class="comparison">
                    <div class="comparison-card good">
                        <h5><i class="fas fa-check"></i> CORRECT - dedup with sortby</h5>
                        <pre><code>index=auth | dedup user sortby -_time</code></pre>
                        <p style="color:var(--text-secondary);">Keeps MOST RECENT per user</p>
                    </div>
                    <div class="comparison-card bad">
                        <h5><i class="fas fa-times"></i> WRONG - plain dedup keeps random</h5>
                        <pre><code>index=auth | dedup user</code></pre>
                        <p style="color:var(--text-secondary);">Keeps first encountered (not newest!)</p>
                    </div>
                </div>

                <!-- EVAL FUNCTIONS -->
                <h2 id="eval"><i class="fas fa-code"></i> if vs case vs coalesce</h2>
                
                <div class="quick-ref">
                    <h4>Quick Decision</h4>
                    <table>
                        <tr><th>Scenario</th><th>Use</th></tr>
                        <tr><td>Simple true/false</td><td><code>if(status<400,"OK","Error")</code></td></tr>
                        <tr><td>Multiple conditions</td><td><code>case(status<300,"Good",status<400,"Redirect",1=1,"Error")</code></td></tr>
                        <tr><td>First non-null value</td><td><code>coalesce(email,phone,"N/A")</code></td></tr>
                    </table>
                </div>

                <h3>Time Functions Memory Trick</h3>
                <div class="alert alert-info">
                    <strong>str<span style="color:var(--accent-orange)">F</span>time</strong> = <strong>F</strong>ormat (epoch → string): <code>strftime(_time, "%Y-%m-%d")</code><br>
                    <strong>str<span style="color:var(--accent-orange)">P</span>time</strong> = <strong>P</strong>arse (string → epoch): <code>strptime("2024-01-15", "%Y-%m-%d")</code>
                </div>

            </main>
        </div>
    </div>
    <script>function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }</script>
</body>
</html>
