<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Hunting | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="shared-styles.css">
    <link rel="stylesheet" href="../assets/css/main.css">


</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
        <!-- Sidebar -->
        <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo"><i class="fas fa-terminal"></i><span>Splunk Reference</span></a>
            </div>
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Certifications</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="power-user-certification.html" class="sidebar-nav-link"><i class="fas fa-user-graduate" style="color:#7ce38b"></i>Power User</a></li>
                        <li class="sidebar-nav-item"><a href="admin-certification.html" class="sidebar-nav-link"><i class="fas fa-user-cog" style="color:#f0883e"></i>Admin</a></li>
                        <li class="sidebar-nav-item"><a href="es-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-shield-alt" style="color:#8957e5"></i>ES Admin</a></li>
                        <li class="sidebar-nav-item"><a href="cloud-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-cloud" style="color:#39c5cf"></i>Cloud Admin</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Learning</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="when-to-use-what.html" class="sidebar-nav-link"><i class="fas fa-map-signs" style="color:#f0883e"></i>When to Use What</a></li>
                        <li class="sidebar-nav-item"><a href="spl-practice-questions.html" class="sidebar-nav-link"><i class="fas fa-tasks" style="color:#58a6ff"></i>Practice MCQs</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced-mcqs.html" class="sidebar-nav-link"><i class="fas fa-brain" style="color:#a371f7"></i>Advanced MCQs</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">SPL Reference</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-code"></i>SPL Fundamentals</a></li>
                        <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-layer-group"></i>SPL Intermediate</a></li>
                        <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i>SPL Advanced</a></li>
                        <li class="sidebar-nav-item"><a href="knowledge-objects.html" class="sidebar-nav-link"><i class="fas fa-lightbulb"></i>Knowledge Objects</a></li>
                        <li class="sidebar-nav-item"><a href="data-models.html" class="sidebar-nav-link"><i class="fas fa-cubes"></i>Data Models</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Administration</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i>Architecture</a></li>
                        <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i>Data Ingestion</a></li>
                        <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-share-alt"></i>Forwarders</a></li>
                        <li class="sidebar-nav-item"><a href="clustering-ha.html" class="sidebar-nav-link"><i class="fas fa-network-wired"></i>Clustering & HA</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Enterprise Security</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i>ES Overview</a></li>
                        <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-search-plus"></i>Correlation Searches</a></li>
                        <li class="sidebar-nav-item"><a href="risk-based-alerting.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i>Risk-Based Alerting</a></li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Resources</div>
                    <ul class="sidebar-nav">
                        <li class="sidebar-nav-item"><a href="lab-exercises.html" class="sidebar-nav-link"><i class="fas fa-flask"></i>Lab Exercises</a></li>
                        <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i>Troubleshooting</a></li>
                    </ul>
                </div>
            </div>
        </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Splunk</a>
                    <span class="separator">/</span>
                    <span class="current">Threat Hunting</span>
                </div>

                <h1><i class="fas fa-crosshairs"></i> Threat Hunting in Splunk</h1>
                <p class="lead">Master proactive threat hunting in Splunk. Learn hunting methodologies, SPL techniques, MITRE ATT&CK-based hunts, and how to operationalize your findings into detections.</p>

                <!-- Threat Hunting Overview -->
                <h2><i class="fas fa-info-circle"></i> Threat Hunting Overview</h2>
                <div class="config-section">
                    <h4>What is Threat Hunting?</h4>
                    <div class="arch-diagram">Threat Hunting Definition:

Proactive, iterative search through networks and datasets to detect 
advanced threats that evade existing security solutions.

KEY CHARACTERISTICS:
â”œâ”€â”€ Hypothesis-driven (not alert-driven)
â”œâ”€â”€ Assumes breach mentality
â”œâ”€â”€ Uses human intuition + machine data
â”œâ”€â”€ Iterative refinement process
â””â”€â”€ Produces actionable intelligence

HUNTING VS DETECTION:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Detection          â”‚ Hunting                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reactive           â”‚ Proactive               â”‚
â”‚ Rule-based         â”‚ Hypothesis-based        â”‚
â”‚ Known threats      â”‚ Unknown threats         â”‚
â”‚ Automated          â”‚ Human-driven            â”‚
â”‚ High volume        â”‚ Targeted investigation  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HUNTING OUTCOMES:
â”œâ”€â”€ New detections (operationalized hunts)
â”œâ”€â”€ Improved visibility (data gaps identified)
â”œâ”€â”€ Threat intelligence (IOCs, TTPs)
â”œâ”€â”€ Risk reduction (threats neutralized)
â””â”€â”€ Security posture improvement</div>

                    <h4>Hunting Maturity Model</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Level</th><th>Description</th><th>Capabilities</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>HM0 - Initial</strong></td><td>Primarily reactive</td><td>Basic log collection, alert response only</td></tr>
                            <tr><td><strong>HM1 - Minimal</strong></td><td>IOC searching</td><td>Can search for known indicators</td></tr>
                            <tr><td><strong>HM2 - Procedural</strong></td><td>Following procedures</td><td>Uses documented hunt procedures</td></tr>
                            <tr><td><strong>HM3 - Innovative</strong></td><td>Creates new hunts</td><td>Develops original hypotheses</td></tr>
                            <tr><td><strong>HM4 - Leading</strong></td><td>Automates & shares</td><td>Operationalizes hunts, shares intel</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Hunting Methodology -->
                <h2><i class="fas fa-route"></i> Hunting Methodology</h2>
                <div class="config-section">
                    <h4>The Hunting Loop</h4>
                    <div class="arch-diagram">SQRRL Hunting Loop (Industry Standard):

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                             â”‚
    â–¼                                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ HYPOTHESISâ”‚â”€â”€â”€â–¶â”‚INVESTIGATEâ”‚â”€â”€â”€â–¶â”‚ DISCOVER  â”‚  â”‚
â”‚           â”‚    â”‚           â”‚    â”‚           â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                       â”‚          â”‚
                                       â–¼          â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                               â”‚  INFORM   â”‚â”€â”€â”€â”€â”€â”€â”˜
                               â”‚           â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. HYPOTHESIS
   â”œâ”€â”€ Form testable assumption about adversary behavior
   â”œâ”€â”€ Sources: threat intel, MITRE ATT&CK, incidents
   â””â”€â”€ Example: "Attackers may use PowerShell for C2"

2. INVESTIGATE
   â”œâ”€â”€ Search data to prove/disprove hypothesis
   â”œâ”€â”€ Use SPL queries, visualizations
   â””â”€â”€ Pivot on findings

3. DISCOVER
   â”œâ”€â”€ Identify true positives, false positives
   â”œâ”€â”€ Document findings
   â””â”€â”€ Determine scope of activity

4. INFORM
   â”œâ”€â”€ Create detections from successful hunts
   â”œâ”€â”€ Update playbooks and procedures
   â””â”€â”€ Share intelligence with team</div>

                    <h4>Hypothesis Sources</h4>
                    <div class="arch-diagram">Where to Get Hunt Ideas:

THREAT INTELLIGENCE:
â”œâ”€â”€ APT reports (Mandiant, CrowdStrike, etc.)
â”œâ”€â”€ CISA advisories
â”œâ”€â”€ Industry ISACs
â”œâ”€â”€ Vendor threat blogs
â””â”€â”€ Twitter/security community

MITRE ATT&CK:
â”œâ”€â”€ Techniques by tactic
â”œâ”€â”€ Procedure examples
â”œâ”€â”€ Detection suggestions
â””â”€â”€ Data source requirements

INTERNAL SOURCES:
â”œâ”€â”€ Past incidents (what did we miss?)
â”œâ”€â”€ Red team findings
â”œâ”€â”€ Vulnerability assessments
â”œâ”€â”€ Architecture changes
â””â”€â”€ New assets/applications

EXTERNAL EVENTS:
â”œâ”€â”€ Major breaches (SolarWinds, etc.)
â”œâ”€â”€ New malware families
â”œâ”€â”€ Emerging threat actors
â””â”€â”€ Zero-day disclosures</div>
                </div>

                <!-- Essential Data Sources -->
                <h2><i class="fas fa-database"></i> Essential Data Sources</h2>
                <div class="config-section">
                    <h4>Data Source Priority</h4>
                    <div class="arch-diagram">Hunting Data Sources (Priority Order):

TIER 1 - CRITICAL:
â”œâ”€â”€ Process Execution (Sysmon 1, Windows 4688)
â”‚   â””â”€â”€ Command lines, parent-child, hashes
â”œâ”€â”€ Authentication (Windows 4624/4625, AD)
â”‚   â””â”€â”€ Logon types, source IPs, failures
â”œâ”€â”€ Network Connections (Firewall, Proxy, DNS)
â”‚   â””â”€â”€ Source/dest IPs, ports, protocols
â””â”€â”€ PowerShell Logging (4103, 4104)
    â””â”€â”€ Script blocks, commands

TIER 2 - HIGH VALUE:
â”œâ”€â”€ File Creation/Modification (Sysmon 11)
â”œâ”€â”€ Registry Changes (Sysmon 12/13/14)
â”œâ”€â”€ Scheduled Tasks (Windows 4698)
â”œâ”€â”€ Service Installation (Windows 7045)
â”œâ”€â”€ WMI Activity (Sysmon 19/20/21)
â””â”€â”€ Named Pipes (Sysmon 17/18)

TIER 3 - ENRICHMENT:
â”œâ”€â”€ DNS Query Logs
â”œâ”€â”€ DHCP Logs
â”œâ”€â”€ VPN Logs
â”œâ”€â”€ Email Gateway Logs
â”œâ”€â”€ Cloud Audit Logs (AWS, Azure, GCP)
â””â”€â”€ Application-specific logs

SPLUNK SOURCETYPES:
â”œâ”€â”€ XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
â”œâ”€â”€ WinEventLog:Security
â”œâ”€â”€ WinEventLog:Microsoft-Windows-PowerShell/Operational
â”œâ”€â”€ stream:dns, stream:http
â””â”€â”€ pan:traffic, cisco:asa</div>

                    <h4>Data Model Usage</h4>
                    <div class="arch-diagram">// Using tstats for fast hunting (accelerated data)

// Process execution hunt
| tstats count from datamodel=Endpoint.Processes 
  where Processes.process_name=* 
  by Processes.dest, Processes.user, Processes.process_name, 
     Processes.process, Processes.parent_process_name
| rename Processes.* as *

// Authentication hunt
| tstats count from datamodel=Authentication 
  where Authentication.action=* 
  by Authentication.src, Authentication.dest, 
     Authentication.user, Authentication.action
| rename Authentication.* as *

// Network traffic hunt
| tstats sum(All_Traffic.bytes) as bytes 
  from datamodel=Network_Traffic 
  by All_Traffic.src_ip, All_Traffic.dest_ip, 
     All_Traffic.dest_port
| rename All_Traffic.* as *</div>
                </div>

                <!-- MITRE ATT&CK Hunts -->
                <h2><i class="fas fa-shield-alt"></i> MITRE ATT&CK-Based Hunts</h2>
                <div class="config-section">
                    <h4>Initial Access (TA0001)</h4>
                    <div class="arch-diagram">// T1566.001 - Spearphishing Attachment
// Hunt for Office spawning suspicious processes
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| where match(ParentImage, "(?i)(winword|excel|powerpnt|outlook)\.exe")
| where match(Image, "(?i)(cmd|powershell|wscript|cscript|mshta|certutil)\.exe")
| stats count by Computer, ParentImage, Image, CommandLine, User
| sort -count

// T1078 - Valid Accounts (Compromised Credentials)
// Hunt for impossible travel
index=windows sourcetype="WinEventLog:Security" EventCode=4624 LogonType=10
| iplocation src_ip
| stats earliest(_time) as first_login, latest(_time) as last_login,
        values(City) as cities, dc(City) as city_count
  by user
| where city_count > 1
| eval time_diff_hours = round((last_login - first_login)/3600, 2)
| where time_diff_hours < 2
| table user, cities, time_diff_hours, first_login, last_login</div>

                    <h4>Execution (TA0002)</h4>
                    <div class="arch-diagram">// T1059.001 - PowerShell
// Hunt for encoded PowerShell commands
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
  Image="*powershell.exe"
| where match(CommandLine, "(?i)(-enc|-encodedcommand|-e\s+[A-Za-z0-9+/=]{20,})")
| stats count by Computer, User, CommandLine
| sort -count

// T1059.001 - PowerShell Download Cradles
index=windows sourcetype="WinEventLog:Microsoft-Windows-PowerShell/Operational" EventCode=4104
| where match(ScriptBlockText, "(?i)(downloadstring|downloadfile|invoke-webrequest|wget|curl|bitstransfer)")
| stats count by Computer, ScriptBlockText
| sort -count

// T1047 - WMI Execution
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| where match(ParentImage, "(?i)wmiprvse\.exe")
| where NOT match(Image, "(?i)(wmiadap|scrcons)\.exe")
| stats count by Computer, Image, CommandLine
| sort -count

// T1053.005 - Scheduled Tasks
index=windows sourcetype="WinEventLog:Security" EventCode=4698
| rex field=TaskContent "<Command>(?<command>[^<]+)</Command>"
| rex field=TaskContent "<Arguments>(?<arguments>[^<]+)</Arguments>"
| where match(command, "(?i)(powershell|cmd|wscript|mshta)")
| stats count by Computer, TaskName, command, arguments
| sort -count</div>

                    <h4>Persistence (TA0003)</h4>
                    <div class="arch-diagram">// T1547.001 - Registry Run Keys
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode IN (12,13,14)
| where match(TargetObject, "(?i)(currentversion\\\\run|currentversion\\\\runonce)")
| stats count by Computer, EventType, TargetObject, Details
| sort -count

// T1543.003 - Windows Service Creation
index=windows sourcetype="WinEventLog:System" EventCode=7045
| where NOT match(ServiceFileName, "(?i)(windows|program files|system32)")
| stats count by Computer, ServiceName, ServiceFileName, ServiceType
| sort -count

// T1136.001 - Local Account Creation
index=windows sourcetype="WinEventLog:Security" EventCode=4720
| stats count by Computer, TargetUserName, SubjectUserName
| sort -count

// T1505.003 - Web Shells
index=web sourcetype=iis OR sourcetype=apache
| where match(uri_path, "(?i)\.(asp|aspx|php|jsp)$")
| where match(uri_query, "(?i)(cmd|exec|shell|eval|base64)")
| stats count by src_ip, uri_path, uri_query, status
| sort -count</div>

                    <h4>Defense Evasion (TA0005)</h4>
                    <div class="arch-diagram">// T1070.001 - Clear Windows Event Logs
index=windows sourcetype="WinEventLog:Security" EventCode=1102
| stats count by Computer, SubjectUserName
| sort -count

// T1036.005 - Masquerading (Filename Mismatch)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| rex field=Image "\\\\(?<filename>[^\\\\]+)$"
| rex field=OriginalFileName "(?<orig_filename>[^\\\\]+)$"
| where filename != orig_filename AND orig_filename != "-"
| stats count by Computer, Image, OriginalFileName, filename
| sort -count

// T1055 - Process Injection (CreateRemoteThread)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=8
| where SourceImage != TargetImage
| stats count by Computer, SourceImage, TargetImage, SourceUser
| sort -count

// T1027 - Obfuscated Files (High Entropy)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| where len(CommandLine) > 500
| eval entropy = len(CommandLine) - len(replace(CommandLine, "[A-Za-z0-9]", ""))
| where entropy < 0.3 * len(CommandLine)
| stats count by Computer, Image, CommandLine
| sort -count</div>

                    <h4>Credential Access (TA0006)</h4>
                    <div class="arch-diagram">// T1003.001 - LSASS Memory Dump (Mimikatz)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=10
  TargetImage="*lsass.exe" GrantedAccess IN ("0x1010", "0x1410", "0x1438", "0x143a")
| stats count by Computer, SourceImage, SourceUser, GrantedAccess
| sort -count

// T1003.002 - SAM Database Access
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| where match(CommandLine, "(?i)(reg save.*sam|reg save.*security|reg save.*system)")
| stats count by Computer, User, CommandLine
| sort -count

// T1558.003 - Kerberoasting
index=windows sourcetype="WinEventLog:Security" EventCode=4769 TicketEncryptionType=0x17
| where ServiceName != "krbtgt" AND NOT match(ServiceName, "\\$$")
| stats count by src_ip, ServiceName, TargetUserName
| where count > 5
| sort -count

// T1110.003 - Password Spraying
index=windows sourcetype="WinEventLog:Security" EventCode=4625
| bucket _time span=5m
| stats dc(TargetUserName) as unique_users, count as attempts 
  by src_ip, _time
| where unique_users > 10 AND attempts > 20
| sort -count</div>

                    <h4>Lateral Movement (TA0008)</h4>
                    <div class="arch-diagram">// T1021.002 - SMB/Windows Admin Shares
index=windows sourcetype="WinEventLog:Security" EventCode=5140
| where match(ShareName, "(?i)(ADMIN\\$|C\\$|IPC\\$)")
| stats count by IpAddress, ShareName, SubjectUserName, Computer
| sort -count

// T1021.001 - Remote Desktop Protocol
index=windows sourcetype="WinEventLog:Security" EventCode=4624 LogonType=10
| stats count by src_ip, dest, user
| where count > 5
| sort -count

// T1021.006 - WinRM
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
  Image="*wsmprovhost.exe"
| stats count by Computer, ParentImage, CommandLine, User
| sort -count

// T1550.002 - Pass the Hash
index=windows sourcetype="WinEventLog:Security" EventCode=4624 
  LogonType=9 AuthenticationPackage=Negotiate
| stats count by src_ip, user, dest
| sort -count</div>

                    <h4>Collection & Exfiltration (TA0009, TA0010)</h4>
                    <div class="arch-diagram">// T1560.001 - Archive Collection
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| where match(CommandLine, "(?i)(7z|rar|zip|tar|compress).*(-p|password)")
| stats count by Computer, User, CommandLine
| sort -count

// T1048.003 - Exfiltration Over DNS
index=dns sourcetype=stream:dns
| eval query_len = len(query)
| where query_len > 50
| stats count, avg(query_len) as avg_len, values(query) as queries 
  by src_ip, query_type
| where avg_len > 60
| sort -count

// T1041 - Exfiltration Over C2 Channel
index=proxy OR index=firewall
| stats sum(bytes_out) as total_bytes by src_ip, dest_ip
| where total_bytes > 100000000
| sort -total_bytes

// Large file transfers outside business hours
index=proxy OR index=firewall
| eval hour = strftime(_time, "%H")
| where hour < 6 OR hour > 22
| stats sum(bytes_out) as bytes by src_ip, dest_ip, dest_port
| where bytes > 50000000
| sort -bytes</div>
                </div>

                <!-- Hunting SPL Techniques -->
                <h2><i class="fas fa-code"></i> Advanced Hunting SPL</h2>
                <div class="config-section">
                    <h4>Statistical Anomaly Detection</h4>
                    <div class="arch-diagram">// Find rare processes (executed on < 3 hosts)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| stats dc(Computer) as host_count, values(Computer) as hosts,
        count as exec_count by Image
| where host_count < 3 AND exec_count < 10
| sort host_count

// Baseline deviation (process execution frequency)
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| bucket _time span=1h
| stats count by _time, Computer, Image
| eventstats avg(count) as avg_count, stdev(count) as stdev_count 
  by Computer, Image
| eval zscore = (count - avg_count) / stdev_count
| where zscore > 3
| sort -zscore

// First-time seen process per host
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| stats earliest(_time) as first_seen by Computer, Image
| where first_seen > relative_time(now(), "-24h")
| convert ctime(first_seen)
| sort -first_seen

// Process execution at unusual times
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| eval hour = strftime(_time, "%H")
| eval is_business_hours = if(hour >= 8 AND hour <= 18, 1, 0)
| stats count by Computer, Image, is_business_hours
| where is_business_hours = 0
| sort -count</div>

                    <h4>Stack Counting & Long Tail Analysis</h4>
                    <div class="arch-diagram">// Stack counting - find outliers in command lines
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| rex field=CommandLine "^(?<cmd_base>[^\s]+)"
| stats count by cmd_base
| sort count
| head 50

// Long tail analysis - rare parent-child relationships
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| stats count by ParentImage, Image
| sort count
| where count < 5

// Rare user-process combinations
index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1
| stats count by User, Image
| eventstats sum(count) as total_by_process by Image
| eval pct = round(count/total_by_process*100, 2)
| where pct < 1 AND count < 5
| sort pct</div>

                    <h4>Temporal Analysis</h4>
                    <div class="arch-diagram">// Beaconing detection (regular intervals)
index=proxy OR index=firewall
| bucket _time span=1m
| stats count by _time, src_ip, dest_ip
| sort src_ip, dest_ip, _time
| streamstats current=f last(_time) as prev_time by src_ip, dest_ip
| eval interval = _time - prev_time
| stats avg(interval) as avg_interval, stdev(interval) as stdev_interval,
        count as beacon_count by src_ip, dest_ip
| where stdev_interval < 10 AND beacon_count > 50
| sort -beacon_count

// Activity timeline for specific host
index=windows Computer="SUSPECT-HOST"
| stats count by sourcetype, _time span=1h
| timechart count by sourcetype

// Event sequence analysis
index=windows Computer="SUSPECT-HOST"
| sort _time
| streamstats count as event_num
| table _time, event_num, sourcetype, EventCode, Message</div>

                    <h4>Network Hunting Queries</h4>
                    <div class="arch-diagram">// DGA detection (high entropy domains)
index=dns sourcetype=stream:dns
| rex field=query "^(?<subdomain>[^.]+)\.(?<domain>[^.]+\.[^.]+)$"
| eval subdomain_len = len(subdomain)
| eval consonant_ratio = 1 - (len(replace(subdomain, "[aeiouAEIOU]", "")) / subdomain_len)
| where subdomain_len > 15 AND consonant_ratio > 0.7
| stats count by query, src_ip
| sort -count

// Connections to newly registered domains
index=proxy OR index=dns
| lookup domain_age_lookup domain as dest_domain OUTPUT registration_date
| eval domain_age_days = (now() - strptime(registration_date, "%Y-%m-%d")) / 86400
| where domain_age_days < 30
| stats count by src_ip, dest_domain, domain_age_days
| sort domain_age_days

// Tor exit node connections
index=firewall OR index=proxy
| lookup tor_exit_nodes ip as dest_ip OUTPUT is_tor_exit
| where is_tor_exit = 1
| stats count by src_ip, dest_ip
| sort -count

// Non-standard ports for HTTP/HTTPS
index=proxy
| where NOT (dest_port IN (80, 443, 8080, 8443))
| stats count by src_ip, dest_ip, dest_port
| sort -count</div>
                </div>

                <!-- Operationalizing Hunts -->
                <h2><i class="fas fa-cogs"></i> Operationalizing Hunts</h2>
                <div class="config-section">
                    <h4>From Hunt to Detection</h4>
                    <div class="arch-diagram">Hunt-to-Detection Workflow:

1. DOCUMENT FINDINGS
   â”œâ”€â”€ Hypothesis tested
   â”œâ”€â”€ Data sources used
   â”œâ”€â”€ Query logic
   â”œâ”€â”€ True/false positive analysis
   â””â”€â”€ MITRE ATT&CK mapping

2. REFINE QUERY
   â”œâ”€â”€ Remove false positives
   â”œâ”€â”€ Add exclusions for known-good
   â”œâ”€â”€ Optimize for performance
   â””â”€â”€ Test over historical data

3. CREATE CORRELATION SEARCH
   â”œâ”€â”€ Schedule interval
   â”œâ”€â”€ Alert actions
   â”œâ”€â”€ Severity mapping
   â””â”€â”€ Notable event fields

4. BUILD RESPONSE PLAYBOOK
   â”œâ”€â”€ Investigation steps
   â”œâ”€â”€ Containment actions
   â”œâ”€â”€ Evidence collection
   â””â”€â”€ Escalation criteria

5. MEASURE EFFECTIVENESS
   â”œâ”€â”€ True positive rate
   â”œâ”€â”€ False positive rate
   â”œâ”€â”€ Time to detect
   â””â”€â”€ Coverage gaps</div>

                    <h4>Correlation Search Example</h4>
                    <div class="arch-diagram">// Convert hunt to scheduled search
// Original hunt: Encoded PowerShell detection

[hunt_encoded_powershell]
search = index=windows sourcetype="XmlWinEventLog:Microsoft-Windows-Sysmon/Operational" EventCode=1 \
  Image="*powershell.exe" \
  | where match(CommandLine, "(?i)(-enc|-encodedcommand|-e\s+[A-Za-z0-9+/=]{20,})") \
  | stats count as execution_count by Computer, User, CommandLine \
  | where execution_count > 0

cron_schedule = */15 * * * *
enableSched = 1
dispatch.earliest_time = -20m
dispatch.latest_time = now

alert.severity = high
alert.suppress = 1
alert.suppress.fields = Computer, CommandLine
alert.suppress.period = 24h

action.notable = 1
action.notable.param.rule_title = Encoded PowerShell Execution
action.notable.param.rule_description = PowerShell executed with encoded command
action.notable.param.security_domain = endpoint
action.notable.param.severity = high
action.notable.param.drilldown_search = index=windows Computer="$Computer$"</div>
                </div>

                <!-- Hunt Documentation -->
                <h2><i class="fas fa-file-alt"></i> Hunt Documentation</h2>
                <div class="config-section">
                    <div class="arch-diagram">Hunt Documentation Template:

HUNT METADATA:
â”œâ”€â”€ Hunt ID: HUNT-2024-001
â”œâ”€â”€ Hunt Name: Encoded PowerShell Execution
â”œâ”€â”€ Author: [Your Name]
â”œâ”€â”€ Date: 2024-01-15
â”œâ”€â”€ Status: Completed â†’ Operationalized
â””â”€â”€ MITRE ATT&CK: T1059.001, T1027

HYPOTHESIS:
"Adversaries may use Base64-encoded PowerShell commands to 
evade detection and execute malicious code."

DATA REQUIREMENTS:
â”œâ”€â”€ Sysmon Event ID 1 (Process Creation)
â”œâ”€â”€ PowerShell Script Block Logging (4104)
â”œâ”€â”€ Index: windows
â””â”€â”€ Retention: 90 days minimum

HUNT QUERY:
[Include optimized SPL query]

FINDINGS:
â”œâ”€â”€ True Positives: 3 (legitimate admin scripts)
â”œâ”€â”€ False Positives: 12 (backup software)
â”œâ”€â”€ Suspicious: 2 (requires investigation)
â””â”€â”€ Malicious: 0

EXCLUSIONS ADDED:
â”œâ”€â”€ User: DOMAIN\backup_svc
â”œâ”€â”€ Path: C:\BackupSoftware\*
â””â”€â”€ CommandLine: "*scheduled-task-backup*"

DETECTION CREATED:
â”œâ”€â”€ Correlation Search: hunt_encoded_powershell
â”œâ”€â”€ Severity: High
â”œâ”€â”€ Schedule: Every 15 minutes
â””â”€â”€ Notable Event: Yes

RECOMMENDATIONS:
â”œâ”€â”€ Monitor for new exclusion bypass attempts
â”œâ”€â”€ Extend to other script interpreters
â””â”€â”€ Review quarterly for false positive rate</div>
                </div>

                <!-- Decision Trees -->
                <h2><i class="fas fa-project-diagram"></i> Threat Hunting Decision Trees</h2>
                <div class="config-section">
                    <h3>Decision Tree: Hunt Type Selection</h3>
                    <div class="arch-diagram">WHAT TYPE OF HUNT SHOULD I RUN?
â”‚
â”œâ”€ What intelligence triggered this hunt?
â”‚   â”‚
â”‚   â”œâ”€ New threat intel / IOCs?
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ IOC-BASED HUNT
â”‚   â”‚       â”œâ”€ Search for specific hashes, IPs, domains
â”‚   â”‚       â”œâ”€ Check historical data (90 days minimum)
â”‚   â”‚       â”œâ”€ Time-bound effort (hours)
â”‚   â”‚       â””â”€ Outcome: Compromise detected or cleared
â”‚   â”‚
â”‚   â”œâ”€ TTPs from threat report?
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ TTP-BASED HUNT
â”‚   â”‚       â”œâ”€ Map to MITRE ATT&CK techniques
â”‚   â”‚       â”œâ”€ Build behavioral queries
â”‚   â”‚       â”œâ”€ Higher false positive rate
â”‚   â”‚       â””â”€ Outcome: New detections + findings
â”‚   â”‚
â”‚   â”œâ”€ Coverage gap identified?
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ HYPOTHESIS-BASED HUNT
â”‚   â”‚       â”œâ”€ Form testable assumption
â”‚   â”‚       â”œâ”€ What-if the attacker did X?
â”‚   â”‚       â”œâ”€ Explore data creatively
â”‚   â”‚       â””â”€ Outcome: Coverage improvements
â”‚   â”‚
â”‚   â””â”€ Regular scheduled hunt?
â”‚       â”‚
â”‚       â””â”€ ANOMALY-BASED HUNT
â”‚           â”œâ”€ Baseline normal behavior
â”‚           â”œâ”€ Find statistical outliers
â”‚           â”œâ”€ Requires data science approach
â”‚           â””â”€ Outcome: Unknown-unknowns discovery
â”‚
â””â”€ What data quality do I have?
    â”‚
    â”œâ”€ Complete endpoint telemetry? â†’ Full hunt capability
    â”œâ”€ Network logs only? â†’ Network-focused hunts
    â””â”€ Missing critical sources? â†’ Hunt for coverage gaps first</div>

                    <h3>Decision Tree: Hunt Finding Assessment</h3>
                    <div class="arch-diagram">FOUND SOMETHING SUSPICIOUS - NOW WHAT?
â”‚
â”œâ”€ Is it definitely malicious?
â”‚   â”‚
â”‚   â”œâ”€ YES (clear IOC match, known malware)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ ESCALATE TO INCIDENT
â”‚   â”‚       â”œâ”€ Follow IR playbook
â”‚   â”‚       â”œâ”€ Preserve evidence
â”‚   â”‚       â”œâ”€ Contain affected systems
â”‚   â”‚       â””â”€ Complete hunt documentation later
â”‚   â”‚
â”‚   â””â”€ NOT SURE (behavioral anomaly)
â”‚       â”‚
â”‚       â””â”€ Continue investigation...
â”‚
â”œâ”€ Gather context:
â”‚   â”‚
â”‚   â”œâ”€ Who/what asset is involved?
â”‚   â”‚   â””â”€ Check asset inventory, criticality
â”‚   â”‚
â”‚   â”œâ”€ What else happened on this host?
â”‚   â”‚   â””â”€ Expand search: 1 hour before/after
â”‚   â”‚
â”‚   â”œâ”€ Is this behavior seen elsewhere?
â”‚   â”‚   â””â”€ Search for same pattern across environment
â”‚   â”‚
â”‚   â””â”€ Has this happened before?
â”‚       â””â”€ Check historical data for same host
â”‚
â”œâ”€ Classification:
â”‚   â”‚
â”‚   â”œâ”€ True Positive (confirmed threat)?
â”‚   â”‚   â””â”€ Escalate to incident response
â”‚   â”‚
â”‚   â”œâ”€ Suspicious - needs more data?
â”‚   â”‚   â””â”€ Request additional logging, containment hold
â”‚   â”‚
â”‚   â””â”€ False Positive (legitimate)?
â”‚       â””â”€ Document exclusion, improve detection
â”‚
â””â”€ Regardless of outcome:
    â”œâ”€ Document hypothesis, queries, findings
    â”œâ”€ Update detection coverage
    â””â”€ Share with team (TLP appropriate)</div>

                    <h3>Decision Tree: Hunt SPL Pattern Selection</h3>
                    <div class="arch-diagram">WHAT SPL PATTERN FOR THIS HUNT?
â”‚
â”œâ”€ Looking for rare events?
â”‚   â”‚
â”‚   â””â”€ RARE VALUE ANALYSIS
â”‚       â”œâ”€ | stats dc(host) as host_count by process
â”‚       â”‚   | where host_count &lt; 3
â”‚       â”‚
â”‚       â””â”€ Find things appearing on few hosts
â”‚
â”œâ”€ Looking for anomalous frequency?
â”‚   â”‚
â”‚   â””â”€ STATISTICAL ANALYSIS
â”‚       â”œâ”€ | eventstats avg(count) as avg, stdev(count) as stdev
â”‚       â”‚   | eval zscore = (count-avg)/stdev
â”‚       â”‚   | where zscore &gt; 3
â”‚       â”‚
â”‚       â””â”€ Z-score &gt; 3 = unusual activity
â”‚
â”œâ”€ Looking for beaconing/periodicity?
â”‚   â”‚
â”‚   â””â”€ TIME INTERVAL ANALYSIS
â”‚       â”œâ”€ | streamstats last(_time) as prev by src,dest
â”‚       â”‚   | eval interval = _time - prev
â”‚       â”‚   | stats stdev(interval) as jitter
â”‚       â”‚   | where jitter &lt; 10
â”‚       â”‚
â”‚       â””â”€ Low jitter = regular beacon
â”‚
â”œâ”€ Looking for first-seen behavior?
â”‚   â”‚
â”‚   â””â”€ FIRST-TIME ANALYSIS
â”‚       â”œâ”€ | stats earliest(_time) as first_seen by user, process
â”‚       â”‚   | where first_seen &gt; relative_time(now(),"-7d")
â”‚       â”‚
â”‚       â””â”€ New behavior in environment
â”‚
â””â”€ Looking for relationship patterns?
    â”‚
    â””â”€ CHAIN ANALYSIS
        â”œâ”€ | transaction host maxspan=10m
        â”‚   | search (EventCode=1 AND process="cmd.exe")
        â”‚     AND (EventCode=3 AND dest_port=443)
        â”‚
        â””â”€ Link related events across time</div>
                </div>

                <!-- What Enterprises Usually Miss -->
                <h2><i class="fas fa-exclamation-circle"></i> What Enterprises Usually Miss</h2>
                <div class="enterprise-gaps">
                    <div class="gap-grid">
                        <div class="gap-category critical">
                            <h4>ğŸ”´ Critical Gaps</h4>
                            <ul>
                                <li><strong>No hunting program:</strong> All reactive detection, zero proactive hunting time allocated</li>
                                <li><strong>Missing critical data:</strong> Command line logging disabled, PowerShell not logged</li>
                                <li><strong>No hypothesis documentation:</strong> Hunts run ad-hoc, no record of what was checked</li>
                                <li><strong>Findings not operationalized:</strong> Good hunts but detections never created</li>
                                <li><strong>Coverage blind spots:</strong> Don't know which ATT&CK techniques aren't covered</li>
                            </ul>
                        </div>
                        <div class="gap-category warning">
                            <h4><i class="fas fa-exclamation-triangle"></i> Operational Gaps</h4>
                            <ul>
                                <li><strong>IOC-only hunting:</strong> Just searching for known-bad, missing behavioral hunts</li>
                                <li><strong>No hunting cadence:</strong> Hunts only after incidents, not regular schedule</li>
                                <li><strong>Silo'd hunters:</strong> No knowledge sharing between shifts/teams</li>
                                <li><strong>No hunt metrics:</strong> Can't demonstrate hunting program value</li>
                                <li><strong>Stale baselines:</strong> "Normal" behavior profiles never updated</li>
                            </ul>
                        </div>
                        <div class="gap-category info">
                            <h4><i class="fas fa-info-circle"></i> Technical Gaps</h4>
                            <ul>
                                <li><strong>Inefficient queries:</strong> Hunting with raw index searches vs data models</li>
                                <li><strong>No hunting workbench:</strong> No saved searches, dashboards, or investigation tools</li>
                                <li><strong>Missing enrichment:</strong> No asset context, threat intel integration weak</li>
                                <li><strong>Short data retention:</strong> Can't hunt for persistent threats beyond 30 days</li>
                                <li><strong>No automation:</strong> Manual hunting only, missing scheduled hunt sweeps</li>
                            </ul>
                        </div>
                        <div class="gap-category best-practice">
                            <h4><i class="fas fa-check-circle"></i> Best Practices Often Ignored</h4>
                            <ul>
                                <li><strong>Map to ATT&CK:</strong> Structure hunts around technique coverage</li>
                                <li><strong>Hunt in pairs:</strong> Two perspectives catch more</li>
                                <li><strong>Time-box hunts:</strong> 2-4 hours per hypothesis, document and move on</li>
                                <li><strong>Hunt the hunters:</strong> Red team exercises to test hunting capability</li>
                                <li><strong>Measure and report:</strong> Track hunts, findings, detections created</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What is threat hunting and how does it differ from detection?</button>
                        <div class="qa-answer">
                            <p><strong>Threat hunting</strong> is proactive, hypothesis-driven search for threats that evade existing detections:</p>
                            <ul>
                                <li><strong>Detection:</strong> Reactive, automated, rule-based, catches known patterns</li>
                                <li><strong>Hunting:</strong> Proactive, human-driven, hypothesis-based, finds unknown threats</li>
                            </ul>
                            <p>Hunting assumes breach mentality and uses human intuition combined with machine data to find advanced threats.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk through your threat hunting methodology.</button>
                        <div class="qa-answer">
                            <p>I follow the SQRRL Hunting Loop:</p>
                            <ol>
                                <li><strong>Hypothesis:</strong> Form testable assumption (e.g., "Attackers using encoded PowerShell")</li>
                                <li><strong>Investigate:</strong> Search data with SPL queries, pivot on findings</li>
                                <li><strong>Discover:</strong> Identify true/false positives, document findings</li>
                                <li><strong>Inform:</strong> Create detections, update playbooks, share intelligence</li>
                            </ol>
                            <p>Sources for hypotheses: threat intel, MITRE ATT&CK, past incidents, red team findings.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you find rare or anomalous processes in Splunk?</button>
                        <div class="qa-answer">
                            <div class="arch-diagram">// Rare processes across environment
index=windows EventCode=1
| stats dc(Computer) as host_count, count by Image
| where host_count < 3
| sort host_count

// Statistical anomaly (z-score)
| eventstats avg(count) as avg, stdev(count) as stdev by Computer
| eval zscore = (count - avg) / stdev
| where zscore > 3</div>
                            <p>Look for processes on few hosts, first-time executions, and statistical outliers.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you detect beaconing behavior?</button>
                        <div class="qa-answer">
                            <p>Beaconing shows regular, periodic communication patterns:</p>
                            <div class="arch-diagram">index=proxy
| bucket _time span=1m
| stats count by _time, src_ip, dest_ip
| streamstats last(_time) as prev_time by src_ip, dest_ip
| eval interval = _time - prev_time
| stats avg(interval) as avg_int, stdev(interval) as stdev_int
  by src_ip, dest_ip
| where stdev_int < 10  // Low variance = regular intervals</div>
                            <p>Key indicators: consistent intervals, low standard deviation, high connection count.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What do you do after a successful hunt?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Document:</strong> Hypothesis, queries, findings, false positives</li>
                                <li><strong>Refine:</strong> Optimize query, add exclusions for known-good</li>
                                <li><strong>Operationalize:</strong> Create correlation search/scheduled alert</li>
                                <li><strong>Playbook:</strong> Build response procedure for analysts</li>
                                <li><strong>Share:</strong> Brief team, update threat intel</li>
                                <li><strong>Measure:</strong> Track detection effectiveness over time</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What data sources are essential for threat hunting?</button>
                        <div class="qa-answer">
                            <p><strong>Tier 1 (Critical):</strong></p>
                            <ul>
                                <li>Process execution with command lines (Sysmon 1, Windows 4688)</li>
                                <li>Authentication logs (Windows 4624/4625)</li>
                                <li>Network connections (firewall, proxy, DNS)</li>
                                <li>PowerShell logging (4103, 4104)</li>
                            </ul>
                            <p><strong>Tier 2 (High Value):</strong> File creation, registry changes, scheduled tasks, WMI</p>
                            <p><strong>Tier 3 (Enrichment):</strong> DNS queries, DHCP, VPN, cloud audit logs</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>