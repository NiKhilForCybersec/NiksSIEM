<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Models | Splunk Enterprise Security</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Splunk Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                    <a href="es-overview.html" class="nav-link"><i class="fas fa-shield-alt"></i> Enterprise Security</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Data Ingestion</a>
                    <a href="forwarders.html" class="nav-link"><i class="fas fa-share"></i> Forwarders</a>
                    <a href="custom-log-onboarding.html" class="nav-link"><i class="fas fa-file-import"></i> Custom Onboarding</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & Fields</a>
                    <a href="data-models.html" class="nav-link active"><i class="fas fa-cubes"></i> Data Models & CIM</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">SPL Query Language</div>
                    <a href="spl-fundamentals.html" class="nav-link"><i class="fas fa-terminal"></i> SPL Fundamentals</a>
                    <a href="spl-intermediate.html" class="nav-link"><i class="fas fa-code"></i> SPL Intermediate</a>
                    <a href="spl-advanced.html" class="nav-link"><i class="fas fa-rocket"></i> SPL Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Security Operations</div>
                    <a href="correlation-searches.html" class="nav-link"><i class="fas fa-project-diagram"></i> Correlation Searches</a>
                    <a href="notable-events.html" class="nav-link"><i class="fas fa-exclamation-triangle"></i> Notable Events</a>
                    <a href="risk-based-alerting.html" class="nav-link"><i class="fas fa-chart-line"></i> Risk-Based Alerting</a>
                    <a href="threat-hunting.html" class="nav-link"><i class="fas fa-crosshairs"></i> Threat Hunting</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-skull-crossbones"></i> Threat Intelligence</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Administration</div>
                    <a href="administration.html" class="nav-link"><i class="fas fa-cog"></i> Administration</a>
                    <a href="apps-tas.html" class="nav-link"><i class="fas fa-puzzle-piece"></i> Apps & Add-ons</a>
                    <a href="dashboards.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboards</a>
                    <a href="retention-tiers.html" class="nav-link"><i class="fas fa-archive"></i> Storage Tiers</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Splunk</a><span class="separator">/</span>
                    <span class="current">Data Models</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-cubes"></i> Splunk Data Models & CIM</h1>
                <p class="lead">Master Splunk data models and the Common Information Model (CIM). Learn data normalization, tstats for fast searches, acceleration, and how ES leverages data models for security operations.</p>

                <!-- Data Models Overview -->
                <h2><i class="fas fa-info-circle"></i> Data Models Overview</h2>
                <div class="config-section">
                    <h4>What are Data Models?</h4>
                    <div class="code-block">Data Models Definition:

Hierarchical, structured representations of your data 
that enable fast, normalized searches across multiple 
source types.

KEY CONCEPTS:
├── Data Model: Container for related objects
├── Object: Represents events (root or child)
├── Field: Normalized attribute (CIM-compliant)
├── Constraint: Defines which events match
└── Acceleration: Pre-computed summaries

WHY USE DATA MODELS:
├── Normalization: Consistent field names
├── Speed: tstats searches are 10-100x faster
├── Abstraction: Query without knowing sourcetypes
├── ES Requirement: Enterprise Security needs them
└── Reporting: Pivot interface for analysts

DATA MODEL HIERARCHY:
┌─────────────────────────────────────┐
│         DATA MODEL                  │
│  ┌───────────────────────────────┐ │
│  │    ROOT OBJECT (Events)       │ │
│  │    ┌───────────────────────┐  │ │
│  │    │   CHILD OBJECT        │  │ │
│  │    │   ┌───────────────┐   │  │ │
│  │    │   │  GRANDCHILD   │   │  │ │
│  │    │   └───────────────┘   │  │ │
│  │    └───────────────────────┘  │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘</div>

                    <h4>Common Information Model (CIM)</h4>
                    <div class="code-block">Common Information Model (CIM):

WHAT IS CIM:
├── Standard field naming convention
├── Enables cross-source correlation
├── Required for Enterprise Security
├── Maintained by Splunk
└── Technology Add-ons (TAs) implement CIM

CIM DATA MODELS:
┌────────────────────────────────────────────────────────────┐
│ Model Name           │ Use Case                           │
├────────────────────────────────────────────────────────────┤
│ Authentication       │ Logon/logoff events                │
│ Change              │ Configuration changes               │
│ Endpoint            │ Process, service, file events       │
│ Intrusion Detection │ IDS/IPS alerts                      │
│ Malware             │ AV detections                       │
│ Network Traffic     │ Firewall, flow data                 │
│ Network Sessions    │ VPN, proxy sessions                 │
│ Web                 │ HTTP/HTTPS traffic                  │
│ Email               │ Email gateway events                │
│ Data Access         │ Database queries                    │
│ Databases          │ Database operations                  │
│ Vulnerabilities     │ Vulnerability scan results          │
│ Alerts              │ Security alerts                     │
│ Updates             │ Patch/update status                 │
└────────────────────────────────────────────────────────────┘</div>
                </div>

                <!-- Key Data Models -->
                <h2><i class="fas fa-database"></i> Key Security Data Models</h2>
                <div class="config-section">
                    <h4>Authentication Data Model</h4>
                    <div class="code-block">Authentication Data Model:

ROOT OBJECT: Authentication
├── Base search: tag=authentication
└── Key fields:
    ├── action (success, failure)
    ├── app (application name)
    ├── dest (destination host)
    ├── src (source host)
    ├── user (username)
    ├── src_user (source username)
    ├── authentication_method
    └── signature (event type)

CHILD OBJECTS:
├── Default_Authentication
│   └── constraint: action=success
├── Failed_Authentication  
│   └── constraint: action=failure
└── Privileged_Authentication
    └── constraint: tag=privileged

COMMON SOURCETYPES:
├── WinEventLog:Security (4624, 4625)
├── linux_secure
├── cisco:asa
├── pan:traffic
└── okta:log

TSTATS EXAMPLE:
| tstats count from datamodel=Authentication 
  where Authentication.action=failure 
  by Authentication.user, Authentication.src
| rename Authentication.* as *
| where count > 10</div>

                    <h4>Endpoint Data Model</h4>
                    <div class="code-block">Endpoint Data Model:

ROOT OBJECTS:
├── Processes
│   ├── Base: tag=process tag=report
│   ├── Fields: process, process_name, process_id,
│   │           parent_process, parent_process_id,
│   │           user, dest, command_line
│   └── Child: Filesystem (process + filesystem events)
│
├── Services
│   ├── Base: tag=service tag=report
│   ├── Fields: service_name, service_path, 
│   │           start_mode, status
│   └── Actions: started, stopped, modified
│
├── Filesystem
│   ├── Base: tag=endpoint tag=filesystem
│   ├── Fields: file_path, file_name, file_hash,
│   │           action (created, modified, deleted)
│   └── Used for: File integrity monitoring
│
└── Registry
    ├── Base: tag=endpoint tag=registry
    ├── Fields: registry_path, registry_key,
    │           registry_value_data, action
    └── Windows only

TSTATS EXAMPLES:
// Process execution
| tstats count from datamodel=Endpoint.Processes 
  by Processes.dest, Processes.user, Processes.process_name
| rename Processes.* as *

// Registry modifications
| tstats count from datamodel=Endpoint.Registry 
  where Registry.action=modified 
  by Registry.dest, Registry.registry_path</div>

                    <h4>Network Traffic Data Model</h4>
                    <div class="code-block">Network Traffic Data Model:

ROOT OBJECT: All_Traffic
├── Base: tag=network tag=communicate
└── Key fields:
    ├── src_ip, src_port
    ├── dest_ip, dest_port
    ├── protocol
    ├── bytes_in, bytes_out, bytes
    ├── packets_in, packets_out
    ├── action (allowed, blocked)
    ├── app (application name)
    └── transport (tcp, udp)

COMMON SOURCETYPES:
├── pan:traffic (Palo Alto)
├── cisco:asa
├── cisco:ftd
├── checkpoint:firewall
├── fortigate:traffic
└── aws:cloudtrail

TSTATS EXAMPLES:
// Top destinations by bytes
| tstats sum(All_Traffic.bytes) as total_bytes 
  from datamodel=Network_Traffic 
  by All_Traffic.dest_ip, All_Traffic.dest_port
| sort -total_bytes

// Blocked connections
| tstats count from datamodel=Network_Traffic 
  where All_Traffic.action=blocked 
  by All_Traffic.src_ip, All_Traffic.dest_ip
| sort -count</div>

                    <h4>Web Data Model</h4>
                    <div class="code-block">Web Data Model:

ROOT OBJECT: Web
├── Base: tag=web
└── Key fields:
    ├── url (full URL)
    ├── uri_path
    ├── uri_query
    ├── http_method (GET, POST, etc.)
    ├── status (HTTP response code)
    ├── bytes_in, bytes_out
    ├── http_user_agent
    ├── http_referrer
    ├── src_ip
    ├── dest_ip
    └── action (allowed, blocked)

CHILD OBJECTS:
├── Proxy: tag=proxy
└── Web_Server: sourcetype with web data

COMMON SOURCETYPES:
├── bluecoat:proxysg:access
├── cisco:wsa
├── zscaler:nss
├── iis
└── apache:access

TSTATS EXAMPLES:
// Top user agents
| tstats count from datamodel=Web 
  by Web.http_user_agent
| sort -count

// Blocked URLs
| tstats count from datamodel=Web 
  where Web.action=blocked 
  by Web.src_ip, Web.url</div>
                </div>

                <!-- tstats Usage -->
                <h2><i class="fas fa-bolt"></i> tstats for Fast Searches</h2>
                <div class="config-section">
                    <h4>tstats Syntax</h4>
                    <div class="code-block">tstats Command:

BASIC SYNTAX:
| tstats [stats-functions] from datamodel=ModelName 
  [where conditions] 
  [by fields]
  [span=timespan]

STATS FUNCTIONS:
├── count: Count events
├── dc(field): Distinct count
├── sum(field): Sum values
├── avg(field): Average
├── min(field), max(field)
├── values(field): Unique values
├── latest(field), earliest(field)
└── prestats: For multi-level stats

PERFORMANCE:
├── 10-100x faster than regular search
├── Uses pre-computed TSIDX files
├── Requires data model acceleration
└── Limited to indexed-time fields

EXAMPLES:
// Count by time
| tstats count from datamodel=Authentication 
  where Authentication.action=failure 
  by _time span=1h

// Multiple aggregations
| tstats count, dc(Authentication.user) as unique_users 
  from datamodel=Authentication 
  by Authentication.src

// Summariesonly for accelerated
| tstats summariesonly=true count 
  from datamodel=Network_Traffic</div>

                    <h4>Advanced tstats Patterns</h4>
                    <div class="code-block">// Combining tstats with regular SPL
| tstats count from datamodel=Authentication 
  where Authentication.action=failure 
  by Authentication.user, Authentication.src
| rename Authentication.* as *
| where count > 5
| lookup user_info user OUTPUT department
| table user, src, count, department

// Time-based analysis
| tstats count from datamodel=Network_Traffic 
  by All_Traffic.src_ip, _time span=1h
| rename All_Traffic.* as *
| timechart span=1h sum(count) by src_ip limit=10

// Using prestats for complex aggregations
| tstats prestats=true count from datamodel=Web 
  by Web.http_user_agent, _time span=1d
| timechart span=1d count by http_user_agent

// Join with asset data
| tstats count from datamodel=Endpoint.Processes 
  where Processes.process_name="powershell.exe" 
  by Processes.dest
| rename Processes.* as *
| lookup assets.csv ip as dest OUTPUT asset_type, criticality</div>
                </div>

                <!-- Data Model Acceleration -->
                <h2><i class="fas fa-rocket"></i> Data Model Acceleration</h2>
                <div class="config-section">
                    <h4>Acceleration Configuration</h4>
                    <div class="code-block">Data Model Acceleration:

PATH: Settings → Data Models → [Model] → Edit Acceleration

ACCELERATION SETTINGS:
├── Accelerate: Enable/Disable
├── Summary Range: Time period to accelerate
│   ├── 1 Day, 7 Days, 1 Month, 3 Months, 1 Year, All Time
│   └── More time = more storage
├── Acceleration Status: 
│   ├── % Complete
│   ├── Size on disk
│   └── Last updated

HOW IT WORKS:
1. Splunk runs background searches
2. Creates TSIDX summary files
3. Stores pre-computed aggregations
4. tstats reads summaries (fast)
5. Regular search scans raw data (slow)

STORAGE IMPACT:
├── ~10-15% of raw data size typically
├── Depends on cardinality of fields
├── More fields = more storage
└── Monitor with:
    | rest /services/admin/summarization

BEST PRACTICES:
├── Accelerate only needed models
├── Start with shorter time range
├── Monitor storage growth
├── Use summariesonly=true for speed
└── Re-accelerate after field changes</div>

                    <h4>Monitoring Acceleration</h4>
                    <div class="code-block">// Check acceleration status
| rest /services/admin/summarization 
| search eai:acl.app=*ES* 
| table title, summary.is_inprogress, summary.complete, 
        summary.size, summary.access_count

// Acceleration job details
| rest /services/data/models 
| search acceleration.enabled=1 
| table title, acceleration.enabled, acceleration.earliest_time

// Storage usage by data model
| dbinspect index=_summariesindex 
| stats sum(sizeOnDiskMB) as size_mb by splunk_server
| sort -size_mb

// Troubleshooting slow acceleration
index=_internal sourcetype=scheduler status=*
  (app=SA-* OR app=Splunk_SA_*)
| stats count by status, app
| sort -count</div>
                </div>

                <!-- CIM Compliance -->
                <h2><i class="fas fa-check-circle"></i> CIM Compliance</h2>
                <div class="config-section">
                    <h4>Making Data CIM-Compliant</h4>
                    <div class="code-block">CIM Compliance Methods:

1. TECHNOLOGY ADD-ONS (TAs)
   ├── Pre-built field extractions
   ├── Install from Splunkbase
   ├── Auto-map to CIM fields
   └── Example: TA for Palo Alto Networks

2. FIELD ALIASES
   props.conf:
   [mysourcetype]
   FIELDALIAS-user = username AS user
   FIELDALIAS-src = source_ip AS src

3. CALCULATED FIELDS
   props.conf:
   [mysourcetype]
   EVAL-action = if(status="blocked", "blocked", "allowed")

4. LOOKUPS
   props.conf:
   [mysourcetype]
   LOOKUP-vendor_action = vendor_action_lookup vendor_code 
     OUTPUT action

5. FIELD EXTRACTIONS
   props.conf:
   [mysourcetype]
   EXTRACT-dest = dest_host=(?<dest>\S+)

6. TAGS
   tags.conf:
   [sourcetype=mysourcetype]
   authentication = enabled
   
   [eventtype=mylogon_success]
   authentication = enabled
   success = enabled</div>

                    <h4>CIM Validation</h4>
                    <div class="code-block">// Check if data maps to CIM
| datamodel Authentication search 
| head 100
| table _raw, user, src, dest, action

// Validate field population
| tstats count from datamodel=Authentication 
  by Authentication.user, Authentication.action
| rename Authentication.* as *
| stats count by user, action

// Find unmapped data
index=* tag=authentication 
| stats count by sourcetype
| join type=left sourcetype 
  [| tstats count from datamodel=Authentication 
     by source
   | rename source as sourcetype]

// CIM compliance check per sourcetype
| tstats count from datamodel=* by source
| stats values(*) as * by source
| rename source as sourcetype</div>
                </div>

                <!-- ES Required Data Models -->
                <h2><i class="fas fa-shield-alt"></i> ES Required Data Models</h2>
                <div class="config-section">
                    <div class="code-block">Enterprise Security Data Model Requirements:

CORE DATA MODELS (Must have):
├── Authentication
│   └── For: Access Center, user tracking
├── Network_Traffic
│   └── For: Network intrusion, traffic analysis
├── Endpoint (Processes, Filesystem)
│   └── For: Endpoint investigation
├── Intrusion_Detection
│   └── For: IDS/IPS correlation
└── Malware
    └── For: Malware tracking

RECOMMENDED DATA MODELS:
├── Change
│   └── For: Change analysis, compliance
├── Web
│   └── For: Web security monitoring
├── Email
│   └── For: Phishing, email security
├── Network_Sessions
│   └── For: VPN, session tracking
├── Vulnerabilities
│   └── For: Vulnerability management
└── Data_Access
    └── For: Database monitoring

ACCELERATION REQUIREMENTS:
├── All core models should be accelerated
├── 90 days minimum for historical correlation
├── Risk-based alerting needs Endpoint.Processes
└── Asset/Identity correlation needs all models</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is CIM and why is it important?</button>
                        <div class="qa-answer">
                            <p><strong>CIM (Common Information Model)</strong> is Splunk's standard for field naming:</p>
                            <ul>
                                <li>Normalizes fields across different data sources</li>
                                <li>Enables cross-source correlation (firewall + auth logs)</li>
                                <li>Required for Enterprise Security to function</li>
                                <li>Implemented via Technology Add-ons (TAs)</li>
                            </ul>
                            <p>Example: "user" field works the same for Windows, Linux, and Okta logs.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is tstats and why is it faster?</button>
                        <div class="qa-answer">
                            <p><strong>tstats</strong> searches pre-computed summaries (TSIDX files) instead of raw data:</p>
                            <ul>
                                <li>10-100x faster than regular search</li>
                                <li>Requires data model acceleration</li>
                                <li>Limited to indexed-time fields and stats functions</li>
                                <li>Use for dashboards and correlation searches</li>
                            </ul>
                            <p>Trade-off: Uses additional storage for acceleration files.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you make data CIM-compliant?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Install TA:</strong> Technology Add-on for your data source</li>
                                <li><strong>Field aliases:</strong> Map source fields to CIM fields</li>
                                <li><strong>Calculated fields:</strong> EVAL for transformations</li>
                                <li><strong>Tags:</strong> Add appropriate tags (authentication, network, etc.)</li>
                                <li><strong>Lookups:</strong> Enrich with additional context</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: Which data models are required for Enterprise Security?</button>
                        <div class="qa-answer">
                            <p><strong>Core (Must have):</strong></p>
                            <ul>
                                <li>Authentication - user tracking, access</li>
                                <li>Network_Traffic - firewall, flow data</li>
                                <li>Endpoint - process execution, files</li>
                                <li>Intrusion_Detection - IDS/IPS</li>
                                <li>Malware - AV detections</li>
                            </ul>
                            <p>All should be accelerated for at least 90 days.</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>