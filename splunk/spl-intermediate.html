<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPL Intermediate | Splunk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
        <!-- Sidebar -->
        <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="apps-tas.html" class="sidebar-nav-link"><i class="fas fa-puzzle-piece"></i><span>Apps & TAs</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-paper-plane"></i><span>Forwarders</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Parsing & Props/Transforms</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Index & Retention</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>SPL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>SPL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>SPL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-models.html" class="sidebar-nav-link"><i class="fas fa-cubes"></i><span>Data Models & CIM</span></a></li>
                    <li class="sidebar-nav-item"><a href="knowledge-objects.html" class="sidebar-nav-link"><i class="fas fa-brain"></i><span>Knowledge Objects</span></a></li>
                    <li class="sidebar-nav-item"><a href="dashboards.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i><span>Dashboards</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Enterprise Security</span></a></li>
                    <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-project-diagram"></i><span>Correlation Searches</span></a></li>
                    <li class="sidebar-nav-item"><a href="notable-events.html" class="sidebar-nav-link"><i class="fas fa-bell"></i><span>Notable Events</span></a></li>
                    <li class="sidebar-nav-item"><a href="risk-based-alerting.html" class="sidebar-nav-link"><i class="fas fa-exclamation-triangle"></i><span>Risk-Based Alerting</span></a></li>
                    <li class="sidebar-nav-item"><a href="alerting-actions.html" class="sidebar-nav-link"><i class="fas fa-bolt"></i><span>Alerting & Actions</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Security Use Cases -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Security Use Cases</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="security-usecases.html" class="sidebar-nav-link"><i class="fas fa-crosshairs"></i><span>Detection Use Cases</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-scenarios.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise Scenarios</span></a></li>
                </ul>
            </div>
            
            <!-- Automation & Intel -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation & Intel</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="soar.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>SOAR</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intelligence</span></a></li>
                </ul>
            </div>
            
            <!-- Operations -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Operations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i><span>Troubleshooting</span></a></li>
                    <li class="sidebar-nav-item"><a href="performance-tuning.html" class="sidebar-nav-link"><i class="fas fa-tachometer-alt"></i><span>Performance Tuning</span></a></li>
                    <li class="sidebar-nav-item"><a href="monitoring-console.html" class="sidebar-nav-link"><i class="fas fa-heartbeat"></i><span>Monitoring Console</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="administration.html" class="sidebar-nav-link"><i class="fas fa-cog"></i><span>Administration</span></a></li>
                    <li class="sidebar-nav-item"><a href="security-rbac.html" class="sidebar-nav-link"><i class="fas fa-users-cog"></i><span>Security & RBAC</span></a></li>
                    <li class="sidebar-nav-item"><a href="clustering-ha.html" class="sidebar-nav-link"><i class="fas fa-server"></i><span>Clustering & HA</span></a></li>
                </ul>
            </div>
            
            <!-- Deployment -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Deployment</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="splunk-cloud.html" class="sidebar-nav-link"><i class="fas fa-cloud"></i><span>Splunk Cloud</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Splunk</a>
                    <span class="separator">/</span>
                    <span class="current">Spl Intermediate</span>
                </div>

                <h1><i class="fas fa-layer-group"></i> SPL Intermediate</h1>
                <p class="lead">Advance your SPL skills with transactions, subsearches, lookups, macros, and event correlation techniques essential for security analysis.</p>

                <!-- Transaction Command -->
                <h2><i class="fas fa-link"></i> Transaction Command</h2>
                <div class="config-section">
                    <p>The <code>transaction</code> command groups related events into single transactions based on field values or time.</p>
                    
                    <div class="cmd-card">
                        <span class="cmd-name">transaction</span> - Group related events
                        <span class="cmd-syntax">transaction [field-list] [startswith=...] [endswith=...] [maxspan=time] [maxpause=time]</span>
                    </div>

                    <h4>Basic Transaction by Field</h4>
                    <div class="arch-diagram">// Group all events by session ID
index=web sourcetype=access_combined
| transaction session_id

// Transaction fields created:
// duration - time span of transaction
// eventcount - number of events in transaction
// _raw - combined raw events</div>

                    <h4>Transaction with Start/End Conditions</h4>
                    <div class="arch-diagram">// Group login sessions
index=security sourcetype=WinEventLog:Security
| transaction user startswith="EventCode=4624" endswith="EventCode=4634"
| table user, duration, eventcount, _time

// Web sessions with request/response
index=web 
| transaction session_id startswith="action=login" endswith="action=logout" maxspan=8h
| where eventcount > 1</div>

                    <h4>Transaction Time Controls</h4>
                    <div class="arch-diagram">// maxspan - maximum total duration
| transaction user maxspan=30m

// maxpause - maximum gap between events
| transaction user maxpause=5m

// Combined
| transaction session_id maxspan=1h maxpause=10m</div>

                    <h4>Security Use Cases</h4>
                    <div class="arch-diagram">// Track user session activity
index=security EventCode IN (4624, 4625, 4634, 4647)
| transaction user maxspan=8h startswith="EventCode=4624" endswith=(EventCode=4634 OR EventCode=4647)
| eval session_hours = round(duration/3600, 2)
| table user, session_hours, eventcount, _time

// Detect multi-stage attacks
index=endpoint
| transaction host maxspan=30m
| search (process_name=powershell.exe) AND (action=network_connection)
| table host, duration, eventcount

// Track file access patterns
index=security EventCode=4663
| transaction user, ObjectName maxspan=5m
| where eventcount > 10
| table user, ObjectName, eventcount, duration</div>
                </div>

                <!-- Subsearches -->
                <h2><i class="fas fa-code-branch"></i> Subsearches</h2>
                <div class="config-section">
                    <p>Subsearches run first and pass results to the outer search. Enclosed in square brackets <code>[ ]</code>.</p>

                    <h4>Basic Subsearch</h4>
                    <div class="arch-diagram">// Find all activity from IPs that had failed logins
index=firewall src_ip IN 
    [search index=security EventCode=4625 earliest=-1h
    | stats count by src_ip 
    | where count > 5 
    | fields src_ip]

// The subsearch:
// 1. Runs first
// 2. Finds IPs with >5 failed logins
// 3. Returns list of src_ip values
// 4. Outer search filters firewall logs to those IPs</div>

                    <h4>Return Command (More Efficient)</h4>
                    <div class="arch-diagram">// return command is more efficient for subsearches
index=firewall src_ip IN 
    [search index=security EventCode=4625 earliest=-1h
    | stats count by src_ip 
    | where count > 5 
    | return 100 src_ip]

// return N fieldname - returns up to N values
// More efficient than fields command for subsearches</div>

                    <h4>Format Command for Complex Subsearches</h4>
                    <div class="arch-diagram">// format creates OR'd search string
index=web 
    [search index=threat_intel type=malicious_ip
    | fields ip
    | format]

// format output: ( ( ip="1.2.3.4" ) OR ( ip="5.6.7.8" ) ... )</div>

                    <h4>Subsearch Use Cases</h4>
                    <div class="arch-diagram">// Find all activity from users who accessed sensitive files
index=endpoint 
    [search index=security EventCode=4663 ObjectName="*sensitive*"
    | dedup user
    | fields user]

// Find network connections from processes that also wrote files
index=firewall 
    [search index=endpoint action=file_write file_path="*temp*"
    | stats count by process_name
    | return 50 process_name]

// Alert context: Get all events for hosts with critical alerts
index=* host IN 
    [search index=alerts severity=critical earliest=-1h
    | dedup host
    | return 100 host]</div>

                    <h4>Subsearch Limitations</h4>
                    <ul style="color: #8b949e;">
                        <li>Default timeout: 60 seconds</li>
                        <li>Default max results: 10,000</li>
                        <li>Results truncated to ~10,000 characters when passed to outer search</li>
                        <li>Consider <code>join</code> for larger datasets</li>
                    </ul>
                </div>

                <!-- Join Command -->
                <h2><i class="fas fa-object-group"></i> Join Command</h2>
                <div class="config-section">
                    <p>Combines results from two searches based on common field values. More powerful than subsearches for large datasets.</p>

                    <div class="cmd-card">
                        <span class="cmd-name">join</span> - Combine search results
                        <span class="cmd-syntax">join [type=inner|outer|left] field [search ...]</span>
                    </div>

                    <h4>Inner Join (Default)</h4>
                    <div class="arch-diagram">// Only matching records from both searches
index=security EventCode=4625
| stats count as failed_logins by src_ip
| join src_ip 
    [search index=assets 
    | fields ip, hostname, owner, department
    | rename ip as src_ip]
| table src_ip, hostname, owner, failed_logins</div>

                    <h4>Left Join</h4>
                    <div class="arch-diagram">// All records from main search, matching from subsearch
index=security EventCode=4625
| stats count as failed_logins by src_ip
| join type=left src_ip 
    [search index=assets | fields ip, hostname | rename ip as src_ip]
| fillnull hostname value="Unknown"
| table src_ip, hostname, failed_logins</div>

                    <h4>Outer Join</h4>
                    <div class="arch-diagram">// All records from both searches
index=security EventCode=4625
| stats count by src_ip
| join type=outer src_ip 
    [search index=threat_intel | fields ip, threat_type | rename ip as src_ip]
| table src_ip, count, threat_type</div>

                    <h4>Join on Multiple Fields</h4>
                    <div class="arch-diagram">// Join on src_ip AND user
index=vpn
| join src_ip, user 
    [search index=security EventCode=4624 
    | fields src_ip, user, workstation]</div>

                    <h4>Alternative: stats + where (Often Better)</h4>
                    <div class="arch-diagram">// Instead of join, combine in single search
index=security OR index=assets
| stats 
    values(EventCode) as events,
    values(hostname) as hostname,
    values(owner) as owner,
    count as event_count
    by src_ip
| where isnotnull(events)</div>
                </div>

                <!-- Lookups -->
                <h2><i class="fas fa-table"></i> Advanced Lookups</h2>
                <div class="config-section">
                    <h4>Lookup Command</h4>
                    <div class="arch-diagram">// Basic lookup
index=firewall
| lookup geo_ip_lookup ip as src_ip OUTPUT country, city, latitude, longitude

// Lookup with field renaming
index=security
| lookup user_info.csv username as user OUTPUT department, manager, title

// Case-insensitive lookup
index=security
| lookup case_insensitive=true user_info.csv username as user OUTPUT department</div>

                    <h4>Inputlookup - Search a Lookup Directly</h4>
                    <div class="arch-diagram">// View entire lookup
| inputlookup threat_intel.csv

// Filter lookup contents
| inputlookup threat_intel.csv 
| where threat_type="malware" AND confidence > 80

// Use lookup for threat hunting
| inputlookup known_bad_hashes.csv
| rename hash as file_hash
| join file_hash [search index=endpoint | fields file_hash, host, file_path]</div>

                    <h4>Outputlookup - Save Results to Lookup</h4>
                    <div class="arch-diagram">// Create/overwrite lookup
index=security EventCode=4625
| stats count by src_ip
| where count > 10
| outputlookup suspicious_ips.csv

// Append to existing lookup
index=security EventCode=4625 earliest=-1h
| stats count by src_ip
| outputlookup append=true suspicious_ips.csv

// Create with key for updates
index=assets
| stats latest(hostname) as hostname, latest(os) as os by ip
| outputlookup createinapp=true assets_inventory.csv</div>

                    <h4>Automatic Lookups</h4>
                    <div class="arch-diagram">// Configure in transforms.conf and props.conf for automatic enrichment
// When configured, lookups run automatically on search

// Example: Automatic user department lookup
// Every search on index=security automatically gets department field
index=security EventCode=4624
| table user, department, src_ip  // department added automatically</div>
                </div>

                <!-- Eval Advanced Functions -->
                <h2><i class="fas fa-calculator"></i> Advanced Eval Functions</h2>
                <div class="config-section">
                    <h4>Conditional Logic</h4>
                    <div class="arch-diagram">// Nested if statements
| eval risk_level = if(count > 100, "Critical", 
                    if(count > 50, "High",
                    if(count > 10, "Medium", "Low")))

// Case function (cleaner for multiple conditions)
| eval risk_level = case(
    count > 100, "Critical",
    count > 50, "High",
    count > 10, "Medium",
    1=1, "Low"
)

// Coalesce - first non-null value
| eval user = coalesce(src_user, dest_user, target_user, "unknown")

// Nullif - return null if condition met
| eval clean_user = nullif(user, "N/A")</div>

                    <h4>String Manipulation</h4>
                    <div class="arch-diagram">// Extract domain from email
| eval domain = mvindex(split(email, "@"), 1)

// Extract filename from path
| eval filename = mvindex(split(file_path, "\\"), -1)

// URL decode
| eval decoded_url = urldecode(url)

// Base64 decode (for investigating encoded commands)
| eval decoded_cmd = base64decode(encoded_string)

// Replace with regex
| eval clean_cmd = replace(command, "password=\S+", "password=REDACTED")

// Padding
| eval padded_id = printf("%08d", id)</div>

                    <h4>Time Calculations</h4>
                    <div class="arch-diagram">// Time since event
| eval hours_ago = round((now() - _time) / 3600, 2)

// Business hours check
| eval hour = strftime(_time, "%H")
| eval is_business_hours = if(hour >= 8 AND hour <= 18, "yes", "no")

// Day of week
| eval day = strftime(_time, "%A")
| eval is_weekend = if(day IN ("Saturday", "Sunday"), "yes", "no")

// Time difference between events
| sort _time
| streamstats current=f last(_time) as prev_time by session_id
| eval gap_seconds = _time - prev_time</div>

                    <h4>Network Functions</h4>
                    <div class="arch-diagram">// CIDR matching
| where cidrmatch("10.0.0.0/8", src_ip)

// Check if IP is internal
| eval is_internal = if(
    cidrmatch("10.0.0.0/8", src_ip) OR
    cidrmatch("172.16.0.0/12", src_ip) OR
    cidrmatch("192.168.0.0/16", src_ip),
    "internal", "external"
)

// Convert IP to integer for sorting
| eval ip_num = tonumber(replace(src_ip, "\.", ""))</div>
                </div>

                <!-- Eventstats and Streamstats -->
                <h2><i class="fas fa-chart-line"></i> Eventstats and Streamstats</h2>
                <div class="config-section">
                    <h4>Eventstats - Add Aggregations Without Reducing Rows</h4>
                    <div class="arch-diagram">// Add total to each event
index=security EventCode=4625
| eventstats count as total_failures
| eval percentage = round(count * 100 / total_failures, 2)

// Compare event to group average
index=firewall
| eventstats avg(bytes) as avg_bytes by src_ip
| eval deviation = bytes - avg_bytes
| where deviation > avg_bytes * 2  // More than 2x average

// Add group statistics
index=security
| eventstats 
    count as total_events,
    dc(src_ip) as unique_ips,
    earliest(_time) as first_seen,
    latest(_time) as last_seen
    by user</div>

                    <h4>Streamstats - Running Statistics</h4>
                    <div class="arch-diagram">// Running count
index=security
| sort _time
| streamstats count as running_total

// Running count by group
index=security
| sort _time
| streamstats count as user_event_num by user

// Windowed statistics (last N events)
index=firewall
| sort _time
| streamstats avg(bytes) as rolling_avg window=10

// Time-windowed statistics
index=security EventCode=4625
| sort _time
| streamstats time_window=5m count as failures_5min by src_ip
| where failures_5min > 10

// Detect velocity spikes
index=web
| sort _time
| streamstats time_window=1m count as requests_per_min by src_ip
| where requests_per_min > 100</div>

                    <h4>Streamstats for Anomaly Detection</h4>
                    <div class="arch-diagram">// Compare current event to recent baseline
index=firewall
| sort _time
| streamstats avg(bytes) as baseline_avg, stdev(bytes) as baseline_std window=100 current=f
| eval zscore = (bytes - baseline_avg) / baseline_std
| where zscore > 3  // More than 3 standard deviations

// Detect gaps in expected events
index=heartbeat
| sort _time
| streamstats current=f last(_time) as prev_time by host
| eval gap_minutes = (_time - prev_time) / 60
| where gap_minutes > 5</div>
                </div>

                <!-- Macros -->
                <h2><i class="fas fa-code"></i> Search Macros</h2>
                <div class="config-section">
                    <p>Macros are reusable search snippets defined in macros.conf or via Splunk UI.</p>

                    <h4>Using Macros</h4>
                    <div class="arch-diagram">// Macro with no arguments
`security_index`
// Expands to: index=security sourcetype=WinEventLog:Security

// Macro with arguments
`failed_logins(10)`
// Expands to: index=security EventCode=4625 | stats count by src_ip | where count > 10

// Nested macro usage
index=security `exclude_service_accounts` `business_hours_only`</div>

                    <h4>Defining Macros (in macros.conf)</h4>
                    <div class="arch-diagram"># macros.conf

[security_index]
definition = index=security sourcetype=WinEventLog:Security

[failed_logins(1)]
args = threshold
definition = index=security EventCode=4625 | stats count by src_ip | where count > $threshold$

[exclude_service_accounts]
definition = NOT user IN ("svc_*", "SYSTEM", "LOCAL SERVICE", "NETWORK SERVICE")

[business_hours_only]
definition = | where (date_hour >= 8 AND date_hour <= 18) AND NOT (date_wday="saturday" OR date_wday="sunday")

[get_risk_score(2)]
args = field, weight
definition = eval risk_score = $field$ * $weight$</div>

                    <h4>Security Macro Examples</h4>
                    <div class="arch-diagram"># Useful security macros

[internal_ip]
definition = (cidrmatch("10.0.0.0/8", src_ip) OR cidrmatch("172.16.0.0/12", src_ip) OR cidrmatch("192.168.0.0/16", src_ip))

[external_ip]
definition = NOT `internal_ip`

[windows_security]
definition = index=security sourcetype=WinEventLog:Security

[authentication_events]
definition = EventCode IN (4624, 4625, 4634, 4647, 4648, 4672)

[high_risk_processes]
definition = process_name IN ("mimikatz.exe", "procdump.exe", "psexec.exe", "wmic.exe", "certutil.exe")</div>
                </div>

                <!-- Tstats for Performance -->
                <h2><i class="fas fa-tachometer-alt"></i> Tstats for High Performance</h2>
                <div class="config-section">
                    <p><code>tstats</code> queries indexed fields directly, providing 10-100x performance improvement over regular searches.</p>

                    <div class="arch-diagram">// Basic tstats query
| tstats count where index=security by source, sourcetype

// With time bucketing
| tstats count where index=security by _time span=1h

// Using data model (most powerful)
| tstats count from datamodel=Authentication where Authentication.action=failure by Authentication.src, Authentication.user

// Prestats with regular search
| tstats prestats=t count where index=security by host
| stats count by host

// Summariesonly for accelerated data models
| tstats summariesonly=t count from datamodel=Network_Traffic by All_Traffic.dest_port</div>

                    <h4>When to Use Tstats</h4>
                    <ul style="color: #8b949e;">
                        <li>Counting and basic aggregations over large datasets</li>
                        <li>Dashboard searches that need sub-second response</li>
                        <li>Data model accelerations are configured</li>
                        <li>Searching indexed fields only (not _raw)</li>
                    </ul>
                </div>

                <!-- Security Analysis Patterns -->
                <h2><i class="fas fa-shield-alt"></i> Security Analysis Patterns</h2>
                <div class="config-section">
                    <h4>Baseline and Anomaly Detection</h4>
                    <div class="arch-diagram">// Build baseline and detect anomalies
index=proxy
| stats count as daily_requests by user, _time span=1d
| eventstats avg(daily_requests) as baseline, stdev(daily_requests) as std by user
| where daily_requests > baseline + (3 * std)
| table _time, user, daily_requests, baseline</div>

                    <h4>First-Time Activity Detection</h4>
                    <div class="arch-diagram">// First time user logged into system
index=security EventCode=4624
| stats earliest(_time) as first_login by user, ComputerName
| where first_login > relative_time(now(), "-24h")
| convert ctime(first_login)
| table user, ComputerName, first_login</div>

                    <h4>Peer Group Analysis</h4>
                    <div class="arch-diagram">// Compare user activity to department peers
index=proxy
| lookup user_department.csv user OUTPUT department
| stats count as user_requests by user, department
| eventstats avg(user_requests) as dept_avg by department
| eval deviation_pct = round((user_requests - dept_avg) / dept_avg * 100, 1)
| where deviation_pct > 200
| table user, department, user_requests, dept_avg, deviation_pct</div>

                    <h4>Threshold Alerting</h4>
                    <div class="arch-diagram">// Failed login threshold with context
index=security EventCode=4625
| bin _time span=10m
| stats count, values(user) as targeted_users, dc(user) as user_count by src_ip, _time
| where count > 10
| eval alert_type = case(
    user_count > 5 AND count > 50, "Credential Stuffing",
    user_count == 1 AND count > 20, "Brute Force",
    1=1, "Multiple Failed Logins"
)</div>
                </div>

                <!-- Decision Trees -->
                <h2><i class="fas fa-project-diagram"></i> SPL Intermediate Decision Trees</h2>
                <div class="config-section">
                    <h3>Decision Tree: Transaction vs Stats Selection</h3>
                    <div class="arch-diagram">NEED TO GROUP EVENTS BY LOGICAL SESSIONS?
│
├─ YES: Need to see individual events in session?
│   │
│   ├─ YES: Use TRANSACTION
│   │   │
│   │   ├─ Known session ID field? → transaction session_id
│   │   ├─ Time-based grouping? → transaction maxpause=5m maxspan=30m
│   │   └─ Multiple connecting fields? → transaction user src_ip maxpause=5m
│   │
│   └─ NO: Only need aggregated values?
│       │
│       └─ Use STATS with session calculation
│           → | stats earliest(_time) as start 
│                    latest(_time) as end 
│                    values(action) as actions 
│                    by session_id
│
└─ NO: Use STATS directly
    │
    ├─ Simple counts → | stats count by user
    ├─ Unique values → | stats dc(src_ip) as unique_ips by user
    └─ Multiple aggregations → | stats count avg(duration) max(bytes) by host</div>

                    <h3>Decision Tree: Subsearch vs Join vs Lookup</h3>
                    <div class="arch-diagram">NEED TO COMBINE DATA FROM MULTIPLE SOURCES?
│
├─ Is reference data STATIC (rarely changes)?
│   │
│   ├─ YES: Use LOOKUP
│   │   │
│   │   ├─ CSV file exists? → | lookup threats.csv ip as src_ip
│   │   ├─ Need automatic updates? → Use automatic lookup in props.conf
│   │   └─ KV Store available? → | lookup kv_threat_intel ip as src_ip
│   │
│   └─ NO: Data is dynamic/real-time?
│       │
│       ├─ Reference dataset SMALL (&lt;10K results)?
│       │   │
│       │   └─ Use SUBSEARCH
│       │       → src_ip IN [search index=ioc | return 1000 ip]
│       │
│       └─ Reference dataset LARGE (&gt;10K results)?
│           │
│           └─ Use JOIN
│               → | join type=left src_ip 
│                   [search index=cmdb | fields ip, owner]
│
├─ Performance Priority?
│   │
│   ├─ LOOKUP: Fastest (pre-indexed)
│   ├─ SUBSEARCH: Medium (limited to 10K, 60s default)
│   └─ JOIN: Slowest (memory intensive)
│
└─ RULE OF THUMB:
    → Static enrichment: LOOKUP
    → Small dynamic lists: SUBSEARCH  
    → Large correlations: JOIN (or summary indexes)</div>

                    <h3>Decision Tree: Eventstats vs Streamstats Selection</h3>
                    <div class="arch-diagram">NEED TO ADD CALCULATED FIELDS TO EVENTS?
│
├─ Need SAME value on ALL events (global calculation)?
│   │
│   └─ Use EVENTSTATS
│       │
│       ├─ Calculate percentage of total
│       │   → | eventstats count as total | eval pct=count/total*100
│       │
│       ├─ Compare each event to average
│       │   → | eventstats avg(bytes) as avg_bytes 
│       │       | where bytes > avg_bytes*3
│       │
│       └─ Group-level totals
│           → | eventstats sum(bytes) as dept_total by department
│
└─ Need RUNNING calculation (position-dependent)?
    │
    └─ Use STREAMSTATS
        │
        ├─ Running totals / cumulative sums
        │   → | streamstats sum(bytes) as running_total
        │
        ├─ Detect velocity/acceleration changes
        │   → | streamstats count as events_in_window window=10
        │
        ├─ Time-windowed calculations
        │   → | streamstats avg(response_time) as rolling_avg 
        │       time_window=5m
        │
        └─ Anomaly detection (deviation from recent behavior)
            → | streamstats avg(count) stdev(count) as std window=24 
                | eval zscore=(count-avg)/std 
                | where zscore > 3</div>
                </div>

                <!-- What Enterprises Usually Miss -->
                <h2><i class="fas fa-exclamation-circle"></i> What Enterprises Usually Miss</h2>
                <div class="enterprise-gaps">
                    <div class="gap-grid">
                        <div class="gap-category critical">
                            <h4><i class="fas fa-times-circle"></i> Performance Killers</h4>
                            <ul>
                                <li><strong>Transaction abuse:</strong> Using transaction when stats would suffice - 10x slower</li>
                                <li><strong>Unbounded subsearches:</strong> No time limits or return limits on subsearches</li>
                                <li><strong>Join on large datasets:</strong> Using join with millions of rows kills search head memory</li>
                                <li><strong>Streamstats without window:</strong> Processing entire dataset for running calculations</li>
                                <li><strong>Missing time bounds:</strong> Eventstats across 30 days when 24 hours would work</li>
                            </ul>
                        </div>
                        <div class="gap-category warning">
                            <h4><i class="fas fa-exclamation-triangle"></i> Logic Errors</h4>
                            <ul>
                                <li><strong>Wrong join type:</strong> Using inner join when left join needed, losing events</li>
                                <li><strong>Subsearch timeout:</strong> Not accounting for 60-second default timeout</li>
                                <li><strong>Transaction maxspan too large:</strong> Grouping unrelated events together</li>
                                <li><strong>Stats by wrong field:</strong> Using stats by user when should be by user+host</li>
                                <li><strong>Eventstats after filtering:</strong> Calculating percentages on already-filtered data</li>
                            </ul>
                        </div>
                        <div class="gap-category info">
                            <h4><i class="fas fa-info-circle"></i> Missed Opportunities</h4>
                            <ul>
                                <li><strong>Lookup enrichment:</strong> Doing subsearches for data that should be lookups</li>
                                <li><strong>Automatic lookups:</strong> Manual lookup in every search vs props.conf automatic</li>
                                <li><strong>Macro consolidation:</strong> Copy-pasting complex SPL instead of creating macros</li>
                                <li><strong>Time-series analysis:</strong> Not using timechart/streamstats for trend detection</li>
                                <li><strong>Dedup opportunities:</strong> Processing duplicate events unnecessarily</li>
                            </ul>
                        </div>
                        <div class="gap-category best-practice">
                            <h4><i class="fas fa-check-circle"></i> Best Practices Often Ignored</h4>
                            <ul>
                                <li><strong>Test subsearch limits:</strong> Validate subsearch returns expected count with | stats count</li>
                                <li><strong>Document complex searches:</strong> Comments explaining transaction/join logic</li>
                                <li><strong>Validate join results:</strong> Compare event counts before/after join</li>
                                <li><strong>Benchmark alternatives:</strong> Test stats vs transaction performance on your data</li>
                                <li><strong>Use append for union:</strong> Combine results without join overhead</li>
                            </ul>
                        </div>
                    </div>

                    <h3><i class="fas fa-clipboard-check"></i> Intermediate SPL Quality Checklist</h3>
                    <div class="checklist-grid">
                        <div class="checklist-section">
                            <h4>Transaction Usage</h4>
                            <ul>
                                <li><input type="checkbox"> Transaction has maxspan and maxpause defined</li>
                                <li><input type="checkbox"> Verified stats cannot achieve same result</li>
                                <li><input type="checkbox"> Transaction fields are indexed for performance</li>
                                <li><input type="checkbox"> Event count validated (not grouping too many/few)</li>
                            </ul>
                        </div>
                        <div class="checklist-section">
                            <h4>Subsearch &amp; Join</h4>
                            <ul>
                                <li><input type="checkbox"> Subsearch has explicit return limit (| return N field)</li>
                                <li><input type="checkbox"> Subsearch time range is bounded</li>
                                <li><input type="checkbox"> Join type (inner/left/outer) is intentional</li>
                                <li><input type="checkbox"> Considered lookup as alternative to subsearch</li>
                            </ul>
                        </div>
                        <div class="checklist-section">
                            <h4>Eventstats &amp; Streamstats</h4>
                            <ul>
                                <li><input type="checkbox"> Streamstats has window parameter when possible</li>
                                <li><input type="checkbox"> Eventstats placement optimized (after filtering)</li>
                                <li><input type="checkbox"> Not confusing eventstats global vs streamstats running</li>
                                <li><input type="checkbox"> Reset_on_change used for streamstats when grouping</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: When would you use transaction vs stats?</button>
                        <div class="qa-answer">
                            <p><strong>Use transaction when:</strong></p>
                            <ul>
                                <li>You need to see the actual events grouped together</li>
                                <li>Events have start/end conditions (login/logout)</li>
                                <li>You need duration between first and last event</li>
                                <li>Order of events matters</li>
                            </ul>
                            <p><strong>Use stats when:</strong></p>
                            <ul>
                                <li>You only need aggregated values (counts, sums)</li>
                                <li>Performance is critical (stats is faster)</li>
                                <li>You don't need to see individual events</li>
                            </ul>
                            <p><strong>Example:</strong> Use transaction to trace a user's session; use stats to count failed logins per user.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between eventstats and streamstats?</button>
                        <div class="qa-answer">
                            <p><strong>eventstats:</strong></p>
                            <ul>
                                <li>Calculates statistics across ALL events in results</li>
                                <li>Adds the same calculated value to every event</li>
                                <li>Good for: comparing each event to total, calculating percentages</li>
                            </ul>
                            <p><strong>streamstats:</strong></p>
                            <ul>
                                <li>Calculates running statistics as it processes events</li>
                                <li>Each event gets statistics based on events before it</li>
                                <li>Supports time windows and event windows</li>
                                <li>Good for: running totals, detecting velocity changes, anomaly detection</li>
                            </ul>
                            <div class="arch-diagram">// eventstats: same total on all rows
| eventstats count as total

// streamstats: cumulative count
| streamstats count as running_total</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you optimize a slow search that uses subsearch?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Use return command:</strong> <code>| return 100 field</code> is more efficient than <code>| fields field</code></li>
                                <li><strong>Limit subsearch scope:</strong> Add time ranges and filters to subsearch</li>
                                <li><strong>Consider join:</strong> For larger datasets, join can be more efficient</li>
                                <li><strong>Use lookups:</strong> If subsearch data is static, save as lookup</li>
                                <li><strong>Increase limits:</strong> <code>maxout</code>, <code>maxtime</code> in limits.conf</li>
                            </ol>
                            <div class="arch-diagram">// Slow
src_ip IN [search index=threat_intel | fields ip]

// Better
src_ip IN [search index=threat_intel | return 1000 ip]

// Best (for static data)
| lookup threat_intel.csv ip as src_ip OUTPUT threat_type</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain how you would detect brute force attacks using intermediate SPL</button>
                        <div class="qa-answer">
                            <p><strong>Approach:</strong> Use stats for counting, then threshold filtering.</p>
                            <div class="arch-diagram">index=windows sourcetype=WinEventLog:Security EventCode=4625
| bin _time span=5m
| stats count as failed_attempts dc(user) as unique_users by src_ip, _time
| where failed_attempts > 10 OR unique_users > 5
| eventstats sum(failed_attempts) as total_attempts by src_ip
| sort -total_attempts</div>
                            <p><strong>Why this approach:</strong></p>
                            <ul>
                                <li><strong>bin _time:</strong> Groups events into 5-minute windows for rate detection</li>
                                <li><strong>stats count + dc:</strong> Captures both volume (failed_attempts) and breadth (unique_users)</li>
                                <li><strong>eventstats:</strong> Adds running total across all windows for prioritization</li>
                                <li><strong>Two thresholds:</strong> Catches both password spray (many users) and single-user brute force</li>
                            </ul>
                            <p><strong>For interview:</strong> Mention you'd create a lookup for known scanner IPs to exclude, and potentially use streamstats for velocity detection.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you correlate authentication events with network events?</button>
                        <div class="qa-answer">
                            <p><strong>Approach:</strong> Use join or append depending on data volume and relationship type.</p>
                            <div class="arch-diagram">// Method 1: Join (when auth events are smaller dataset)
index=windows EventCode IN (4624, 4625)
| join type=left src_ip 
    [search index=firewall action=blocked 
     | stats count as blocked_count by src_ip]
| where blocked_count > 0

// Method 2: Append + Transaction (for timeline view)
index=windows EventCode IN (4624, 4625) OR index=firewall
| transaction src_ip maxspan=10m
| where eventcount > 1 AND match(_raw, "blocked")

// Method 3: Subsearch (when firewall IPs are filter criteria)
index=windows EventCode=4625
    [search index=firewall action=blocked 
     | stats count by src_ip 
     | where count > 5 
     | return 500 src_ip]</div>
                            <p><strong>Decision factors:</strong></p>
                            <ul>
                                <li><strong>Join:</strong> When you need all auth events enriched with network context</li>
                                <li><strong>Transaction:</strong> When you need to see the sequence/timeline</li>
                                <li><strong>Subsearch:</strong> When network data is just a filter criterion</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What are the subsearch limitations and how do you work around them?</button>
                        <div class="qa-answer">
                            <p><strong>Default Limitations:</strong></p>
                            <ul>
                                <li><strong>maxtime:</strong> 60 seconds (subsearch times out)</li>
                                <li><strong>maxout:</strong> 10,000 results maximum</li>
                                <li><strong>Memory:</strong> Results must fit in search head memory</li>
                            </ul>
                            <p><strong>Workarounds:</strong></p>
                            <div class="arch-diagram">// 1. Use return command (more efficient)
[search index=threat | return 5000 ip]

// 2. Use lookup for static data
| inputlookup threat_intel.csv

// 3. Use summary indexes for large correlations
| tstats count from summary_index where threat_type=* by ip

// 4. Increase limits in limits.conf (requires admin)
[subsearch]
maxout = 50000
maxtime = 300

// 5. Use join instead for large datasets
| join type=left ip [search index=threat | dedup ip]</div>
                            <p><strong>Best practice:</strong> Always validate subsearch returns expected count with <code>| stats count</code> before using in production.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you use streamstats for anomaly detection?</button>
                        <div class="qa-answer">
                            <p><strong>Classic approach:</strong> Calculate rolling baseline and detect deviations.</p>
                            <div class="arch-diagram">// Detect unusual login volume per user
index=windows EventCode=4624
| timechart span=1h count by user
| streamstats window=168 avg(count) as baseline stdev(count) as std by user
| eval zscore = (count - baseline) / std
| where zscore > 3 OR zscore < -3
| fields _time user count baseline zscore

// Detect velocity anomalies (sudden spikes)
index=web_access
| timechart span=5m count as requests by src_ip
| streamstats window=12 avg(requests) as avg_rate by src_ip
| eval spike_ratio = requests / avg_rate
| where spike_ratio > 5</div>
                            <p><strong>Key parameters:</strong></p>
                            <ul>
                                <li><strong>window=168:</strong> 168 hours = 7 days of hourly data for baseline</li>
                                <li><strong>zscore > 3:</strong> Standard statistical threshold for anomaly</li>
                                <li><strong>time_window:</strong> Alternative to event window - uses actual time span</li>
                                <li><strong>reset_on_change=true:</strong> Restart calculation when group field changes</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain automatic vs manual lookups and when to use each</button>
                        <div class="qa-answer">
                            <p><strong>Manual Lookup:</strong> Explicitly called in search</p>
                            <div class="arch-diagram">// Manual lookup - called explicitly
index=firewall 
| lookup geo_ip.csv ip as src_ip OUTPUT country, city

// With outputnew (don't overwrite existing fields)
| lookup asset_inventory.csv ip as dest_ip OUTPUTNEW asset_owner, criticality</div>
                            <p><strong>Automatic Lookup:</strong> Configured in props.conf, applied automatically</p>
                            <div class="arch-diagram">// In props.conf
[source::firewall]
LOOKUP-geo = geo_ip.csv ip as src_ip OUTPUT country city
LOOKUP-asset = asset_inventory.csv ip as dest_ip OUTPUTNEW owner criticality

// Now every search on firewall data automatically has these fields</div>
                            <p><strong>When to use each:</strong></p>
                            <ul>
                                <li><strong>Automatic:</strong> Enrichment needed in 80%+ of searches (asset info, geo-IP)</li>
                                <li><strong>Manual:</strong> Specific use cases, large lookups that would slow all searches</li>
                                <li><strong>Performance tip:</strong> Automatic lookups run at search time - large lookups can slow everything</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk through a complex search you've built using intermediate SPL</button>
                        <div class="qa-answer">
                            <p><strong>Example: Detecting potential data exfiltration</strong></p>
                            <div class="arch-diagram">// Goal: Find users uploading large amounts to unusual destinations
index=proxy action=upload
| bin _time span=1h
| stats sum(bytes) as total_bytes dc(dest) as unique_dests values(dest) as destinations by user, _time
| eventstats avg(total_bytes) as user_avg stdev(total_bytes) as user_std by user
| eval zscore = (total_bytes - user_avg) / user_std
| where zscore > 2 OR unique_dests > 10
| join type=left user 
    [search index=hr_data | fields user, department, termination_date
     | eval is_termed = if(isnotnull(termination_date), 1, 0)]
| where is_termed=1 OR zscore > 3
| sort -total_bytes
| table _time user department total_bytes unique_dests destinations zscore is_termed</div>
                            <p><strong>Explanation of components:</strong></p>
                            <ul>
                                <li><strong>bin + stats:</strong> Aggregate uploads by hour per user</li>
                                <li><strong>eventstats:</strong> Calculate per-user baseline for comparison</li>
                                <li><strong>zscore:</strong> Statistical anomaly detection</li>
                                <li><strong>join with HR data:</strong> Enrich with employment status (insider threat indicator)</li>
                                <li><strong>Compound filtering:</strong> Termed employees OR high-volume anomalies</li>
                            </ul>
                            <p><strong>Production considerations:</strong> Would add lookup for approved cloud destinations, schedule as alert with risk score output for RBA.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle multi-value fields in SPL?</button>
                        <div class="qa-answer">
                            <p><strong>Key commands for multi-value fields:</strong></p>
                            <div class="arch-diagram">// mvexpand - create separate event per value
| mvexpand dest_port
| stats count by dest_port

// mvjoin - combine into single string
| eval ports_string = mvjoin(dest_port, ",")

// mvfind - search within multi-value
| where mvfind(dest_port, "443") >= 0

// mvcount - count values
| eval port_count = mvcount(dest_port)

// mvfilter - filter values within field
| eval high_ports = mvfilter(dest_port > 1024)

// mvdedup - remove duplicates within field  
| eval unique_ports = mvdedup(dest_port)

// mvzip - combine two mv fields
| eval port_proto = mvzip(dest_port, protocol, ":")</div>
                            <p><strong>Common use case:</strong> CIM-normalized data often has multi-value fields. Know when to expand vs keep collapsed.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>