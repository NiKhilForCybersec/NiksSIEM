<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAP Security Monitoring | Splunk SIEM Reference</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                </ul>
            </div>
            
            <!-- Power User Certification -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Power User Certification</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="power-user-certification.html" class="sidebar-nav-link"><i class="fas fa-graduation-cap"></i><span>Certification Guide</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>SPL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-intermediate.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>SPL Intermediate</span></a></li>
                    <li class="sidebar-nav-item"><a href="spl-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>SPL Advanced</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="forwarders.html" class="sidebar-nav-link"><i class="fas fa-paper-plane"></i><span>Forwarders</span></a></li>
                    <li class="sidebar-nav-item"><a href="sap-security.html" class="sidebar-nav-link active"><i class="fas fa-industry"></i><span>SAP Security</span></a></li>
                </ul>
            </div>
            
            <!-- Cloud Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Cloud Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="splunk-cloud.html" class="sidebar-nav-link"><i class="fas fa-cloud"></i><span>Cloud Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="splunk-cloud-mastery.html" class="sidebar-nav-link"><i class="fas fa-cloud-upload-alt"></i><span>Cloud Mastery</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="es-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>Enterprise Security</span></a></li>
                    <li class="sidebar-nav-item"><a href="correlation-searches.html" class="sidebar-nav-link"><i class="fas fa-project-diagram"></i><span>Correlation Searches</span></a></li>
                    <li class="sidebar-nav-item"><a href="retail-security.html" class="sidebar-nav-link"><i class="fas fa-shopping-cart"></i><span>Retail Security</span></a></li>
                </ul>
            </div>
            
            <!-- Operations -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Operations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i><span>Troubleshooting</span></a></li>
                    <li class="sidebar-nav-item"><a href="monitoring-console.html" class="sidebar-nav-link"><i class="fas fa-heartbeat"></i><span>Monitoring Console</span></a></li>
                </ul>
            </div>
                    <!-- Certification Prep -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Certification Prep</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="power-user-certification.html" class="sidebar-nav-link"><i class="fas fa-certificate"></i><span>Power User Cert</span></a></li>
                    <li class="sidebar-nav-item"><a href="admin-certification.html" class="sidebar-nav-link"><i class="fas fa-user-cog"></i><span>Admin Cert</span></a></li>
                    <li class="sidebar-nav-item"><a href="es-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-shield-alt"></i><span>ES Admin Cert</span></a></li>
                    <li class="sidebar-nav-item"><a href="cloud-admin-certification.html" class="sidebar-nav-link"><i class="fas fa-cloud"></i><span>Cloud Admin Cert</span></a></li>
                    <li class="sidebar-nav-item"><a href="lab-exercises.html" class="sidebar-nav-link"><i class="fas fa-flask"></i><span>Lab Exercises</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Splunk</a>
                    <span class="separator">/</span>
                    <span class="current">SAP Security</span>
                </div>

                <h1><i class="fas fa-industry"></i> SAP Security Monitoring - Complete Guide</h1>
                <p class="lead">Enterprise-grade SAP security monitoring with Splunk. Complete coverage of SAP log collection, field extraction, CIM mapping, security detections, and dashboards. Designed for retail enterprises like Sobeys running SAP ERP and S/4HANA.</p>

                <!-- Quick Reference Card -->
                <div class="info-box info-box-primary">
                    <h4><i class="fas fa-bolt"></i> Quick Reference - SAP Security in Splunk</h4>
                    <table class="compact-table">
                        <tr><td><strong>Primary App</strong></td><td>Splunk Connect for SAP (formerly SAP Business Application Analytics)</td></tr>
                        <tr><td><strong>Key Log Types</strong></td><td>Security Audit Log (SM21), System Log, Change Documents, RFC Logs</td></tr>
                        <tr><td><strong>Index Naming</strong></td><td>sap_security, sap_audit, sap_performance, sap_change</td></tr>
                        <tr><td><strong>Sourcetypes</strong></td><td>sap:security:audit, sap:system:log, sap:change:documents, sap:rfc:log</td></tr>
                        <tr><td><strong>CIM Models</strong></td><td>Authentication, Change, Application State</td></tr>
                        <tr><td><strong>Retail Context</strong></td><td>POS integration, inventory management, financial transactions</td></tr>
                    </table>
                </div>

                <!-- Why SAP Security Matters -->
                <h2><i class="fas fa-exclamation-triangle"></i> Why SAP Security Monitoring Matters</h2>
                
                <div class="config-section">
                    <h3>Business Impact for Retail Enterprises</h3>
                    <div class="arch-diagram">
SAP Security Risk Profile for Retail (Sobeys Context)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CRITICAL BUSINESS PROCESSES IN SAP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SOBEYS SAP LANDSCAPE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚   SAP ECC    â”‚    â”‚  SAP S/4HANA â”‚    â”‚   SAP BW     â”‚                 â”‚
â”‚   â”‚   â•â•â•â•â•â•â•â•   â”‚    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â”‚    â”‚   â•â•â•â•â•â•     â”‚                 â”‚
â”‚   â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                 â”‚
â”‚   â”‚ â€¢ Finance    â”‚    â”‚ â€¢ Retail     â”‚    â”‚ â€¢ Analytics  â”‚                 â”‚
â”‚   â”‚ â€¢ MM/SD      â”‚    â”‚ â€¢ Supply     â”‚    â”‚ â€¢ Reporting  â”‚                 â”‚
â”‚   â”‚ â€¢ HR/Payroll â”‚    â”‚   Chain      â”‚    â”‚ â€¢ KPIs       â”‚                 â”‚
â”‚   â”‚ â€¢ Inventory  â”‚    â”‚ â€¢ POS Data   â”‚    â”‚              â”‚                 â”‚
â”‚   â”‚              â”‚    â”‚              â”‚    â”‚              â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚          â”‚                   â”‚                   â”‚                          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                               â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚   INTEGRATION     â”‚                                    â”‚
â”‚                    â”‚   â•â•â•â•â•â•â•â•â•â•â•     â”‚                                    â”‚
â”‚                    â”‚                   â”‚                                    â”‚
â”‚                    â”‚ â€¢ 1,500+ stores   â”‚                                    â”‚
â”‚                    â”‚ â€¢ 10,000+ POS     â”‚                                    â”‚
â”‚                    â”‚ â€¢ Distribution    â”‚                                    â”‚
â”‚                    â”‚   centers         â”‚                                    â”‚
â”‚                    â”‚ â€¢ Supplier portal â”‚                                    â”‚
â”‚                    â”‚                   â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY SECURITY CONCERNS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ”´ CRITICAL RISKS
   â”œâ”€â”€ Financial fraud (AP/AR manipulation, vendor master changes)
   â”œâ”€â”€ Inventory theft (goods receipt/issue manipulation)
   â”œâ”€â”€ Payroll fraud (ghost employees, salary manipulation)
   â”œâ”€â”€ Segregation of duties violations
   â””â”€â”€ Unauthorized access to sensitive transactions

ğŸŸ  HIGH RISKS  
   â”œâ”€â”€ Privileged access abuse (SAP_ALL, SAP_NEW profiles)
   â”œâ”€â”€ Debug/replace authorization misuse
   â”œâ”€â”€ RFC destination compromise
   â”œâ”€â”€ Transport system manipulation
   â””â”€â”€ Audit log tampering

ğŸŸ¡ MEDIUM RISKS
   â”œâ”€â”€ Password policy violations
   â”œâ”€â”€ Excessive failed logons
   â”œâ”€â”€ Dormant account usage
   â”œâ”€â”€ Cross-client access
   â””â”€â”€ Direct table modifications

COMPLIANCE REQUIREMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Regulation         â”‚ SAP Monitoring Requirements                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SOX                â”‚ Change tracking, access reviews, SoD monitoring        â”‚
â”‚ PCI-DSS            â”‚ Cardholder data access, authentication logging         â”‚
â”‚ PIPEDA (Canada)    â”‚ Personal data access, privacy controls                 â”‚
â”‚ Internal Audit     â”‚ Transaction monitoring, exception reporting            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </div>
                </div>

                <!-- SAP Log Types -->
                <h2><i class="fas fa-file-alt"></i> SAP Log Types & Data Sources</h2>
                
                <div class="config-section">
                    <h3>Complete SAP Log Taxonomy</h3>
                    <div class="arch-diagram">
SAP LOG TYPES FOR SECURITY MONITORING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. SECURITY AUDIT LOG (SM20/SM21) - CRITICAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Records security-relevant events
   T-Code: SM20 (analysis), SM21 (display), RSAU_CONFIG (configuration)
   
   Events Captured:
   â”œâ”€â”€ Dialog logon/logoff
   â”œâ”€â”€ RFC/CPIC logon
   â”œâ”€â”€ Transaction starts
   â”œâ”€â”€ Report starts
   â”œâ”€â”€ User master changes
   â”œâ”€â”€ Authorization check failures
   â”œâ”€â”€ File access (read/write/delete)
   â”œâ”€â”€ HTTP requests
   â””â”€â”€ System messages

   Log Location: /usr/sap/<SID>/DVEBMGS<##>/log/audit_*
   
   Sample Event Format:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Date: 20240115 Time: 143022 User: JSMITH Client: 100                   â”‚
   â”‚ Source: DIALOG Terminal: WS001 T-Code: FB60                            â”‚
   â”‚ Event: AU3 (Transaction start) Message: Transaction FB60 started       â”‚
   â”‚ Variables: Company Code=1000, Document Type=KR                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. SYSTEM LOG (SM21) - HIGH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Technical system events and errors
   T-Code: SM21
   
   Events Captured:
   â”œâ”€â”€ System startup/shutdown
   â”œâ”€â”€ Work process status changes
   â”œâ”€â”€ Database errors
   â”œâ”€â”€ Memory issues
   â”œâ”€â”€ Update failures
   â”œâ”€â”€ Lock conflicts
   â””â”€â”€ ABAP runtime errors

   Log Location: /usr/sap/<SID>/DVEBMGS<##>/log/SLOG*

3. CHANGE DOCUMENTS (CDHDR/CDPOS) - CRITICAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Track master data and transaction changes
   Tables: CDHDR (header), CDPOS (positions/details)
   
   Key Object Classes:
   â”œâ”€â”€ KRED - Vendor master
   â”œâ”€â”€ DEBI - Customer master
   â”œâ”€â”€ MATERIAL - Material master
   â”œâ”€â”€ EINKBELEG - Purchase documents
   â”œâ”€â”€ VERKBELEG - Sales documents
   â”œâ”€â”€ FKOM - Chart of accounts
   â””â”€â”€ USER - User master

   Critical Fields:
   â”œâ”€â”€ OBJECTCLAS - Object type
   â”œâ”€â”€ OBJECTID - Object key
   â”œâ”€â”€ CHANGENR - Change number
   â”œâ”€â”€ USERNAME - Who made change
   â”œâ”€â”€ UDATE/UTIME - When
   â”œâ”€â”€ TCODE - Transaction used
   â”œâ”€â”€ FNAME - Field changed
   â”œâ”€â”€ VALUE_OLD - Previous value
   â””â”€â”€ VALUE_NEW - New value

4. USER CHANGE LOGS (USR02/USH02) - HIGH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: User administration changes
   Tables: USR02 (current), USH02 (history)
   
   Tracked Changes:
   â”œâ”€â”€ User creation/deletion
   â”œâ”€â”€ Password changes
   â”œâ”€â”€ Lock/unlock status
   â”œâ”€â”€ Validity period changes
   â”œâ”€â”€ Profile assignments
   â””â”€â”€ Role assignments

5. TABLE ACCESS LOGS (STAD/ST05) - MEDIUM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Direct table access tracking
   T-Codes: ST05 (SQL trace), STAD (statistics)
   
   Critical Tables to Monitor:
   â”œâ”€â”€ PA0008 - Payroll data
   â”œâ”€â”€ BSEG - Accounting document segments
   â”œâ”€â”€ EKKO/EKPO - Purchase orders
   â”œâ”€â”€ VBAK/VBAP - Sales orders
   â”œâ”€â”€ USR02 - User master
   â”œâ”€â”€ AGR_USERS - Role assignments
   â””â”€â”€ T000 - Client table

6. RFC LOGS - HIGH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Remote function call tracking
   T-Code: SMGW (gateway monitor)
   
   Security Relevance:
   â”œâ”€â”€ External system access
   â”œâ”€â”€ Automated processes
   â”œâ”€â”€ Integration points
   â””â”€â”€ Potential lateral movement

   Key Destinations:
   â”œâ”€â”€ Trusted RFC (privileged)
   â”œâ”€â”€ HTTP connections
   â””â”€â”€ Background RFC (bgRFC)

7. WEB DISPATCHER / ICM LOGS - MEDIUM
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: HTTP/HTTPS access logs
   Location: /usr/sap/<SID>/DVEBMGS<##>/work/dev_icm
   
   Log Format: Extended Common Log Format (ECLF)
   Contains: IP, user, timestamp, request, status, bytes, referrer, user-agent

8. TRANSPORT LOGS (STMS) - CRITICAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Purpose: Change management tracking
   T-Code: STMS, SE01
   
   Security Relevance:
   â”œâ”€â”€ Code deployments
   â”œâ”€â”€ Configuration changes
   â”œâ”€â”€ Authorization changes
   â””â”€â”€ Potential backdoor insertion
                    </div>
                </div>

                <!-- Collection Architecture -->
                <h2><i class="fas fa-network-wired"></i> SAP Log Collection Architecture</h2>
                
                <div class="config-section">
                    <h3>Splunk Connect for SAP Architecture</h3>
                    <div class="arch-diagram">
SAP TO SPLUNK COLLECTION ARCHITECTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OPTION 1: SPLUNK CONNECT FOR SAP (RECOMMENDED)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SAP PRODUCTION LANDSCAPE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚  SAP ECC   â”‚     â”‚  SAP BW    â”‚     â”‚ S/4HANA    â”‚                     â”‚
â”‚   â”‚  PRD 100   â”‚     â”‚  PRD 200   â”‚     â”‚  PRD 300   â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                  â”‚                  â”‚                             â”‚
â”‚         â”‚    RFC/BAPI Calls (Port 33##)      â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                            â”‚                                                 â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚                   â”‚  SAP ROUTER     â”‚  (Optional - for secure access)       â”‚
â”‚                   â”‚  Port 3299      â”‚                                       â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                            â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    Firewall â”‚ Port 33## (RFC), 443 (HTTPS)
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPLUNK DATA COLLECTION LAYER                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              SPLUNK CONNECT FOR SAP SERVER                          â”‚   â”‚
â”‚   â”‚              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚ JCo Connector   â”‚   â”‚ Data Extractors â”‚   â”‚ Log Parsers     â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚   â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ RFC calls     â”‚   â”‚ â€¢ Security Log  â”‚   â”‚ â€¢ Time parsing  â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ BAPI access   â”‚   â”‚ â€¢ Change Docs   â”‚   â”‚ â€¢ Field extract â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ Table reads   â”‚   â”‚ â€¢ User logs     â”‚   â”‚ â€¢ CIM mapping   â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â€¢ Function      â”‚   â”‚ â€¢ Transport     â”‚   â”‚ â€¢ Enrichment    â”‚  â”‚   â”‚
â”‚   â”‚   â”‚   modules       â”‚   â”‚ â€¢ Custom tables â”‚   â”‚                 â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚                 â”‚  â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Configuration: $SPLUNK_HOME/etc/apps/splunk_connect_for_sap/     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â”‚ HEC (Port 8088) or S2S (Port 9997)     â”‚
â”‚                                    â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    SPLUNK INDEXERS / CLOUD                          â”‚   â”‚
â”‚   â”‚                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                          â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Indexes:                                                          â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sap_security    (Security Audit Log, auth events)            â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sap_audit       (Change documents, user changes)             â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sap_system      (System log, technical events)               â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ sap_performance (STAD, workload stats)                       â”‚   â”‚
â”‚   â”‚   â””â”€â”€ sap_transport   (Transport logs, code changes)               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


OPTION 2: FILE-BASED COLLECTION (LEGACY/FALLBACK)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SAP APPLICATION SERVER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Log Directories:                                                           â”‚
â”‚   â”œâ”€â”€ /usr/sap/<SID>/DVEBMGS<##>/log/audit_*    (Security Audit Log)       â”‚
â”‚   â”œâ”€â”€ /usr/sap/<SID>/DVEBMGS<##>/log/SLOG*      (System Log)               â”‚
â”‚   â”œâ”€â”€ /usr/sap/<SID>/DVEBMGS<##>/work/dev_icm   (ICM/Web Dispatcher)       â”‚
â”‚   â””â”€â”€ /usr/sap/<SID>/<INST>/work/trans_log      (Transport logs)           â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚              SPLUNK UNIVERSAL FORWARDER                             â”‚   â”‚
â”‚   â”‚              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   inputs.conf:                                                      â”‚   â”‚
â”‚   â”‚   [monitor:///usr/sap/PRD/DVEBMGS00/log/audit_*]                   â”‚   â”‚
â”‚   â”‚   sourcetype = sap:security:audit                                   â”‚   â”‚
â”‚   â”‚   index = sap_security                                              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   [monitor:///usr/sap/PRD/DVEBMGS00/log/SLOG*]                     â”‚   â”‚
â”‚   â”‚   sourcetype = sap:system:log                                       â”‚   â”‚
â”‚   â”‚   index = sap_system                                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   âš ï¸ FILE-BASED LIMITATIONS:
   â€¢ No real-time table data extraction (CDHDR, USR02, etc.)
   â€¢ Requires filesystem access on SAP server
   â€¢ May miss events if logs rotate before collection
   â€¢ Cannot extract data from SAP tables directly


OPTION 3: DATABASE EXTRACTION (SUPPLEMENTAL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

   For historical data or specific tables not covered by Connect for SAP:
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ DB Connect or Custom Scripts â†’ HANA/Oracle/SQL Server                   â”‚
   â”‚                                                                          â”‚
   â”‚ Example: Extract change documents                                        â”‚
   â”‚ SELECT * FROM CDHDR h                                                    â”‚
   â”‚ INNER JOIN CDPOS p ON h.CHANGENR = p.CHANGENR                           â”‚
   â”‚ WHERE h.UDATE >= '20240101'                                              â”‚
   â”‚ AND h.OBJECTCLAS IN ('KRED', 'DEBI', 'MATERIAL')                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </div>
                </div>

                <!-- Splunk Connect for SAP Setup -->
                <h2><i class="fas fa-cogs"></i> Splunk Connect for SAP Configuration</h2>
                
                <div class="config-section">
                    <h3>Installation & Configuration</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Step 1: Prerequisites</span>
                            <span class="config-location">SAP Basis & Splunk Admin Tasks</span>
                        </div>
                        <pre><code># SAP PREREQUISITES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Create RFC User in SAP (SE80 or SU01)
User ID: SPLUNK_RFC
User Type: System (B)
Password: [Strong password - store in Splunk credential store]

# 2. Assign Required Authorizations
# Create role Z_SPLUNK_EXTRACT with:
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Object                  Field           Values
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# S_RFC                   RFC_TYPE        FUGR (Function Group)
#                         RFC_NAME        SYST, SDIFRUNTIME, RFC1, RSAU*, SWNC*
#                         ACTVT           16 (Execute)
#
# S_TABU_DIS              DICBERCLS       *  (All table classes - restrict in prod)
#                         ACTVT           03 (Display)
#
# S_DATASET               FILENAME        *  (Or specific paths)
#                         PROGRAM         *
#                         ACTVT           33 (Read)
#
# S_ADMI_FCD              S_ADMI_FCD      AUDA (Read audit log)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# 3. Enable Security Audit Log (if not already)
# Transaction: RSAU_CONFIG (or SM19 in older systems)
# - Enable audit log
# - Configure filters for relevant events
# - Set log retention (recommend 90+ days)

# 4. Network Requirements
# - Port 33## (RFC) from Splunk server to SAP
# - Port 8088 (HEC) or 9997 (S2S) from SAP network to Splunk
# - SAP Router if required by security policy</code></pre>
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Step 2: Install Splunk Connect for SAP</span>
                            <span class="config-location">Heavy Forwarder or Dedicated Server</span>
                        </div>
                        <pre><code># INSTALLATION ON DEDICATED DATA COLLECTION SERVER
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Download from Splunkbase
# https://splunkbase.splunk.com/app/3812/
# App: Splunk Connect for SAP

# 2. Install on Heavy Forwarder (recommended) or Search Head
$SPLUNK_HOME/bin/splunk install app splunk_connect_for_sap.tgz -auth admin:password

# 3. Install SAP Java Connector (JCo)
# Download from SAP Service Marketplace (requires SAP S-user)
# Files needed:
# - sapjco3.jar
# - libsapjco3.so (Linux) or sapjco3.dll (Windows)

# Linux installation:
cp sapjco3.jar $SPLUNK_HOME/etc/apps/splunk_connect_for_sap/java-lib/
cp libsapjco3.so $SPLUNK_HOME/lib/

# Set library path
export LD_LIBRARY_PATH=$SPLUNK_HOME/lib:$LD_LIBRARY_PATH

# 4. Configure Java (if not default)
# Edit: $SPLUNK_HOME/etc/apps/splunk_connect_for_sap/local/java.conf
[settings]
java_home = /usr/lib/jvm/java-11-openjdk-amd64

# 5. Restart Splunk
$SPLUNK_HOME/bin/splunk restart</code></pre>
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Step 3: Configure SAP Connection</span>
                            <span class="config-location">$SPLUNK_HOME/etc/apps/splunk_connect_for_sap/local/</span>
                        </div>
                        <pre><code># sap_connections.conf - SAP System Connections
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[sap_prd_ecc]
# Connection to SAP ECC Production
jco_ashost = sapprd01.sobeys.local
jco_sysnr = 00
jco_client = 100
jco_user = SPLUNK_RFC
jco_passwd = $7$encrypted_password_here
jco_lang = EN
jco_pool_capacity = 10
jco_peak_limit = 20

[sap_prd_s4]
# Connection to S/4HANA Production
jco_ashost = s4prd01.sobeys.local
jco_sysnr = 00
jco_client = 100
jco_user = SPLUNK_RFC
jco_passwd = $7$encrypted_password_here
jco_lang = EN
jco_pool_capacity = 10
jco_peak_limit = 20

[sap_bw]
# Connection to SAP BW
jco_mshost = sapbwprd.sobeys.local
jco_r3name = BWP
jco_group = PUBLIC
jco_client = 100
jco_user = SPLUNK_RFC
jco_passwd = $7$encrypted_password_here

# Note: Use Splunk credential store for passwords in production
# $SPLUNK_HOME/bin/splunk add credentials -username SPLUNK_RFC -password xxxxx</code></pre>
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Step 4: Configure Data Inputs</span>
                            <span class="config-location">inputs.conf</span>
                        </div>
                        <pre><code># inputs.conf - SAP Data Collection Inputs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SECURITY AUDIT LOG
[sap_security_audit://sap_prd_ecc]
connection = sap_prd_ecc
interval = 300
index = sap_security
sourcetype = sap:security:audit
disabled = 0

[sap_security_audit://sap_prd_s4]
connection = sap_prd_s4
interval = 300
index = sap_security
sourcetype = sap:security:audit
disabled = 0

# CHANGE DOCUMENTS
[sap_change_documents://sap_prd_ecc]
connection = sap_prd_ecc
interval = 600
index = sap_audit
sourcetype = sap:change:documents
# Object classes to monitor
object_classes = KRED,DEBI,MATERIAL,EINKBELEG,VERKBELEG,FKOM,USER,BANF
disabled = 0

# USER CHANGES
[sap_user_changes://sap_prd_ecc]
connection = sap_prd_ecc
interval = 300
index = sap_audit
sourcetype = sap:user:changes
disabled = 0

# SYSTEM LOG
[sap_system_log://sap_prd_ecc]
connection = sap_prd_ecc
interval = 300
index = sap_system
sourcetype = sap:system:log
disabled = 0

# WORKLOAD STATISTICS (STAD)
[sap_workload://sap_prd_ecc]
connection = sap_prd_ecc
interval = 900
index = sap_performance
sourcetype = sap:workload:stats
disabled = 0

# RFC LOGS
[sap_rfc_log://sap_prd_ecc]
connection = sap_prd_ecc
interval = 600
index = sap_security
sourcetype = sap:rfc:log
disabled = 0</code></pre>
                    </div>
                </div>

                <!-- Index Configuration -->
                <h2><i class="fas fa-database"></i> Index & Sourcetype Design</h2>
                
                <div class="config-section">
                    <h3>SAP Index Strategy for Retail Enterprise</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">indexes.conf - SAP Indexes</span>
                            <span class="config-location">Splunk Enterprise/Cloud</span>
                        </div>
                        <pre><code># indexes.conf - SAP Index Configuration
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# SECURITY INDEX - Authentication, authorization, security events
[sap_security]
homePath   = $SPLUNK_DB/sap_security/db
coldPath   = $SPLUNK_DB/sap_security/colddb
thawedPath = $SPLUNK_DB/sap_security/thaweddb
frozenTimePeriodInSecs = 31536000  # 365 days for compliance
maxTotalDataSizeMB = 500000        # 500 GB

# AUDIT INDEX - Change documents, user master changes
[sap_audit]
homePath   = $SPLUNK_DB/sap_audit/db
coldPath   = $SPLUNK_DB/sap_audit/colddb
thawedPath = $SPLUNK_DB/sap_audit/thaweddb
frozenTimePeriodInSecs = 94608000  # 3 years for SOX compliance
maxTotalDataSizeMB = 1000000       # 1 TB

# SYSTEM INDEX - Technical logs, errors
[sap_system]
homePath   = $SPLUNK_DB/sap_system/db
coldPath   = $SPLUNK_DB/sap_system/colddb
thawedPath = $SPLUNK_DB/sap_system/thaweddb
frozenTimePeriodInSecs = 7776000   # 90 days
maxTotalDataSizeMB = 200000        # 200 GB

# PERFORMANCE INDEX - Workload, response times
[sap_performance]
homePath   = $SPLUNK_DB/sap_performance/db
coldPath   = $SPLUNK_DB/sap_performance/colddb
thawedPath = $SPLUNK_DB/sap_performance/thaweddb
frozenTimePeriodInSecs = 2592000   # 30 days
maxTotalDataSizeMB = 100000        # 100 GB

# TRANSPORT INDEX - Code changes, deployments
[sap_transport]
homePath   = $SPLUNK_DB/sap_transport/db
coldPath   = $SPLUNK_DB/sap_transport/colddb
thawedPath = $SPLUNK_DB/sap_transport/thaweddb
frozenTimePeriodInSecs = 31536000  # 365 days
maxTotalDataSizeMB = 50000         # 50 GB

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# VOLUME ESTIMATES FOR SOBEYS (1,500 stores, 10,000 POS terminals)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# sap_security:    ~5 GB/day  (High volume from auth events)
# sap_audit:       ~2 GB/day  (Change documents)
# sap_system:      ~1 GB/day  (System logs)
# sap_performance: ~500 MB/day
# sap_transport:   ~100 MB/day
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Total:           ~8.6 GB/day â†’ ~3.1 TB/year (security index)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</code></pre>
                    </div>
                </div>

                <!-- Field Extractions -->
                <h2><i class="fas fa-cut"></i> Field Extractions for SAP Logs</h2>
                
                <div class="config-section">
                    <h3>props.conf - SAP Field Extractions</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">props.conf - Security Audit Log Extractions</span>
                            <span class="config-location">TA_SAP_security/local/props.conf</span>
                        </div>
                        <pre><code># props.conf - SAP Security Audit Log Field Extractions
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[sap:security:audit]
# Time extraction
TIME_FORMAT = %Y%m%d%H%M%S
TIME_PREFIX = Date:\s*
MAX_TIMESTAMP_LOOKAHEAD = 20

# Line breaking
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)Date:

# Key field extractions
EXTRACT-sap_user = User:\s+(?<user>\S+)
EXTRACT-sap_client = Client:\s+(?<sap_client>\d{3})
EXTRACT-sap_tcode = T-Code:\s+(?<transaction_code>\S+)
EXTRACT-sap_terminal = Terminal:\s+(?<terminal>\S+)
EXTRACT-sap_event_id = Event:\s+(?<event_id>\w+)
EXTRACT-sap_event_class = \((?<event_class>[^)]+)\)
EXTRACT-sap_message = Message:\s+(?<message>.+?)(?=Variables:|$)
EXTRACT-sap_source = Source:\s+(?<source_type>\S+)

# SAP-specific event mapping
LOOKUP-sap_event_codes = sap_event_codes event_id OUTPUT event_description, severity, event_category

# CIM field aliases for Authentication data model
FIELDALIAS-user = user AS src_user
FIELDALIAS-app = transaction_code AS app
FIELDALIAS-action = event_class AS action

# Event type tagging
EVAL-vendor = "SAP"
EVAL-product = "SAP ERP"


[sap:change:documents]
# Change document extraction
TIME_FORMAT = %Y%m%d%H%M%S
TIME_PREFIX = UDATE:\s*

EXTRACT-sap_change_object = OBJECTCLAS:\s*(?<object_class>\S+)
EXTRACT-sap_change_objectid = OBJECTID:\s*(?<object_id>\S+)
EXTRACT-sap_change_user = USERNAME:\s*(?<user>\S+)
EXTRACT-sap_change_tcode = TCODE:\s*(?<transaction_code>\S+)
EXTRACT-sap_change_field = FNAME:\s*(?<field_name>\S+)
EXTRACT-sap_old_value = VALUE_OLD:\s*(?<old_value>[^|]+)
EXTRACT-sap_new_value = VALUE_NEW:\s*(?<new_value>[^|]+)

# CIM mapping for Change data model
FIELDALIAS-object_category = object_class AS object_category
FIELDALIAS-object = object_id AS object
FIELDALIAS-change_type = field_name AS change_type

EVAL-vendor = "SAP"
EVAL-action = "modified"


[sap:user:changes]
# User master changes
TIME_FORMAT = %Y%m%d%H%M%S

EXTRACT-sap_changed_user = BNAME:\s*(?<changed_user>\S+)
EXTRACT-sap_change_type = USTYP:\s*(?<user_type>\S+)
EXTRACT-sap_lock_status = UFLAG:\s*(?<lock_status>\d+)
EXTRACT-sap_valid_from = GLTGV:\s*(?<valid_from>\d+)
EXTRACT-sap_valid_to = GLTGB:\s*(?<valid_to>\d+)
EXTRACT-sap_last_logon = TRDAT:\s*(?<last_logon>\d+)

# Lock status interpretation
EVAL-account_status = case(lock_status=0, "active", lock_status=32, "locked_by_admin", lock_status=64, "locked_incorrect_logons", lock_status=128, "locked_global", true(), "unknown")


[sap:rfc:log]
# RFC log extraction
TIME_FORMAT = %Y%m%d%H%M%S

EXTRACT-rfc_user = User:\s*(?<user>\S+)
EXTRACT-rfc_destination = Destination:\s*(?<rfc_destination>\S+)
EXTRACT-rfc_function = Function:\s*(?<function_name>\S+)
EXTRACT-rfc_source_system = Source:\s*(?<source_system>\S+)
EXTRACT-rfc_status = Status:\s*(?<status>\S+)

# Trusted RFC detection (security risk)
EVAL-is_trusted_rfc = if(match(rfc_destination, "TRUSTED"), "yes", "no")</code></pre>
                    </div>
                </div>

                <!-- SAP Event Codes Lookup -->
                <div class="config-section">
                    <h3>SAP Event Codes Lookup Table</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">sap_event_codes.csv</span>
                            <span class="config-location">lookups/</span>
                        </div>
                        <pre><code>event_id,event_description,severity,event_category
AU0,Successful dialog logon,informational,authentication
AU1,Unsuccessful dialog logon,high,authentication
AU2,Successful RFC logon,informational,authentication
AU3,Transaction started,informational,authorization
AU4,Transaction started (RFC),informational,authorization
AU5,Report started,informational,authorization
AU6,ABAP program started,informational,authorization
AU7,Remote function call started,low,authorization
AU8,Successful logon via HTTP,informational,authentication
AU9,Unsuccessful logon via HTTP,high,authentication
AUA,Authorization check failed,high,authorization
AUB,Successful CPIC logon,informational,authentication
AUC,Unsuccessful CPIC logon,high,authentication
AUD,User master record changed,high,audit
AUE,User locked due to failed logons,critical,authentication
AUF,User unlocked,high,audit
AUG,Generic table access,medium,audit
AUH,Download of table data,high,audit
AUI,Change to system parameter,critical,audit
AUJ,File access,medium,audit
AUK,Successful password change,informational,authentication
AUL,Failed password change,medium,authentication
AUM,Debugging/replacing,critical,audit
AUN,Switch user session (SU01),critical,audit
AUO,Deletion of audit log,critical,audit
AUP,Print spool sensitive data,medium,audit
AUQ,ICF handler called,low,authorization
AUR,User logoff,informational,authentication
AUS,Start of system audit,informational,system
AUT,Change of audit config,critical,audit
AUU,RFC destination changed,critical,audit
AUV,Downloaded file,medium,audit
AUW,Uploaded file,medium,audit
AUX,Authority check for S_RFC,medium,authorization
AUY,Trusted system accessed,high,authorization
AUZ,Transport released,high,audit
BU1,Background job started,informational,authorization
BU2,Background job failed,medium,system
CU1,Object changed in customizing,high,audit
CU2,Table entry changed,high,audit
DU1,Debug with change option,critical,audit
DU2,Replace in debugger,critical,audit
EU1,Critical PFCG change,high,audit
EU2,Role assignment changed,high,audit</code></pre>
                    </div>
                </div>

                <!-- CIM Mapping -->
                <h2><i class="fas fa-map"></i> CIM Mapping for SAP</h2>
                
                <div class="config-section">
                    <h3>SAP to CIM Data Model Mapping</h3>
                    <div class="arch-diagram">
SAP TO CIM DATA MODEL MAPPING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

AUTHENTICATION DATA MODEL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAP Field               â†’ CIM Field              Mapping Logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
user                    â†’ user                   Direct
sap_client              â†’ app                    "SAP_" + client
terminal                â†’ src                    Direct
event_id                â†’ action                 AU0="success", AU1="failure"
transaction_code        â†’ dest_app               Direct
-                       â†’ vendor                 "SAP"
-                       â†’ product                "SAP ERP"
event_class             â†’ authentication_method  DIALOG, RFC, HTTP
-                       â†’ tag                    authentication

Example SPL:
| eval action=case(event_id="AU0", "success", event_id="AU1", "failure", 
                   event_id="AU2", "success", event_id="AU9", "failure",
                   event_id="AUE", "lockout", true(), "unknown")

CHANGE DATA MODEL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAP Field               â†’ CIM Field              Mapping Logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
object_class            â†’ object_category        KRED="vendor", DEBI="customer"
object_id               â†’ object_id              Direct
user                    â†’ user                   Direct (USERNAME)
field_name              â†’ object_attrs           Array of changed fields
old_value               â†’ object_attrs.old_value 
new_value               â†’ object_attrs.new_value
transaction_code        â†’ command                Direct
-                       â†’ action                 "modified"
-                       â†’ change_type            Based on object_class
-                       â†’ tag                    change

Example SPL:
| eval object_category=case(object_class="KRED", "vendor_master",
                            object_class="DEBI", "customer_master",
                            object_class="MATERIAL", "material_master",
                            object_class="USER", "user_master",
                            true(), object_class)

APPLICATION STATE DATA MODEL (for system health)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAP Field               â†’ CIM Field              Mapping Logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
system_id               â†’ dest                   SID
instance                â†’ dest_port              Instance number
status                  â†’ status                 UP, DOWN, ERROR
response_time           â†’ response_time          In milliseconds
error_count             â†’ severity               Based on count
-                       â†’ app                    "SAP"
-                       â†’ tag                    application_state

ENDPOINT DATA MODEL (for workload/access)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SAP Field               â†’ CIM Field              Mapping Logic
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
user                    â†’ user                   Direct
transaction_code        â†’ process                Direct
terminal                â†’ src                    Direct
response_time_ms        â†’ process_exec_time      In milliseconds
cpu_time                â†’ process_cpu_time       In milliseconds
db_time                 â†’ -                      Custom field
-                       â†’ tag                    process
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">tags.conf - SAP CIM Tags</span>
                            <span class="config-location">TA_SAP_security/local/tags.conf</span>
                        </div>
                        <pre><code># tags.conf - SAP CIM Tagging
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Authentication tags
[eventtype=sap_authentication_success]
authentication = enabled
default = enabled

[eventtype=sap_authentication_failure]
authentication = enabled
default = enabled

# Change tags
[eventtype=sap_change_document]
change = enabled
audit = enabled

# Alert tags
[eventtype=sap_security_alert]
alert = enabled</code></pre>
                    </div>

                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">eventtypes.conf - SAP Event Types</span>
                            <span class="config-location">TA_SAP_security/local/eventtypes.conf</span>
                        </div>
                        <pre><code># eventtypes.conf - SAP Event Types for CIM
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[sap_authentication_success]
search = sourcetype=sap:security:audit event_id IN ("AU0", "AU2", "AU8", "AUB")

[sap_authentication_failure]
search = sourcetype=sap:security:audit event_id IN ("AU1", "AU9", "AUC")

[sap_authentication_lockout]
search = sourcetype=sap:security:audit event_id="AUE"

[sap_change_document]
search = sourcetype=sap:change:documents

[sap_user_change]
search = sourcetype=sap:user:changes

[sap_critical_tcode]
search = sourcetype=sap:security:audit transaction_code IN ("SE16", "SE38", "SU01", "PFCG", "STMS", "SM21")

[sap_debug_replace]
search = sourcetype=sap:security:audit event_id IN ("AUM", "DU1", "DU2")

[sap_security_alert]
search = sourcetype=sap:security:audit (event_id IN ("AUA", "AUE", "AUM", "AUN", "DU1", "DU2") OR severity="critical")</code></pre>
                    </div>
                </div>

                <!-- SAP Security Detections -->
                <h2><i class="fas fa-crosshairs"></i> SAP Security Detections</h2>
                
                <div class="config-section">
                    <h3>Critical SAP Security Detection Rules</h3>
                    
                    <div class="detection-card">
                        <div class="detection-header critical">
                            <span class="detection-name">SAP-001: Debug/Replace Mode Usage</span>
                            <span class="detection-severity">CRITICAL</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects when users enable debug mode with replace capability, allowing direct memory/data manipulation. This is one of the most dangerous SAP authorizations.</p>
                            <p><strong>MITRE ATT&CK:</strong> T1098 - Account Manipulation, T1565 - Data Manipulation</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit 
    (event_id IN ("AUM", "DU1", "DU2") OR message="*debug*replace*")
| stats count as debug_count 
    values(transaction_code) as tcodes 
    earliest(_time) as first_seen 
    latest(_time) as last_seen 
    by user, sap_client
| where debug_count > 0
| eval risk_score = 90
| eval description = "User " . user . " used debug/replace " . debug_count . " times"
| table _time, user, sap_client, debug_count, tcodes, description, risk_score</code></pre>
                            </div>
                            <p><strong>Response:</strong> Immediate investigation required. Debug/replace should rarely be used in production. Verify business justification with SAP Basis team.</p>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header critical">
                            <span class="detection-name">SAP-002: SAP_ALL Profile Assignment</span>
                            <span class="detection-severity">CRITICAL</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects assignment of SAP_ALL or SAP_NEW profiles, which grant unrestricted access to all SAP functions.</p>
                            <p><strong>MITRE ATT&CK:</strong> T1078.002 - Valid Accounts: Domain Accounts</p>
                            <div class="config-block">
                                <pre><code>index=sap_audit sourcetype=sap:change:documents 
    object_class="USER" 
    field_name IN ("AGR_NAME", "PROFILE")
    new_value IN ("SAP_ALL", "SAP_NEW", "*ALL*")
| stats count as assignment_count 
    values(user) as changed_by 
    values(object_id) as affected_users 
    by _time, sap_client
| eval risk_score = 95
| eval description = "SAP_ALL/SAP_NEW profile assigned to users: " . affected_users</code></pre>
                            </div>
                            <p><strong>Sobeys Context:</strong> Should never occur in production. Emergency access should use firefighter IDs with GRC monitoring.</p>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header high">
                            <span class="detection-name">SAP-003: Sensitive T-Code Execution by Non-Basis User</span>
                            <span class="detection-severity">HIGH</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects execution of sensitive transactions by users not in the Basis or Security team.</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit event_id="AU3"
    transaction_code IN ("SE16", "SE16N", "SE38", "SA38", "SM30", "SM31", 
                         "SU01", "SU10", "PFCG", "SUIM", "STMS", "SE01",
                         "SCC4", "SCC5", "SM59", "RSAU_CONFIG")
| lookup sap_basis_users user OUTPUT is_basis_user
| where is_basis_user != "yes"
| stats count as exec_count 
    values(transaction_code) as tcodes 
    dc(transaction_code) as unique_tcodes
    by user, sap_client
| where exec_count > 5
| eval risk_score = case(unique_tcodes > 3, 80, unique_tcodes > 1, 70, true(), 60)
| eval description = user . " executed " . exec_count . " sensitive transactions: " . tcodes</code></pre>
                            </div>
                            <p><strong>Tuning:</strong> Create sap_basis_users.csv lookup with authorized personnel. Adjust threshold based on environment.</p>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header high">
                            <span class="detection-name">SAP-004: Vendor Master Bank Account Change</span>
                            <span class="detection-severity">HIGH</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects changes to vendor bank account details, a common target for BEC-style fraud.</p>
                            <p><strong>MITRE ATT&CK:</strong> T1565.001 - Data Manipulation: Stored Data Manipulation</p>
                            <div class="config-block">
                                <pre><code>index=sap_audit sourcetype=sap:change:documents 
    object_class="KRED" 
    field_name IN ("BANKN", "BANKL", "BANKS", "BKONT", "IBAN")
| stats count as change_count
    values(field_name) as fields_changed
    values(old_value) as old_values
    values(new_value) as new_values
    by user, object_id, _time, sap_client
| eval vendor_id = object_id
| lookup sap_vendor_master vendor_id OUTPUT vendor_name, payment_amount_30d
| eval risk_score = case(
    payment_amount_30d > 1000000, 90,
    payment_amount_30d > 100000, 80,
    true(), 70
)
| eval description = "Vendor " . vendor_name . " (" . vendor_id . ") bank details changed by " . user</code></pre>
                            </div>
                            <p><strong>Sobeys Context:</strong> Monitor high-value vendors (food suppliers, distribution partners). Cross-reference with recent payment runs.</p>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header high">
                            <span class="detection-name">SAP-005: RFC Destination Modification</span>
                            <span class="detection-severity">HIGH</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects changes to RFC destinations which could enable lateral movement or data exfiltration.</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit event_id="AUU"
| eval rfc_change_type = case(
    match(message, "created"), "created",
    match(message, "deleted"), "deleted",
    match(message, "changed"), "modified",
    true(), "unknown"
)
| stats count by user, rfc_destination, rfc_change_type, _time
| eval risk_score = case(
    rfc_change_type="created", 85,
    rfc_change_type="modified", 75,
    rfc_change_type="deleted", 70,
    true(), 60
)
| eval description = "RFC destination " . rfc_destination . " " . rfc_change_type . " by " . user</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header high">
                            <span class="detection-name">SAP-006: Multiple Failed Logons Followed by Success</span>
                            <span class="detection-severity">HIGH</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects potential brute force or credential stuffing attacks.</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit event_id IN ("AU0", "AU1")
| eval is_success = if(event_id="AU0", 1, 0)
| eval is_failure = if(event_id="AU1", 1, 0)
| bin _time span=10m
| stats sum(is_failure) as failures, sum(is_success) as successes, 
        values(terminal) as source_terminals
    by user, _time
| where failures >= 5 AND successes >= 1
| eval risk_score = case(
    failures >= 20, 90,
    failures >= 10, 80,
    failures >= 5, 70,
    true(), 60
)
| eval description = user . " had " . failures . " failed logons followed by " . successes . " success"</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header medium">
                            <span class="detection-name">SAP-007: Direct Table Access (SE16/SE16N)</span>
                            <span class="detection-severity">MEDIUM</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects direct table browsing which could indicate data exploration or exfiltration attempts.</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit 
    transaction_code IN ("SE16", "SE16N", "SE17", "SM30", "SM31")
| rex field=message "Table[:\s]+(?&lt;table_name&gt;[\w]+)"
| lookup sap_sensitive_tables table_name OUTPUT sensitivity_level, data_category
| where sensitivity_level IN ("critical", "high")
| stats count as access_count 
    values(table_name) as tables_accessed 
    dc(table_name) as unique_tables
    by user, sap_client, _time
| eval risk_score = case(
    unique_tables > 5, 75,
    unique_tables > 2, 65,
    true(), 55
)
| eval description = user . " accessed " . unique_tables . " sensitive tables: " . tables_accessed</code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="detection-card">
                        <div class="detection-header medium">
                            <span class="detection-name">SAP-008: After-Hours SAP Activity</span>
                            <span class="detection-severity">MEDIUM</span>
                        </div>
                        <div class="detection-body">
                            <p><strong>Description:</strong> Detects SAP interactive logons outside normal business hours.</p>
                            <div class="config-block">
                                <pre><code>index=sap_security sourcetype=sap:security:audit event_id="AU0" source_type="DIALOG"
| eval hour = strftime(_time, "%H")
| eval day = strftime(_time, "%A")
| eval is_after_hours = case(
    day IN ("Saturday", "Sunday"), 1,
    hour < 6 OR hour > 20, 1,
    true(), 0
)
| where is_after_hours = 1
| lookup sap_service_accounts user OUTPUT is_service_account
| where is_service_account != "yes"
| stats count as logon_count 
    values(transaction_code) as tcodes 
    earliest(_time) as first_activity
    latest(_time) as last_activity
    by user, day, sap_client
| eval risk_score = case(
    day IN ("Saturday", "Sunday"), 65,
    true(), 55
)
| eval description = user . " logged in during " . day . " with " . logon_count . " sessions"</code></pre>
                            </div>
                            <p><strong>Sobeys Context:</strong> Adjust for retail hours - stores operate extended hours. Focus on back-office SAP access.</p>
                        </div>
                    </div>
                </div>

                <!-- SAP Dashboard -->
                <h2><i class="fas fa-chart-line"></i> SAP Security Dashboard</h2>
                
                <div class="config-section">
                    <h3>Executive SAP Security Dashboard</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">sap_security_dashboard.xml</span>
                            <span class="config-location">Dashboard XML</span>
                        </div>
                        <pre><code>&lt;dashboard version="1.1"&gt;
  &lt;label&gt;SAP Security Operations - Sobeys&lt;/label&gt;
  &lt;description&gt;Real-time SAP security monitoring for retail enterprise&lt;/description&gt;
  
  &lt;!-- Row 1: Key Metrics --&gt;
  &lt;row&gt;
    &lt;panel&gt;
      &lt;title&gt;Total SAP Logons (24h)&lt;/title&gt;
      &lt;single&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit event_id="AU0" earliest=-24h
| stats count
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="colorMode"&gt;none&lt;/option&gt;
        &lt;option name="drilldown"&gt;all&lt;/option&gt;
      &lt;/single&gt;
    &lt;/panel&gt;
    &lt;panel&gt;
      &lt;title&gt;Failed Logons (24h)&lt;/title&gt;
      &lt;single&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit event_id="AU1" earliest=-24h
| stats count
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="colorMode"&gt;block&lt;/option&gt;
        &lt;option name="rangeColors"&gt;["0x53a051","0xf8be34","0xdc4e41"]&lt;/option&gt;
        &lt;option name="rangeValues"&gt;[50,100]&lt;/option&gt;
        &lt;option name="useColors"&gt;1&lt;/option&gt;
      &lt;/single&gt;
    &lt;/panel&gt;
    &lt;panel&gt;
      &lt;title&gt;Critical Security Events&lt;/title&gt;
      &lt;single&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit 
    (event_id IN ("AUM", "DU1", "DU2", "AUE", "AUN", "AUO") OR severity="critical")
    earliest=-24h
| stats count
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="colorMode"&gt;block&lt;/option&gt;
        &lt;option name="rangeColors"&gt;["0x53a051","0xf8be34","0xdc4e41"]&lt;/option&gt;
        &lt;option name="rangeValues"&gt;[0,5]&lt;/option&gt;
        &lt;option name="useColors"&gt;1&lt;/option&gt;
      &lt;/single&gt;
    &lt;/panel&gt;
    &lt;panel&gt;
      &lt;title&gt;Vendor Master Changes&lt;/title&gt;
      &lt;single&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_audit sourcetype=sap:change:documents object_class="KRED" earliest=-24h
| stats dc(object_id) as vendors_changed
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="colorMode"&gt;block&lt;/option&gt;
        &lt;option name="rangeColors"&gt;["0x53a051","0xf8be34","0xdc4e41"]&lt;/option&gt;
        &lt;option name="rangeValues"&gt;[10,25]&lt;/option&gt;
        &lt;option name="useColors"&gt;1&lt;/option&gt;
      &lt;/single&gt;
    &lt;/panel&gt;
  &lt;/row&gt;
  
  &lt;!-- Row 2: Authentication Trends --&gt;
  &lt;row&gt;
    &lt;panel&gt;
      &lt;title&gt;SAP Logon Activity - 7 Day Trend&lt;/title&gt;
      &lt;chart&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit event_id IN ("AU0", "AU1") earliest=-7d
| eval status = if(event_id="AU0", "Success", "Failure")
| timechart span=1h count by status
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="charting.chart"&gt;area&lt;/option&gt;
        &lt;option name="charting.chart.stackMode"&gt;stacked&lt;/option&gt;
        &lt;option name="charting.fieldColors"&gt;{"Success": 0x53a051, "Failure": 0xdc4e41}&lt;/option&gt;
      &lt;/chart&gt;
    &lt;/panel&gt;
  &lt;/row&gt;
  
  &lt;!-- Row 3: Top Users and Transactions --&gt;
  &lt;row&gt;
    &lt;panel&gt;
      &lt;title&gt;Top SAP Users by Activity&lt;/title&gt;
      &lt;table&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit event_id="AU3" earliest=-24h
| stats count as transactions 
    dc(transaction_code) as unique_tcodes 
    latest(_time) as last_activity
    by user
| sort -transactions
| head 20
| eval last_activity = strftime(last_activity, "%Y-%m-%d %H:%M")
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="drilldown"&gt;cell&lt;/option&gt;
      &lt;/table&gt;
    &lt;/panel&gt;
    &lt;panel&gt;
      &lt;title&gt;Most Used Transactions&lt;/title&gt;
      &lt;chart&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit event_id="AU3" earliest=-24h
| stats count by transaction_code
| sort -count
| head 15
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="charting.chart"&gt;bar&lt;/option&gt;
      &lt;/chart&gt;
    &lt;/panel&gt;
  &lt;/row&gt;
  
  &lt;!-- Row 4: Security Alerts --&gt;
  &lt;row&gt;
    &lt;panel&gt;
      &lt;title&gt;Recent Security Alerts&lt;/title&gt;
      &lt;table&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_security sourcetype=sap:security:audit 
    (event_id IN ("AUA", "AUE", "AUM", "AUN", "DU1", "DU2", "AUO", "AUT") 
     OR message="*SAP_ALL*" OR message="*debug*")
    earliest=-24h
| eval severity = case(
    event_id IN ("AUM", "DU1", "DU2", "AUO"), "Critical",
    event_id IN ("AUE", "AUN", "AUT"), "High",
    event_id = "AUA", "Medium",
    true(), "Low"
)
| lookup sap_event_codes event_id OUTPUT event_description
| table _time, severity, user, sap_client, event_id, event_description, transaction_code, message
| sort -_time
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="drilldown"&gt;row&lt;/option&gt;
      &lt;/table&gt;
    &lt;/panel&gt;
  &lt;/row&gt;
  
  &lt;!-- Row 5: Change Monitoring --&gt;
  &lt;row&gt;
    &lt;panel&gt;
      &lt;title&gt;Critical Object Changes (24h)&lt;/title&gt;
      &lt;table&gt;
        &lt;search&gt;
          &lt;query&gt;
index=sap_audit sourcetype=sap:change:documents 
    object_class IN ("KRED", "DEBI", "USER", "MATERIAL") 
    earliest=-24h
| eval object_type = case(
    object_class="KRED", "Vendor",
    object_class="DEBI", "Customer",
    object_class="USER", "User Master",
    object_class="MATERIAL", "Material",
    true(), object_class
)
| stats count as changes 
    dc(field_name) as fields_changed 
    values(field_name) as changed_fields
    by user, object_type, object_id
| sort -changes
| head 25
          &lt;/query&gt;
        &lt;/search&gt;
        &lt;option name="drilldown"&gt;cell&lt;/option&gt;
      &lt;/table&gt;
    &lt;/panel&gt;
  &lt;/row&gt;
  
&lt;/dashboard&gt;</code></pre>
                    </div>
                </div>

                <!-- Validation SPL -->
                <h2><i class="fas fa-check-circle"></i> SAP Data Validation Queries</h2>
                
                <div class="config-section">
                    <h3>Data Quality and Completeness Checks</h3>
                    <div class="config-block">
                        <div class="config-block-header">
                            <span class="config-title">Validation Query Library</span>
                        </div>
                        <pre><code># SAP DATA VALIDATION QUERIES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Check data freshness - should see events in last 15 minutes
index=sap_security sourcetype=sap:security:audit earliest=-15m
| stats count by sap_client
| append [| makeresults | eval sap_client="NO_DATA_IN_15_MIN", count=0]

# 2. Verify all SAP systems are sending data
index=sap_* earliest=-1h
| stats count as event_count 
    earliest(_time) as first_event 
    latest(_time) as last_event 
    by host, sourcetype
| eval first_event = strftime(first_event, "%Y-%m-%d %H:%M:%S")
| eval last_event = strftime(last_event, "%Y-%m-%d %H:%M:%S")
| eval data_gap_minutes = round((now() - strptime(last_event, "%Y-%m-%d %H:%M:%S")) / 60, 1)
| where data_gap_minutes > 30
| table host, sourcetype, event_count, last_event, data_gap_minutes

# 3. Check field extraction quality
index=sap_security sourcetype=sap:security:audit earliest=-1h
| stats count as total,
    count(eval(isnotnull(user))) as has_user,
    count(eval(isnotnull(event_id))) as has_event_id,
    count(eval(isnotnull(transaction_code))) as has_tcode,
    count(eval(isnotnull(sap_client))) as has_client
| eval user_pct = round(has_user/total*100, 1)
| eval event_id_pct = round(has_event_id/total*100, 1)
| eval tcode_pct = round(has_tcode/total*100, 1)
| eval client_pct = round(has_client/total*100, 1)

# 4. Compare today vs yesterday volume (anomaly detection)
index=sap_security sourcetype=sap:security:audit
| bin _time span=1d
| stats count by _time
| sort _time
| streamstats window=2 current=f avg(count) as avg_previous
| eval variance_pct = round((count - avg_previous) / avg_previous * 100, 1)
| where abs(variance_pct) > 30

# 5. Verify CIM compliance - Authentication model
| datamodel Authentication search
| search sourcetype=sap:*
| stats count by sourcetype, action, tag
| where count > 0

# 6. Check for parsing errors
index=sap_* sourcetype=sap:* _time=*
| stats count(eval(isnotnull(_raw))) as parsed, 
        count(eval(match(_raw, "^[^{]"))) as unparsed
| eval parse_success_rate = round(parsed / (parsed + unparsed) * 100, 2)</code></pre>
                    </div>
                </div>

                <!-- Troubleshooting -->
                <h2><i class="fas fa-bug"></i> SAP Onboarding Troubleshooting</h2>
                
                <div class="config-section">
                    <h3>Common SAP Collection Issues</h3>
                    <div class="arch-diagram">
SAP ONBOARDING TROUBLESHOOTING GUIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ISSUE 1: NO DATA FROM SAP CONNECT
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Symptoms:
â€¢ No events in sap_* indexes
â€¢ Splunk Connect for SAP shows no activity

Diagnostic Steps:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # 1. Check Splunk Connect for SAP internal logs                            â”‚
â”‚ index=_internal sourcetype=splunkd component=ModularInputs                 â”‚
â”‚     SAP earliest=-1h                                                       â”‚
â”‚                                                                             â”‚
â”‚ # 2. Verify Java is running                                                â”‚
â”‚ ps aux | grep java | grep sap                                              â”‚
â”‚                                                                             â”‚
â”‚ # 3. Check JCo connectivity                                                â”‚
â”‚ $SPLUNK_HOME/bin/splunk cmd python                                         â”‚
â”‚ >>> from sapjco3 import JCoDestinationManager                              â”‚
â”‚ >>> dest = JCoDestinationManager.getDestination("SAP_PRD")                 â”‚
â”‚                                                                             â”‚
â”‚ # 4. Verify SAP user permissions                                           â”‚
â”‚ In SAP: SU53 (last auth check for SPLUNK_RFC user)                         â”‚
â”‚                                                                             â”‚
â”‚ # 5. Network connectivity                                                  â”‚
â”‚ telnet sapprd01.sobeys.local 3300                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ISSUE 2: MISSING EVENTS (PARTIAL DATA)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Symptoms:
â€¢ Some events arrive, but gaps exist
â€¢ Specific event types missing

Diagnostic Steps:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # 1. Check SAP audit log configuration                                     â”‚
â”‚ In SAP: RSAU_CONFIG                                                        â”‚
â”‚ - Verify filters include required event classes                            â”‚
â”‚ - Check "Kernel Audit" is enabled for all event types                     â”‚
â”‚                                                                             â”‚
â”‚ # 2. Verify extraction interval vs event volume                            â”‚
â”‚ # If interval=300 but 10,000 events/5min, may need shorter interval        â”‚
â”‚                                                                             â”‚
â”‚ # 3. Check for extraction errors                                           â”‚
â”‚ index=_internal source=*sap* error OR failed earliest=-1h                 â”‚
â”‚                                                                             â”‚
â”‚ # 4. Compare SAP log count vs Splunk                                       â”‚
â”‚ In SAP: SM21 > count events for time range                                 â”‚
â”‚ In Splunk: index=sap_security earliest=-1h | stats count                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ISSUE 3: TIMESTAMP PARSING ERRORS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Symptoms:
â€¢ Events with wrong _time
â€¢ Events appearing with indexing time instead of event time

Fix:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # SAP uses various timestamp formats                                       â”‚
â”‚                                                                             â”‚
â”‚ # In props.conf, ensure correct TIME_FORMAT:                               â”‚
â”‚ [sap:security:audit]                                                       â”‚
â”‚ TIME_FORMAT = %Y%m%d%H%M%S                                                 â”‚
â”‚ TIME_PREFIX = Date:\s*                                                     â”‚
â”‚ MAX_TIMESTAMP_LOOKAHEAD = 20                                               â”‚
â”‚                                                                             â”‚
â”‚ # For SAP timezone issues (SAP stores in UTC):                             â”‚
â”‚ TZ = UTC                                                                    â”‚
â”‚ # Or if SAP uses local time:                                               â”‚
â”‚ TZ = America/Halifax  (for Sobeys Atlantic Canada)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ISSUE 4: HIGH LATENCY IN DATA ARRIVAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Symptoms:
â€¢ Data arrives 30+ minutes delayed
â€¢ Dashboard shows stale information

Diagnostic Steps:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # 1. Check extraction interval                                             â”‚
â”‚ # Default may be 600s (10 min) - reduce for real-time                     â”‚
â”‚ interval = 60  # For near real-time                                        â”‚
â”‚                                                                             â”‚
â”‚ # 2. Check indexer queue                                                   â”‚
â”‚ index=_internal sourcetype=splunkd group=queue                             â”‚
â”‚     name=parsingQueue OR name=indexQueue                                   â”‚
â”‚ | timechart avg(current_size)                                              â”‚
â”‚                                                                             â”‚
â”‚ # 3. Check network latency                                                 â”‚
â”‚ # From Splunk server to SAP:                                               â”‚
â”‚ ping -c 10 sapprd01.sobeys.local                                           â”‚
â”‚                                                                             â”‚
â”‚ # 4. RFC performance in SAP                                                â”‚
â”‚ In SAP: SM59 > Test connection timing                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ISSUE 5: LICENSE USAGE TOO HIGH
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Symptoms:
â€¢ SAP data consuming more license than expected
â€¢ Daily volume much higher than estimates

Solutions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ # 1. Filter verbose events at source                                       â”‚
â”‚ # In SAP: RSAU_CONFIG - disable low-value event classes                    â”‚
â”‚ # Disable: AU3 for non-sensitive t-codes, routine RFC calls                â”‚
â”‚                                                                             â”‚
â”‚ # 2. Use Ingest Actions (Splunk Cloud) or HF transforms                    â”‚
â”‚ # Route verbose data to summary index                                      â”‚
â”‚                                                                             â”‚
â”‚ # transforms.conf                                                          â”‚
â”‚ [sap_route_verbose]                                                         â”‚
â”‚ REGEX = event_id="(AU3|AU4|AU5)"                                           â”‚
â”‚ DEST_KEY = _MetaData:Index                                                 â”‚
â”‚ FORMAT = sap_verbose                                                        â”‚
â”‚                                                                             â”‚
â”‚ # 3. Aggregate high-volume events                                          â”‚
â”‚ # Create summary index for transaction counts vs raw events                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </div>
                </div>

                <!-- Interview Q&A -->
                <h2><i class="fas fa-comments"></i> Interview Questions & Answers</h2>
                
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question">Q: How would you approach onboarding SAP logs to Splunk for a retail enterprise?</button>
                        <div class="qa-answer">
                            <p><strong>Structured Approach:</strong></p>
                            <div class="arch-diagram">
Phase 1: Discovery & Planning
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Identify SAP landscape: ECC, S/4HANA, BW, number of systems
â€¢ Determine security requirements: Compliance (SOX, PCI), audit needs
â€¢ Estimate volume: Number of users, transaction volume, event types
â€¢ Choose collection method: Splunk Connect for SAP vs file-based
â€¢ Plan indexes: Separate by data type (security, audit, performance)

Phase 2: SAP Preparation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Create RFC user with minimal required authorizations
â€¢ Enable Security Audit Log (RSAU_CONFIG)
â€¢ Configure audit log filters for required events
â€¢ Test RFC connectivity from Splunk network

Phase 3: Splunk Configuration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Install Splunk Connect for SAP on HF
â€¢ Install SAP JCo libraries
â€¢ Configure connections to each SAP system
â€¢ Set up inputs with appropriate intervals
â€¢ Create indexes with retention aligned to compliance

Phase 4: Validation & Tuning
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Verify data flow for all event types
â€¢ Validate field extractions
â€¢ Configure CIM mapping
â€¢ Tune extraction intervals based on volume
â€¢ Build validation dashboards

Phase 5: Security Content
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Deploy detection rules (debug/replace, SAP_ALL, etc.)
â€¢ Create operational dashboards
â€¢ Configure alerts for critical events
â€¢ Document runbooks for SOC team
                            </div>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question">Q: What are the most critical SAP security events to monitor?</button>
                        <div class="qa-answer">
                            <p><strong>Priority 1 - Critical (Immediate Alert):</strong></p>
                            <ul>
                                <li>Debug/Replace mode usage (AUM, DU1, DU2) - Can modify any data in memory</li>
                                <li>SAP_ALL/SAP_NEW profile assignment - Unlimited access</li>
                                <li>Audit log deletion or configuration change (AUO, AUT)</li>
                                <li>User session switching (AUN) - Identity impersonation</li>
                            </ul>
                            <p><strong>Priority 2 - High (Same-day Review):</strong></p>
                            <ul>
                                <li>Vendor/Customer master bank account changes</li>
                                <li>User master modifications (especially role assignments)</li>
                                <li>RFC destination changes</li>
                                <li>Transport releases to production</li>
                                <li>Multiple failed logons followed by success</li>
                            </ul>
                            <p><strong>Priority 3 - Medium (Regular Monitoring):</strong></p>
                            <ul>
                                <li>Sensitive table access (SE16/SE16N on financial tables)</li>
                                <li>After-hours activity by non-service accounts</li>
                                <li>Authorization failures</li>
                                <li>Dormant account reactivation</li>
                            </ul>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question">Q: How do you map SAP data to Splunk CIM?</button>
                        <div class="qa-answer">
                            <p>SAP data primarily maps to these CIM data models:</p>
                            <p><strong>Authentication Model:</strong></p>
                            <ul>
                                <li>SAP logon events (AU0, AU1, AU2, AU8, AU9) â†’ action (success/failure)</li>
                                <li>User field â†’ user, src_user</li>
                                <li>Terminal â†’ src</li>
                                <li>Client â†’ app</li>
                            </ul>
                            <p><strong>Change Model:</strong></p>
                            <ul>
                                <li>Change documents (CDHDR/CDPOS) â†’ object, object_category, action</li>
                                <li>OBJECTCLAS â†’ object_category (vendor, customer, material)</li>
                                <li>FNAME/VALUE_OLD/VALUE_NEW â†’ object_attrs</li>
                            </ul>
                            <p><strong>Implementation:</strong> Use eventtypes.conf for tagging, props.conf for field aliases, and lookups for value translation.</p>
                        </div>
                    </div>

                    <div class="qa-item">
                        <button class="qa-question">Q: What SAP-specific compliance requirements should be monitored?</button>
                        <div class="qa-answer">
                            <p><strong>SOX Compliance:</strong></p>
                            <ul>
                                <li>Segregation of Duties - Monitor for SoD violations in transaction execution</li>
                                <li>Change Management - Track all production changes through transport system</li>
                                <li>Access Reviews - Report on privileged access and dormant accounts</li>
                                <li>Financial Data Integrity - Monitor direct table changes to FI/CO data</li>
                            </ul>
                            <p><strong>PCI-DSS (for retail like Sobeys):</strong></p>
                            <ul>
                                <li>Cardholder data access - Monitor tables containing card data</li>
                                <li>Authentication logging - All logon attempts with success/failure</li>
                                <li>Privileged access - Track admin activity</li>
                                <li>Log retention - Minimum 1 year, 3 months immediately available</li>
                            </ul>
                            <p><strong>Key Reports:</strong> Failed logon trends, privileged user activity, sensitive table access, change document audit trail.</p>
                        </div>
                    </div>
                </div>

                <!-- What Enterprises Miss -->
                <h2><i class="fas fa-exclamation-circle"></i> What Enterprises Usually Miss</h2>
                
                <div class="enterprise-gap-grid">
                    <div class="gap-card gap-critical">
                        <h4>ğŸ”´ Critical Gaps</h4>
                        <ul>
                            <li><strong>Security Audit Log not enabled:</strong> Many SAP systems have audit logging disabled by default - no visibility into security events</li>
                            <li><strong>No monitoring of change documents:</strong> Financial fraud often involves master data changes that go undetected</li>
                            <li><strong>RFC user with excessive permissions:</strong> Splunk RFC user often given SAP_ALL "temporarily" and never reduced</li>
                            <li><strong>No alerting on debug/replace:</strong> Most dangerous SAP activity goes unmonitored</li>
                        </ul>
                    </div>
                    
                    <div class="gap-card gap-warning">
                        <h4>ğŸŸ¡ Common Oversights</h4>
                        <ul>
                            <li><strong>Single client monitoring:</strong> Only monitoring client 100 when 200, 300 also have production data</li>
                            <li><strong>Missing non-production systems:</strong> Dev/QA systems used as stepping stones not monitored</li>
                            <li><strong>No correlation with AD/IdP:</strong> SAP logons not correlated with impossible travel or compromised accounts</li>
                            <li><strong>Timezone confusion:</strong> SAP timestamps not properly converted, causing timeline issues</li>
                        </ul>
                    </div>
                    
                    <div class="gap-card gap-info">
                        <h4>ğŸ”µ Often Overlooked</h4>
                        <ul>
                            <li><strong>Transport system monitoring:</strong> Code deployments not tracked for backdoor insertion</li>
                            <li><strong>RFC destination changes:</strong> Lateral movement paths created without detection</li>
                            <li><strong>Batch job monitoring:</strong> Scheduled jobs executing with elevated privileges</li>
                            <li><strong>Web Dispatcher logs:</strong> HTTP attacks on SAP not visible</li>
                        </ul>
                    </div>
                    
                    <div class="gap-card gap-best-practice">
                        <h4>ğŸŸ¢ Best Practices Often Skipped</h4>
                        <ul>
                            <li><strong>SAP GRC integration:</strong> Not correlating Splunk alerts with GRC Access Control findings</li>
                            <li><strong>Business context enrichment:</strong> Not adding vendor payment amounts to change alerts</li>
                            <li><strong>Baseline establishment:</strong> No normal behavior baseline for anomaly detection</li>
                            <li><strong>Runbook documentation:</strong> SOC team doesn't know how to investigate SAP alerts</li>
                        </ul>
                    </div>
                </div>

                <!-- Related Resources -->
                <h2><i class="fas fa-link"></i> Related Resources</h2>
                <ul>
                    <li><a href="data-ingestion.html">Data Ingestion Guide</a></li>
                    <li><a href="custom-log-onboarding.html">Custom Log Onboarding</a></li>
                    <li><a href="correlation-searches.html">Correlation Searches</a></li>
                    <li><a href="retail-security.html">Retail Security Monitoring</a></li>
                    <li><a href="dashboards.html">Dashboard Development</a></li>
                </ul>

            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>
