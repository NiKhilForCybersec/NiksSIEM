<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alert Tuning | Microsoft Defender for Endpoint</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">MDE Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="fundamentals.html" class="nav-link"><i class="fas fa-book"></i> Fundamentals</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Deployment</div>
                    <a href="onboarding-windows.html" class="nav-link"><i class="fab fa-windows"></i> Windows Onboarding</a>
                    <a href="onboarding-macos.html" class="nav-link"><i class="fab fa-apple"></i> macOS Onboarding</a>
                    <a href="onboarding-linux.html" class="nav-link"><i class="fab fa-linux"></i> Linux Onboarding</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection & Hunting</div>
                    <a href="kql-hunting.html" class="nav-link"><i class="fas fa-crosshairs"></i> KQL Hunting</a>
                    <a href="advanced-hunting.html" class="nav-link"><i class="fas fa-code"></i> Advanced Hunting</a>
                    <a href="alert-tuning.html" class="nav-link active"><i class="fas fa-sliders-h"></i> Alert Tuning</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Response</div>
                    <a href="response-actions.html" class="nav-link"><i class="fas fa-bolt"></i> Response Actions</a>
                    <a href="incident-management.html" class="nav-link"><i class="fas fa-clipboard-list"></i> Incident Management</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Administration</div>
                    <a href="troubleshooting.html" class="nav-link"><i class="fas fa-wrench"></i> Troubleshooting</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">MDE</a><span class="separator">/</span>
                    <span class="current">Alert Tuning</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-sliders-h"></i> MDE Alert Tuning</h1>
                <p class="lead">Master alert tuning in Microsoft Defender for Endpoint. Learn suppression rules, indicator allowlisting, exclusion management, and best practices for reducing false positives while maintaining security coverage.</p>

                <!-- Alert Tuning Overview -->
                <h2><i class="fas fa-info-circle"></i> Alert Tuning Overview</h2>
                <div class="config-section">
                    <h4>Why Tune Alerts?</h4>
                    <div class="code-block">Alert Tuning Goals:

REDUCE FALSE POSITIVES:
├── Legitimate business tools triggering alerts
├── Admin activities appearing suspicious
├── Security tools detecting themselves
├── Automated processes misidentified
└── Known-good applications flagged

MAINTAIN DETECTION COVERAGE:
├── Don't over-tune (blind spots)
├── Document all exclusions
├── Regular review of tuning rules
├── Monitor for tuning bypass attempts
└── Balance security vs operations

IMPROVE SOC EFFICIENCY:
├── Analysts focus on real threats
├── Reduced alert fatigue
├── Faster triage times
├── Higher true positive rate
└── Better analyst morale

TUNING METHODS IN MDE:
├── Alert Suppression Rules
├── Indicator Allowlisting
├── Folder/Path Exclusions
├── Process Exclusions
├── File Hash Allowlisting
└── Custom Detection Tuning</div>

                    <h4>Tuning Decision Framework</h4>
                    <div class="code-block">Tuning Decision Tree:

START: Alert received
│
├─▶ Is this malicious activity?
│   ├── YES → Respond (don't tune)
│   └── NO → Continue
│
├─▶ Is this legitimate business activity?
│   ├── YES → Consider tuning
│   └── NO/UNCERTAIN → Investigate more
│
├─▶ Is this recurring (same alert, same context)?
│   ├── YES → Strong tuning candidate
│   └── NO → May not need tuning
│
├─▶ Can we tune specifically (not broadly)?
│   ├── YES → Create specific rule
│   └── NO → Risk assessment needed
│
└─▶ Document and implement tuning

TUNING SPECIFICITY (Most to Least Preferred):
1. Specific hash + specific machine group
2. Specific process path + command line
3. Process name + parent process
4. File path pattern
5. Entire alert type (last resort)</div>
                </div>

                <!-- Suppression Rules -->
                <h2><i class="fas fa-ban"></i> Alert Suppression Rules</h2>
                <div class="config-section">
                    <p><span class="console-path">security.microsoft.com → Settings → Endpoints → Rules → Alert suppression</span></p>

                    <h4>Creating Suppression Rules</h4>
                    <div class="code-block">Alert Suppression Rule Configuration:

RULE COMPONENTS:
├── Rule Name: Descriptive identifier
├── Alert Title: Specific alert to suppress
├── Conditions: Matching criteria
│   ├── Device name/group
│   ├── User name
│   ├── File path
│   ├── SHA1/SHA256 hash
│   ├── Command line
│   └── IP address
├── Scope: Where rule applies
│   ├── Organization-wide
│   └── Specific device group
├── Action: Hide/Resolve
└── Expiration: Auto-expire date

EXAMPLE: Suppress admin tool alerts
Rule Name: IT Admin - PSExec Usage
Alert Title: Suspicious use of PsExec
Conditions:
  - User: domain\admin_* (wildcard)
  - Device Group: IT Workstations
  - File Path: C:\AdminTools\*
Action: Hide alert
Expiration: 90 days

BEST PRACTICES:
├── Use most specific conditions possible
├── Set expiration dates (review regularly)
├── Document business justification
├── Limit scope (device groups > org-wide)
├── Monitor suppressed alert trends
└── Review and prune regularly</div>

                    <h4>Suppression Rule Examples</h4>
                    <div class="code-block">Common Suppression Scenarios:

1. VULNERABILITY SCANNER
   Alert: Suspicious network scanning
   Conditions:
     - Device: vuln-scanner.domain.com
     - User: svc_qualys
   Justification: Authorized vulnerability scanning

2. PENETRATION TESTING
   Alert: [Multiple alert types]
   Conditions:
     - Device Group: PenTest Lab
     - Time: During testing window
   Justification: Authorized red team activity
   Expiration: End of engagement

3. BACKUP SOFTWARE
   Alert: Suspicious file access
   Conditions:
     - Process: veeam.backup.agent.exe
     - Path: C:\Program Files\Veeam\*
   Justification: Legitimate backup operations

4. SECURITY TOOLS
   Alert: LSASS memory access
   Conditions:
     - Process: *\CrowdStrike\*
     - SHA256: [known hash]
   Justification: EDR tool legitimate activity

5. DEPLOYMENT TOOLS
   Alert: Suspicious remote execution
   Conditions:
     - Process: sccm*.exe
     - User: SYSTEM
     - Parent: ccmexec.exe
   Justification: SCCM software deployment</div>
                </div>

                <!-- Indicators Allowlisting -->
                <h2><i class="fas fa-check-circle"></i> Indicator Allowlisting</h2>
                <div class="config-section">
                    <p><span class="console-path">security.microsoft.com → Settings → Endpoints → Indicators</span></p>

                    <h4>Indicator Types</h4>
                    <div class="code-block">Indicator Allowlist Types:

FILE HASHES:
├── SHA256 (recommended)
├── SHA1
├── MD5 (not recommended, collisions)
└── Action: Allow and stop scanning

FILE CERTIFICATES:
├── Certificate thumbprint
├── Issuer name
├── Subject name
└── Action: Allow signed files

IP ADDRESSES:
├── Single IP
├── CIDR range
└── Action: Allow network traffic

URLS/DOMAINS:
├── Specific URL
├── Domain (with subdomains option)
└── Action: Allow web access

CREATING FILE HASH ALLOW:
1. Go to Indicators → File hashes → Add indicator
2. Enter SHA256 hash
3. Action: Allow
4. Title: Application Name
5. Description: Business justification
6. Expiration: Set review date
7. Scope: All devices or specific group</div>

                    <h4>Indicator Management</h4>
                    <div class="code-block">// Find hash for allowlisting
// In Advanced Hunting:
DeviceFileEvents
| where FileName == "legitimate_app.exe"
| where FolderPath has "Program Files"
| distinct SHA256, FileName
| take 10

// Verify indicator effectiveness
DeviceEvents
| where ActionType == "AntivirusDetection"
| where SHA256 == "your_hash_here"
| summarize count() by DeviceName, FileName

API MANAGEMENT:
# List indicators via API
GET /api/indicators

# Add indicator via API
POST /api/indicators
{
  "indicatorValue": "SHA256_HASH",
  "indicatorType": "FileSha256",
  "action": "Allowed",
  "title": "Allowed Application",
  "description": "Business justification",
  "expirationTime": "2024-12-31T00:00:00Z",
  "severity": "Informational",
  "recommendedActions": "No action needed"
}

BULK IMPORT:
├── CSV format supported
├── Max 15,000 indicators per type
├── Columns: IndicatorType, IndicatorValue, 
│            Action, Title, Description, 
│            ExpirationTime, Severity
└── Import via portal or API</div>
                </div>

                <!-- Antivirus Exclusions -->
                <h2><i class="fas fa-folder-open"></i> Antivirus Exclusions</h2>
                <div class="config-section">
                    <p><span class="console-path">Intune → Endpoint security → Antivirus → Policies</span></p>

                    <h4>Exclusion Types</h4>
                    <div class="code-block">Microsoft Defender Antivirus Exclusions:

FILE EXCLUSIONS:
├── Specific file path
├── Wildcard patterns
└── Example: C:\App\data\*.tmp

FOLDER EXCLUSIONS:
├── Full folder path
├── Includes subfolders
└── Example: C:\Database\

PROCESS EXCLUSIONS:
├── Process opens files = excluded from scan
├── By full path or name
├── Example: sqlserver.exe

EXTENSION EXCLUSIONS:
├── All files with extension
├── Example: .mdf, .ldf
└── Use sparingly (broad)

CONFIGURATION METHODS:
├── Intune/MEM (preferred for managed)
├── Group Policy
├── PowerShell (Set-MpPreference)
├── ConfigMgr
└── Windows Security app (local only)</div>

                    <h4>Common Exclusions</h4>
                    <div class="code-block">Recommended Exclusions by Application:

SQL SERVER:
├── Folders: [SQLDataPath]\*
├── Files: *.mdf, *.ldf, *.ndf
├── Process: sqlservr.exe, sqlagent.exe
└── Justification: Performance, scan locks

EXCHANGE SERVER:
├── Folders: [ExchangeInstallPath]\*
├── Files: *.edb, *.log, *.chk
├── Process: EdgeTransport.exe, etc.
└── Reference: Microsoft KB2972493

SHAREPOINT:
├── Folders: [SharePointPath]\*
├── Process: w3wp.exe (with filters)
└── Reference: Microsoft documentation

HYPER-V:
├── Folders: [VMPath]\*
├── Files: *.vhd, *.vhdx, *.avhd
├── Process: vmwp.exe, vmms.exe
└── Justification: Performance

DOMAIN CONTROLLERS:
├── Folders: %systemroot%\NTDS\*
├── Files: ntds.dit, *.edb
├── Process: ntdsa.exe
└── Reference: Microsoft KB822158

EXCLUSION POWERSHELL:
# Add folder exclusion
Add-MpPreference -ExclusionPath "C:\Database\"

# Add process exclusion
Add-MpPreference -ExclusionProcess "sqlservr.exe"

# Add extension exclusion
Add-MpPreference -ExclusionExtension "mdf"

# View current exclusions
Get-MpPreference | Select-Object Exclusion*</div>
                </div>

                <!-- ASR Rule Exclusions -->
                <h2><i class="fas fa-shield-alt"></i> ASR Rule Exclusions</h2>
                <div class="config-section">
                    <h4>ASR Exclusion Configuration</h4>
                    <div class="code-block">Attack Surface Reduction Exclusions:

EXCLUSION SCOPE:
├── Per ASR rule (recommended)
├── All ASR rules (broad, avoid)
└── By file path or process

COMMON ASR RULES NEEDING EXCLUSIONS:
├── Block Office creating child processes
│   └── Exclude: Legitimate macro tools
├── Block credential stealing from LSASS
│   └── Exclude: Security tools, backup agents
├── Block executable content from email
│   └── Exclude: Known safe attachments
└── Block untrusted processes from USB
    └── Exclude: Approved USB tools

INTUNE CONFIGURATION:
Endpoint security → Attack surface reduction →
  Create policy → Add exclusions

GPO CONFIGURATION:
Computer Configuration → Admin Templates →
  Windows Components → Defender Antivirus →
  Attack Surface Reduction → Exclude files and paths

POWERSHELL:
# Add ASR exclusion
Add-MpPreference -AttackSurfaceReductionOnlyExclusions "C:\AdminTools\"

# View ASR exclusions
Get-MpPreference | Select-Object AttackSurfaceReductionOnlyExclusions</div>
                </div>

                <!-- Tuning Workflow -->
                <h2><i class="fas fa-tasks"></i> Tuning Workflow</h2>
                <div class="config-section">
                    <div class="code-block">Alert Tuning Workflow:

PHASE 1: IDENTIFICATION
├── Review high-volume alerts
├── Identify patterns (same device, user, process)
├── Check if legitimate activity
└── Document findings

// Find top alert types
AlertInfo
| where Timestamp > ago(7d)
| summarize Count = count() by Title, Severity
| order by Count desc
| take 20

PHASE 2: ANALYSIS
├── Investigate sample alerts thoroughly
├── Verify benign nature
├── Identify unique attributes
└── Determine tuning scope

// Analyze specific alert
AlertInfo
| where Title == "Suspicious PowerShell command line"
| join kind=inner AlertEvidence on AlertId
| summarize by DeviceName, AccountName, FileName, 
              ProcessCommandLine
| take 100

PHASE 3: IMPLEMENTATION
├── Create specific suppression rule
├── Add indicators if needed
├── Configure exclusions
├── Set expiration date
└── Document everything

PHASE 4: VALIDATION
├── Monitor rule effectiveness
├── Check for false negatives
├── Verify alert reduction
└── Adjust if needed

// Verify suppression working
AlertInfo
| where Timestamp > ago(24h)
| where Title == "Suppressed Alert Title"
| summarize count()
// Should be 0 or very low

PHASE 5: REVIEW
├── Quarterly tuning review
├── Remove expired rules
├── Update documentation
└── Assess new false positives</div>
                </div>

                <!-- Advanced Hunting for Tuning -->
                <h2><i class="fas fa-search"></i> Advanced Hunting for Tuning</h2>
                <div class="config-section">
                    <div class="code-block">// Find alerts for tuning candidates
AlertInfo
| where Timestamp > ago(30d)
| where Severity in ("Low", "Medium")
| summarize 
    AlertCount = count(),
    Devices = dcount(DeviceId),
    Sample = take_any(AlertId)
  by Title
| where AlertCount > 50
| order by AlertCount desc

// Analyze false positive patterns
AlertInfo
| where Title == "Suspicious process behavior"
| join kind=inner (
    AlertEvidence
    | where EntityType == "Process"
) on AlertId
| extend 
    ProcessName = tostring(parse_json(AdditionalFields).FileName),
    ProcessPath = tostring(parse_json(AdditionalFields).FolderPath)
| summarize count() by ProcessName, ProcessPath
| order by count_ desc

// Find alerts by device group
AlertInfo
| where Timestamp > ago(7d)
| join kind=inner DeviceInfo on DeviceId
| summarize AlertCount = count() by DeviceGroup, Title
| order by AlertCount desc

// Identify alerts from specific processes
DeviceAlertEvents
| where Timestamp > ago(7d)
| extend ProcessName = tostring(parse_json(AdditionalFields).ProcessName)
| summarize AlertCount = count(), 
            AlertTypes = make_set(Title)
  by ProcessName
| where AlertCount > 10
| order by AlertCount desc

// Check if exclusion is working
DeviceEvents
| where Timestamp > ago(24h)
| where ActionType == "AntivirusDetection"
| where FolderPath has "ExcludedPath"
| summarize count() by FolderPath, FileName
// Should be 0 if exclusion is effective</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you approach alert tuning in MDE?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Identify:</strong> Find high-volume, recurring false positives</li>
                                <li><strong>Analyze:</strong> Verify activity is legitimate, find unique attributes</li>
                                <li><strong>Implement:</strong> Create specific suppression rule or exclusion</li>
                                <li><strong>Validate:</strong> Monitor effectiveness, check for false negatives</li>
                                <li><strong>Review:</strong> Quarterly review, remove expired rules</li>
                            </ol>
                            <p>Key: Be as specific as possible, document everything, set expirations.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What's the difference between suppression rules and exclusions?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Suppression Rules:</strong> Hide/resolve alerts after detection. Activity still logged, just not alerted.</li>
                                <li><strong>AV Exclusions:</strong> Prevent scanning entirely. Activity not monitored at all.</li>
                                <li><strong>Indicators (Allow):</strong> Allow specific hashes/IPs/domains.</li>
                            </ul>
                            <p>Prefer suppression rules - maintains visibility while reducing noise.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What are the risks of over-tuning?</button>
                        <div class="qa-answer">
                            <ul>
                                <li>Creating blind spots for real attacks</li>
                                <li>Attackers using allowed paths/processes</li>
                                <li>Missing lateral movement via excluded tools</li>
                                <li>Compliance gaps from lack of monitoring</li>
                            </ul>
                            <p><strong>Mitigation:</strong> Specific rules, regular reviews, expiration dates, documentation.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you find tuning candidates in Advanced Hunting?</button>
                        <div class="qa-answer">
                            <div class="code-block">AlertInfo
| where Timestamp > ago(30d)
| summarize Count = count() by Title, Severity
| where Count > 50
| order by Count desc</div>
                            <p>Look for high-volume, low/medium severity alerts. Analyze patterns by device, user, process.</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>