<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Onboarding | Defender for Endpoint</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <a href="../xsiam/index.html" class="sidebar-nav-link" data-platform="xsiam">
                            <span class="platform-dot"></span>
                            <span>XSIAM</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../splunk/index.html" class="sidebar-nav-link" data-platform="splunk">
                            <span class="platform-dot"></span>
                            <span>Splunk</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../sentinel/index.html" class="sidebar-nav-link" data-platform="sentinel">
                            <span class="platform-dot"></span>
                            <span>Sentinel</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../crowdstrike/index.html" class="sidebar-nav-link" data-platform="crowdstrike">
                            <span class="platform-dot"></span>
                            <span>CrowdStrike</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../cortex/index.html" class="sidebar-nav-link" data-platform="cortex">
                            <span class="platform-dot"></span>
                            <span>Cortex XDR</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../mde/index.html" class="sidebar-nav-link active" data-platform="mde">
                            <span class="platform-dot"></span>
                            <span>Defender for Endpoint</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../operations/index.html" class="sidebar-nav-link" data-platform="operations">
                            <span class="platform-dot"></span>
                            <span>SOC Operations</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Current Platform Pages -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Defender for Endpoint Pages</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <a href="advanced-hunting.html" class="sidebar-nav-link">
                            <i class="fas fa-terminal"></i>
                            <span>Advanced Hunting</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="alert-tuning.html" class="sidebar-nav-link">
                            <i class="fas fa-bell"></i>
                            <span>Alert Tuning</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="architecture.html" class="sidebar-nav-link">
                            <i class="fas fa-sitemap"></i>
                            <span>Architecture</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="fundamentals.html" class="sidebar-nav-link">
                            <i class="fas fa-code"></i>
                            <span>Fundamentals</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="incident-management.html" class="sidebar-nav-link">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Incident Management</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="index.html" class="sidebar-nav-link">
                            <i class="fas fa-home"></i>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="kql-hunting.html" class="sidebar-nav-link">
                            <i class="fas fa-code"></i>
                            <span>Kql Hunting</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="onboarding-linux.html" class="sidebar-nav-link">
                            <i class="fas fa-download"></i>
                            <span>Onboarding Linux</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="onboarding-macos.html" class="sidebar-nav-link">
                            <i class="fas fa-download"></i>
                            <span>Onboarding Macos</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="onboarding-windows.html" class="sidebar-nav-link active">
                            <i class="fas fa-download"></i>
                            <span>Onboarding Windows</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="response-actions.html" class="sidebar-nav-link">
                            <i class="fas fa-terminal"></i>
                            <span>Response Actions</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="troubleshooting.html" class="sidebar-nav-link">
                            <i class="fas fa-wrench"></i>
                            <span>Troubleshooting</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </aside>
    
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">Defender for Endpoint</a>
                    <span class="separator">/</span>
                    <span class="current">Onboarding Windows</span>
                </div>

                <h1><i class="fab fa-windows"></i> Windows Onboarding</h1>
                <p class="lead">Complete guide to onboarding Windows devices to Microsoft Defender for Endpoint. Learn all deployment methods, prerequisites, verification, and troubleshooting for enterprise deployments.</p>

                <!-- Licensing & Prerequisites -->
                <h2><i class="fas fa-key"></i> Licensing & Prerequisites</h2>
                <div class="config-section">
                    <h4>License Requirements</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>License</th><th>MDE P1</th><th>MDE P2</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Microsoft 365 E3</strong></td><td>Add-on</td><td>Add-on</td></tr>
                            <tr><td><strong>Microsoft 365 E5</strong></td><td>✓ Included</td><td>✓ Included</td></tr>
                            <tr><td><strong>Microsoft 365 E5 Security</strong></td><td>✓ Included</td><td>✓ Included</td></tr>
                            <tr><td><strong>Windows 10/11 Enterprise E5</strong></td><td>✓ Included</td><td>✓ Included</td></tr>
                            <tr><td><strong>MDE Standalone</strong></td><td>✓ Available</td><td>✓ Available</td></tr>
                            <tr><td><strong>Microsoft Defender for Business</strong></td><td>✓ SMB version</td><td>-</td></tr>
                        </tbody>
                    </table>

                    <h4>Supported Windows Versions</h4>
                    <div class="code-block">Supported Windows Versions:

WINDOWS CLIENT:
├── Windows 11 (all editions) - Native support
├── Windows 10 (1709+) - Native support
├── Windows 10 (1607-1703) - Limited features
├── Windows 8.1 Pro/Enterprise - Via MMA
└── Windows 7 SP1 - Via MMA (extended support)

WINDOWS SERVER:
├── Windows Server 2022 - Native support
├── Windows Server 2019 - Native support
├── Windows Server 2016 - Via MMA or modern unified
├── Windows Server 2012 R2 - Modern unified solution
├── Windows Server 2012 - Modern unified solution
└── Windows Server 2008 R2 - Via MMA (legacy)

MODERN UNIFIED SOLUTION (Server 2012 R2+):
├── Single installer package
├── Same capabilities as Win10/11
├── No MMA dependency
├── Includes EDR + EPP
└── Recommended for all servers

REQUIREMENTS:
├── .NET Framework 4.5+
├── Internet connectivity to Microsoft URLs
├── TLS 1.2 support
├── Windows Update current
└── Admin rights for installation</div>
                </div>

                <!-- Onboarding Methods -->
                <h2><i class="fas fa-download"></i> Onboarding Methods</h2>
                <div class="config-section">
                    <h4>Method Comparison</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Method</th><th>Best For</th><th>Scale</th><th>Management</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>Microsoft Intune</strong></td><td>Cloud-managed devices</td><td>Enterprise</td><td>Cloud</td></tr>
                            <tr><td><strong>SCCM/MECM</strong></td><td>On-premises managed</td><td>Enterprise</td><td>On-prem</td></tr>
                            <tr><td><strong>Group Policy</strong></td><td>Domain-joined devices</td><td>Enterprise</td><td>On-prem</td></tr>
                            <tr><td><strong>Local Script</strong></td><td>Testing, small deployments</td><td>Small</td><td>Manual</td></tr>
                            <tr><td><strong>VDI Script</strong></td><td>Virtual desktops</td><td>VDI</td><td>Special</td></tr>
                        </tbody>
                    </table>

                    <h4>Intune/MEM Onboarding</h4>
                    <div class="code-block">Intune Onboarding Steps:

PREREQUISITES:
├── Devices enrolled in Intune
├── Microsoft Defender for Endpoint license assigned
├── MDE-Intune connector configured
└── Appropriate Intune roles

STEP 1: CONFIGURE CONNECTOR
Path: security.microsoft.com → Settings → Endpoints → 
      Advanced features → Microsoft Intune connection
└── Enable connection

STEP 2: CREATE EDR POLICY
Path: Intune → Endpoint security → 
      Endpoint detection and response
├── Create policy
├── Platform: Windows 10/11
├── Profile: Endpoint detection and response
└── Settings:
    ├── Sample sharing: All
    ├── Expedite telemetry: Enable
    ├── Endpoint Detection and Response: Enable

STEP 3: ASSIGN TO DEVICES
├── All devices (full deployment)
├── Device groups (phased rollout)
└── Dynamic groups (by criteria)

STEP 4: MONITOR DEPLOYMENT
Path: Intune → Devices → Configuration profiles
├── Check assignment status
├── Verify successful deployment
└── Review errors/failures</div>

                    <h4>SCCM/MECM Onboarding</h4>
                    <div class="code-block">SCCM/MECM Onboarding Steps:

STEP 1: DOWNLOAD PACKAGE
Path: security.microsoft.com → Settings → Endpoints → 
      Onboarding → Download package
├── Select: Microsoft Endpoint Configuration Manager
└── Download: WindowsDefenderATPOnboardingPackage.zip

STEP 2: CREATE CONFIGURATION ITEM
Path: SCCM Console → Assets and Compliance → 
      Compliance Settings → Configuration Items
├── Create Configuration Item
├── Name: "MDE Onboarding"
├── Type: Windows 10
├── Settings: Use script from package

STEP 3: CREATE CONFIGURATION BASELINE
├── Add Configuration Item
├── Set remediation: Yes
└── Deploy to collections

STEP 4: DEPLOY TO COLLECTION
├── Target: Device Collection
├── Schedule: ASAP or scheduled
├── Remediate: Enable
└── Monitor: Compliance reporting

ALTERNATIVE: TASK SEQUENCE
├── Add "Run Command Line" step
├── Command: WindowsDefenderATPLocalOnboardingScript.cmd
├── Run as: System
└── Use for OS deployment integration</div>

                    <h4>Group Policy Onboarding</h4>
                    <div class="code-block">Group Policy Onboarding Steps:

STEP 1: DOWNLOAD PACKAGE
Path: security.microsoft.com → Settings → Endpoints → 
      Onboarding → Download package
├── Select: Group Policy
└── Download: WindowsDefenderATPOnboardingPackage.zip

STEP 2: CREATE NETWORK SHARE
├── Create share accessible by computers
├── Copy onboarding script to share
├── Set permissions: Domain Computers - Read
└── Path: \\fileserver\MDE\OnboardingScript.cmd

STEP 3: CREATE GPO
Path: Group Policy Management → Create GPO
├── Computer Configuration →
│   Policies → Windows Settings →
│   Scripts → Startup
├── Add Script:
│   └── \\fileserver\MDE\OnboardingScript.cmd
└── Link to appropriate OU

OPTIONAL: ADDITIONAL SETTINGS
Computer Configuration → Admin Templates →
  Windows Components → Microsoft Defender Antivirus →
  MAPS:
    ├── Join Microsoft MAPS: Advanced
    ├── Send file samples: Send all samples
    └── Configure local override: Disabled

VERIFICATION:
├── gpupdate /force on target machine
├── Check Event Viewer: Microsoft-Windows-SENSE
└── Verify in MDE portal</div>

                    <h4>Local Script Onboarding</h4>
                    <div class="code-block">Local Script Onboarding (Testing/Manual):

STEP 1: DOWNLOAD SCRIPT
Path: security.microsoft.com → Settings → Endpoints → 
      Onboarding → Download package
├── Select: Local Script
└── Download: WindowsDefenderATPLocalOnboardingScript.cmd

STEP 2: RUN SCRIPT
# Open elevated Command Prompt
cd C:\path\to\script
WindowsDefenderATPLocalOnboardingScript.cmd

# Expected output:
# "Onboarding successful."

STEP 3: VERIFY ONBOARDING
# Run detection test
powershell.exe -NoExit -ExecutionPolicy Bypass -WindowStyle Hidden 
  $ErrorActionPreference = 'silentlycontinue';
  (New-Object System.Net.WebClient).DownloadString(
    'https://aka.ms/ioavtest') | iex

# Should see test alert in portal within 10-30 minutes

STEP 4: VERIFY STATUS
# Check SENSE service
sc query sense

# Check onboarding state
reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
# OnboardingState should be 1

# PowerShell check
Get-MpComputerStatus | Select-Object AMRunningMode</div>
                </div>

                <!-- Server Onboarding -->
                <h2><i class="fas fa-server"></i> Server-Specific Onboarding</h2>
                <div class="config-section">
                    <h4>Windows Server 2019/2022</h4>
                    <div class="code-block">Server 2019/2022 Onboarding:

NATIVE SUPPORT:
├── Same process as Windows 10/11
├── Built-in Defender Antivirus
├── Full EDR capabilities
└── Use any deployment method

STEPS:
1. Ensure Windows Defender is enabled
   # Check status
   Get-WindowsFeature Windows-Defender*
   
   # Enable if needed
   Install-WindowsFeature Windows-Defender

2. Deploy using preferred method (Intune, SCCM, GPO, Script)

3. Configure server-specific settings
   # Performance optimization
   Add-MpPreference -ExclusionPath "D:\SQLData"
   Add-MpPreference -ExclusionProcess "sqlservr.exe"

4. Verify onboarding
   sc query sense
   reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"</div>

                    <h4>Windows Server 2016</h4>
                    <div class="code-block">Server 2016 Onboarding:

OPTION 1: MODERN UNIFIED SOLUTION (Recommended)
├── Download unified package from portal
├── Includes both EDR and EPP
├── No MMA dependency
└── Same capabilities as 2019/2022

STEPS:
1. Download package
   Path: Settings → Endpoints → Onboarding →
         Windows Server 2016/2019/2022

2. Install package
   msiexec /i md4ws.msi /quiet

3. Onboard with script
   WindowsDefenderATPLocalOnboardingScript.cmd

OPTION 2: MMA-BASED (Legacy)
├── Requires Microsoft Monitoring Agent
├── Separate EDR and AV
└── Being deprecated

STEPS:
1. Install MMA agent
2. Configure workspace (MDE workspace ID/key)
3. Run onboarding script</div>

                    <h4>Windows Server 2012 R2</h4>
                    <div class="code-block">Server 2012 R2 Onboarding:

MODERN UNIFIED SOLUTION:
├── Download unified installer
├── Prerequisites:
│   ├── .NET Framework 4.5+
│   ├── KB3080149 (servicing stack)
│   ├── KB2919355 (update)
│   └── TLS 1.2 enabled
└── Same capabilities as newer servers

INSTALLATION:
# Download from portal
# Run as Administrator:
msiexec /i md4ws.msi /quiet FORCEINSTALL=1

# Run onboarding script
.\WindowsDefenderATPLocalOnboardingScript.cmd

# Verify
sc query sense
Get-Service Sense

TROUBLESHOOTING:
├── Check prerequisites installed
├── Verify .NET 4.5+ present
├── Ensure TLS 1.2 enabled
└── Review installation logs: %temp%\md4ws*.log</div>
                </div>

                <!-- Verification & Troubleshooting -->
                <h2><i class="fas fa-check-circle"></i> Verification & Troubleshooting</h2>
                <div class="config-section">
                    <h4>Verification Steps</h4>
                    <div class="code-block">Onboarding Verification:

1. CHECK SENSE SERVICE
   sc query sense
   # STATE should be: RUNNING

2. CHECK REGISTRY
   reg query "HKLM\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
   # OnboardingState = 1 (onboarded)

3. CHECK POWERSHELL
   Get-MpComputerStatus | Select-Object *
   # AMRunningMode should be "Normal"

4. RUN DETECTION TEST
   # This creates a test alert
   powershell.exe -NoExit -ExecutionPolicy Bypass -WindowStyle Hidden $ErrorActionPreference='silentlycontinue';(New-Object System.Net.WebClient).DownloadString('https://aka.ms/ioavtest')|iex

5. CHECK PORTAL
   Path: security.microsoft.com → Devices → Device inventory
   ├── Device should appear within 5-30 minutes
   ├── Health state should be "Active"
   └── Test alert should appear

6. CONNECTIVITY TEST
   # Run MDE Client Analyzer
   # Download from: https://aka.ms/mdeanalyzer
   MDEClientAnalyzer.cmd
   # Review results for connectivity issues</div>

                    <h4>Common Issues</h4>
                    <div class="code-block">Troubleshooting Common Issues:

DEVICE NOT APPEARING IN PORTAL:
├── Check SENSE service running
├── Verify network connectivity to Microsoft URLs
├── Check OnboardingState registry value
├── Review Event Viewer: Microsoft-Windows-SENSE/Operational
└── Run MDEClientAnalyzer for diagnostics

SENSE SERVICE NOT STARTING:
├── Check if another EDR is installed (conflict)
├── Verify Windows Defender AV is enabled
├── Check for missing prerequisites
├── Review System Event Log for errors
└── Try re-running onboarding script

CONNECTIVITY ISSUES:
Required URLs (allow in firewall/proxy):
├── *.wd.microsoft.com
├── *.microsoftonline.com  
├── *.blob.core.windows.net
├── winatp-gw-cus.microsoft.com
├── winatp-gw-eus.microsoft.com
└── (Check docs for full list)

PARTIAL TELEMETRY:
├── Check diagnostic data level (Enhanced or Full)
├── Verify sample submission settings
├── Check for conflicting policies
└── Review MAPS settings

EVENT LOG LOCATIONS:
├── Microsoft-Windows-SENSE/Operational
├── Microsoft-Windows-Windows Defender/Operational
├── Application log (MsSense errors)
└── System log (service issues)

OFFBOARDING AND RE-ONBOARDING:
# If needed, offboard first
# Download offboarding script from portal
WindowsDefenderATPLocalOffboardingScript.cmd
# Wait 24 hours (cooling off period)
# Then onboard again</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What are the main onboarding methods for MDE?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Intune/MEM:</strong> Best for cloud-managed devices, uses EDR policy</li>
                                <li><strong>SCCM/MECM:</strong> Best for on-premises managed, uses configuration baseline</li>
                                <li><strong>Group Policy:</strong> Best for domain-joined, uses startup script</li>
                                <li><strong>Local Script:</strong> Best for testing, manual execution</li>
                                <li><strong>VDI Script:</strong> Optimized for non-persistent VDI</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you verify MDE onboarding was successful?</button>
                        <div class="qa-answer">
                            <ol>
                                <li>Check SENSE service: <code>sc query sense</code> (should be RUNNING)</li>
                                <li>Check registry: <code>OnboardingState = 1</code></li>
                                <li>Run detection test: <code>https://aka.ms/ioavtest</code></li>
                                <li>Verify device appears in portal (Devices → Device inventory)</li>
                                <li>Run MDEClientAnalyzer for full diagnostics</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you onboard Windows Server 2012 R2?</button>
                        <div class="qa-answer">
                            <ol>
                                <li>Install prerequisites: .NET 4.5+, TLS 1.2, servicing updates</li>
                                <li>Download modern unified solution (md4ws.msi)</li>
                                <li>Install: <code>msiexec /i md4ws.msi /quiet</code></li>
                                <li>Run onboarding script</li>
                                <li>Verify SENSE service running</li>
                            </ol>
                            <p>The modern unified solution provides full EDR capabilities without MMA dependency.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: Device not appearing in MDE portal - how do you troubleshoot?</button>
                        <div class="qa-answer">
                            <ol>
                                <li>Check SENSE service status (sc query sense)</li>
                                <li>Verify OnboardingState registry value = 1</li>
                                <li>Check Event Viewer: Microsoft-Windows-SENSE/Operational</li>
                                <li>Test connectivity to Microsoft URLs</li>
                                <li>Run MDEClientAnalyzer tool</li>
                                <li>Check for conflicting EDR products</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>