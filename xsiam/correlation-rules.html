<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correlation Rules | XSIAM | Nik's SIEM Compendium</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">XSIAM Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                    <a href="comparison.html" class="nav-link"><i class="fas fa-balance-scale"></i> vs Competitors</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Ingestion Methods</a>
                    <a href="broker-vm.html" class="nav-link"><i class="fas fa-server"></i> Broker VM</a>
                    <a href="agents.html" class="nav-link"><i class="fas fa-desktop"></i> Cortex Agents</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & XDM</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">XQL Query Language</div>
                    <a href="xql-fundamentals.html" class="nav-link"><i class="fas fa-terminal"></i> Fundamentals</a>
                    <a href="xql-advanced.html" class="nav-link"><i class="fas fa-code"></i> Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection & Response</div>
                    <a href="correlation-rules.html" class="nav-link active"><i class="fas fa-bell"></i> Correlation Rules</a>
                    <a href="xsoar-automation.html" class="nav-link"><i class="fas fa-robot"></i> XSOAR Automation</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-crosshairs"></i> Threat Intel</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Operations</div>
                    <a href="dashboards.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboards</a>
                    <a href="retention-tiers.html" class="nav-link"><i class="fas fa-archive"></i> Retention Tiers</a>
                    <a href="marketplace.html" class="nav-link"><i class="fas fa-store"></i> Marketplace</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">XSIAM</a><span class="separator">/</span>
                    <span class="current">Correlation Rules</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-project-diagram"></i> XSIAM Correlation Rules</h1>
                <p class="lead">Correlation rules are the detection engine of XSIAM. They analyze data patterns across sources and generate alerts when threats are detected. Master rule creation for effective security monitoring.</p>

                <!-- RULE TYPE DECISION TREE -->
                <h2><i class="fas fa-route"></i> Choosing the Right Rule Type</h2>
                
                <div class="decision-tree">
                    <div class="decision-node">
                        <div class="decision-node-question">What detection pattern are you implementing?</div>
                    </div>
                    <div class="decision-paths">
                        <div class="decision-path">
                            <div class="decision-path-label yes">Single Event Matching</div>
                            <div class="decision-path-content">
                                <p style="color: #3fb950; font-weight: 600;">→ IOC Rule or Simple Correlation</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Match specific indicators: IPs, hashes, domains. Fast, low latency.</p>
                            </div>
                        </div>
                        <div class="decision-path">
                            <div class="decision-path-label no">Multi-Event Pattern</div>
                            <div class="decision-path-content">
                                <p style="color: #d29922; font-weight: 600;">→ Sequence or Aggregation Rule</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Detect patterns over time: brute force, lateral movement, data staging.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-tree">
                    <div class="decision-node">
                        <div class="decision-node-question">Does detection require cross-source correlation?</div>
                    </div>
                    <div class="decision-paths">
                        <div class="decision-path">
                            <div class="decision-path-label yes">Yes - Multiple Data Sources</div>
                            <div class="decision-path-content">
                                <p style="color: #3fb950; font-weight: 600;">→ Use XDM Fields</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Query using xdm.* fields to correlate across vendors (firewall + EDR + identity).</p>
                            </div>
                        </div>
                        <div class="decision-path">
                            <div class="decision-path-label no">Single Source</div>
                            <div class="decision-path-content">
                                <p style="color: #d29922; font-weight: 600;">→ Vendor-Specific Fields OK</p>
                                <p style="color: #8b949e; font-size: 0.85rem;">Can use native field names for simpler rules.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RULE TYPES -->
                <h2><i class="fas fa-layer-group"></i> Correlation Rule Types</h2>
                
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1c3a5e; color: #58a6ff;"><i class="fas fa-bullseye"></i></div>
                            <div class="comparison-item-title">IOC Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Match known bad indicators</li>
                            <li><i class="fas fa-check"></i> IP addresses, domains, hashes</li>
                            <li><i class="fas fa-check"></i> Fastest detection (real-time)</li>
                            <li><i class="fas fa-check"></i> Integrated with TI feeds</li>
                            <li><i class="fas fa-info-circle"></i> High confidence, known threats</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #1a4d2e; color: #3fb950;"><i class="fas fa-calculator"></i></div>
                            <div class="comparison-item-title">Aggregation Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Count events over time</li>
                            <li><i class="fas fa-check"></i> Threshold-based detection</li>
                            <li><i class="fas fa-check"></i> Brute force, anomalies</li>
                            <li><i class="fas fa-check"></i> Group by entity (user, IP)</li>
                            <li><i class="fas fa-info-circle"></i> >10 failed logins in 5 min</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #4d3a0d; color: #d29922;"><i class="fas fa-stream"></i></div>
                            <div class="comparison-item-title">Sequence Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Ordered event patterns</li>
                            <li><i class="fas fa-check"></i> A then B then C detection</li>
                            <li><i class="fas fa-check"></i> Attack chain correlation</li>
                            <li><i class="fas fa-check"></i> Time window constraints</li>
                            <li><i class="fas fa-info-circle"></i> Login → Priv Esc → Exfil</li>
                        </ul>
                    </div>
                    <div class="comparison-item">
                        <div class="comparison-item-header">
                            <div class="comparison-item-icon" style="background: #3d2a5e; color: #a371f7;"><i class="fas fa-brain"></i></div>
                            <div class="comparison-item-title">ML/UEBA Rules</div>
                        </div>
                        <ul class="comparison-item-list">
                            <li><i class="fas fa-check"></i> Behavioral baselines</li>
                            <li><i class="fas fa-check"></i> Anomaly detection</li>
                            <li><i class="fas fa-check"></i> Pre-built ML models</li>
                            <li><i class="fas fa-check"></i> No threshold tuning</li>
                            <li><i class="fas fa-info-circle"></i> Unknown threats</li>
                        </ul>
                    </div>
                </div>

                <!-- RULE EXAMPLES -->
                <h2><i class="fas fa-code"></i> Rule Examples</h2>

                <h3>Example 1: Brute Force Detection (Aggregation)</h3>
                <div class="code-block">
                    <div class="code-header"><i class="fas fa-code"></i> XQL Correlation Rule</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect brute force login attempts</span>
<span style="color: #8b949e;">// Trigger: >10 failed logins from same source to same user in 5 minutes</span>

<span style="color: #79c0ff;">dataset</span> = xdr_data
| <span style="color: #79c0ff;">filter</span> xdm.event.type = "AUTHENTICATION" 
    <span style="color: #f97583;">and</span> xdm.auth.outcome = "FAILURE"
| <span style="color: #79c0ff;">comp</span> count() <span style="color: #f97583;">as</span> failed_attempts <span style="color: #f97583;">by</span> 
    xdm.source.ipv4, 
    xdm.target.user.username,
    bin(_time, 5m)
| <span style="color: #79c0ff;">filter</span> failed_attempts > 10
| <span style="color: #79c0ff;">alter</span> 
    alert_name = "Brute Force Attack Detected",
    severity = "HIGH",
    mitre_tactic = "Credential Access",
    mitre_technique = "T1110"
</pre>
                </div>

                <h3>Example 2: Suspicious Process Chain (Sequence)</h3>
                <div class="code-block">
                    <div class="code-header"><i class="fas fa-code"></i> XQL Sequence Rule</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Detect Office app spawning command interpreter</span>
<span style="color: #8b949e;">// Common initial access technique for malware</span>

<span style="color: #79c0ff;">dataset</span> = xdr_data
| <span style="color: #79c0ff;">filter</span> xdm.event.type = "PROCESS" 
    <span style="color: #f97583;">and</span> xdm.source.process.name <span style="color: #f97583;">in</span> ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "OUTLOOK.EXE")
    <span style="color: #f97583;">and</span> xdm.target.process.name <span style="color: #f97583;">in</span> ("cmd.exe", "powershell.exe", "wscript.exe", "cscript.exe")
| <span style="color: #79c0ff;">alter</span>
    alert_name = "Office Application Spawned Suspicious Process",
    severity = "CRITICAL",
    mitre_tactic = "Execution",
    mitre_technique = "T1059"
</pre>
                </div>

                <h3>Example 3: Data Exfiltration Pattern (Cross-Source)</h3>
                <div class="code-block">
                    <div class="code-header"><i class="fas fa-code"></i> XQL Cross-Source Correlation</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Correlate large file access with external upload</span>
<span style="color: #8b949e;">// Uses XDM fields to correlate EDR + Firewall data</span>

<span style="color: #79c0ff;">dataset</span> = xdr_data
| <span style="color: #79c0ff;">filter</span> xdm.event.type = "FILE" 
    <span style="color: #f97583;">and</span> xdm.event.operation = "READ"
    <span style="color: #f97583;">and</span> xdm.target.file.size > 10000000 <span style="color: #8b949e;">// >10MB</span>
| <span style="color: #79c0ff;">join</span> type=inner (
    <span style="color: #79c0ff;">dataset</span> = panw_ngfw_traffic
    | <span style="color: #79c0ff;">filter</span> xdm.network.direction = "OUTBOUND"
        <span style="color: #f97583;">and</span> xdm.target.sent_bytes > 10000000
        <span style="color: #f97583;">and</span> xdm.target.host.hostname <span style="color: #f97583;">not in</span> ("*.company.com", "*.microsoft.com")
) <span style="color: #f97583;">as</span> network 
<span style="color: #f97583;">on</span> xdm.source.host.hostname = network.xdm.source.host.hostname
| <span style="color: #79c0ff;">alter</span>
    alert_name = "Potential Data Exfiltration",
    severity = "CRITICAL"
</pre>
                </div>

                <!-- RULE LIFECYCLE -->
                <h2><i class="fas fa-sync-alt"></i> Rule Development Lifecycle</h2>
                
                <div class="pipeline">
                    <div class="pipeline-stage" data-step="1">
                        <div class="pipeline-stage-title">Identify Use Case</div>
                        <div class="pipeline-stage-desc">Define what threat you're detecting</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>MITRE ATT&CK technique mapping</li>
                                <li>Threat intelligence input</li>
                                <li>Gap analysis from coverage review</li>
                                <li>Incident lessons learned</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="2">
                        <div class="pipeline-stage-title">Write XQL Query</div>
                        <div class="pipeline-stage-desc">Develop detection logic</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Use XDM fields for portability</li>
                                <li>Test against historical data</li>
                                <li>Validate true positive rate</li>
                                <li>Check for false positives</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="3">
                        <div class="pipeline-stage-title">Configure Rule</div>
                        <div class="pipeline-stage-desc">Set parameters and metadata</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Set severity level</li>
                                <li>Configure time window</li>
                                <li>Add MITRE mapping</li>
                                <li>Set alert grouping</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="4">
                        <div class="pipeline-stage-title">Test & Tune</div>
                        <div class="pipeline-stage-desc">Validate in production</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Enable in test mode first</li>
                                <li>Monitor for false positives</li>
                                <li>Adjust thresholds</li>
                                <li>Add exclusions as needed</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage" data-step="5">
                        <div class="pipeline-stage-title">Operationalize</div>
                        <div class="pipeline-stage-desc">Deploy and maintain</div>
                        <div class="pipeline-stage-details">
                            <ul>
                                <li>Enable in production</li>
                                <li>Document for SOC</li>
                                <li>Link to playbook</li>
                                <li>Schedule regular review</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ENTERPRISE EXAMPLE -->
                <div class="enterprise-example">
                    <div class="enterprise-example-header">
                        <i class="fas fa-building"></i>
                        <div class="enterprise-example-title">Enterprise Example: Insider Threat Detection</div>
                    </div>
                    <div class="enterprise-example-scenario">
                        <strong>Scenario:</strong> Detect potential data theft by employees accessing unusual amounts of sensitive data before resignation.
                    </div>
                    
                    <div class="code-block" style="margin-top: 16px;">
                        <div class="code-header"><i class="fas fa-code"></i> Multi-Signal Correlation</div>
<pre style="color: #f0f6fc; background: #0d1117; padding: 16px; border-radius: 8px; overflow-x: auto;">
<span style="color: #8b949e;">// Correlate: HR resignation flag + unusual file access + external upload</span>

<span style="color: #79c0ff;">dataset</span> = xdr_data
| <span style="color: #79c0ff;">filter</span> xdm.event.type = "FILE" <span style="color: #f97583;">and</span> xdm.event.operation = "READ"
| <span style="color: #79c0ff;">comp</span> 
    count() <span style="color: #f97583;">as</span> file_access_count,
    sum(xdm.target.file.size) <span style="color: #f97583;">as</span> total_bytes
  <span style="color: #f97583;">by</span> xdm.source.user.username, bin(_time, 1d)
| <span style="color: #79c0ff;">filter</span> file_access_count > 100 <span style="color: #f97583;">or</span> total_bytes > 100000000
| <span style="color: #79c0ff;">join</span> type=inner (
    <span style="color: #79c0ff;">dataset</span> = hr_departures_list  <span style="color: #8b949e;">// Custom dataset from HR</span>
    | <span style="color: #79c0ff;">filter</span> resignation_date > now() - 30d
) <span style="color: #f97583;">on</span> xdm.source.user.username = employee_email
</pre>
                    </div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question">Q: How do you tune a correlation rule that has too many false positives?</button>
                        <div class="qa-answer">
                            <p><strong>Tuning approach:</strong></p>
                            <ol>
                                <li><strong>Analyze FPs:</strong> Identify common patterns in false alerts</li>
                                <li><strong>Add exclusions:</strong> Known good IPs, service accounts, expected behavior</li>
                                <li><strong>Adjust thresholds:</strong> Increase count/time window if too sensitive</li>
                                <li><strong>Add context:</strong> Require additional conditions (e.g., AND not from internal subnet)</li>
                                <li><strong>Whitelist entities:</strong> Create exception list for known benign sources</li>
                                <li><strong>Time-based exclusions:</strong> Exclude maintenance windows</li>
                            </ol>
                            <p><strong>Document all changes</strong> for audit trail and future reference.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question">Q: Why use XDM fields instead of vendor-specific fields in rules?</button>
                        <div class="qa-answer">
                            <p><strong>Benefits of XDM:</strong></p>
                            <ul>
                                <li><strong>Cross-vendor detection:</strong> One rule works across all data sources</li>
                                <li><strong>Correlation:</strong> Join firewall + EDR + identity with common field names</li>
                                <li><strong>Portability:</strong> Rules work when you add new data sources</li>
                                <li><strong>Maintenance:</strong> Don't need to update rules when vendor changes format</li>
                            </ul>
                            <p><strong>Example:</strong> A rule using xdm.source.ipv4 works for Palo Alto (src), Windows (IpAddress), AWS (sourceIPAddress), and Okta (client.ipAddress) - all automatically.</p>
                        </div>
                    </div>
                </div>

            </main>
            <footer class="main-footer">
                <div class="footer-content">
                    <p>Nik's SIEM Compendium</p>
                </div>
            </footer>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) {
                    answer.style.display = 'block';
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
