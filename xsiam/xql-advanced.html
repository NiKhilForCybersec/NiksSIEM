<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced XQL Techniques | XSIAM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <a href="../xsiam/index.html" class="sidebar-nav-link active" data-platform="xsiam">
                            <span class="platform-dot"></span>
                            <span>XSIAM</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../splunk/index.html" class="sidebar-nav-link" data-platform="splunk">
                            <span class="platform-dot"></span>
                            <span>Splunk</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../sentinel/index.html" class="sidebar-nav-link" data-platform="sentinel">
                            <span class="platform-dot"></span>
                            <span>Sentinel</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../crowdstrike/index.html" class="sidebar-nav-link" data-platform="crowdstrike">
                            <span class="platform-dot"></span>
                            <span>CrowdStrike</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../cortex/index.html" class="sidebar-nav-link" data-platform="cortex">
                            <span class="platform-dot"></span>
                            <span>Cortex XDR</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../mde/index.html" class="sidebar-nav-link" data-platform="mde">
                            <span class="platform-dot"></span>
                            <span>Defender for Endpoint</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="../operations/index.html" class="sidebar-nav-link" data-platform="operations">
                            <span class="platform-dot"></span>
                            <span>SOC Operations</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Current Platform Pages -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">XSIAM Pages</div>
                                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item">
                        <a href="index.html" class="sidebar-nav-link">
                            <i class="fas fa-home"></i>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="architecture.html" class="sidebar-nav-link">
                            <i class="fas fa-sitemap"></i>
                            <span>Architecture</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="data-ingestion.html" class="sidebar-nav-link">
                            <i class="fas fa-database"></i>
                            <span>Data Ingestion</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="broker-vm.html" class="sidebar-nav-link">
                            <i class="fas fa-server"></i>
                            <span>Broker VM</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="agents.html" class="sidebar-nav-link">
                            <i class="fas fa-microchip"></i>
                            <span>Agents</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="parsing-flows.html" class="sidebar-nav-link">
                            <i class="fas fa-stream"></i>
                            <span>Parsing & Flows</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="custom-log-onboarding.html" class="sidebar-nav-link">
                            <i class="fas fa-plus-circle"></i>
                            <span>Custom Log Onboarding</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="retention-tiers.html" class="sidebar-nav-link">
                            <i class="fas fa-archive"></i>
                            <span>Retention Tiers</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="xql-fundamentals.html" class="sidebar-nav-link">
                            <i class="fas fa-terminal"></i>
                            <span>XQL Fundamentals</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="xql-advanced.html" class="sidebar-nav-link active">
                            <i class="fas fa-rocket"></i>
                            <span>XQL Advanced</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="xdr-overview.html" class="sidebar-nav-link">
                            <i class="fas fa-shield-virus"></i>
                            <span>XDR & Detection</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="correlation-rules.html" class="sidebar-nav-link">
                            <i class="fas fa-project-diagram"></i>
                            <span>Correlation Rules</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="alert-management.html" class="sidebar-nav-link">
                            <i class="fas fa-bell"></i>
                            <span>Alert Management</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="xsoar-automation.html" class="sidebar-nav-link">
                            <i class="fas fa-robot"></i>
                            <span>XSOAR Automation</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="threat-intel.html" class="sidebar-nav-link">
                            <i class="fas fa-skull-crossbones"></i>
                            <span>Threat Intel</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="recon-asm.html" class="sidebar-nav-link">
                            <i class="fas fa-globe"></i>
                            <span>Recon & ASM</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="dashboards.html" class="sidebar-nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Dashboards</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="marketplace.html" class="sidebar-nav-link">
                            <i class="fas fa-store"></i>
                            <span>Marketplace</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="enterprise-soc.html" class="sidebar-nav-link">
                            <i class="fas fa-building"></i>
                            <span>Enterprise SOC</span>
                        </a>
                    </li>
                    <li class="sidebar-nav-item">
                        <a href="comparison.html" class="sidebar-nav-link">
                            <i class="fas fa-balance-scale"></i>
                            <span>Platform Comparison</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </aside>
    
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">XSIAM</a>
                    <span class="separator">/</span>
                    <span class="current">Xql Advanced</span>
                </div>

                <header class="page-header">
            <h1>Advanced XQL</h1>
            <p class="subtitle">Joins, Subqueries, Correlation Rules & Complex Analytics</p>
        </header>
        <!-- Joins Section -->
        <section class="content-section">
            <h2 class="section-title">XQL Joins</h2>
            <p class="intro-text">
                Joins allow you to combine data from multiple datasets or subqueries. This is essential for 
                correlating events across different log sources, enriching data, or building complex detection logic.
            </p>
            <div class="info-box">
                    <h4><i class="fas fa-info-circle"></i> Diagram</h4>
                    <p style="color: #8b949e;">See Data Ingestion page for detailed visual diagrams of this architecture.</p>
                </div>
            <div class="subsection">
                <h3 class="subsection-title">Join Syntax</h3>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">Basic Join Syntax</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Basic Join Structure</span>
<span class="keyword">dataset</span> = <span class="dataset">primary_dataset</span>
<span class="operator">|</span> <span class="function">join</span> <span class="keyword">type</span> = <span class="string">inner</span> (
    <span class="keyword">dataset</span> = <span class="dataset">secondary_dataset</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">some_condition</span>
    <span class="operator">|</span> <span class="function">fields</span> <span class="field">join_key</span>, <span class="field">enrichment_field</span>
) <span class="keyword">as</span> <span class="field">joined_data</span> <span class="field">joined_data</span>.<span class="field">join_key</span> = <span class="field">primary_key</span>
<span class="comment">// Available join types:</span>
<span class="comment">// type = inner (default) - Only matching rows</span>
<span class="comment">// type = left  - All from primary + matching secondary</span>
<span class="comment">// type = right - All from secondary + matching primary</span>
<span class="comment">// type = full  - All rows from both</span></pre>
                    </div>
                </div>
                <div class="memory-trick">
                    <div class="memory-trick-header">Memory Trick: Join Syntax Pattern</div>
                    <p><strong>"JOT-A-K" = Join On Type, Alias, Key</strong></p>
                    <p>‚Ä¢ <code>join type=X</code> - Specify type (inner/left/right/full)</p>
                    <p>‚Ä¢ <code>(...) as alias</code> - Give subquery an alias</p>
                    <p>‚Ä¢ <code>alias.key = main.key</code> - Define join condition</p>
                </div>
            </div>
            <div class="subsection">
                <h3 class="subsection-title">Practical Join Examples</h3>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">1. Enrich Process Events with Network Connections</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Find processes that made external connections</span>
<span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">PROCESS</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">action_process_image_name</span> <span class="function">contains</span> <span class="string">"powershell"</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, <span class="field">actor_process_instance_id</span>, 
        <span class="field">action_process_image_name</span>, <span class="field">actor_process_command_line</span>
<span class="operator">|</span> <span class="function">join</span> <span class="keyword">type</span> = <span class="string">left</span> (
    <span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">NETWORK</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">action_external_hostname</span> != <span class="keyword">null</span>
    <span class="operator">|</span> <span class="function">fields</span> <span class="field">causality_actor_process_instance_id</span>, 
            <span class="field">action_external_hostname</span>, <span class="field">dst_action_external_port</span>
    <span class="operator">|</span> <span class="function">dedup</span> <span class="field">causality_actor_process_instance_id</span>, <span class="field">action_external_hostname</span>
) <span class="keyword">as</span> <span class="field">network</span> <span class="field">network</span>.<span class="field">causality_actor_process_instance_id</span> = <span class="field">actor_process_instance_id</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">network</span>.<span class="field">action_external_hostname</span> != <span class="keyword">null</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, <span class="field">action_process_image_name</span>,
        <span class="field">actor_process_command_line</span>, <span class="field">network</span>.<span class="field">action_external_hostname</span></pre>
                    </div>
                </div>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">2. Cross-Dataset: Login from New Device + High-Risk Country</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Correlate Azure AD logins with threat intel</span>
<span class="keyword">dataset</span> = <span class="dataset">azure_ad_signin_raw</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">status_errorCode</span> = <span class="number">0</span> <span class="comment">// Successful login</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">deviceDetail_isManaged</span> = <span class="keyword">false</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">userPrincipalName</span>, <span class="field">ipAddress</span>, <span class="field">location_countryOrRegion</span>
<span class="operator">|</span> <span class="function">join</span> <span class="keyword">type</span> = <span class="string">inner</span> (
    <span class="comment">// High-risk countries lookup (could be from TIM)</span>
    <span class="keyword">dataset</span> = <span class="dataset">threat_intel_indicators</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">indicator_type</span> = <span class="string">"geo_country"</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">risk_score</span> > <span class="number">80</span>
    <span class="operator">|</span> <span class="function">fields</span> <span class="field">indicator_value</span> <span class="keyword">as</span> <span class="field">risky_country</span>
) <span class="keyword">as</span> <span class="field">threat</span> <span class="field">threat</span>.<span class="field">risky_country</span> = <span class="field">location_countryOrRegion</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">userPrincipalName</span>, <span class="field">ipAddress</span>, <span class="field">location_countryOrRegion</span></pre>
                    </div>
                </div>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">3. Self-Join: Find Processes Spawned by Suspicious Parent</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Find child processes of suspicious parents</span>
<span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">PROCESS</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, <span class="field">actor_process_instance_id</span>,
        <span class="field">actor_process_image_name</span>, <span class="field">causality_actor_process_instance_id</span>,
        <span class="field">action_process_image_name</span>, <span class="field">actor_process_command_line</span>
<span class="operator">|</span> <span class="function">join</span> <span class="keyword">type</span> = <span class="string">inner</span> (
    <span class="comment">// Find suspicious parent processes</span>
    <span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">PROCESS</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">action_process_image_name</span> ~= <span class="string">".*\\\\(mshta|wscript|cscript|regsvr32)\.exe"</span>
    <span class="operator">|</span> <span class="function">fields</span> <span class="field">actor_process_instance_id</span> <span class="keyword">as</span> <span class="field">parent_id</span>,
            <span class="field">action_process_image_name</span> <span class="keyword">as</span> <span class="field">parent_name</span>
) <span class="keyword">as</span> <span class="field">parent</span> <span class="field">parent</span>.<span class="field">parent_id</span> = <span class="field">causality_actor_process_instance_id</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, <span class="field">parent</span>.<span class="field">parent_name</span>,
        <span class="field">action_process_image_name</span>, <span class="field">actor_process_command_line</span></pre>
                    </div>
                </div>
            </div>
            <div class="warning-box">
                <div class="warning-box-title">‚ö†Ô∏è Join Performance Tips</div>
                <ul style="color: var(--text-primary); margin-left: 1.5rem;">
                    <li><strong>Filter early</strong> - Apply filters inside the subquery to reduce data</li>
                    <li><strong>Limit fields</strong> - Only select fields you need in both sides</li>
                    <li><strong>Use dedup</strong> - Remove duplicates before joining to avoid explosions</li>
                    <li><strong>Time-bound</strong> - Always limit time range, especially for large datasets</li>
                    <li><strong>Avoid full joins</strong> - They're expensive; use inner/left when possible</li>
                </ul>
            </div>
        </section>
        <!-- Subqueries Section -->
        <section class="content-section">
            <h2 class="section-title">Subqueries</h2>
            <p class="intro-text">
                Subqueries let you use the results of one query as input to another. They're essential for 
                complex filtering, dynamic thresholds, and multi-stage analysis.
            </p>
            <div class="subsection">
                <h3 class="subsection-title">Subquery Patterns</h3>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">Pattern 1: Filter Using Subquery Results</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Find all activity from hosts with critical alerts</span>
<span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">agent_hostname</span> <span class="keyword">in</span> (
    <span class="comment">// Subquery: Get hosts with critical alerts</span>
    <span class="keyword">dataset</span> = <span class="dataset">xdr_alerts</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">severity</span> = <span class="string">"CRITICAL"</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">_time</span> > <span class="function">subtract_time</span>(<span class="function">current_time</span>(), <span class="string">"24h"</span>)
    <span class="operator">|</span> <span class="function">comp</span> <span class="function">values</span>(<span class="field">agent_hostname</span>)
)
<span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> <span class="keyword">in</span> (<span class="string">PROCESS</span>, <span class="string">NETWORK</span>, <span class="string">FILE</span>)
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, <span class="field">event_type</span>, <span class="field">action_process_image_name</span>
<span class="operator">|</span> <span class="function">sort</span> <span class="keyword">desc</span> <span class="field">_time</span></pre>
                    </div>
                </div>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">Pattern 2: Dynamic Threshold (Baseline Comparison)</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Find users with login attempts above their normal baseline</span>
<span class="keyword">dataset</span> = <span class="dataset">azure_ad_signin_raw</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">_time</span> > <span class="function">subtract_time</span>(<span class="function">current_time</span>(), <span class="string">"1h"</span>)
<span class="operator">|</span> <span class="function">comp</span> <span class="function">count</span>() <span class="keyword">as</span> <span class="field">current_hour_logins</span> <span class="keyword">by</span> <span class="field">userPrincipalName</span>
<span class="operator">|</span> <span class="function">join</span> <span class="keyword">type</span> = <span class="string">inner</span> (
    <span class="comment">// Baseline: Average logins per hour over past week</span>
    <span class="keyword">dataset</span> = <span class="dataset">azure_ad_signin_raw</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">_time</span> > <span class="function">subtract_time</span>(<span class="function">current_time</span>(), <span class="string">"7d"</span>)
    <span class="operator">|</span> <span class="function">comp</span> <span class="function">count</span>() <span class="keyword">as</span> <span class="field">total_logins</span> <span class="keyword">by</span> <span class="field">userPrincipalName</span>
    <span class="operator">|</span> <span class="function">alter</span> <span class="field">avg_hourly</span> = <span class="field">total_logins</span> / (<span class="number">7</span> * <span class="number">24</span>)
    <span class="operator">|</span> <span class="function">fields</span> <span class="field">userPrincipalName</span>, <span class="field">avg_hourly</span>
) <span class="keyword">as</span> <span class="field">baseline</span> <span class="field">baseline</span>.<span class="field">userPrincipalName</span> = <span class="field">userPrincipalName</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">threshold</span> = <span class="field">baseline</span>.<span class="field">avg_hourly</span> * <span class="number">3</span> <span class="comment">// 3x normal</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">current_hour_logins</span> > <span class="field">threshold</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">userPrincipalName</span>, <span class="field">current_hour_logins</span>, <span class="field">baseline</span>.<span class="field">avg_hourly</span>, <span class="field">threshold</span></pre>
                    </div>
                </div>
                <div class="arch-diagram">
                    <div class="code-header">
                        <span class="code-lang">XQL</span>
                        <span class="code-title">Pattern 3: Exclusion List (NOT IN)</span>
                    </div>
                    <div class="code-content">
<pre><span class="comment">// Find processes NOT in the approved baseline</span>
<span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">PROCESS</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">action_process_image_sha256</span> <span class="keyword">not in</span> (
    <span class="comment">// Approved process hashes (from asset list or lookup)</span>
    <span class="keyword">dataset</span> = <span class="dataset">xdr_assets_baseline</span>
    <span class="operator">|</span> <span class="function">filter</span> <span class="field">approval_status</span> = <span class="string">"approved"</span>
    <span class="operator">|</span> <span class="function">comp</span> <span class="function">values</span>(<span class="field">process_sha256</span>)
)
<span class="operator">|</span> <span class="function">comp</span> <span class="function">count</span>() <span class="keyword">as</span> <span class="field">execution_count</span>,
      <span class="function">count_distinct</span>(<span class="field">agent_hostname</span>) <span class="keyword">as</span> <span class="field">host_count</span>
      <span class="keyword">by</span> <span class="field">action_process_image_name</span>, <span class="field">action_process_image_sha256</span>
<span class="operator">|</span> <span class="function">sort</span> <span class="keyword">desc</span> <span class="field">host_count</span></pre>
                    </div>
                </div>
            </div>
            <div class="interview-box">
                <div class="interview-header">Interview Answer: When to Use Subqueries vs Joins</div>
                <p><strong>Q: When would you use a subquery versus a join in XQL?</strong></p>
                <p>"The choice depends on what you're trying to accomplish:</p>
                <p><strong>Use Subqueries when:</strong></p>
                <p>‚Ä¢ You need a simple IN/NOT IN filter against a list of values</p>
                <p>‚Ä¢ You're creating dynamic thresholds or baselines</p>
                <p>‚Ä¢ You don't need fields from both datasets in the final output</p>
                <p><strong>Use Joins when:</strong></p>
                <p>‚Ä¢ You need to enrich data by adding fields from another dataset</p>
                <p>‚Ä¢ You need to correlate events with complex matching conditions</p>
                <p>‚Ä¢ You need fields from both datasets in your output</p>
                <p>In XSIAM specifically, subqueries inside IN clauses are often more performant for simple filtering."</p>
            </div>
        </section>
        <!-- Correlation Rules Section -->
        <section class="content-section">
            <h2 class="section-title">XQL Correlation Rules</h2>
            <p class="intro-text">
                Correlation rules are the heart of XSIAM's detection engine. They use XQL to identify threats by 
                correlating events across multiple data sources and time windows.
            </p>
            <div class="info-box">
                    <h4><i class="fas fa-info-circle"></i> Diagram</h4>
                    <p style="color: #8b949e;">See Data Ingestion page for detailed visual diagrams of this architecture.</p>
                </div>
            <div class="subsection">
                <h3 class="subsection-title">Correlation Rule Examples</h3>
                <div class="use-case-grid">
                    <div class="use-case-card">
                        <div class="use-case-header">
                            <div class="use-case-title">Brute Force Detection</div>
                            <div class="use-case-desc">Multiple failed logins followed by success</div>
                        </div>
                        <div class="use-case-body">
                            <span class="rule-type correlation">Correlation</span>
                            <div class="arch-diagram" style="margin-top: 1rem;">
                                <div class="code-content">
<pre><span class="comment">// Brute force: 10+ failures then success within 10 min</span>
<span class="keyword">dataset</span> = <span class="dataset">azure_ad_signin_raw</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">login_status</span> = <span class="keyword">if</span>(<span class="field">status_errorCode</span> = <span class="number">0</span>, 
    <span class="string">"success"</span>, <span class="string">"failure"</span>)
<span class="operator">|</span> <span class="function">comp</span> 
    <span class="function">count</span>(<span class="field">login_status</span> = <span class="string">"failure"</span>) <span class="keyword">as</span> <span class="field">failures</span>,
    <span class="function">count</span>(<span class="field">login_status</span> = <span class="string">"success"</span>) <span class="keyword">as</span> <span class="field">successes</span>,
    <span class="function">min</span>(<span class="field">_time</span>) <span class="keyword">as</span> <span class="field">first_attempt</span>,
    <span class="function">max</span>(<span class="field">_time</span>) <span class="keyword">as</span> <span class="field">last_attempt</span>
    <span class="keyword">by</span> <span class="field">userPrincipalName</span>, <span class="field">ipAddress</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">failures</span> >= <span class="number">10</span> <span class="keyword">and</span> <span class="field">successes</span> >= <span class="number">1</span></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="use-case-card">
                        <div class="use-case-header">
                            <div class="use-case-title">Lateral Movement Chain</div>
                            <div class="use-case-desc">RDP/SMB to multiple hosts from single source</div>
                        </div>
                        <div class="use-case-body">
                            <span class="rule-type correlation">Correlation</span>
                            <div class="arch-diagram" style="margin-top: 1rem;">
                                <div class="code-content">
<pre><span class="comment">// 5+ unique destinations via RDP/SMB in 30 min</span>
<span class="keyword">dataset</span> = <span class="dataset">panw_ngfw_traffic_raw</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">app</span> <span class="keyword">in</span> (<span class="string">"ms-rdp"</span>, <span class="string">"ms-smb"</span>, <span class="string">"ms-wmi"</span>)
<span class="operator">|</span> <span class="function">filter</span> <span class="field">action</span> = <span class="string">"allow"</span>
<span class="operator">|</span> <span class="function">comp</span> 
    <span class="function">count_distinct</span>(<span class="field">dst_ip</span>) <span class="keyword">as</span> <span class="field">unique_targets</span>,
    <span class="function">values</span>(<span class="field">dst_ip</span>) <span class="keyword">as</span> <span class="field">target_list</span>,
    <span class="function">count</span>() <span class="keyword">as</span> <span class="field">total_connections</span>
    <span class="keyword">by</span> <span class="field">src_ip</span>, <span class="field">src_user</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">unique_targets</span> >= <span class="number">5</span></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="use-case-card">
                        <div class="use-case-header">
                            <div class="use-case-title">Data Exfiltration Pattern</div>
                            <div class="use-case-desc">Large data transfer to external destination</div>
                        </div>
                        <div class="use-case-body">
                            <span class="rule-type analytics">Analytics</span>
                            <div class="arch-diagram" style="margin-top: 1rem;">
                                <div class="code-content">
<pre><span class="comment">// High outbound transfer to external IPs</span>
<span class="keyword">dataset</span> = <span class="dataset">panw_ngfw_traffic_raw</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">direction</span> = <span class="string">"outbound"</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">dst_ip</span> !~= <span class="string">"^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)"</span>
<span class="operator">|</span> <span class="function">comp</span> 
    <span class="function">sum</span>(<span class="field">bytes_sent</span>) <span class="keyword">as</span> <span class="field">total_bytes</span>
    <span class="keyword">by</span> <span class="field">src_ip</span>, <span class="field">src_user</span>, <span class="field">dst_ip</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">total_mb</span> = <span class="field">total_bytes</span> / <span class="number">1048576</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">total_mb</span> > <span class="number">500</span> <span class="comment">// 500 MB threshold</span></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="use-case-card">
                        <div class="use-case-header">
                            <div class="use-case-title">Suspicious Process Chain</div>
                            <div class="use-case-desc">Office app spawning cmd/powershell/wscript</div>
                        </div>
                        <div class="use-case-body">
                            <span class="rule-type bioc">BIOC</span>
                            <div class="arch-diagram" style="margin-top: 1rem;">
                                <div class="code-content">
<pre><span class="comment">// Office app ‚Üí suspicious child process</span>
<span class="keyword">dataset</span> = <span class="dataset">xdr_data</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">event_type</span> = <span class="string">PROCESS</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">actor_process_image_name</span> ~= 
    <span class="string">".*\\\\(winword|excel|powerpnt|outlook)\\.exe"</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">action_process_image_name</span> ~= 
    <span class="string">".*\\\\(cmd|powershell|wscript|cscript|mshta)\\.exe"</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">_time</span>, <span class="field">agent_hostname</span>, 
        <span class="field">actor_process_image_name</span>, 
        <span class="field">action_process_image_name</span>,
        <span class="field">actor_process_command_line</span></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="memory-trick">
                <div class="memory-trick-header">Memory Trick: Rule Types in XSIAM</div>
                <p><strong>"B.C.A." = BIOC, Correlation, Analytics</strong></p>
                <p>‚Ä¢ <strong>BIOC</strong> (Behavioral IOC) - Endpoint-focused, process/file/registry patterns, run by XDR agent</p>
                <p>‚Ä¢ <strong>Correlation</strong> - Cross-source, XQL-based, time-window aggregations, run centrally</p>
                <p>‚Ä¢ <strong>Analytics</strong> - ML-based anomaly detection, baseline comparisons, run by analytics engine</p>
            </div>
        </section>
        <!-- Window Functions -->
        <section class="content-section">
            <h2 class="section-title">Time-Based Analytics</h2>
            <p class="intro-text">
                Time-based analytics are crucial for detecting patterns that unfold over time, such as 
                beaconing, periodic data exfiltration, or slow credential stuffing attacks.
            </p>
            <div class="arch-diagram">
                <div class="code-header">
                    <span class="code-lang">XQL</span>
                    <span class="code-title">Beaconing Detection (Regular Interval Connections)</span>
                </div>
                <div class="code-content">
<pre><span class="comment">// Detect beaconing by analyzing connection intervals</span>
<span class="keyword">dataset</span> = <span class="dataset">panw_ngfw_traffic_raw</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">_time</span> > <span class="function">subtract_time</span>(<span class="function">current_time</span>(), <span class="string">"24h"</span>)
<span class="operator">|</span> <span class="function">filter</span> <span class="field">direction</span> = <span class="string">"outbound"</span>
<span class="operator">|</span> <span class="function">sort</span> <span class="keyword">asc</span> <span class="field">_time</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">prev_time</span> = <span class="function">prev</span>(<span class="field">_time</span>, <span class="field">src_ip</span>, <span class="field">dst_ip</span>)
<span class="operator">|</span> <span class="function">alter</span> <span class="field">interval_seconds</span> = <span class="function">timestamp_diff</span>(<span class="field">_time</span>, <span class="field">prev_time</span>, <span class="string">"SECOND"</span>)
<span class="operator">|</span> <span class="function">filter</span> <span class="field">interval_seconds</span> > <span class="number">0</span>
<span class="operator">|</span> <span class="function">comp</span> 
    <span class="function">avg</span>(<span class="field">interval_seconds</span>) <span class="keyword">as</span> <span class="field">avg_interval</span>,
    <span class="function">stddev</span>(<span class="field">interval_seconds</span>) <span class="keyword">as</span> <span class="field">interval_stddev</span>,
    <span class="function">count</span>() <span class="keyword">as</span> <span class="field">connection_count</span>
    <span class="keyword">by</span> <span class="field">src_ip</span>, <span class="field">dst_ip</span>, <span class="field">dst_port</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">connection_count</span> > <span class="number">50</span> <span class="comment">// Enough samples</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">beacon_score</span> = <span class="field">avg_interval</span> / (<span class="field">interval_stddev</span> + <span class="number">1</span>)
<span class="operator">|</span> <span class="function">filter</span> <span class="field">beacon_score</span> > <span class="number">10</span> <span class="comment">// High regularity = likely beacon</span>
<span class="operator">|</span> <span class="function">sort</span> <span class="keyword">desc</span> <span class="field">beacon_score</span></pre>
                </div>
            </div>
            <div class="arch-diagram">
                <div class="code-header">
                    <span class="code-lang">XQL</span>
                    <span class="code-title">Hourly Activity Baseline Comparison</span>
                </div>
                <div class="code-content">
<pre><span class="comment">// Compare current hour to historical baseline per user</span>
<span class="keyword">dataset</span> = <span class="dataset">azure_ad_signin_raw</span>
<span class="operator">|</span> <span class="function">alter</span> <span class="field">hour_of_day</span> = <span class="function">extract_time</span>(<span class="field">_time</span>, <span class="string">"HOUR"</span>)
<span class="operator">|</span> <span class="function">alter</span> <span class="field">day_of_week</span> = <span class="function">extract_time</span>(<span class="field">_time</span>, <span class="string">"DAYOFWEEK"</span>)
<span class="operator">|</span> <span class="function">alter</span> <span class="field">is_today</span> = <span class="keyword">if</span>(
    <span class="field">_time</span> > <span class="function">subtract_time</span>(<span class="function">current_time</span>(), <span class="string">"24h"</span>), 
    <span class="number">1</span>, <span class="number">0</span>)
<span class="operator">|</span> <span class="function">comp</span> 
    <span class="function">sum</span>(<span class="field">is_today</span>) <span class="keyword">as</span> <span class="field">today_count</span>,
    <span class="function">count</span>() <span class="keyword">as</span> <span class="field">total_historical</span>,
    <span class="function">avg</span>(<span class="keyword">if</span>(<span class="field">is_today</span> = <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)) <span class="keyword">as</span> <span class="field">historical_avg</span>
    <span class="keyword">by</span> <span class="field">userPrincipalName</span>, <span class="field">hour_of_day</span>
<span class="operator">|</span> <span class="function">filter</span> <span class="field">today_count</span> > <span class="field">historical_avg</span> * <span class="number">5</span> <span class="comment">// 5x normal</span>
<span class="operator">|</span> <span class="function">fields</span> <span class="field">userPrincipalName</span>, <span class="field">hour_of_day</span>, <span class="field">today_count</span>, <span class="field">historical_avg</span></pre>
                </div>
            </div>
            <div class="tip-box">
                <div class="tip-box-title">üí° Pro Tip: prev() and next() Functions</div>
                <p>The <code>prev()</code> and <code>next()</code> functions are powerful for time-series analysis:</p>
                <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-primary);">
                    <li><code>prev(field, partition_by)</code> - Get previous row's value</li>
                    <li><code>next(field, partition_by)</code> - Get next row's value</li>
                    <li>Use with <code>sort</code> first to ensure proper ordering</li>
                    <li>Partition fields ensure you compare within the same group</li>
                </ul>
            </div>
        </section>
        <!-- Comparison with Other Platforms -->
        <section class="content-section">
            <h2 class="section-title">Advanced Operations: XQL vs KQL vs SPL</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th class="xsiam">XQL (XSIAM)</th>
                        <th class="sentinel">KQL (Sentinel)</th>
                        <th class="splunk">SPL (Splunk)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Inner Join</strong></td>
                        <td><code>| join type=inner (...) as t t.k = k</code></td>
                        <td><code>| join kind=inner (...) on k</code></td>
                        <td><code>| join type=inner [...] </code></td>
                    </tr>
                    <tr>
                        <td><strong>Left Join</strong></td>
                        <td><code>| join type=left (...)</code></td>
                        <td><code>| join kind=leftouter (...)</code></td>
                        <td><code>| join type=left [...] </code></td>
                    </tr>
                    <tr>
                        <td><strong>Subquery Filter</strong></td>
                        <td><code>| filter f in (dataset...)</code></td>
                        <td><code>| where f in (Table...)</code></td>
                        <td><code>| where f IN [search...]</code></td>
                    </tr>
                    <tr>
                        <td><strong>Time Bucket</strong></td>
                        <td><code>| alter hour = extract_time(_time, "HOUR")</code></td>
                        <td><code>| bin TimeGenerated span=1h</code></td>
                        <td><code>| bucket span=1h _time</code></td>
                    </tr>
                    <tr>
                        <td><strong>Previous Row</strong></td>
                        <td><code>| alter prev = prev(field, partition)</code></td>
                        <td><code>| serialize | extend prev = prev(field)</code></td>
                        <td><code>| autoregress field p=1</code></td>
                    </tr>
                    <tr>
                        <td><strong>Standard Deviation</strong></td>
                        <td><code>| comp stddev(field) by group</code></td>
                        <td><code>| summarize stdev(field) by group</code></td>
                        <td><code>| stats stdev(field) by group</code></td>
                    </tr>
                    <tr>
                        <td><strong>Percentile</strong></td>
                        <td><code>| comp percentile(field, 95)</code></td>
                        <td><code>| summarize percentile(field, 95)</code></td>
                        <td><code>| stats perc95(field)</code></td>
                    </tr>
                    <tr>
                        <td><strong>Conditional Count</strong></td>
                        <td><code>| comp count(condition) as c</code></td>
                        <td><code>| summarize countif(condition)</code></td>
                        <td><code>| stats count(eval(condition))</code></td>
                    </tr>
                </tbody>
            </table>
        </section>
        <!-- Best Practices -->
        <section class="content-section">
            <h2 class="section-title">Best Practices for Complex Queries</h2>
            <div class="concept-card">
                <h4>1. Query Structure Pattern</h4>
                <p>Follow this order for maintainable, performant queries:</p>
                <ol style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-secondary);">
                    <li><strong>Dataset</strong> - Start with the primary data source</li>
                    <li><strong>Time Filter</strong> - Limit time range immediately</li>
                    <li><strong>Selective Filters</strong> - Most restrictive filters first</li>
                    <li><strong>Field Selection</strong> - Reduce columns early</li>
                    <li><strong>Joins</strong> - Add after primary filtering</li>
                    <li><strong>Transforms</strong> - Create calculated fields</li>
                    <li><strong>Aggregations</strong> - Group and summarize</li>
                    <li><strong>Final Filters</strong> - Filter aggregated results</li>
                    <li><strong>Sort & Limit</strong> - Order and cap output</li>
                </ol>
            </div>
            <div class="concept-card">
                <h4>2. Performance Optimization Checklist</h4>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                    <li>‚úì Always specify time range (preferably in first filter)</li>
                    <li>‚úì Filter on indexed XDM fields (event_type, action_process_image_name)</li>
                    <li>‚úì Use <code>contains</code> instead of regex when possible</li>
                    <li>‚úì Dedup before joins to prevent Cartesian explosions</li>
                    <li>‚úì Select only needed fields before expensive operations</li>
                    <li>‚úì Use <code>limit</code> during development, remove for production rules</li>
                    <li>‚úì Test with small time windows first, then expand</li>
                </ul>
            </div>
            <div class="concept-card">
                <h4>3. Correlation Rule Design</h4>
                <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                    <li>‚úì Name rules clearly: <code>[MITRE Tactic] Description - Data Source</code></li>
                    <li>‚úì Include MITRE ATT&CK mappings for context</li>
                    <li>‚úì Set appropriate severity (don't make everything Critical)</li>
                    <li>‚úì Define clear aggregation keys (user, host, IP)</li>
                    <li>‚úì Use sensible thresholds based on environment baseline</li>
                    <li>‚úì Document expected false positive scenarios</li>
                    <li>‚úì Create suppression rules for known-good behaviors</li>
                </ul>
            </div>
            <div class="interview-box">
                <div class="interview-header">Interview Answer: Building Effective Detection Rules</div>
                <p><strong>Q: Walk me through your process for creating a correlation rule in XSIAM.</strong></p>
                <p>"My process follows these steps:</p>
                <p><strong>1. Understand the Threat:</strong> Start with the MITRE technique or threat behavior I want to detect. Research what log sources would capture this activity.</p>
                <p><strong>2. Data Discovery:</strong> Run exploratory queries to understand what the data looks like, field names, and normal patterns in our environment.</p>
                <p><strong>3. Build the Detection Logic:</strong> Start simple, then add complexity. First get the basic filter working, then add aggregations and thresholds.</p>
                <p><strong>4. Baseline and Tune:</strong> Run the query historically to see what would have triggered. Adjust thresholds to balance detection vs. false positives.</p>
                <p><strong>5. Add Context:</strong> Include MITRE mappings, set appropriate severity, and write clear alert descriptions that help analysts understand the finding.</p>
                <p><strong>6. Test and Monitor:</strong> Enable in detection-only mode first, review alerts, tune as needed before enabling automated response."</p>
            </div>
        </section>
        <!-- Navigation -->
        <section class="content-section">
            <h2 class="section-title">Continue Learning</h2>
            <div class="nav-cards">
                <a href="xdr-overview.html" class="nav-card">
                    <div class="nav-card-title">XDR & Detection ‚Üí</div>
                    <div class="nav-card-desc">BIOC rules, endpoint analytics, and investigation workflows</div>
                </a>
                <a href="xsoar-automation.html" class="nav-card">
                    <div class="nav-card-title">XSOAR Automation ‚Üí</div>
                    <div class="nav-card-desc">Playbooks, integrations, and automated response</div>
                </a>
                <a href="xql-fundamentals.html" class="nav-card">
                    <div class="nav-card-title">‚Üê XQL Basics</div>
                    <div class="nav-card-desc">Review fundamental syntax and operators</div>
                </a>
                <a href="index.html" class="nav-card">
                    <div class="nav-card-title">‚Üê XSIAM Home</div>
                    <div class="nav-card-desc">Return to the main guide</div>
                </a>
            </div>
        </section>

        <!-- Decision Tree: Advanced XQL Technique Selection -->
        <section class="content-section">
            <div class="decision-tree">
                <h3><i class="fas fa-sitemap"></i> Decision Tree: Choose the Right Advanced Technique</h3>
                
                <div class="decision-node">
                    <i class="fas fa-question-circle"></i>
                    <strong>What is your analysis goal?</strong>
                    <small>Determine what you're trying to achieve</small>
                </div>
                
                <div class="decision-branch">
                    <div class="decision-arrow" style="background-color: #58a6ff;">Enrich with External Data</div>
                    <div class="decision-outcome" style="border-left-color: #58a6ff;">
                        <i class="fas fa-plus-circle" style="color: #58a6ff;"></i>
                        <strong>Use: JOIN</strong>
                        <small><code>| join type=left (...) as enrichment enrichment.key = primary.key</code> | Adds fields from another dataset</small>
                    </div>
                </div>
                
                <div class="decision-branch">
                    <div class="decision-arrow" style="background-color: #3fb950;">Filter Against a List</div>
                    <div class="decision-node">
                        <i class="fas fa-question-circle"></i>
                        <strong>Is the list static or dynamic?</strong>
                        <small>Known values vs. query-generated list</small>
                    </div>
                    
                    <div class="decision-branch">
                        <div class="decision-arrow yes">Static List</div>
                        <div class="decision-outcome" style="border-left-color: #3fb950;">
                            <i class="fas fa-list" style="color: #3fb950;"></i>
                            <strong>Use: IN operator</strong>
                            <small><code>| filter field in ("val1", "val2", "val3")</code></small>
                        </div>
                    </div>
                    
                    <div class="decision-branch">
                        <div class="decision-arrow no">Dynamic List</div>
                        <div class="decision-outcome" style="border-left-color: #d29922;">
                            <i class="fas fa-code-branch" style="color: #d29922;"></i>
                            <strong>Use: Subquery with IN</strong>
                            <small><code>| filter field in (dataset = ... | comp values(field))</code></small>
                        </div>
                    </div>
                </div>
                
                <div class="decision-branch">
                    <div class="decision-arrow" style="background-color: #a371f7;">Compare to Baseline</div>
                    <div class="decision-outcome" style="border-left-color: #a371f7;">
                        <i class="fas fa-chart-line" style="color: #a371f7;"></i>
                        <strong>Use: Join + Baseline Subquery</strong>
                        <small>Calculate baseline in subquery, join to current data, filter on deviation | See "Dynamic Threshold" pattern</small>
                    </div>
                </div>
                
                <div class="decision-branch">
                    <div class="decision-arrow" style="background-color: #f85149;">Sequence Detection</div>
                    <div class="decision-outcome" style="border-left-color: #f85149;">
                        <i class="fas fa-sort-amount-down" style="color: #f85149;"></i>
                        <strong>Use: Window Functions + Self-Join</strong>
                        <small>Use prev(), timestamp arithmetic, or correlation rules with time windows</small>
                    </div>
                </div>
                
                <div class="decision-branch">
                    <div class="decision-arrow" style="background-color: #8b949e;">Combine Multiple Sources</div>
                    <div class="decision-outcome" style="border-left-color: #8b949e;">
                        <i class="fas fa-object-ungroup" style="color: #8b949e;"></i>
                        <strong>Use: UNION</strong>
                        <small><code>dataset = ds1 | union (dataset = ds2)</code> | Stacks rows from multiple datasets</small>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Comprehensive Interview Q&A -->
        <section class="content-section">
            <h2><i class="fas fa-comments"></i> Interview Questions</h2>
            <div class="qa-section">
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk me through how you would build a correlation rule that detects lateral movement using XQL.</button>
                    <div class="qa-answer">
                        <p>Detecting lateral movement requires correlating activity across multiple hosts over time, which is exactly what XSIAM's correlation rules are designed for. My approach combines authentication events, process execution, and network connections.</p>
                        <p>First, I identify the data sources I need. For lateral movement, I'm looking at authentication events showing where a user logged in, process events showing what they executed (especially remote tools like PsExec, WMI, or PowerShell remoting), and network connections showing RDP, SMB, or WinRM traffic between internal hosts.</p>
                        <p>The correlation rule structure uses a join to connect authentication success on a target host with suspicious process execution shortly after. Something like: <code>dataset = xdr_data | filter event_type = ENUM.PROCESS | filter action_process_image_name in ("psexec.exe", "wmiprvse.exe") | join type = inner (dataset = identity_logs | filter event_outcome = "SUCCESS" | filter _time > ago(15m)) as auth auth.target_host = agent_hostname and auth.username = actor_effective_username</code></p>
                        <p>The key tuning elements are the time window (I usually start with 15 minutes between authentication and process execution), the list of suspicious processes, and exclusions for legitimate admin activity. I test against historical data to baseline what's normal‚ÄîIT admins using tools like SCCM will trigger this, so I need exclusions or a separate allowlist of admin accounts and source IPs.</p>
                        <p>For production, I add context fields like source host, target host, username, and the specific process that executed. I also set the MITRE ATT&CK mapping to T1021 (Remote Services) and configure the severity based on whether the source is a known admin jump host or an unexpected workstation.</p>
                    </div>
                </div>
                
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Explain the difference between joins and subqueries in XQL. When would you use each?</button>
                    <div class="qa-answer">
                        <p>This is a fundamental design choice that affects both query structure and performance. The key difference is what you get in your output and how the query engine processes the data.</p>
                        <p>Joins combine rows from two datasets based on matching keys and give you fields from both datasets in the output. Use joins when you need to enrich your primary data with additional context‚Äîlike adding user details to process events, or adding threat intel context to network connections. The result is a wider row with columns from both sources. Join types (inner, left, right, full) control which rows appear when matches aren't found.</p>
                        <p>Subqueries, particularly with IN or NOT IN operators, are for filtering. The subquery generates a list of values, and the main query uses that list to include or exclude rows. You don't get fields from the subquery in your output‚Äîit's purely a filter mechanism. Use subqueries for things like "show me activity from hosts that had critical alerts" or "find processes not in our approved baseline."</p>
                        <p>From a performance perspective, subqueries with IN are often faster for simple filtering because the query engine can optimize them as lookups. Joins are more expensive because they need to match and combine every qualifying row. For large datasets, I always dedup the secondary dataset before joining to prevent Cartesian explosion.</p>
                        <p>The practical rule I follow: if I need columns from the secondary dataset in my output, use a join. If I just need to filter based on whether something exists in another dataset, use a subquery.</p>
                    </div>
                </div>
                
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you build a dynamic baseline detection that alerts when user activity exceeds their normal pattern?</button>
                    <div class="qa-answer">
                        <p>Dynamic baselines are powerful for detecting anomalies without hardcoding thresholds. The pattern involves calculating a baseline from historical data and comparing current activity against it, usually with a multiplier to account for normal variance.</p>
                        <p>The query structure has two parts: a baseline subquery and a current activity comparison. For example, to detect users with unusually high login activity: <code>dataset = identity_logs | filter _time > ago(1h) | comp current_count = count() by username | join type = inner (dataset = identity_logs | filter _time > ago(7d) and _time < ago(1h) | comp total = count() by username | alter avg_hourly = total / (6*24)) as baseline baseline.username = username | alter threshold = baseline.avg_hourly * 3 | filter current_count > threshold</code></p>
                        <p>The critical design decisions are: the baseline period (I typically use 7-30 days), the comparison window (hourly or daily depending on the use case), and the multiplier (3x is common, but tune based on your environment). I also exclude the current window from the baseline to avoid self-comparison.</p>
                        <p>Edge cases to handle: new users without baseline (I add a minimum threshold fallback), seasonal variations (weekend vs weekday patterns), and users with very low baselines where small absolute increases trigger alerts. For sophisticated implementations, I use standard deviation instead of simple multipliers‚Äîflag anything more than 2 standard deviations above the mean.</p>
                        <p>In production correlation rules, I include both the absolute count and the threshold in the alert fields so analysts can see not just "user had anomalous activity" but "user had 150 logins vs their normal 20/hour threshold."</p>
                    </div>
                </div>
                
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you optimize XQL queries for performance when dealing with large datasets?</button>
                    <div class="qa-answer">
                        <p>Performance optimization in XQL follows some universal principles plus some XSIAM-specific techniques. The biggest gains come from reducing data early and being smart about expensive operations.</p>
                        <p>First principle: filter early and filter aggressively. Put your most selective filters first‚Äîtime range, then event type, then specific field conditions. The query engine processes filters in order, so <code>filter event_type = ENUM.PROCESS | filter _time > ago(1h) | filter action_process_image_name contains "powershell"</code> is worse than <code>filter _time > ago(1h) | filter event_type = ENUM.PROCESS | filter action_process_image_name contains "powershell"</code> because time range eliminates more data faster.</p>
                        <p>Second principle: select only the fields you need before expensive operations. Running <code>fields hostname, username, process_name</code> before a join dramatically reduces memory usage because you're not carrying all columns through the operation.</p>
                        <p>Third principle: dedup before joins. If you're joining against a reference table, make sure the secondary dataset doesn't have duplicate keys. A join against 1000 rows with 10 duplicates per key becomes 10,000 result rows instead of 1000. Use <code>dedup join_key</code> in your subquery.</p>
                        <p>Fourth principle: use contains instead of regex when possible. Regex operations are expensive; simple string matching is fast. If you're just looking for a substring, <code>~contains</code> is much cheaper than <code>~matches</code>.</p>
                        <p>For complex queries, I develop iteratively: start with a narrow time window and limit 100, verify the logic works, then expand the time range and remove the limit. This prevents long-running queries during development and helps identify which stage of the query is slowest.</p>
                    </div>
                </div>
                
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Describe how you would convert a Splunk or KQL detection rule to XQL.</button>
                    <div class="qa-answer">
                        <p>Converting detection rules between query languages is something I do regularly, and there's a systematic approach that works well. The key is understanding the logical intent of the rule, not just translating syntax line by line.</p>
                        <p>I start by identifying the core components: What data source is it querying? What conditions define the detection? What aggregation or correlation is involved? What fields appear in the output? Once I understand these, I can map them to XQL equivalents.</p>
                        <p>For syntax translation, I keep a mental mapping: Splunk's <code>index=</code> becomes <code>dataset =</code>. KQL's <code>where</code> and Splunk's <code>search</code> become <code>filter</code>. Splunk's <code>stats count by field</code> and KQL's <code>summarize count() by field</code> become <code>comp count() by field</code>. String matching differs: Splunk uses wildcards like <code>field=*powershell*</code>, KQL uses <code>has</code> or <code>contains</code>, XQL uses <code>~contains</code>.</p>
                        <p>The trickiest part is usually field names. Splunk and KQL might use <code>src_ip</code> while XSIAM uses <code>action_remote_ip</code> or <code>xdm.source.ipv4</code>. I run exploratory queries to find the equivalent fields in XSIAM's schema, or check the XDM documentation.</p>
                        <p>After converting, I always test against historical data where I know the rule should have triggered. If the Splunk rule would have caught a specific incident last month, I verify the XQL version catches it too. If results differ, I compare field values to find schema mismatches or logic errors.</p>
                        <p>One common gotcha: time functions differ between platforms. Splunk uses <code>earliest=-1h</code>, KQL uses <code>ago(1h)</code>, XQL uses <code>_time > ago(1h)</code> or <code>timestamp > subtract_time(current_time(), "1h")</code>. Getting time handling wrong is a frequent source of conversion bugs.</p>
                    </div>
                </div>
            </div>
        </section>
            

                <!-- Real-World Use Cases -->
                </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        
        // Q&A toggle
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        
        // Close sidebar on resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>