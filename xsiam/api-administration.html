<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Administration | XSIAM Administration</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link active" data-platform="xsiam"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link" data-platform="splunk"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link" data-platform="sentinel"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link" data-platform="crowdstrike"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link" data-platform="cortex"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link" data-platform="mde"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link" data-platform="operations"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">XSIAM Core</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="comparison.html" class="sidebar-nav-link"><i class="fas fa-balance-scale"></i><span>Platform Comparison</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac-access-control.html" class="sidebar-nav-link"><i class="fas fa-users-cog"></i><span>RBAC & Access Control</span></a></li>
                    <li class="sidebar-nav-item"><a href="api-administration.html" class="sidebar-nav-link active"><i class="fas fa-code"></i><span>API Administration</span></a></li>
                    <li class="sidebar-nav-item"><a href="health-monitoring.html" class="sidebar-nav-link"><i class="fas fa-heartbeat"></i><span>Health Monitoring</span></a></li>
                    <li class="sidebar-nav-item"><a href="licensing-costs.html" class="sidebar-nav-link"><i class="fas fa-file-invoice-dollar"></i><span>Licensing & Costs</span></a></li>
                    <li class="sidebar-nav-item"><a href="backup-recovery.html" class="sidebar-nav-link"><i class="fas fa-undo"></i><span>Backup & Recovery</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Architecture & Planning</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="capacity-planning.html" class="sidebar-nav-link"><i class="fas fa-calculator"></i><span>Capacity Planning</span></a></li>
                    <li class="sidebar-nav-item"><a href="network-requirements.html" class="sidebar-nav-link"><i class="fas fa-network-wired"></i><span>Network Requirements</span></a></li>
                    <li class="sidebar-nav-item"><a href="multi-tenant.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Multi-Tenant</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-residency.html" class="sidebar-nav-link"><i class="fas fa-map-marked-alt"></i><span>Data Residency</span></a></li>
                    <li class="sidebar-nav-item"><a href="migration-guide.html" class="sidebar-nav-link"><i class="fas fa-exchange-alt"></i><span>Migration Guide</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">Operations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="dashboards.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i><span>Dashboards</span></a></li>
                    <li class="sidebar-nav-item"><a href="alert-tuning.html" class="sidebar-nav-link"><i class="fas fa-sliders-h"></i><span>Alert Tuning</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-metrics.html" class="sidebar-nav-link"><i class="fas fa-tachometer-alt"></i><span>SOC Metrics</span></a></li>
                    <li class="sidebar-nav-item"><a href="reporting.html" class="sidebar-nav-link"><i class="fas fa-file-pdf"></i><span>Reporting</span></a></li>
                    <li class="sidebar-nav-item"><a href="case-management.html" class="sidebar-nav-link"><i class="fas fa-briefcase"></i><span>Case Management</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-soc.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise SOC</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- Main Content Wrapper -->
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu">
                <i class="fas fa-bars"></i>
            </button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a>
                    <span class="separator">/</span>
                    <a href="index.html">XSIAM</a>
                    <span class="separator">/</span>
                    <span class="current">API Administration</span>
                </div>

                <h1><i class="fas fa-code"></i> API Administration</h1>
                <p class="lead">Complete guide to XSIAM API management, including authentication, rate limits, common endpoints, automation patterns, and security best practices.</p>

                <!-- API Overview -->
                <h2><i class="fas fa-plug"></i> XSIAM API Architecture</h2>
                
                <div class="info-box" style="border-color: #58a6ff;">
                    <h4><i class="fas fa-info-circle"></i> API Capabilities</h4>
                    <p>The XSIAM API enables programmatic access to platform capabilities including incident management, endpoint actions, query execution, and configuration management. It's essential for SOAR integrations, custom automation, and reporting pipelines.</p>
                </div>

                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-sitemap"></i> API Request Flow</div>
<pre style="color: #8b949e; font-size: 0.8rem; line-height: 1.6; overflow-x: auto;">
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                                   API REQUEST FLOW                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                          │
│  ┌──────────────────┐         ┌──────────────────┐         ┌──────────────────┐         │
│  │   API Client     │         │   API Gateway    │         │   XSIAM Backend  │         │
│  │                  │         │                  │         │                  │         │
│  │  • SOAR Platform │ ──────► │  • Rate Limiting │ ──────► │  • Authentication│         │
│  │  • Custom Script │  HTTPS  │  • Load Balance  │   Auth  │  • Authorization │         │
│  │  • Integration   │   443   │  • TLS Terminate │  Check  │  • Process Query │         │
│  │                  │         │                  │         │                  │         │
│  └──────────────────┘         └──────────────────┘         └────────┬─────────┘         │
│                                                                      │                   │
│                                                                      ▼                   │
│                                                            ┌──────────────────┐         │
│                                                            │   Data Layer     │         │
│                                                            │                  │         │
│                                                            │  • Query Engine  │         │
│                                                            │  • Alert Store   │         │
│                                                            │  • Endpoint DB   │         │
│                                                            │                  │         │
│                                                            └──────────────────┘         │
│                                                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘

API Authentication Methods:
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│  ┌──────────────────────────────────────────────────────────────────────────────────┐   │
│  │                           STANDARD API KEY                                        │   │
│  │  Headers:                                                                         │   │
│  │    x-xdr-auth-id: {API_KEY_ID}                                                   │   │
│  │    Authorization: {API_KEY_SECRET}                                               │   │
│  │    Content-Type: application/json                                                │   │
│  └──────────────────────────────────────────────────────────────────────────────────┘   │
│                                                                                          │
│  ┌──────────────────────────────────────────────────────────────────────────────────┐   │
│  │                          ADVANCED API KEY                                         │   │
│  │  Headers:                                                                         │   │
│  │    x-xdr-auth-id: {API_KEY_ID}                                                   │   │
│  │    Authorization: {NONCE}{TIMESTAMP}{API_KEY_HASH}                               │   │
│  │    x-xdr-timestamp: {TIMESTAMP}                                                  │   │
│  │    x-xdr-nonce: {NONCE}                                                          │   │
│  └──────────────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
                </div>

                <!-- API Key Types -->
                <h2><i class="fas fa-key"></i> API Key Types</h2>
                
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>Key Type</th>
                            <th>Security Level</th>
                            <th>Use Case</th>
                            <th>Authentication</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong style="color: #3fb950;">Standard</strong></td>
                            <td>Basic</td>
                            <td>Internal integrations, trusted networks</td>
                            <td>Static key in header</td>
                        </tr>
                        <tr>
                            <td><strong style="color: #58a6ff;">Advanced</strong></td>
                            <td>Enhanced</td>
                            <td>External integrations, security-sensitive</td>
                            <td>Timestamped hash with nonce</td>
                        </tr>
                    </tbody>
                </table>

                <div class="config-section">
                    <h4>API Authentication Code Examples</h4>
                    <div class="arch-diagram"># Python - Standard API Key Authentication
# ═══════════════════════════════════════════════════════════════

import requests

API_URL = "https://api-{tenant}.xdr.us.paloaltonetworks.com"
API_KEY_ID = "your_api_key_id"
API_KEY = "your_api_key_secret"

headers = {
    "x-xdr-auth-id": API_KEY_ID,
    "Authorization": API_KEY,
    "Content-Type": "application/json"
}

response = requests.post(
    f"{API_URL}/public_api/v1/incidents/get_incidents",
    headers=headers,
    json={"request_data": {"filters": [], "search_from": 0, "search_to": 100}}
)

print(response.json())

# ═══════════════════════════════════════════════════════════════
# Python - Advanced API Key Authentication
# ═══════════════════════════════════════════════════════════════

import requests
import hashlib
import secrets
import string
from datetime import datetime, timezone

def generate_advanced_auth(api_key: str) -> tuple:
    """Generate Advanced API authentication headers"""
    # Generate nonce (random 64-char string)
    nonce = ''.join(secrets.choice(string.ascii_letters + string.digits) 
                    for _ in range(64))
    
    # Generate timestamp (milliseconds since epoch)
    timestamp = int(datetime.now(timezone.utc).timestamp() * 1000)
    
    # Create hash: SHA256(api_key + nonce + timestamp)
    auth_string = f"{api_key}{nonce}{timestamp}"
    auth_hash = hashlib.sha256(auth_string.encode()).hexdigest()
    
    return nonce, timestamp, auth_hash

nonce, timestamp, auth_hash = generate_advanced_auth(API_KEY)

headers = {
    "x-xdr-auth-id": API_KEY_ID,
    "Authorization": auth_hash,
    "x-xdr-timestamp": str(timestamp),
    "x-xdr-nonce": nonce,
    "Content-Type": "application/json"
}

response = requests.post(
    f"{API_URL}/public_api/v1/incidents/get_incidents",
    headers=headers,
    json={"request_data": {"filters": [], "search_from": 0, "search_to": 100}}
)</div>
                </div>

                <!-- Rate Limits -->
                <h2><i class="fas fa-tachometer-alt"></i> Rate Limits</h2>
                
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>Endpoint Category</th>
                            <th>Rate Limit</th>
                            <th>Time Window</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>General API Calls</strong></td>
                            <td>500 requests</td>
                            <td>Per minute</td>
                            <td>Applies to most endpoints</td>
                        </tr>
                        <tr>
                            <td><strong>XQL Queries</strong></td>
                            <td>100 queries</td>
                            <td>Per minute</td>
                            <td>Complex queries count more</td>
                        </tr>
                        <tr>
                            <td><strong>Bulk Operations</strong></td>
                            <td>10 requests</td>
                            <td>Per minute</td>
                            <td>Mass endpoint actions</td>
                        </tr>
                        <tr>
                            <td><strong>File Operations</strong></td>
                            <td>50 requests</td>
                            <td>Per minute</td>
                            <td>File retrieval, quarantine</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <h4><i class="fas fa-exclamation-triangle"></i> Rate Limit Best Practices</h4>
                    <p>Implement exponential backoff when hitting rate limits. Check response headers for <code>X-RateLimit-Remaining</code> and <code>X-RateLimit-Reset</code> to proactively manage request pacing. For high-volume integrations, implement request queuing.</p>
                </div>

                <div class="config-section">
                    <h4>Rate Limit Handling</h4>
                    <div class="arch-diagram"># Python - Rate Limit Handling with Exponential Backoff
# ═══════════════════════════════════════════════════════════════

import requests
import time
from typing import Optional

class XSIAMAPIClient:
    def __init__(self, base_url: str, api_key_id: str, api_key: str):
        self.base_url = base_url
        self.headers = {
            "x-xdr-auth-id": api_key_id,
            "Authorization": api_key,
            "Content-Type": "application/json"
        }
        self.max_retries = 5
        self.base_delay = 1  # seconds
    
    def make_request(self, endpoint: str, payload: dict, 
                     method: str = "POST") -> Optional[dict]:
        """Make API request with retry logic"""
        url = f"{self.base_url}{endpoint}"
        
        for attempt in range(self.max_retries):
            try:
                response = requests.request(
                    method=method,
                    url=url,
                    headers=self.headers,
                    json=payload,
                    timeout=30
                )
                
                # Check rate limit headers
                remaining = response.headers.get('X-RateLimit-Remaining')
                reset_time = response.headers.get('X-RateLimit-Reset')
                
                if remaining and int(remaining) < 10:
                    print(f"Warning: Only {remaining} requests remaining")
                
                # Handle rate limiting (429)
                if response.status_code == 429:
                    if reset_time:
                        wait_time = int(reset_time) - int(time.time())
                    else:
                        wait_time = self.base_delay * (2 ** attempt)
                    
                    print(f"Rate limited. Waiting {wait_time}s...")
                    time.sleep(wait_time)
                    continue
                
                # Handle server errors with retry
                if response.status_code >= 500:
                    wait_time = self.base_delay * (2 ** attempt)
                    print(f"Server error {response.status_code}. Retry in {wait_time}s")
                    time.sleep(wait_time)
                    continue
                
                response.raise_for_status()
                return response.json()
                
            except requests.exceptions.Timeout:
                print(f"Request timeout, attempt {attempt + 1}/{self.max_retries}")
                time.sleep(self.base_delay * (2 ** attempt))
                
            except requests.exceptions.RequestException as e:
                print(f"Request failed: {e}")
                if attempt == self.max_retries - 1:
                    raise
        
        return None

# Usage
client = XSIAMAPIClient(
    base_url="https://api-tenant.xdr.us.paloaltonetworks.com",
    api_key_id="your_key_id",
    api_key="your_api_key"
)

result = client.make_request(
    endpoint="/public_api/v1/incidents/get_incidents",
    payload={"request_data": {"filters": []}}
)</div>
                </div>

                <!-- Common API Endpoints -->
                <h2><i class="fas fa-list"></i> Common API Endpoints</h2>
                
                <div class="config-section">
                    <h4>Incident Management</h4>
                    <div class="arch-diagram"># GET INCIDENTS
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/incidents/get_incidents

Request:
{
  "request_data": {
    "filters": [
      {"field": "status", "operator": "eq", "value": "new"},
      {"field": "severity", "operator": "gte", "value": "high"}
    ],
    "search_from": 0,
    "search_to": 100,
    "sort": {"field": "creation_time", "keyword": "desc"}
  }
}

Response:
{
  "reply": {
    "total_count": 45,
    "result_count": 45,
    "incidents": [
      {
        "incident_id": "INC-12345",
        "description": "Malware detected",
        "severity": "high",
        "status": "new",
        "creation_time": 1699123456000
      }
    ]
  }
}

# UPDATE INCIDENT
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/incidents/update_incident

Request:
{
  "request_data": {
    "incident_id": "INC-12345",
    "update_data": {
      "status": "under_investigation",
      "assigned_user_mail": "analyst@company.com",
      "manual_severity": "critical"
    }
  }
}</div>

                    <h4>Endpoint Management</h4>
                    <div class="arch-diagram"># GET ALL ENDPOINTS
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/endpoints/get_endpoints

Request:
{
  "request_data": {
    "filters": [
      {"field": "endpoint_status", "operator": "eq", "value": "connected"}
    ],
    "search_from": 0,
    "search_to": 500
  }
}

# ISOLATE ENDPOINT
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/endpoints/isolate

Request:
{
  "request_data": {
    "endpoint_id": "abc123def456",
    "incident_id": "INC-12345"  # Optional: link to incident
  }
}

# UNISOLATE ENDPOINT
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/endpoints/unisolate

Request:
{
  "request_data": {
    "endpoint_id": "abc123def456"
  }
}

# SCAN ENDPOINT
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/endpoints/scan

Request:
{
  "request_data": {
    "endpoint_id_list": ["abc123", "def456"],
    "scan_type": "full"  # or "quick"
  }
}</div>

                    <h4>XQL Query Execution</h4>
                    <div class="arch-diagram"># RUN XQL QUERY
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/xql/start_xql_query

Request:
{
  "request_data": {
    "query": "dataset = xdr_data | filter action_process_image_name = 'powershell.exe' | limit 100",
    "tenants": [],  # Empty for current tenant
    "timeframe": {
      "from": 1699000000000,
      "to": 1699100000000
    }
  }
}

Response:
{
  "reply": {
    "execution_id": "query_12345_67890"
  }
}

# GET QUERY RESULTS
# ═══════════════════════════════════════════════════════════════
POST /public_api/v1/xql/get_query_results

Request:
{
  "request_data": {
    "query_id": "query_12345_67890",
    "format": "json"  # or "csv"
  }
}

Response:
{
  "reply": {
    "status": "SUCCESS",
    "number_of_results": 42,
    "results": {
      "data": [
        {"_time": "2024-01-15T10:30:00Z", "action_process_image_name": "powershell.exe", ...}
      ]
    }
  }
}</div>
                </div>

                <!-- API Security Decision Tree -->
                <h2><i class="fas fa-code-branch"></i> API Key Type Selection</h2>
                
                <div class="decision-tree">
                    <div class="decision-node question">
                        <strong>Where will the API calls originate?</strong>
                    </div>
                    <div class="decision-branch">
                        <div>
                            <div class="decision-arrow">↓ Internal Network Only</div>
                            <div class="decision-node question">
                                <strong>Is the calling system trusted and secured?</strong>
                            </div>
                            <div class="decision-branch">
                                <div>
                                    <div class="decision-arrow">↓ YES (e.g., SOAR)</div>
                                    <div class="decision-node yes" style="background: #1a4d2e;">
                                        <strong style="color: #3fb950;">Standard API Key</strong>
                                        <div style="color: #8b949e; font-size: 0.85rem;">Simpler implementation<br>Store in secrets manager</div>
                                    </div>
                                </div>
                                <div>
                                    <div class="decision-arrow">↓ NO</div>
                                    <div class="decision-node" style="background: #1c3a5e; border-color: #58a6ff;">
                                        <strong style="color: #58a6ff;">Advanced API Key</strong>
                                        <div style="color: #8b949e; font-size: 0.85rem;">Additional protection layer</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-arrow">↓ External/Cloud/Third-Party</div>
                            <div class="decision-node" style="background: #3d2a5e; border-color: #a371f7;">
                                <strong style="color: #a371f7;">Advanced API Key Required</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">Timestamp prevents replay attacks<br>Nonce ensures uniqueness</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Key Management -->
                <h2><i class="fas fa-cogs"></i> API Key Lifecycle Management</h2>
                
                <div class="flow-diagram">
                    <div class="flow-diagram-title"><i class="fas fa-sync"></i> API Key Rotation Process</div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 16px;">
                        <div class="flow-step" style="background: #1c3a5e; border-color: #58a6ff;">
                            <div class="flow-icon"><i class="fas fa-key"></i></div>
                            <div class="flow-content">
                                <strong>1. Create New Key</strong>
                                <ul>
                                    <li>Generate new API key</li>
                                    <li>Same role/permissions</li>
                                    <li>Document purpose</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step" style="background: #3d2a5e; border-color: #a371f7;">
                            <div class="flow-icon"><i class="fas fa-lock"></i></div>
                            <div class="flow-content">
                                <strong>2. Store Securely</strong>
                                <ul>
                                    <li>Update secrets manager</li>
                                    <li>Vault, AWS Secrets, etc.</li>
                                    <li>Version the secret</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step" style="background: #4d3a0d; border-color: #d29922;">
                            <div class="flow-icon"><i class="fas fa-check"></i></div>
                            <div class="flow-content">
                                <strong>3. Test New Key</strong>
                                <ul>
                                    <li>Verify connectivity</li>
                                    <li>Test all integrations</li>
                                    <li>Confirm functionality</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step" style="background: #1a4d2e; border-color: #3fb950;">
                            <div class="flow-icon"><i class="fas fa-sync-alt"></i></div>
                            <div class="flow-content">
                                <strong>4. Switch Over</strong>
                                <ul>
                                    <li>Update all consumers</li>
                                    <li>Monitor for errors</li>
                                    <li>Keep old key briefly</li>
                                </ul>
                            </div>
                        </div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step" style="background: #4d1a1a; border-color: #f85149;">
                            <div class="flow-icon"><i class="fas fa-trash"></i></div>
                            <div class="flow-content">
                                <strong>5. Revoke Old Key</strong>
                                <ul>
                                    <li>Delete old API key</li>
                                    <li>Remove from secrets</li>
                                    <li>Audit log entry</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Integration Patterns -->
                <h2><i class="fas fa-puzzle-piece"></i> Common Integration Patterns</h2>
                
                <div class="config-section">
                    <h4>SOAR Integration (XSOAR/Splunk SOAR)</h4>
                    <div class="arch-diagram"># XSOAR Playbook - Incident Enrichment & Response
# ═══════════════════════════════════════════════════════════════

# Task 1: Get incident details from XSIAM
xsiam_incident = demisto.executeCommand("xsiam-get-incident", {
    "incident_id": incident.id
})

# Task 2: Get associated alerts
alerts = demisto.executeCommand("xsiam-get-alerts", {
    "incident_id": incident.id,
    "limit": 50
})

# Task 3: Enrich with endpoint details
for alert in alerts:
    if alert.endpoint_id:
        endpoint = demisto.executeCommand("xsiam-get-endpoint", {
            "endpoint_id": alert.endpoint_id
        })
        # Add to context
        
# Task 4: Auto-response for high severity
if incident.severity >= "high":
    if risk_score > 80:
        demisto.executeCommand("xsiam-isolate-endpoint", {
            "endpoint_id": primary_endpoint.id,
            "incident_id": incident.id
        })
        
# Task 5: Update incident status
demisto.executeCommand("xsiam-update-incident", {
    "incident_id": incident.id,
    "status": "under_investigation",
    "assigned_user": analyst_email
})</div>

                    <h4>Ticketing Integration (ServiceNow)</h4>
                    <div class="arch-diagram"># Python - XSIAM to ServiceNow Integration
# ═══════════════════════════════════════════════════════════════

import requests
from datetime import datetime

class XSIAMServiceNowIntegration:
    def __init__(self, xsiam_client, snow_client):
        self.xsiam = xsiam_client
        self.snow = snow_client
    
    def sync_incidents(self):
        """Sync high severity incidents to ServiceNow"""
        # Get new high/critical incidents from XSIAM
        incidents = self.xsiam.make_request(
            "/public_api/v1/incidents/get_incidents",
            {
                "request_data": {
                    "filters": [
                        {"field": "status", "operator": "eq", "value": "new"},
                        {"field": "severity", "operator": "gte", "value": "high"}
                    ]
                }
            }
        )
        
        for incident in incidents['reply']['incidents']:
            # Check if ticket already exists
            existing = self.snow.find_ticket(
                external_id=incident['incident_id']
            )
            
            if not existing:
                # Create ServiceNow incident
                snow_ticket = self.snow.create_incident({
                    "short_description": f"[XSIAM] {incident['description']}",
                    "description": self._format_description(incident),
                    "urgency": self._map_severity(incident['severity']),
                    "category": "Security",
                    "subcategory": "Security Incident",
                    "correlation_id": incident['incident_id']
                })
                
                # Update XSIAM with ticket reference
                self.xsiam.make_request(
                    "/public_api/v1/incidents/update_incident",
                    {
                        "request_data": {
                            "incident_id": incident['incident_id'],
                            "update_data": {
                                "resolve_comment": f"ServiceNow: {snow_ticket['number']}"
                            }
                        }
                    }
                )
    
    def _map_severity(self, xsiam_severity: str) -> int:
        """Map XSIAM severity to ServiceNow urgency"""
        mapping = {
            "critical": 1,
            "high": 2,
            "medium": 3,
            "low": 4
        }
        return mapping.get(xsiam_severity.lower(), 3)</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you design a secure API integration between XSIAM and your SOAR platform?</button>
                        <div class="qa-answer">
                            <p>Designing a secure XSIAM API integration requires thinking about authentication, network security, least privilege, and operational resilience. Let me walk through how I'd approach this for a SOAR integration.</p>
                            
                            <p>For authentication, I'd use Advanced API keys rather than Standard keys. Even though the SOAR platform is internal, Advanced keys provide additional protection through timestamped authentication that prevents replay attacks. The authentication hash changes with each request, so even if network traffic were captured, the credentials couldn't be reused. I'd create a dedicated service account in XSIAM specifically for the SOAR integration, rather than using a personal account.</p>
                            
                            <p>API key storage is critical. Never embed keys in playbook code or configuration files in version control. Store the keys in a secrets manager - HashiCorp Vault, CyberArk, or the SOAR platform's built-in credential storage. The SOAR platform retrieves credentials at runtime, and rotation can happen without modifying playbooks. I'd set up 90-day automatic rotation for the API keys.</p>
                            
                            <p>For least privilege, I'd assign the minimum role required for the integration's functions. If the SOAR only needs to read incidents and update status, it doesn't need Instance Administrator. Create a custom role or use the built-in Viewer or Responder role. Document exactly which API endpoints the integration uses, and validate the role allows only those operations.</p>
                            
                            <p>Network security includes restricting API access to known source IPs. If your SOAR platform has static IPs, configure XSIAM to only accept API calls from those addresses. This adds another layer even if credentials are compromised. Also ensure traffic flows through secure channels - the API is HTTPS-only, but verify your internal network path doesn't have any TLS interception that could log credentials.</p>
                            
                            <p>Finally, implement monitoring and alerting. Log all API calls, monitor for unusual patterns like sudden volume spikes or calls to unexpected endpoints. Alert on authentication failures. This provides visibility into integration health and early warning of potential compromise.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle API rate limiting in a high-volume integration?</button>
                        <div class="qa-answer">
                            <p>Rate limiting is a common challenge with security platform APIs, especially for integrations that need to process large volumes of data. My approach combines proactive management with graceful degradation.</p>
                            
                            <p>First, understand the rate limits. XSIAM has different limits for different endpoint categories - general API calls, XQL queries, and bulk operations each have separate limits. Document these for your integration and calculate whether your expected call volume fits within limits. If you need 1,000 incident updates per minute but the limit is 500, you have a design problem to solve.</p>
                            
                            <p>Implement request pacing proactively rather than waiting to hit limits. If you need to process 10,000 endpoints, don't fire all requests simultaneously. Queue them and send at a controlled rate - maybe 400/minute when the limit is 500, leaving headroom for other integrations. Use token bucket or leaky bucket algorithms to smooth request rates.</p>
                            
                            <p>Monitor rate limit headers in responses. Most APIs return headers like X-RateLimit-Remaining and X-RateLimit-Reset. Check these after each request. If remaining requests drop below a threshold (say 10%), slow down proactively rather than waiting to get rate-limited. Log these events so you can see patterns and adjust your pacing.</p>
                            
                            <p>When you do hit rate limits (429 responses), implement exponential backoff. First retry after 1 second, then 2, then 4, up to some maximum. The rate limit reset header tells you exactly when the window resets - wait until then if practical. Don't just keep hammering the API; that wastes resources and may trigger additional protections.</p>
                            
                            <p>For high-volume needs, consider batching and async patterns. Instead of one API call per endpoint, use bulk endpoints that accept arrays. For XQL queries, run broader queries less frequently rather than narrow queries constantly. Implement async processing where the integration queues work and processes it within rate constraints rather than trying to be real-time.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Describe your approach to API key rotation for multiple integrations.</button>
                        <div class="qa-answer">
                            <p>API key rotation at scale requires planning, automation, and clear ownership. With multiple integrations, you can't manually rotate keys without risking outages or missing some.</p>
                            
                            <p>First, maintain an inventory of all API keys and their consumers. Document which integration uses each key, what endpoints it accesses, who owns the integration, and when the key was last rotated. Without this inventory, you don't know what you're managing. Store this in a CMDB or dedicated secrets management system that tracks metadata.</p>
                            
                            <p>Implement a standard rotation process. The key steps are: generate new key, deploy to secrets manager, update integration to use new key, verify functionality, revoke old key. Each step needs to work reliably. I automate as much as possible - the XSIAM API can create new keys programmatically, and secrets managers like Vault support programmatic updates.</p>
                            
                            <p>For multi-consumer keys - where the same key is used by multiple integrations - rotation is more complex. Either coordinate updates across all consumers simultaneously (risky), or maintain two valid keys during transition (preferred). Create the new key, update consumers one by one, verify each works, then revoke the old key only after all consumers have migrated.</p>
                            
                            <p>Better yet, use per-integration keys. Each integration gets its own dedicated key. This isolates blast radius - compromising one key doesn't affect other integrations. It also allows independent rotation schedules and makes it clear which integration is responsible for which API activity in logs.</p>
                            
                            <p>Set up rotation reminders or automation. Keys should rotate regularly - 90 days is common, 30 days for high-sensitivity integrations. Calendar reminders work for small scale; automated rotation via secrets manager is better. Vault and similar tools can rotate secrets automatically on schedule and update consumer applications. Monitor for keys approaching expiration and alert if rotation doesn't happen on schedule.</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
                overlay.classList.toggle('active');
            } else {
                sidebar.classList.toggle('collapsed');
                mainWrapper.classList.toggle('expanded');
            }
        }
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            }
        });
    </script>
</body>
</html>
