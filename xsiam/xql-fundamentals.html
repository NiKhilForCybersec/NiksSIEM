<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XQL Fundamentals | XSIAM Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">XSIAM Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="architecture.html" class="nav-link"><i class="fas fa-sitemap"></i> Architecture</a>
                    <a href="comparison.html" class="nav-link"><i class="fas fa-balance-scale"></i> vs Competitors</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Data Collection</div>
                    <a href="data-ingestion.html" class="nav-link"><i class="fas fa-database"></i> Ingestion Methods</a>
                    <a href="custom-log-onboarding.html" class="nav-link"><i class="fas fa-file-import"></i> Custom Log Onboarding</a>
                    <a href="broker-vm.html" class="nav-link"><i class="fas fa-server"></i> Broker VM</a>
                    <a href="agents.html" class="nav-link"><i class="fas fa-desktop"></i> Cortex Agents</a>
                    <a href="parsing-flows.html" class="nav-link"><i class="fas fa-stream"></i> Parsing & XDM</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">XQL Query Language</div>
                    <a href="xql-fundamentals.html" class="nav-link active"><i class="fas fa-terminal"></i> XQL Fundamentals</a>
                    <a href="xql-advanced.html" class="nav-link"><i class="fas fa-code"></i> XQL Advanced</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection & Response</div>
                    <a href="correlation-rules.html" class="nav-link"><i class="fas fa-project-diagram"></i> Correlation Rules</a>
                    <a href="alert-management.html" class="nav-link"><i class="fas fa-bell"></i> Alert Management</a>
                    <a href="threat-intel.html" class="nav-link"><i class="fas fa-skull-crossbones"></i> Threat Intelligence</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Automation & SOAR</div>
                    <a href="xsoar-automation.html" class="nav-link"><i class="fas fa-robot"></i> XSOAR Automation</a>
                    <a href="dashboards.html" class="nav-link"><i class="fas fa-chart-bar"></i> Dashboards</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Advanced Features</div>
                    <a href="xdr-overview.html" class="nav-link"><i class="fas fa-shield-alt"></i> XDR Capabilities</a>
                    <a href="recon-asm.html" class="nav-link"><i class="fas fa-globe"></i> Recon & ASM</a>
                    <a href="retention-tiers.html" class="nav-link"><i class="fas fa-archive"></i> Storage Tiers</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">XSIAM</a><span class="separator">/</span>
                    <span class="current">XQL Fundamentals</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-terminal"></i> XQL Fundamentals</h1>
                <p class="lead">Master the XQL query language for XSIAM. Learn syntax, operators, and essential techniques for searching and analyzing security data.</p>

                <!-- XQL Overview -->
                <h2><i class="fas fa-info-circle"></i> XQL Overview</h2>
                <div class="config-section">
                    <p><span class="console-path">Investigation → Query Center</span></p>

                    <h4>What is XQL?</h4>
                    <div class="code-block">XQL (Extended Query Language):

- Native query language for XSIAM/Cortex XDR
- Pipe-based syntax (similar to SPL, KQL)
- Queries data in Cortex Data Lake
- Supports XDM normalized fields
- Used for hunting, investigation, correlation rules

Query Structure:
dataset = [dataset_name]
| filter [conditions]
| compute [calculations]
| fields [output_fields]
| sort [order]
| limit [count]</div>

                    <h4>Key Datasets</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Dataset</th><th>Description</th><th>Key Fields</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>xdr_data</strong></td><td>All endpoint telemetry</td><td>agent_hostname, action_*, actor_*</td></tr>
                            <tr><td><strong>cloud_audit_logs</strong></td><td>Cloud provider logs</td><td>cloud_provider, event_type</td></tr>
                            <tr><td><strong>panw_ngfw_traffic</strong></td><td>Firewall traffic logs</td><td>src_ip, dst_ip, action</td></tr>
                            <tr><td><strong>panw_ngfw_threat</strong></td><td>Firewall threat logs</td><td>threat_name, severity</td></tr>
                            <tr><td><strong>msft_azure_*</strong></td><td>Azure AD/O365 logs</td><td>user, operation, result</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Basic Syntax -->
                <h2><i class="fas fa-code"></i> Basic Syntax</h2>
                <div class="config-section">
                    <h4>Dataset Selection</h4>
                    <div class="code-block">// Query all XDR endpoint data
dataset = xdr_data

// Query specific preset
preset = xdr_process_event

// Query multiple datasets
dataset in (xdr_data, cloud_audit_logs)

// Query with time range (GUI selection or explicit)
dataset = xdr_data
| filter _time >= timestamp("2024-01-01T00:00:00Z")
| filter _time <= timestamp("2024-01-02T00:00:00Z")</div>

                    <h4>Filter Operator</h4>
                    <div class="code-block">// Basic equality
dataset = xdr_data
| filter agent_hostname = "WORKSTATION01"

// Not equals
| filter agent_hostname != "DC01"

// Multiple conditions (AND)
| filter agent_hostname = "WORKSTATION01" and event_type = PROCESS

// OR conditions
| filter agent_hostname = "WORKSTATION01" or agent_hostname = "WORKSTATION02"

// IN list
| filter agent_hostname in ("WORKSTATION01", "WORKSTATION02", "SERVER01")

// NOT IN
| filter agent_hostname not in ("DC01", "DC02")

// Contains (case-insensitive)
| filter action_process_image_name contains "powershell"

// Wildcard matching
| filter action_process_image_path ~= ".*\\\\temp\\\\.*"

// Null checks
| filter action_remote_ip != null</div>

                    <h4>Comparison Operators</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Operator</th><th>Description</th><th>Example</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>=</strong></td><td>Equals</td><td>status = "success"</td></tr>
                            <tr><td><strong>!=</strong></td><td>Not equals</td><td>status != "failed"</td></tr>
                            <tr><td><strong>></strong></td><td>Greater than</td><td>bytes > 1000000</td></tr>
                            <tr><td><strong><</strong></td><td>Less than</td><td>count < 10</td></tr>
                            <tr><td><strong>>=</strong></td><td>Greater or equal</td><td>severity >= 7</td></tr>
                            <tr><td><strong><=</strong></td><td>Less or equal</td><td>attempts <= 3</td></tr>
                            <tr><td><strong>~=</strong></td><td>Regex match</td><td>path ~= ".*\\.exe$"</td></tr>
                            <tr><td><strong>contains</strong></td><td>Substring match</td><td>cmd contains "-enc"</td></tr>
                            <tr><td><strong>in</strong></td><td>In list</td><td>port in (80, 443, 8080)</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Fields and Output -->
                <h2><i class="fas fa-columns"></i> Fields and Output</h2>
                <div class="config-section">
                    <h4>Selecting Fields</h4>
                    <div class="code-block">// Select specific fields
dataset = xdr_data
| filter event_type = PROCESS
| fields _time, agent_hostname, action_process_image_name, 
         action_process_image_command_line

// Rename fields in output
| fields _time as timestamp, 
         agent_hostname as host,
         action_process_image_name as process

// All fields (default if not specified)
| fields *</div>

                    <h4>Sorting and Limiting</h4>
                    <div class="code-block">// Sort ascending
| sort asc _time

// Sort descending
| sort desc _time

// Sort by multiple fields
| sort desc count, asc agent_hostname

// Limit results
| limit 100

// Complete example
dataset = xdr_data
| filter event_type = PROCESS
| filter action_process_image_name contains "powershell"
| fields _time, agent_hostname, action_process_image_command_line
| sort desc _time
| limit 50</div>
                </div>

                <!-- Aggregations -->
                <h2><i class="fas fa-calculator"></i> Aggregations</h2>
                <div class="config-section">
                    <h4>Comp (Stats) Operator</h4>
                    <div class="code-block">// Count events
dataset = xdr_data
| filter event_type = PROCESS
| comp count() as event_count

// Count by field
| comp count() by agent_hostname

// Multiple aggregations
| comp count() as total,
       count_distinct(action_process_image_name) as unique_processes
  by agent_hostname

// Sum, avg, min, max
| comp sum(bytes) as total_bytes,
       avg(bytes) as avg_bytes,
       min(bytes) as min_bytes,
       max(bytes) as max_bytes
  by agent_hostname</div>

                    <h4>Common Aggregation Functions</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Function</th><th>Description</th><th>Example</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><strong>count()</strong></td><td>Count events</td><td>count() as total</td></tr>
                            <tr><td><strong>count_distinct()</strong></td><td>Unique values</td><td>count_distinct(user) as unique_users</td></tr>
                            <tr><td><strong>sum()</strong></td><td>Sum values</td><td>sum(bytes) as total_bytes</td></tr>
                            <tr><td><strong>avg()</strong></td><td>Average</td><td>avg(duration) as avg_time</td></tr>
                            <tr><td><strong>min()</strong></td><td>Minimum</td><td>min(_time) as first_seen</td></tr>
                            <tr><td><strong>max()</strong></td><td>Maximum</td><td>max(_time) as last_seen</td></tr>
                            <tr><td><strong>values()</strong></td><td>List values</td><td>values(hostname) as hosts</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Common Queries -->
                <h2><i class="fas fa-search"></i> Common Queries</h2>
                <div class="config-section">
                    <h4>Process Queries</h4>
                    <div class="code-block">// All PowerShell execution
dataset = xdr_data
| filter event_type = PROCESS
| filter action_process_image_name contains "powershell"
| fields _time, agent_hostname, actor_effective_username,
         action_process_image_command_line
| sort desc _time

// Suspicious command line patterns
dataset = xdr_data
| filter event_type = PROCESS
| filter action_process_image_command_line contains "-enc" or
         action_process_image_command_line contains "downloadstring" or
         action_process_image_command_line contains "bypass"
| fields _time, agent_hostname, action_process_image_name,
         action_process_image_command_line

// Process from temp folders
dataset = xdr_data
| filter event_type = PROCESS
| filter action_process_image_path ~= "(?i)\\\\temp\\\\"
| comp count() by action_process_image_name, agent_hostname
| sort desc count</div>

                    <h4>Network Queries</h4>
                    <div class="code-block">// Outbound connections to rare IPs
dataset = xdr_data
| filter event_type = NETWORK
| filter action_remote_ip != null
| comp count() as connections,
       count_distinct(agent_hostname) as unique_hosts
  by action_remote_ip
| filter unique_hosts = 1
| sort desc connections

// Connections on non-standard ports
dataset = xdr_data
| filter event_type = NETWORK
| filter action_remote_port not in (80, 443, 53, 22, 25)
| filter action_remote_ip != null
| fields _time, agent_hostname, action_process_image_name,
         action_remote_ip, action_remote_port
| sort desc _time</div>

                    <h4>Authentication Queries</h4>
                    <div class="code-block">// Failed logins by user
dataset = xdr_data
| filter event_type = ENUM.EVENT_TYPE.LOGIN
| filter action_login_result = FAILED
| comp count() as failed_attempts by actor_effective_username
| filter failed_attempts > 5
| sort desc failed_attempts

// Logins from multiple IPs
dataset = xdr_data
| filter event_type = ENUM.EVENT_TYPE.LOGIN
| filter action_login_result = SUCCESS
| comp count_distinct(action_remote_ip) as unique_ips,
       values(action_remote_ip) as ips
  by actor_effective_username
| filter unique_ips > 3</div>
                </div>

                <!-- XDM Fields Reference -->
                <h2><i class="fas fa-book"></i> XDM Fields Reference</h2>
                <div class="config-section">
                    <h4>Common XDM Fields</h4>
                    <div class="code-block">XDM (Cross-Data Model) Normalized Fields:

ENDPOINT FIELDS:
├── agent_hostname          - Endpoint hostname
├── agent_id               - Agent unique ID
├── agent_ip_addresses     - Endpoint IPs
└── agent_os_type          - OS type (WINDOWS, LINUX, MAC)

ACTOR FIELDS (who initiated):
├── actor_process_image_name      - Parent process name
├── actor_process_image_path      - Parent process path
├── actor_process_command_line    - Parent command line
├── actor_effective_username      - User context
└── actor_primary_username        - Primary user

ACTION FIELDS (what happened):
├── action_process_image_name     - Executed process
├── action_process_image_path     - Process path
├── action_process_image_command_line  - Command line
├── action_process_image_sha256   - Process hash
├── action_file_name              - File involved
├── action_file_path              - File path
├── action_remote_ip              - Destination IP
├── action_remote_port            - Destination port
└── action_local_port             - Source port

EVENT FIELDS:
├── _time                  - Event timestamp
├── event_type            - PROCESS, NETWORK, FILE, REGISTRY
├── event_sub_type        - Specific event subtype
└── event_id              - Unique event ID</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is the basic structure of an XQL query?</button>
                        <div class="qa-answer">
                            <p>XQL queries follow a pipe-based structure:</p>
                            <ol>
                                <li><strong>Dataset:</strong> <code>dataset = xdr_data</code> - Select data source</li>
                                <li><strong>Filter:</strong> <code>| filter conditions</code> - Narrow results</li>
                                <li><strong>Compute:</strong> <code>| comp aggregations</code> - Calculate statistics</li>
                                <li><strong>Fields:</strong> <code>| fields column1, column2</code> - Select output</li>
                                <li><strong>Sort:</strong> <code>| sort desc field</code> - Order results</li>
                                <li><strong>Limit:</strong> <code>| limit 100</code> - Cap output</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is XDM and why is it important?</button>
                        <div class="qa-answer">
                            <p><strong>XDM (Cross-Data Model)</strong> is XSIAM's schema normalization:</p>
                            <ul>
                                <li>Standardizes field names across all data sources</li>
                                <li>Enables cross-source correlation with single queries</li>
                                <li>Uses consistent naming: actor_* (who), action_* (what)</li>
                                <li>Simplifies rule writing and hunting</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you find rare processes in XQL?</button>
                        <div class="qa-answer">
                            <div class="code-block">dataset = xdr_data
| filter event_type = PROCESS
| comp count() as executions,
       count_distinct(agent_hostname) as unique_hosts
  by action_process_image_name
| filter unique_hosts = 1 and executions < 5
| sort asc executions</div>
                            <p>This finds processes that ran on only one host with few executions - potential malware or unusual activity.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What's the difference between actor and action fields?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>Actor fields:</strong> The entity that initiated the event (parent process, user)</li>
                                <li><strong>Action fields:</strong> What was done (child process, file, network connection)</li>
                            </ul>
                            <p><strong>Example:</strong> If cmd.exe spawns powershell.exe:</p>
                            <ul>
                                <li>actor_process_image_name = "cmd.exe"</li>
                                <li>action_process_image_name = "powershell.exe"</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>