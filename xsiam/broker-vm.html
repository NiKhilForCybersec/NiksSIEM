<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Broker VM - Complete Setup Guide | XSIAM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand"><i class="fas fa-shield-alt"></i><span>Nik's SIEM</span></a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar"><i class="fas fa-chevron-left"></i></button>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link active"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-section">
                <div class="sidebar-section-title">XSIAM Pages</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="broker-vm.html" class="sidebar-nav-link active"><i class="fas fa-server"></i><span>Broker VM</span></a></li>
                    <li class="sidebar-nav-item"><a href="agents.html" class="sidebar-nav-link"><i class="fas fa-microchip"></i><span>Agents</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention Tiers</span></a></li>
                    <li class="sidebar-nav-item"><a href="xql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>XQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="xql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>XQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="xdr-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-virus"></i><span>XDR & Detection</span></a></li>
                    <li class="sidebar-nav-item"><a href="correlation-rules.html" class="sidebar-nav-link"><i class="fas fa-project-diagram"></i><span>Correlation Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="alert-management.html" class="sidebar-nav-link"><i class="fas fa-bell"></i><span>Alert Management</span></a></li>
                    <li class="sidebar-nav-item"><a href="xsoar-automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>XSOAR Automation</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intel</span></a></li>
                    <li class="sidebar-nav-item"><a href="recon-asm.html" class="sidebar-nav-link"><i class="fas fa-globe"></i><span>Recon & ASM</span></a></li>
                    <li class="sidebar-nav-item"><a href="dashboards.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i><span>Dashboards</span></a></li>
                    <li class="sidebar-nav-item"><a href="marketplace.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Marketplace</span></a></li>
                    <li class="sidebar-nav-item"><a href="enterprise-soc.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise SOC</span></a></li>
                    <li class="sidebar-nav-item"><a href="comparison.html" class="sidebar-nav-link"><i class="fas fa-balance-scale"></i><span>Platform Comparison</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
    <div class="main-wrapper" id="mainWrapper">
        <button class="mobile-toggle" onclick="toggleSidebar()" title="Open menu"><i class="fas fa-bars"></i></button>
        
        <main class="main-content">
            <div class="breadcrumb">
                <a href="../index.html">Home</a>
                <span class="separator">/</span>
                <a href="index.html">XSIAM</a>
                <span class="separator">/</span>
                <span class="current">Broker VM</span>
            </div>

            <h1><i class="fas fa-server"></i> Broker VM - Complete Setup Guide</h1>
            <p class="lead">The Broker VM is XSIAM's on-premises log collector for devices that can't send directly to the cloud. This guide covers deployment, configuration, sizing, high availability, and troubleshooting with production-ready configurations.</p>

            <!-- What is Broker VM -->
            <h2><i class="fas fa-question-circle"></i> What is a Broker VM?</h2>
            
            <div class="info-box">
                <h4><i class="fas fa-lightbulb"></i> Broker VM in One Sentence</h4>
                <p>The Broker VM is a <strong>virtual machine you deploy in your network</strong> that collects logs from on-premises devices (via syslog, WEL, file, etc.) and securely forwards them to XSIAM cloud.</p>
            </div>

            <div class="flow-diagram">
                <div class="flow-diagram-title"><i class="fas fa-project-diagram"></i> Broker VM Data Flow</div>
                <div class="flow-row centered">
                    <div class="flow-box">
                        <div class="flow-box-title"><i class="fas fa-network-wired"></i> On-Prem Sources</div>
                        <div class="flow-box-subtitle">Firewalls, Servers, Network</div>
                    </div>
                    <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
                    <div class="flow-box primary">
                        <div class="flow-box-title"><i class="fas fa-server"></i> Broker VM</div>
                        <div class="flow-box-subtitle">Your Network (On-Prem)</div>
                    </div>
                    <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
                    <div class="flow-box success">
                        <div class="flow-box-title"><i class="fas fa-cloud"></i> XSIAM Cloud</div>
                        <div class="flow-box-subtitle">HTTPS/443 (Outbound)</div>
                    </div>
                </div>
            </div>

            <!-- Decision Tree: Do You Need a Broker VM -->
            <h2><i class="fas fa-code-branch"></i> Decision Tree: Do You Need a Broker VM?</h2>
            
            <div class="decision-tree">
                <div class="decision-node question">
                    <strong>What type of data sources do you have?</strong>
                </div>
                <div class="decision-branch">
                    <div>
                        <div class="decision-arrow">↓ Only Cloud/SaaS</div>
                        <div class="decision-node yes" style="background: #1a4d2e;">
                            <strong style="color: #3fb950;"><i class="fas fa-times"></i> No Broker VM Needed</strong>
                            <div style="color: #8b949e; font-size: 0.85rem;">Use native cloud collectors & API integrations</div>
                        </div>
                    </div>
                    <div>
                        <div class="decision-arrow">↓ Endpoints Only</div>
                        <div class="decision-node yes" style="background: #1a4d2e;">
                            <strong style="color: #3fb950;"><i class="fas fa-times"></i> No Broker VM Needed</strong>
                            <div style="color: #8b949e; font-size: 0.85rem;">XDR agents connect directly to cloud</div>
                        </div>
                    </div>
                    <div>
                        <div class="decision-arrow">↓ On-Prem Network Devices</div>
                        <div class="decision-node question">
                            <strong>Firewalls, switches, IDS, servers?</strong>
                        </div>
                        <div class="decision-branch">
                            <div>
                                <div class="decision-arrow">↓ YES</div>
                                <div class="decision-node no" style="background: #4d1a1a;">
                                    <strong style="color: #f85149;"><i class="fas fa-check"></i> Broker VM Required</strong>
                                    <div style="color: #8b949e; font-size: 0.85rem;">For syslog, WEL, file-based collection</div>
                                </div>
                            </div>
                            <div>
                                <div class="decision-arrow">↓ NO</div>
                                <div class="decision-node yes" style="background: #1a4d2e;">
                                    <strong style="color: #3fb950;"><i class="fas fa-times"></i> No Broker VM Needed</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deployment Steps -->
            <h2><i class="fas fa-download"></i> Step-by-Step Deployment</h2>

            <div class="steps-container">
                <div class="step-card">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Download Broker VM Image</h4>
                        <p>Navigate to <span class="console-path">Settings → Data Sources → Broker VM → Download</span></p>
                        <p>Choose your hypervisor: VMware OVA, Hyper-V VHD, or KVM QCOW2</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Deploy the Virtual Machine</h4>
                        <p>Import into your hypervisor and allocate resources based on expected EPS (see sizing below)</p>
                        <p>Minimum: 4 vCPU, 8 GB RAM, 256 GB disk. Production: 8+ vCPU, 32+ GB RAM</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Configure Network Settings</h4>
                        <p>Assign static IP accessible by log sources. Configure DNS and NTP (critical for timestamps).</p>
                        <p>Open outbound HTTPS/443 to XSIAM cloud endpoints (see firewall rules below)</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Register with XSIAM</h4>
                        <p>SSH to Broker VM (default user: admin). Run: <code>broker_setup</code></p>
                        <p>Enter the registration token from XSIAM console. Broker will appear in UI within 2-5 minutes.</p>
                    </div>
                </div>
                <div class="step-card">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Configure Data Collection</h4>
                        <p>In XSIAM console, configure data sources to use this Broker VM</p>
                        <p>Set up syslog listeners, WEL collection, or file monitoring as needed</p>
                    </div>
                </div>
            </div>

            <!-- Sizing Guide -->
            <h2><i class="fas fa-calculator"></i> Sizing Guide</h2>
            
            <div class="config-section">
                <h4>Resource Requirements by EPS</h4>
                <table class="styled-table">
                    <thead>
                        <tr><th>Expected EPS</th><th>vCPU</th><th>RAM</th><th>Disk</th><th>Network</th><th>Use Case</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>&lt; 2,000 EPS</strong></td>
                            <td>4</td>
                            <td>8 GB</td>
                            <td>256 GB</td>
                            <td>1 Gbps</td>
                            <td>Small office, single site</td>
                        </tr>
                        <tr>
                            <td><strong>2,000 - 10,000 EPS</strong></td>
                            <td>8</td>
                            <td>16 GB</td>
                            <td>512 GB</td>
                            <td>1 Gbps</td>
                            <td>Medium enterprise</td>
                        </tr>
                        <tr>
                            <td><strong>10,000 - 30,000 EPS</strong></td>
                            <td>12</td>
                            <td>32 GB</td>
                            <td>1 TB</td>
                            <td>10 Gbps</td>
                            <td>Large enterprise, DC</td>
                        </tr>
                        <tr>
                            <td><strong>&gt; 30,000 EPS</strong></td>
                            <td>16+</td>
                            <td>64+ GB</td>
                            <td>2+ TB SSD</td>
                            <td>10 Gbps</td>
                            <td>Multiple Brokers recommended</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box" style="margin-top: 16px;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Disk is Critical</h4>
                    <p>Broker VM buffers data locally if XSIAM cloud is unreachable. Size disk for 24-48 hours of buffering at peak EPS. Use SSD for high-volume deployments.</p>
                </div>
            </div>

            <!-- Network Requirements -->
            <h2><i class="fas fa-network-wired"></i> Network Requirements</h2>
            
            <div class="config-section">
                <h4>Firewall Rules</h4>
                <table class="styled-table">
                    <thead>
                        <tr><th>Direction</th><th>Source</th><th>Destination</th><th>Port</th><th>Purpose</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge green">Inbound</span></td>
                            <td>Log Sources</td>
                            <td>Broker VM</td>
                            <td>514/UDP, 514/TCP, 6514/TCP</td>
                            <td>Syslog (UDP, TCP, TLS)</td>
                        </tr>
                        <tr>
                            <td><span class="badge green">Inbound</span></td>
                            <td>Admin Workstations</td>
                            <td>Broker VM</td>
                            <td>22/TCP</td>
                            <td>SSH Management</td>
                        </tr>
                        <tr>
                            <td><span class="badge blue">Outbound</span></td>
                            <td>Broker VM</td>
                            <td>*.xdr.paloaltonetworks.com</td>
                            <td>443/TCP</td>
                            <td>Data upload to XSIAM</td>
                        </tr>
                        <tr>
                            <td><span class="badge blue">Outbound</span></td>
                            <td>Broker VM</td>
                            <td>NTP Server</td>
                            <td>123/UDP</td>
                            <td>Time synchronization (critical)</td>
                        </tr>
                        <tr>
                            <td><span class="badge blue">Outbound</span></td>
                            <td>Broker VM</td>
                            <td>DNS Server</td>
                            <td>53/UDP</td>
                            <td>Name resolution</td>
                        </tr>
                    </tbody>
                </table>

                <div class="tip-box" style="margin-top: 16px;">
                    <div class="tip-box-title"><i class="fas fa-lightbulb"></i> Pro Tip: Place Broker VM Strategically</div>
                    <p>Deploy in a DMZ or management VLAN accessible by all log sources. Avoid routing syslog across WAN links - deploy regional Brokers instead.</p>
                </div>
            </div>

            <!-- Syslog Configuration -->
            <h2><i class="fas fa-cog"></i> Syslog Listener Configuration</h2>
            <p class="console-path">Settings → Data Sources → Syslog Collector</p>

            <div class="config-section">
                <h4>Creating a Syslog Listener</h4>
                <div class="steps-container">
                    <div class="step-card">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Add New Listener</h4>
                            <p>Click "Add Listener" → Select Broker VM → Choose Protocol (UDP/TCP/TLS)</p>
                        </div>
                    </div>
                    <div class="step-card">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Configure Port</h4>
                            <p>Default: 514. Use custom ports to separate different log types (e.g., 515 for firewalls, 516 for servers)</p>
                        </div>
                    </div>
                    <div class="step-card">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Map to Vendor/Product</h4>
                            <p>Select the log source vendor (e.g., Palo Alto Networks → NGFW). This determines the parser used.</p>
                        </div>
                    </div>
                    <div class="step-card">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Enable and Test</h4>
                            <p>Enable the listener. Configure your source device to send to Broker_IP:Port. Verify data in Query Center.</p>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 24px;">Example Syslog Configurations</h4>
                
                <div class="code-header">
                    <span class="code-title">Palo Alto NGFW Syslog Server Configuration</span>
                    <span class="code-lang">PAN-OS CLI</span>
                </div>
                <div class="code-content">set deviceconfig system syslog profile XSIAM server BROKER1 server &lt;BROKER_IP&gt;
set deviceconfig system syslog profile XSIAM server BROKER1 transport TCP
set deviceconfig system syslog profile XSIAM server BROKER1 port 514
set deviceconfig system syslog profile XSIAM server BROKER1 format BSD
set deviceconfig system syslog profile XSIAM server BROKER1 facility LOG_USER

# Apply to log forwarding profile
set rulebase security rules allow-all log-setting log_to_syslog</div>

                <div class="code-header" style="margin-top: 16px;">
                    <span class="code-title">Linux rsyslog Configuration</span>
                    <span class="code-lang">/etc/rsyslog.d/xsiam.conf</span>
                </div>
                <div class="code-content"># Forward all logs to Broker VM via TCP
*.* @@&lt;BROKER_IP&gt;:514

# Or for TLS (recommended)
*.* @@(o)&lt;BROKER_IP&gt;:6514</div>

                <div class="code-header" style="margin-top: 16px;">
                    <span class="code-title">Windows Event Forwarding (WEF) to Syslog</span>
                    <span class="code-lang">Note</span>
                </div>
                <div class="code-content"># Windows doesn't natively support syslog
# Options:
# 1. Use NXLog to convert WEL to syslog
# 2. Use Broker VM's native WEL collection (recommended)
# 3. Deploy XDR agent (best option for Windows)</div>
            </div>

            <!-- High Availability -->
            <h2><i class="fas fa-server"></i> High Availability Architecture</h2>
            
            <div class="flow-diagram">
                <div class="flow-diagram-title"><i class="fas fa-project-diagram"></i> HA Broker Deployment</div>
                <div class="flow-row centered">
                    <div class="flow-box">
                        <div class="flow-box-title"><i class="fas fa-network-wired"></i> Log Sources</div>
                    </div>
                </div>
                <div class="flow-row centered">
                    <span class="flow-arrow"><i class="fas fa-arrow-down"></i></span>
                </div>
                <div class="flow-row centered">
                    <div class="flow-box warning">
                        <div class="flow-box-title"><i class="fas fa-balance-scale"></i> Load Balancer (Optional)</div>
                        <div class="flow-box-subtitle">VIP for failover</div>
                    </div>
                </div>
                <div class="flow-row centered">
                    <span class="flow-arrow"><i class="fas fa-arrow-down"></i></span>
                </div>
                <div class="flow-row centered">
                    <div class="flow-box primary">
                        <div class="flow-box-title"><i class="fas fa-server"></i> Broker VM 1</div>
                        <div class="flow-box-subtitle">Active</div>
                    </div>
                    <div class="flow-box primary">
                        <div class="flow-box-title"><i class="fas fa-server"></i> Broker VM 2</div>
                        <div class="flow-box-subtitle">Active</div>
                    </div>
                </div>
                <div class="flow-row centered">
                    <span class="flow-arrow"><i class="fas fa-arrow-down"></i></span>
                </div>
                <div class="flow-row centered">
                    <div class="flow-box success">
                        <div class="flow-box-title"><i class="fas fa-cloud"></i> XSIAM Cloud</div>
                    </div>
                </div>
            </div>

            <div class="config-section">
                <h4>HA Options</h4>
                <table class="styled-table">
                    <thead>
                        <tr><th>Option</th><th>How It Works</th><th>Pros</th><th>Cons</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Active-Active (Recommended)</strong></td>
                            <td>Configure sources to send to both Brokers. XSIAM deduplicates.</td>
                            <td>No single point of failure, load distribution</td>
                            <td>Duplicate network traffic</td>
                        </tr>
                        <tr>
                            <td><strong>Load Balancer VIP</strong></td>
                            <td>LB distributes traffic. Failover on Broker failure.</td>
                            <td>Single destination for sources, automatic failover</td>
                            <td>Requires LB infrastructure</td>
                        </tr>
                        <tr>
                            <td><strong>Active-Passive</strong></td>
                            <td>Secondary Broker on standby. Manual or scripted failover.</td>
                            <td>Simple, lower resource usage</td>
                            <td>Manual intervention, potential data gap</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Troubleshooting -->
            <h2><i class="fas fa-tools"></i> Troubleshooting</h2>
            
            <div class="config-section">
                <h4>Common Issues & Solutions</h4>
                
                <div class="decision-tree">
                    <div class="decision-node question">
                        <strong>Broker VM Not Appearing in Console</strong>
                    </div>
                    <div class="decision-branch">
                        <div style="flex: 1;">
                            <div class="decision-path">
                                <span class="decision-path-label yes">Check</span>
                                <div class="decision-path-content">
                                    <strong>Outbound connectivity</strong>
                                    <p style="margin: 4px 0; font-size: 0.9rem;">Can Broker reach *.xdr.paloaltonetworks.com:443?</p>
                                    <code style="font-size: 0.8rem;">curl -v https://api.xdr.paloaltonetworks.com</code>
                                </div>
                            </div>
                            <div class="decision-path">
                                <span class="decision-path-label yes">Check</span>
                                <div class="decision-path-content">
                                    <strong>Registration token</strong>
                                    <p style="margin: 4px 0; font-size: 0.9rem;">Token expired? Generate new one in console.</p>
                                </div>
                            </div>
                            <div class="decision-path">
                                <span class="decision-path-label yes">Check</span>
                                <div class="decision-path-content">
                                    <strong>DNS resolution</strong>
                                    <p style="margin: 4px 0; font-size: 0.9rem;"><code>nslookup api.xdr.paloaltonetworks.com</code></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-tree" style="margin-top: 16px;">
                    <div class="decision-node question">
                        <strong>No Data Arriving from Syslog Source</strong>
                    </div>
                    <div class="decision-branch">
                        <div style="flex: 1;">
                            <div class="decision-path">
                                <span class="decision-path-label yes">Step 1</span>
                                <div class="decision-path-content">
                                    <strong>Verify packets arriving at Broker</strong>
                                    <code style="font-size: 0.8rem;">tcpdump -i eth0 port 514 -nn</code>
                                </div>
                            </div>
                            <div class="decision-path">
                                <span class="decision-path-label yes">Step 2</span>
                                <div class="decision-path-content">
                                    <strong>Check listener status</strong>
                                    <code style="font-size: 0.8rem;">netstat -an | grep 514</code>
                                </div>
                            </div>
                            <div class="decision-path">
                                <span class="decision-path-label yes">Step 3</span>
                                <div class="decision-path-content">
                                    <strong>Check Broker logs</strong>
                                    <code style="font-size: 0.8rem;">tail -f /var/log/panw/collector.log</code>
                                </div>
                            </div>
                            <div class="decision-path">
                                <span class="decision-path-label yes">Step 4</span>
                                <div class="decision-path-content">
                                    <strong>Query raw logs in XSIAM</strong>
                                    <code style="font-size: 0.8rem;">dataset = _raw_log | limit 10</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 24px;">CLI Commands Reference</h4>
                <div class="code-header">
                    <span class="code-title">Broker VM CLI Commands</span>
                    <span class="code-lang">SSH</span>
                </div>
                <div class="code-content"># Check Broker status
broker_status

# View collector logs
tail -f /var/log/panw/collector.log

# Check disk usage (critical!)
df -h

# Check memory usage
free -m

# Test connectivity to XSIAM
curl -v https://api.xdr.paloaltonetworks.com

# Restart collector service
sudo systemctl restart panw-collector

# View active connections
netstat -an | grep ESTABLISHED</div>
            </div>

            <!-- Interview Questions -->
            <h2><i class="fas fa-comments"></i> Interview Questions & Answers</h2>
            <div class="qa-section">
                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: When would you deploy a Broker VM vs using direct cloud collection?</button>
                    <div class="qa-answer">
                        <p>The decision between Broker VM and direct cloud collection comes down to where the data source lives and what protocols it supports:</p>
                        
                        <p><strong>Broker VM is required when:</strong></p>
                        <ul>
                            <li><strong>On-premises network devices:</strong> Firewalls, switches, routers, IDS/IPS, and load balancers typically only support syslog. They can't initiate HTTPS connections to cloud endpoints, so you need a Broker VM to receive syslog and forward it securely.</li>
                            <li><strong>Windows servers without XDR agents:</strong> If you can't deploy the Cortex XDR agent on certain servers (legacy systems, third-party restrictions), the Broker VM can collect Windows Event Logs directly.</li>
                            <li><strong>Air-gapped or regulated environments:</strong> Some environments require data to pass through controlled egress points. The Broker VM acts as that controlled point, with all data leaving through a single, auditable path.</li>
                            <li><strong>High-volume sources benefiting from local aggregation:</strong> For extremely high EPS sources, local buffering and compression on the Broker VM can reduce bandwidth and handle temporary cloud connectivity issues.</li>
                        </ul>
                        
                        <p><strong>Direct cloud collection is preferred when:</strong></p>
                        <ul>
                            <li><strong>Cloud services:</strong> AWS, Azure, GCP have native collectors that pull directly from CloudTrail, Azure Monitor, etc. No need to route through on-premises.</li>
                            <li><strong>SaaS applications:</strong> Okta, Microsoft 365, Salesforce have API integrations. XSIAM pulls directly from their APIs.</li>
                            <li><strong>Endpoints with XDR agents:</strong> Agents connect directly to XSIAM cloud. This is always the best option for endpoints because you get richer telemetry and response capabilities.</li>
                        </ul>
                        
                        <p><strong>Hybrid scenarios:</strong> Most enterprises need both. Endpoints use agents, cloud uses native collectors, and on-premises network infrastructure uses Broker VMs. The key is deploying Broker VMs strategically—typically one or two per major site or data center, rather than one per device.</p>
                    </div>
                </div>

                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How would you size a Broker VM for a large enterprise environment?</button>
                    <div class="qa-answer">
                        <p>Sizing a Broker VM correctly is critical—undersized Brokers cause data loss, oversized ones waste resources. Here's my methodology:</p>
                        
                        <p><strong>Step 1: Calculate expected EPS</strong></p>
                        <p>I inventory all sources that will send to this Broker and estimate their EPS. For example:</p>
                        <ul>
                            <li>Palo Alto NGFW (busy data center): 5,000-10,000 EPS</li>
                            <li>Cisco switches (20 devices × 50 EPS): 1,000 EPS</li>
                            <li>Linux servers (100 servers × 20 EPS): 2,000 EPS</li>
                            <li>Total: ~15,000 EPS with headroom for spikes</li>
                        </ul>
                        
                        <p><strong>Step 2: Apply the sizing table</strong></p>
                        <p>For 15,000 EPS, I'd spec: 12 vCPU, 32 GB RAM, 1 TB SSD disk, 10 Gbps NIC. But I always add 50% headroom for unexpected spikes—attacks, misconfigurations, and new sources added without planning.</p>
                        
                        <p><strong>Step 3: Size disk for buffering</strong></p>
                        <p>This is often overlooked. If XSIAM cloud is unreachable, the Broker buffers locally. I calculate: 15,000 EPS × 1 KB average × 86,400 seconds × 2 days = ~2.6 TB for 48-hour buffer. I'd provision 2 TB SSD minimum.</p>
                        
                        <p><strong>Step 4: Consider multiple Brokers</strong></p>
                        <p>For very high EPS (30,000+), I recommend multiple Brokers rather than one massive one. Benefits include:</p>
                        <ul>
                            <li>High availability if one fails</li>
                            <li>Distribute load across hypervisor hosts</li>
                            <li>Separate by data type or security zone</li>
                        </ul>
                        
                        <p><strong>Step 5: Plan for growth</strong></p>
                        <p>I ask about planned growth—new offices, acquisitions, cloud migrations. It's much easier to provision extra resources upfront than to expand later.</p>
                        
                        <p><strong>Monitoring after deployment:</strong> I set up alerts for CPU > 80%, memory > 85%, and disk > 70%. These give early warning before performance degrades.</p>
                    </div>
                </div>

                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you ensure high availability for Broker VM deployments?</button>
                    <div class="qa-answer">
                        <p>High availability for Broker VMs is essential because they're a single point of failure for on-premises log collection. Here's my approach:</p>
                        
                        <p><strong>Active-Active deployment (my preferred approach):</strong></p>
                        <p>I deploy two Broker VMs and configure log sources to send to both. Most network devices support multiple syslog destinations. XSIAM handles deduplication automatically—events with identical timestamps and content are merged. This provides:</p>
                        <ul>
                            <li>Zero data loss if one Broker fails</li>
                            <li>Load distribution during normal operations</li>
                            <li>No manual failover required</li>
                        </ul>
                        <p>The trade-off is doubled network traffic on the log source side, but for most syslog sources this is negligible.</p>
                        
                        <p><strong>Load balancer approach:</strong></p>
                        <p>For sources that only support a single syslog destination, I put a load balancer in front of the Brokers. The LB presents a virtual IP (VIP) that sources send to. The LB distributes traffic and handles failover. Considerations:</p>
                        <ul>
                            <li>LB must support UDP (syslog) health checks</li>
                            <li>Session persistence typically not needed for syslog</li>
                            <li>The LB itself needs to be redundant</li>
                        </ul>
                        
                        <p><strong>Geographic distribution:</strong></p>
                        <p>For multi-site enterprises, I deploy Broker VMs locally at each major site rather than centralizing. This reduces WAN dependency—if the WAN link fails, local logs still reach the local Broker and buffer until connectivity is restored.</p>
                        
                        <p><strong>Monitoring and alerting:</strong></p>
                        <p>I set up monitoring for each Broker's health: CPU, memory, disk, and connectivity to XSIAM cloud. I also monitor for data gaps—if events from a source stop arriving, alert immediately. The goal is to detect Broker issues before they cause data loss.</p>
                        
                        <p><strong>Testing failover:</strong></p>
                        <p>I regularly test HA by intentionally stopping one Broker and verifying data continues flowing through the other. This validates the design and trains the team on the expected behavior during an actual failure.</p>
                    </div>
                </div>

                <div class="qa-item">
                    <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk me through troubleshooting a Broker VM that's not forwarding data to XSIAM.</button>
                    <div class="qa-answer">
                        <p>When a Broker VM isn't forwarding data, I work through the data path systematically:</p>
                        
                        <p><strong>Step 1: Verify the Broker appears healthy in XSIAM console</strong></p>
                        <p>First, I check if XSIAM sees the Broker at all. In Settings → Data Sources → Broker VM, I look for the Broker's status. If it shows as disconnected, the issue is outbound connectivity from the Broker to XSIAM cloud.</p>
                        
                        <p><strong>Step 2: Test outbound connectivity</strong></p>
                        <p>I SSH to the Broker and run:</p>
                        <ul>
                            <li><code>curl -v https://api.xdr.paloaltonetworks.com</code> — Should return 200 or 401 (authentication expected)</li>
                            <li>If it fails: Check firewall rules for outbound 443, proxy settings, DNS resolution</li>
                        </ul>
                        
                        <p><strong>Step 3: Check Broker disk space</strong></p>
                        <p><code>df -h</code> — If disk is full, the Broker can't buffer data. This is a common issue with undersized deployments. Clear old data or expand disk immediately.</p>
                        
                        <p><strong>Step 4: Check collector service</strong></p>
                        <p><code>systemctl status panw-collector</code> — Is the service running? Check logs at <code>/var/log/panw/collector.log</code> for errors. Common issues include certificate problems, memory exhaustion, or configuration corruption.</p>
                        
                        <p><strong>Step 5: Verify data is arriving at Broker</strong></p>
                        <p>If outbound is fine, I check inbound data. <code>tcpdump -i eth0 port 514 -nn</code> shows if syslog packets are arriving. If not, the issue is between the source and Broker—check source configuration and network path.</p>
                        
                        <p><strong>Step 6: Check listener configuration</strong></p>
                        <p><code>netstat -an | grep 514</code> — Is the Broker listening on the expected port? In XSIAM console, verify the listener is enabled and mapped to the correct vendor/product.</p>
                        
                        <p><strong>Step 7: Check XSIAM for raw data</strong></p>
                        <p>Query: <code>dataset = _raw_log | filter _collector_name = "BrokerName" | limit 10</code>. If raw logs appear but parsed data doesn't, the issue is parsing—check the vendor/product mapping.</p>
                        
                        <p><strong>Resolution workflow:</strong> I document each step's findings, fix the root cause, then verify data flows end-to-end by checking query results in XSIAM.</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="next-steps-grid" style="margin-top: 32px;">
                <a href="data-ingestion.html" class="next-step-card">
                    <h4><i class="fas fa-database"></i> Data Ingestion Overview</h4>
                    <p>Learn about all collection methods</p>
                </a>
                <a href="parsing-flows.html" class="next-step-card">
                    <h4><i class="fas fa-stream"></i> Parsing & Flows</h4>
                    <p>How data is parsed and normalized</p>
                </a>
                <a href="custom-log-onboarding.html" class="next-step-card">
                    <h4><i class="fas fa-plus-circle"></i> Custom Log Onboarding</h4>
                    <p>Onboard unsupported data sources</p>
                </a>
            </div>
        </main>
    </div>
</div>

<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const mainWrapper = document.getElementById('mainWrapper');
        const overlay = document.getElementById('sidebarOverlay');
        if (window.innerWidth <= 768) {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        } else {
            sidebar.classList.toggle('collapsed');
            mainWrapper.classList.toggle('expanded');
        }
    }
    document.querySelectorAll('.qa-question').forEach(btn => {
        btn.addEventListener('click', () => {
            const answer = btn.nextElementSibling;
            const isOpen = answer.style.display === 'block';
            document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
            if (!isOpen) answer.style.display = 'block';
        });
    });
    window.addEventListener('resize', () => {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (window.innerWidth > 768) {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }
    });
</script>
</body>
</html>
