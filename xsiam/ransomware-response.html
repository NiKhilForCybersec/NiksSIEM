<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ransomware Response Playbook | XSIAM Incident Response</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
            <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="../index.html" class="sidebar-brand">
                <i class="fas fa-shield-alt"></i>
                <span>Nik's SIEM</span>
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="sidebar-content">
            <!-- Platforms Section -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Platforms</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="../xsiam/index.html" class="sidebar-nav-link active" data-platform="xsiam"><span class="platform-dot"></span><span>XSIAM</span></a></li>
                    <li class="sidebar-nav-item"><a href="../splunk/index.html" class="sidebar-nav-link" data-platform="splunk"><span class="platform-dot"></span><span>Splunk</span></a></li>
                    <li class="sidebar-nav-item"><a href="../sentinel/index.html" class="sidebar-nav-link" data-platform="sentinel"><span class="platform-dot"></span><span>Sentinel</span></a></li>
                    <li class="sidebar-nav-item"><a href="../crowdstrike/index.html" class="sidebar-nav-link" data-platform="crowdstrike"><span class="platform-dot"></span><span>CrowdStrike</span></a></li>
                    <li class="sidebar-nav-item"><a href="../cortex/index.html" class="sidebar-nav-link" data-platform="cortex"><span class="platform-dot"></span><span>Cortex XDR</span></a></li>
                    <li class="sidebar-nav-item"><a href="../mde/index.html" class="sidebar-nav-link" data-platform="mde"><span class="platform-dot"></span><span>Defender for Endpoint</span></a></li>
                    <li class="sidebar-nav-item"><a href="../operations/index.html" class="sidebar-nav-link" data-platform="operations"><span class="platform-dot"></span><span>SOC Operations</span></a></li>
                </ul>
            </div>

            <div class="sidebar-divider"></div>
            
            <!-- Getting Started -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Getting Started</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="index.html" class="sidebar-nav-link"><i class="fas fa-home"></i><span>Overview</span></a></li>
                    <li class="sidebar-nav-item"><a href="architecture.html" class="sidebar-nav-link"><i class="fas fa-sitemap"></i><span>Architecture</span></a></li>
                    <li class="sidebar-nav-item"><a href="comparison.html" class="sidebar-nav-link"><i class="fas fa-balance-scale"></i><span>Platform Comparison</span></a></li>
                </ul>
            </div>
            
            <!-- Data Collection -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Data Collection</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="data-ingestion.html" class="sidebar-nav-link"><i class="fas fa-database"></i><span>Data Ingestion</span></a></li>
                    <li class="sidebar-nav-item"><a href="broker-vm.html" class="sidebar-nav-link"><i class="fas fa-server"></i><span>Broker VM</span></a></li>
                    <li class="sidebar-nav-item"><a href="agents.html" class="sidebar-nav-link"><i class="fas fa-microchip"></i><span>Agents</span></a></li>
                    <li class="sidebar-nav-item"><a href="parsing-flows.html" class="sidebar-nav-link"><i class="fas fa-stream"></i><span>Parsing & Flows</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-log-onboarding.html" class="sidebar-nav-link"><i class="fas fa-plus-circle"></i><span>Custom Log Onboarding</span></a></li>
                    <li class="sidebar-nav-item"><a href="retention-tiers.html" class="sidebar-nav-link"><i class="fas fa-archive"></i><span>Retention Tiers</span></a></li>
                </ul>
            </div>
            
            <!-- Query & Analysis -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Query & Analysis</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="xql-fundamentals.html" class="sidebar-nav-link"><i class="fas fa-terminal"></i><span>XQL Fundamentals</span></a></li>
                    <li class="sidebar-nav-item"><a href="xql-advanced.html" class="sidebar-nav-link"><i class="fas fa-rocket"></i><span>XQL Advanced</span></a></li>
                    <li class="sidebar-nav-item"><a href="dashboards.html" class="sidebar-nav-link"><i class="fas fa-chart-line"></i><span>Dashboards</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-hunting.html" class="sidebar-nav-link"><i class="fas fa-search"></i><span>Threat Hunting</span></a></li>
                </ul>
            </div>
            
            <!-- Detection & Response -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Detection & Response</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="xdr-overview.html" class="sidebar-nav-link"><i class="fas fa-shield-virus"></i><span>XDR & Detection</span></a></li>
                    <li class="sidebar-nav-item"><a href="correlation-rules.html" class="sidebar-nav-link"><i class="fas fa-project-diagram"></i><span>Correlation Rules</span></a></li>
                    <li class="sidebar-nav-item"><a href="ml-ueba.html" class="sidebar-nav-link"><i class="fas fa-brain"></i><span>ML & UEBA</span></a></li>
                    <li class="sidebar-nav-item"><a href="identity-analytics.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>Identity Analytics</span></a></li>
                    <li class="sidebar-nav-item"><a href="alert-management.html" class="sidebar-nav-link"><i class="fas fa-bell"></i><span>Alert Management</span></a></li>
                    <li class="sidebar-nav-item"><a href="incident-response.html" class="sidebar-nav-link"><i class="fas fa-ambulance"></i><span>Incident Response</span></a></li>
                </ul>
            </div>
            
            <!-- Incident Playbooks (NEW) -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Incident Playbooks</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="ransomware-response.html" class="sidebar-nav-link active"><i class="fas fa-lock"></i><span>Ransomware Response</span></a></li>
                    <li class="sidebar-nav-item"><a href="bec-investigation.html" class="sidebar-nav-link"><i class="fas fa-envelope"></i><span>BEC Investigation</span></a></li>
                    <li class="sidebar-nav-item"><a href="insider-threat.html" class="sidebar-nav-link"><i class="fas fa-user-secret"></i><span>Insider Threat</span></a></li>
                </ul>
            </div>
            
            <!-- Automation & Intel -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Automation & Intel</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="xsoar-automation.html" class="sidebar-nav-link"><i class="fas fa-robot"></i><span>XSOAR Automation</span></a></li>
                    <li class="sidebar-nav-item"><a href="threat-intel.html" class="sidebar-nav-link"><i class="fas fa-skull-crossbones"></i><span>Threat Intel</span></a></li>
                    <li class="sidebar-nav-item"><a href="recon-asm.html" class="sidebar-nav-link"><i class="fas fa-globe"></i><span>Recon & ASM</span></a></li>
                </ul>
            </div>
            
            <!-- Integrations -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Integrations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="cloud-integrations.html" class="sidebar-nav-link"><i class="fas fa-cloud"></i><span>Cloud (AWS/Azure/GCP)</span></a></li>
                    <li class="sidebar-nav-item"><a href="identity-integrations.html" class="sidebar-nav-link"><i class="fas fa-id-card"></i><span>Identity (Okta/AD)</span></a></li>
                    <li class="sidebar-nav-item"><a href="custom-integrations.html" class="sidebar-nav-link"><i class="fas fa-puzzle-piece"></i><span>Custom Integrations</span></a></li>
                    <li class="sidebar-nav-item"><a href="marketplace.html" class="sidebar-nav-link"><i class="fas fa-store"></i><span>Marketplace</span></a></li>
                </ul>
            </div>
            
            <!-- Operations (NEW) -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Operations</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="troubleshooting.html" class="sidebar-nav-link"><i class="fas fa-wrench"></i><span>Troubleshooting</span></a></li>
                    <li class="sidebar-nav-item"><a href="day2-operations.html" class="sidebar-nav-link"><i class="fas fa-tasks"></i><span>Day-2 Operations</span></a></li>
                    <li class="sidebar-nav-item"><a href="alert-tuning.html" class="sidebar-nav-link"><i class="fas fa-sliders-h"></i><span>Alert Tuning</span></a></li>
                    <li class="sidebar-nav-item"><a href="cost-optimization.html" class="sidebar-nav-link"><i class="fas fa-dollar-sign"></i><span>Cost Optimization</span></a></li>
                </ul>
            </div>
            
            <!-- Administration -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Administration</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="rbac-access-control.html" class="sidebar-nav-link"><i class="fas fa-users-cog"></i><span>RBAC & Access</span></a></li>
                    <li class="sidebar-nav-item"><a href="health-monitoring.html" class="sidebar-nav-link"><i class="fas fa-heartbeat"></i><span>Health Monitoring</span></a></li>
                    <li class="sidebar-nav-item"><a href="backup-recovery.html" class="sidebar-nav-link"><i class="fas fa-undo"></i><span>Backup & Recovery</span></a></li>
                    <li class="sidebar-nav-item"><a href="api-administration.html" class="sidebar-nav-link"><i class="fas fa-code"></i><span>API Administration</span></a></li>
                </ul>
            </div>
            
            <!-- Architecture & Planning -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Architecture & Planning</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="capacity-planning.html" class="sidebar-nav-link"><i class="fas fa-calculator"></i><span>Capacity Planning</span></a></li>
                    <li class="sidebar-nav-item"><a href="network-requirements.html" class="sidebar-nav-link"><i class="fas fa-network-wired"></i><span>Network Requirements</span></a></li>
                    <li class="sidebar-nav-item"><a href="multi-tenant.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Multi-Tenant</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-residency.html" class="sidebar-nav-link"><i class="fas fa-map-marked-alt"></i><span>Data Residency</span></a></li>
                    <li class="sidebar-nav-item"><a href="migration-guide.html" class="sidebar-nav-link"><i class="fas fa-exchange-alt"></i><span>Migration Guide</span></a></li>
                </ul>
            </div>
            
            <!-- Compliance & Governance -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Compliance & Governance</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="compliance-frameworks.html" class="sidebar-nav-link"><i class="fas fa-clipboard-check"></i><span>Compliance Frameworks</span></a></li>
                    <li class="sidebar-nav-item"><a href="audit-reporting.html" class="sidebar-nav-link"><i class="fas fa-file-alt"></i><span>Audit & Reporting</span></a></li>
                    <li class="sidebar-nav-item"><a href="data-privacy.html" class="sidebar-nav-link"><i class="fas fa-user-shield"></i><span>Data Privacy</span></a></li>
                    <li class="sidebar-nav-item"><a href="soc-metrics.html" class="sidebar-nav-link"><i class="fas fa-tachometer-alt"></i><span>SOC Metrics & KPIs</span></a></li>
                </ul>
            </div>
            
            <!-- Enterprise -->
            <div class="sidebar-section">
                <div class="sidebar-section-title">Enterprise</div>
                <ul class="sidebar-nav">
                    <li class="sidebar-nav-item"><a href="enterprise-soc.html" class="sidebar-nav-link"><i class="fas fa-building"></i><span>Enterprise SOC</span></a></li>
                </ul>
            </div>
        </div>
    </aside>
    
    <!-- Sidebar Overlay (for mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>


        
        <div class="main-wrapper" id="mainWrapper">
            <button class="mobile-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
            
            <main class="main-content">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">XSIAM</a><span class="separator">/</span>
                    <span class="current">Ransomware Response</span>
                </div>

                <h1><i class="fas fa-lock"></i> Ransomware Incident Response Playbook</h1>
                <p class="lead">Step-by-step response procedures for ransomware incidents using XSIAM. This playbook covers detection, containment, investigation, eradication, and recovery phases with specific XQL queries and response actions.</p>

                <div class="warning-box" style="border-color: #f85149; background: rgba(248, 81, 73, 0.1);">
                    <h4><i class="fas fa-exclamation-triangle"></i> CRITICAL INCIDENT - Time Sensitive</h4>
                    <p>Ransomware spreads rapidly. Every minute counts. Follow this playbook in order but prioritize CONTAINMENT to stop spread. Do NOT pay ransom without executive/legal approval.</p>
                </div>

                <!-- Phase 0: Initial Detection -->
                <h2><i class="fas fa-bell"></i> Phase 0: Detection & Triage (0-15 minutes)</h2>
                
                <div class="decision-tree">
                    <div class="decision-node question">
                        <strong>How was ransomware detected?</strong>
                    </div>
                    <div class="decision-branch" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px;">
                        <div>
                            <div class="decision-node" style="background: #4d1a1a; border-color: #f85149;">
                                <strong style="color: #f85149;">User Reported</strong>
                                <div style="color: #8b949e; font-size: 0.8rem;">Ransom note seen<br>Files encrypted<br>→ Likely active infection</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-node" style="background: #4d3a0d; border-color: #d29922;">
                                <strong style="color: #d29922;">XDR Alert</strong>
                                <div style="color: #8b949e; font-size: 0.8rem;">Ransomware behavior detected<br>May have been blocked<br>→ Verify containment status</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-node" style="background: #1c3a5e; border-color: #58a6ff;">
                                <strong style="color: #58a6ff;">Threat Intel Match</strong>
                                <div style="color: #8b949e; font-size: 0.8rem;">IOC match found<br>May be early stage<br>→ Hunt for execution</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>Initial Triage Queries</h4>
                    <div class="arch-diagram"># Ransomware Detection Query - Run Immediately
# ═══════════════════════════════════════════════════════════════

# Check for Ransomware Alerts (Last 24h)
dataset = xdr_alerts
| filter _time > now() - 24h
| filter alert_name contains_any ("ransomware", "encryption", "ransom", "crypto")
   OR category contains_any ("Ransomware", "Malware")
| fields _time, endpoint_name, alert_name, severity, action_taken, user_name
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# Mass File Modification Detection
dataset = xdr_data
| filter _time > now() - 4h
| filter event_type = "FILE_MODIFICATION" OR event_type = "FILE_RENAME"
| filter action_file_extension in ("encrypted", "locked", "crypto", "crypt", 
         "locky", "cerber", "ryuk", "conti", "lockbit", "blackcat")
| comp count() as file_ops, count_distinct(action_file_path) as unique_files 
  by endpoint_name, user_name
| filter file_ops > 100
| sort file_ops desc

# ═══════════════════════════════════════════════════════════════

# Shadow Copy Deletion (Ransomware Indicator)
dataset = xdr_data
| filter _time > now() - 4h
| filter action_process_image_name in ("vssadmin.exe", "wmic.exe", "powershell.exe")
| filter action_process_command_line contains_any ("delete shadows", "shadowcopy delete", 
         "resize shadowstorage")
| fields _time, endpoint_name, user_name, action_process_command_line
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# Identify Patient Zero (First Infected Host)
dataset = xdr_data
| filter _time > now() - 24h
| filter event_type = "PROCESS_EXECUTION"
| filter actor_process_image_sha256 = "[KNOWN_RANSOMWARE_HASH]"  // Replace with actual hash
| comp min(_time) as first_seen by endpoint_name
| sort first_seen asc
| limit 1</div>
                </div>

                <!-- Phase 1: Containment -->
                <h2><i class="fas fa-shield-alt"></i> Phase 1: Containment (15-60 minutes)</h2>
                
                <div class="warning-box">
                    <h4><i class="fas fa-bolt"></i> ACT FAST - Containment is Priority #1</h4>
                    <p>Isolate infected systems IMMEDIATELY. Do not wait for full investigation. Better to over-contain initially and relax later than let ransomware spread.</p>
                </div>

                <div class="decision-tree">
                    <div class="decision-node question">
                        <strong>Containment Decision Tree</strong>
                    </div>
                    <div class="decision-branch">
                        <div>
                            <div class="decision-arrow">↓ Single Endpoint Infected</div>
                            <div class="decision-node" style="background: #1a4d2e; border-color: #3fb950;">
                                <strong style="color: #3fb950;">Isolate Endpoint via XDR</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Isolate in XSIAM console<br>2. Block hash if known<br>3. Monitor for spread</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-arrow">↓ Multiple Endpoints (2-10)</div>
                            <div class="decision-node" style="background: #4d3a0d; border-color: #d29922;">
                                <strong style="color: #d29922;">Bulk Isolation + Network Segment</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Isolate all affected hosts<br>2. Block lateral movement ports<br>3. Consider subnet isolation</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-arrow">↓ Widespread (&gt;10 endpoints)</div>
                            <div class="decision-node" style="background: #4d1a1a; border-color: #f85149;">
                                <strong style="color: #f85149;">ENTERPRISE CONTAINMENT</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Disable AD accounts<br>2. Isolate network segments<br>3. Block all SMB/RDP<br>4. Consider full network isolation</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>XSIAM Containment Actions</h4>
                    <div class="arch-diagram"># Containment Action Checklist
# ═══════════════════════════════════════════════════════════════

## 1. ISOLATE INFECTED ENDPOINTS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
XSIAM Console: Endpoints → Select Host → Actions → Isolate

API Method:
POST /public_api/v1/endpoints/isolate
{
  "request_data": {
    "endpoint_id": "ENDPOINT_ID_HERE"
  }
}

## 2. BLOCK MALICIOUS HASHES
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
XSIAM Console: Response → Action Center → Block Hash
Add SHA256 of ransomware executable

## 3. BLOCK LATERAL MOVEMENT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Critical ports to block (via firewall/XSOAR):
- SMB: TCP 445, 139
- RDP: TCP 3389  
- WMI: TCP 135
- WinRM: TCP 5985, 5986
- PSExec: TCP 445 + Admin$ share

## 4. DISABLE COMPROMISED ACCOUNTS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Via Active Directory:
- Disable user accounts showing malicious activity
- Reset passwords for admin accounts
- Disable service accounts if compromised

## 5. PRESERVE EVIDENCE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
DO NOT wipe or reimage until:
- Memory dump captured (if possible)
- Disk image captured
- XSIAM logs exported
- Network logs preserved

# ═══════════════════════════════════════════════════════════════</div>
                </div>

                <div class="config-section">
                    <h4>Find All Affected Systems</h4>
                    <div class="arch-diagram"># Identify All Infected Hosts
# ═══════════════════════════════════════════════════════════════

# By Malicious Hash
dataset = xdr_data
| filter _time > now() - 7d
| filter actor_process_image_sha256 = "[RANSOMWARE_SHA256]"
   OR action_process_image_sha256 = "[RANSOMWARE_SHA256]"
| comp count() as executions, 
        min(_time) as first_seen,
        max(_time) as last_seen
  by endpoint_name, endpoint_id
| sort first_seen asc

# ═══════════════════════════════════════════════════════════════

# By Ransomware Behavior
dataset = xdr_data
| filter _time > now() - 24h
| filter causality_chain_sha256_list contains "[RANSOMWARE_SHA256]"
| comp count() as related_events by endpoint_name, endpoint_id
| sort related_events desc

# ═══════════════════════════════════════════════════════════════

# By Network Connections from Patient Zero
dataset = xdr_data
| filter _time > now() - 24h
| filter endpoint_name = "[PATIENT_ZERO_HOSTNAME]"
| filter event_type = "NETWORK_CONNECTION"
| filter dst_ip != null
| comp count() as connections by dst_ip
| join type=inner (
    dataset = xdr_agent_inventory 
    | fields endpoint_name, endpoint_ip
  ) as hosts on dst_ip = hosts.endpoint_ip
| sort connections desc

# ═══════════════════════════════════════════════════════════════

# Endpoints with Encryption Activity
dataset = xdr_data
| filter _time > now() - 12h
| filter event_type = "FILE_MODIFICATION"
| filter action_file_extension matches "^[a-z0-9]{5,10}$"  // Random extensions
| comp count() as encrypted_files by endpoint_name
| filter encrypted_files > 50
| sort encrypted_files desc</div>
                </div>

                <!-- Phase 2: Investigation -->
                <h2><i class="fas fa-search"></i> Phase 2: Investigation (1-4 hours)</h2>
                
                <div class="config-section">
                    <h4>Attack Timeline Reconstruction</h4>
                    <div class="arch-diagram"># Build Complete Attack Timeline
# ═══════════════════════════════════════════════════════════════

# Full Process Chain on Patient Zero
dataset = xdr_data
| filter _time > now() - 7d
| filter endpoint_name = "[PATIENT_ZERO]"
| filter causality_id = "[INCIDENT_CAUSALITY_ID]"
| fields _time, event_type, actor_process_image_name, 
         action_process_image_name, action_process_command_line,
         action_file_path, dst_ip, user_name
| sort _time asc

# ═══════════════════════════════════════════════════════════════

# Initial Access Vector - Check Email
dataset = xdr_data
| filter _time > now() - 7d
| filter endpoint_name = "[PATIENT_ZERO]"
| filter actor_process_image_name in ("outlook.exe", "thunderbird.exe")
| filter action_file_path contains_any (".exe", ".dll", ".js", ".vbs", ".ps1", ".bat", ".hta")
| fields _time, actor_process_image_name, action_file_path, action_file_sha256
| sort _time asc

# ═══════════════════════════════════════════════════════════════

# Initial Access Vector - Check Web Download
dataset = xdr_data
| filter _time > now() - 7d
| filter endpoint_name = "[PATIENT_ZERO]"
| filter actor_process_image_name in ("chrome.exe", "firefox.exe", "msedge.exe", "iexplore.exe")
| filter action_file_path matches "\\.(exe|dll|js|vbs|ps1|bat|hta|iso|img)$"
| fields _time, actor_process_image_name, action_file_path, action_file_sha256
| sort _time asc

# ═══════════════════════════════════════════════════════════════

# Credential Access Detection
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type in ("LSASS_ACCESS", "CREDENTIAL_ACCESS")
| filter endpoint_name in ("[AFFECTED_HOSTS]")
| fields _time, endpoint_name, actor_process_image_name, 
         action_process_image_name, user_name
| sort _time asc

# ═══════════════════════════════════════════════════════════════

# Lateral Movement Detection
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type = "REMOTE_EXECUTION"
| filter src_endpoint_name in ("[AFFECTED_HOSTS]") OR 
         dst_endpoint_name in ("[AFFECTED_HOSTS]")
| fields _time, src_endpoint_name, dst_endpoint_name, 
         user_name, action_process_command_line
| sort _time asc</div>
                </div>

                <div class="config-section">
                    <h4>Identify Ransomware Family</h4>
                    <div class="arch-diagram"># Ransomware Identification
# ═══════════════════════════════════════════════════════════════

## Identify by Ransom Note
Common ransom note filenames:
- readme.txt, README.txt
- DECRYPT-FILES.txt
- HOW_TO_DECRYPT.txt
- RECOVER-FILES.txt
- !!!READ_ME!!!.txt
- HELP_DECRYPT.html

## Identify by File Extension
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Extension           | Ransomware Family
────────────────────┼──────────────────
.lockbit            | LockBit
.blackcat, .ALPHV   | BlackCat/ALPHV
.conti              | Conti
.ryuk               | Ryuk
.revil, .sodinokibi | REvil
.hive               | Hive
.play               | Play
.royal              | Royal
.[random_8_chars]   | Various families

## XQL Query for File Extensions
dataset = xdr_data
| filter _time > now() - 24h
| filter event_type = "FILE_RENAME"
| alter new_extension = arrayindex(split(action_file_path, "."), -1)
| filter length(new_extension) > 4  // Unusual extensions
| comp count() as files by new_extension
| filter files > 10
| sort files desc

## Submit Hash to Threat Intel
1. Get hash from XSIAM incident
2. Check VirusTotal: https://www.virustotal.com
3. Check MalwareBazaar: https://bazaar.abuse.ch
4. Check ID Ransomware: https://id-ransomware.malwarehunterteam.com

# ═══════════════════════════════════════════════════════════════</div>
                </div>

                <!-- Phase 3: Eradication -->
                <h2><i class="fas fa-broom"></i> Phase 3: Eradication (4-24 hours)</h2>
                
                <div class="config-section">
                    <h4>Eradication Checklist</h4>
                    <div style="background: #21262d; padding: 16px; border-radius: 8px;">
                        <h4 style="color: #f85149; margin-top: 0;">⚠️ Do Not Skip Steps - Incomplete Eradication = Reinfection</h4>
                        <div style="display: grid; gap: 8px; margin-top: 12px;">
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ All ransomware hashes blocked in XSIAM</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Malicious domains/IPs blocked at firewall</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Compromised credentials reset (ALL affected accounts)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Service accounts reviewed and rotated</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Persistence mechanisms removed (scheduled tasks, services, registry)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Infected systems wiped and rebuilt (do NOT decrypt in place)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Backup integrity verified before restore</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; color: #c9d1d9;">
                                <input type="checkbox"> <span>☐ Initial access vector closed (phishing email deleted, vulnerability patched)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>Persistence Hunt Queries</h4>
                    <div class="arch-diagram"># Find All Persistence Mechanisms
# ═══════════════════════════════════════════════════════════════

# Scheduled Tasks Created Recently
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type = "SCHEDULED_TASK_CREATION"
| fields _time, endpoint_name, task_name, task_command, user_name
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# Services Created/Modified
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type in ("SERVICE_CREATION", "SERVICE_MODIFICATION")
| fields _time, endpoint_name, service_name, service_path, user_name
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# Registry Run Keys Modified
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type = "REGISTRY_SET_VALUE"
| filter action_registry_key_name contains_any (
    "\\Run", "\\RunOnce", "\\RunServices", "\\Userinit", "\\Shell"
)
| fields _time, endpoint_name, action_registry_key_name, 
         action_registry_value_name, action_registry_data
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# WMI Subscriptions (Advanced Persistence)
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type = "WMI_SUBSCRIPTION"
| fields _time, endpoint_name, wmi_consumer_name, wmi_command
| sort _time desc

# ═══════════════════════════════════════════════════════════════

# Startup Folder Items
dataset = xdr_data
| filter _time > now() - 7d
| filter event_type = "FILE_CREATE"
| filter action_file_path contains "\\Startup\\"
| fields _time, endpoint_name, action_file_path, action_file_sha256
| sort _time desc</div>
                </div>

                <!-- Phase 4: Recovery -->
                <h2><i class="fas fa-undo-alt"></i> Phase 4: Recovery (24-72 hours)</h2>
                
                <div class="decision-tree">
                    <div class="decision-node question">
                        <strong>Recovery Decision Tree</strong>
                    </div>
                    <div class="decision-branch">
                        <div>
                            <div class="decision-arrow">↓ Clean Backups Available</div>
                            <div class="decision-node" style="background: #1a4d2e; border-color: #3fb950;">
                                <strong style="color: #3fb950;">Restore from Backup</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Verify backup integrity<br>2. Rebuild infected systems<br>3. Restore data from backup<br>4. Monitor closely</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-arrow">↓ Backups Compromised/Old</div>
                            <div class="decision-node" style="background: #4d3a0d; border-color: #d29922;">
                                <strong style="color: #d29922;">Partial Recovery</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Check for decryption tools<br>2. Restore what backups exist<br>3. Accept data loss for rest<br>4. Consider negotiation (last resort)</div>
                            </div>
                        </div>
                        <div>
                            <div class="decision-arrow">↓ No Backups</div>
                            <div class="decision-node" style="background: #4d1a1a; border-color: #f85149;">
                                <strong style="color: #f85149;">Critical Situation</strong>
                                <div style="color: #8b949e; font-size: 0.85rem;">1. Check NoMoreRansom.org<br>2. Preserve encrypted files<br>3. Engage legal/executive<br>4. Consider negotiation</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-section">
                    <h4>Recovery Procedures</h4>
                    <div class="arch-diagram"># Recovery Checklist
# ═══════════════════════════════════════════════════════════════

## Phase 4A: Verify Eradication Complete
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ No ransomware alerts in last 24 hours
□ All IOCs blocked at all layers
□ Compromised accounts disabled/reset
□ Isolated systems still isolated

## Phase 4B: Rebuild Systems
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Wipe infected systems (do NOT just delete ransomware)
2. Reinstall OS from known-good media
3. Apply all security patches
4. Install XDR agent FIRST before network connection
5. Harden configuration
6. Restore data from verified backup

## Phase 4C: Validate Recovery
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ XDR agent reporting successfully
□ System functioning normally
□ Users can access required data
□ No signs of reinfection

## Phase 4D: Return to Production
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Remove network isolation gradually
2. Monitor for 72 hours minimum
3. Maintain heightened alerting
4. Keep incident team on standby

# Free Decryption Resources
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
- NoMoreRansom.org (Europol/vendors collaboration)
- ID Ransomware (identify & find decryptors)
- BleepingComputer forums
- Emsisoft decryption tools
- Kaspersky No Ransom

# ═══════════════════════════════════════════════════════════════</div>
                </div>

                <!-- Phase 5: Post-Incident -->
                <h2><i class="fas fa-clipboard-check"></i> Phase 5: Post-Incident Activities</h2>
                
                <div class="config-section">
                    <h4>Post-Incident Checklist</h4>
                    <div class="arch-diagram"># Post-Incident Required Actions
# ═══════════════════════════════════════════════════════════════

## Reporting & Compliance
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ Notify executive leadership
□ Engage legal counsel
□ Determine regulatory notification requirements:
  - GDPR: 72 hours to supervisory authority
  - HIPAA: 60 days for breach notification
  - SEC: Material cybersecurity incidents
  - State breach notification laws
□ Notify cyber insurance carrier
□ Consider law enforcement notification (FBI IC3)

## Documentation
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ Complete incident timeline
□ All affected systems documented
□ Root cause analysis
□ Response actions taken
□ Costs incurred
□ Lessons learned

## Security Improvements
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ Close initial access vector permanently
□ Improve detection for this attack pattern
□ Update backup procedures if gaps found
□ Enhance network segmentation
□ Review and update incident response plan
□ Conduct tabletop exercise for team

## XSIAM Detection Improvements
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ Add IOCs to threat intel feeds
□ Create correlation rules for attack pattern
□ Build dashboard for ransomware indicators
□ Create automated response playbook

# ═══════════════════════════════════════════════════════════════</div>
                </div>

                <!-- XSOAR Playbook -->
                <h2><i class="fas fa-robot"></i> XSOAR Automated Response Playbook</h2>
                
                <div class="config-section">
                    <h4>Ransomware Response Playbook Structure</h4>
                    <div class="arch-diagram"># XSOAR Ransomware Response Playbook
# ═══════════════════════════════════════════════════════════════

TRIGGER: Alert with category = "Ransomware" OR 
         Alert name contains "ransomware"

## PHASE 1: TRIAGE (Automated)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
1. Extract IOCs from alert
   - File hashes
   - IP addresses
   - Domain names
   - User accounts
   
2. Enrich IOCs
   - VirusTotal lookup
   - AutoFocus query
   - Check threat intel feeds
   
3. Calculate severity
   - Confirmed ransomware = Critical
   - Suspected = High
   
4. Notify SOC (Slack/Email/PagerDuty)

## PHASE 2: CONTAINMENT (Human Approval Required)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
5. Present containment options to analyst:
   □ Isolate endpoint
   □ Block hash globally
   □ Disable user account
   
6. On approval → Execute containment
7. Log all actions taken

## PHASE 3: INVESTIGATION (Automated Collection)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
8. Query for related alerts (same hash/user/host)
9. Build timeline of events
10. Identify potential lateral movement
11. Find all affected endpoints
12. Generate investigation report

## PHASE 4: ESCALATION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
13. If > 5 endpoints affected:
    - Escalate to IR Manager
    - Page on-call leadership
    - Create war room channel
    
14. Update incident with findings

# ═══════════════════════════════════════════════════════════════</div>
                </div>

                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: You receive an alert that ransomware was detected on an endpoint. Walk me through your immediate response.</button>
                        <div class="qa-answer">
                            <p>My immediate response focuses on stopping the spread before investigating the details.</p>
                            
                            <p><strong>First 60 seconds:</strong> I validate the alert is real, not a false positive. I check the alert details - is there a confirmed malicious hash? Did XDR block execution or did it succeed? A blocked attempt is very different from active encryption.</p>
                            
                            <p><strong>Containment (next 5 minutes):</strong> If ransomware executed or is suspected active, I immediately isolate the endpoint via XSIAM. This cuts network access while maintaining agent communication. I don't wait for full investigation - containment is priority one.</p>
                            
                            <p><strong>Scope assessment (next 15 minutes):</strong> I query XSIAM to find if any other endpoints have the same malicious hash, connected to the infected host, or show similar behaviors. Ransomware spreads fast, so I'm racing to find and isolate any other infected systems.</p>
                            
                            <p><strong>Block indicators:</strong> I add the ransomware hash to XSIAM's block list to prevent execution on any other endpoint. If I have C2 IPs or domains, those get blocked at the firewall.</p>
                            
                            <p><strong>Escalation decision:</strong> If it's a single contained endpoint with XDR-blocked execution, I continue investigation. If I find multiple systems or signs of active encryption, I immediately escalate - this is now a major incident requiring all hands.</p>
                            
                            <p>Throughout this, I'm documenting every action and timestamp. In a ransomware incident, you will be asked later exactly what happened and when.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you determine the initial access vector in a ransomware incident?</button>
                        <div class="qa-answer">
                            <p>Finding initial access is critical for closing the door and preventing reinfection. I use XSIAM's telemetry to trace back from the ransomware execution to its origin.</p>
                            
                            <p><strong>Step 1: Identify patient zero</strong> - I query for the first endpoint where the ransomware hash appeared. The earliest timestamp is likely where the attack started.</p>
                            
                            <p><strong>Step 2: Build the process tree</strong> - On patient zero, I examine the full causality chain. What process spawned the ransomware? If it was spawned by Word or Outlook, that suggests phishing. If it came from a browser download or an archive extraction, that suggests drive-by or malicious download.</p>
                            
                            <p><strong>Step 3: Check email logs</strong> - I query for any email attachments or links accessed shortly before the ransomware appeared. I correlate with the email security gateway to find the specific message.</p>
                            
                            <p><strong>Step 4: Check web activity</strong> - If not email, I look at browser history and downloads. Did the user visit a compromised site? Download something from a suspicious source?</p>
                            
                            <p><strong>Step 5: Check for exploitation</strong> - Sometimes initial access is through vulnerability exploitation - an exposed RDP, a vulnerable VPN, an unpatched server. I look for unusual authentication patterns or connections from unexpected sources in the hours before ransomware deployed.</p>
                            
                            <p>Most enterprise ransomware today starts with either phishing, compromised RDP, or exploited VPN. Once I identify the vector, I ensure it's closed immediately and add detection for similar attempts.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: The ransomware encrypted critical systems and backups are compromised. What do you do?</button>
                        <div class="qa-answer">
                            <p>This is the nightmare scenario, and it requires very careful decision-making with executive involvement.</p>
                            
                            <p><strong>First: Complete containment</strong> - Even without clean backups, I ensure the attack is fully contained. We can't recover anything if ransomware is still spreading.</p>
                            
                            <p><strong>Assess what's actually lost</strong> - Not all data is equally critical. I work with business stakeholders to inventory what's encrypted, what was backed up elsewhere (cloud services, email, etc.), and what's truly unrecoverable.</p>
                            
                            <p><strong>Check for decryption options</strong> - I check NoMoreRansom.org and security vendor resources. Some ransomware families have been cracked and free decryptors exist. I also check if it's a known family with weak encryption.</p>
                            
                            <p><strong>Preserve encrypted files</strong> - Even if we can't decrypt today, a decryptor might become available later. I ensure encrypted files are preserved, not deleted.</p>
                            
                            <p><strong>Engage leadership and legal</strong> - At this point, decisions about ransom payment are above my pay grade. I provide the technical assessment: what we've lost, recovery options, and risks. The business decides whether to negotiate with attackers.</p>
                            
                            <p><strong>My recommendation:</strong> Generally, I advise against paying. Payment doesn't guarantee decryption, funds criminal operations, and may violate sanctions laws. But I recognize this is ultimately a business decision balancing many factors including business survival.</p>
                            
                            <p><strong>If they decide to pay:</strong> Use experienced ransomware negotiators, verify proof of decryption capability first, involve law enforcement (FBI often has intelligence on specific groups), and have legal review sanctions compliance.</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    
    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const overlay = document.getElementById('sidebarOverlay');
            if (window.innerWidth <= 768) { sidebar.classList.toggle('open'); overlay.classList.toggle('active'); }
            else { sidebar.classList.toggle('collapsed'); mainWrapper.classList.toggle('expanded'); }
        }
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) answer.style.display = 'block';
            });
        });
    </script>
</body>
</html>
