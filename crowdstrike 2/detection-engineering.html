<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detection Engineering | CrowdStrike</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">CrowdStrike Platform</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="fundamentals.html" class="nav-link"><i class="fas fa-book"></i> Fundamentals</a>
                    <a href="sensor-deployment.html" class="nav-link"><i class="fas fa-download"></i> Sensor Deployment</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection</div>
                    <a href="detection-engineering.html" class="nav-link active"><i class="fas fa-cog"></i> Detection Engineering</a>
                    <a href="ioa-rules.html" class="nav-link"><i class="fas fa-code"></i> IOA Rules</a>
                    <a href="detection-tuning.html" class="nav-link"><i class="fas fa-sliders-h"></i> Detection Tuning</a>
                    <a href="falcon-intelligence.html" class="nav-link"><i class="fas fa-brain"></i> Falcon Intelligence</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Investigation</div>
                    <a href="threat-hunting.html" class="nav-link"><i class="fas fa-crosshairs"></i> Threat Hunting</a>
                    <a href="incident-management.html" class="nav-link"><i class="fas fa-clipboard-list"></i> Incident Management</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Response</div>
                    <a href="response-actions.html" class="nav-link"><i class="fas fa-bolt"></i> Response Actions</a>
                    <a href="rtr.html" class="nav-link"><i class="fas fa-terminal"></i> Real Time Response</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">CrowdStrike</a><span class="separator">/</span>
                    <span class="current">Detection Engineering</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-crosshairs"></i> Detection Engineering in CrowdStrike</h1>
                <p class="lead">Build custom detections in CrowdStrike Falcon using Custom IOAs, Machine Learning exclusions, and detection policies to enhance your threat detection capabilities.</p>

                <!-- Detection Types -->
                <h2><i class="fas fa-shield-alt"></i> CrowdStrike Detection Types</h2>
                <div class="config-section">
                    <table class="styled-table">
                        <thead>
                            <tr><th>Detection Type</th><th>Description</th><th>Customizable</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Machine Learning</strong></td>
                                <td>AI-based detection of malicious files and behaviors</td>
                                <td>Exclusions only</td>
                            </tr>
                            <tr>
                                <td><strong>Sensor-Based ML</strong></td>
                                <td>On-sensor machine learning for offline detection</td>
                                <td>Sensitivity levels</td>
                            </tr>
                            <tr>
                                <td><strong>Behavioral IOAs</strong></td>
                                <td>Indicator of Attack patterns built by CrowdStrike</td>
                                <td>Exclusions only</td>
                            </tr>
                            <tr>
                                <td><strong>Custom IOAs</strong></td>
                                <td>Custom detection rules created by your team</td>
                                <td>Fully customizable</td>
                            </tr>
                            <tr>
                                <td><strong>IOC Detection</strong></td>
                                <td>Hash, IP, domain blocklists</td>
                                <td>Fully customizable</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Custom IOA Rules -->
                <h2><i class="fas fa-plus-circle"></i> Custom IOA Rules</h2>
                <div class="config-section">
                    <p>Custom Indicators of Attack (IOAs) let you create behavioral detection rules.</p>
                    <p><span class="console-path">Configuration → Custom IOA Rule Groups → Create Rule Group</span></p>

                    <h4>IOA Rule Components</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Component</th><th>Description</th><th>Options</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Rule Type</strong></td>
                                <td>Category of behavior to detect</td>
                                <td>Process, Network, File, Registry, DNS</td>
                            </tr>
                            <tr>
                                <td><strong>Action</strong></td>
                                <td>What to do when rule triggers</td>
                                <td>Detect, Block</td>
                            </tr>
                            <tr>
                                <td><strong>Severity</strong></td>
                                <td>Alert priority level</td>
                                <td>Informational, Low, Medium, High, Critical</td>
                            </tr>
                            <tr>
                                <td><strong>Conditions</strong></td>
                                <td>Matching criteria</td>
                                <td>Various field operators</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- IOA Rule Types -->
                <h2><i class="fas fa-list"></i> IOA Rule Types</h2>
                <div class="config-section">
                    <h4>Process Creation Rules</h4>
                    <div class="ioa-card">
                        <h5>Detect Suspicious PowerShell</h5>
                        <div class="code-block">Rule Type: Process Creation
Name: PowerShell Encoded Command Execution
Severity: High
Action: Detect

Conditions:
- Image File Name: powershell.exe, pwsh.exe
- Command Line CONTAINS: -enc, -EncodedCommand, -e 
- Command Line Length > 500

MITRE: T1059.001</div>
                    </div>

                    <div class="ioa-card">
                        <h5>Detect LOLBin Abuse</h5>
                        <div class="code-block">Rule Type: Process Creation
Name: Certutil Download/Decode
Severity: High
Action: Detect

Conditions:
- Image File Name: certutil.exe
- Command Line CONTAINS ANY: -urlcache, -decode, -decodehex, http, ftp

MITRE: T1218, T1140</div>
                    </div>

                    <div class="ioa-card">
                        <h5>Detect Office Spawning Shell</h5>
                        <div class="code-block">Rule Type: Process Creation
Name: Office Application Spawning Command Shell
Severity: Critical
Action: Detect

Conditions:
- Parent Image File Name: winword.exe, excel.exe, powerpnt.exe, outlook.exe
- Image File Name: cmd.exe, powershell.exe, wscript.exe, cscript.exe, mshta.exe

MITRE: T1566.001, T1059</div>
                    </div>

                    <h4>Network Connection Rules</h4>
                    <div class="ioa-card">
                        <h5>Detect Non-Browser HTTP</h5>
                        <div class="code-block">Rule Type: Network Connection
Name: Non-Browser Process Making HTTP Connection
Severity: Medium
Action: Detect

Conditions:
- Remote Port: 80, 443
- Image File Name NOT: chrome.exe, firefox.exe, msedge.exe, iexplore.exe
- Image File Name NOT: svchost.exe, Windows Defender

MITRE: T1071.001</div>
                    </div>

                    <div class="ioa-card">
                        <h5>Detect Suspicious Destination</h5>
                        <div class="code-block">Rule Type: Network Connection
Name: Connection to High-Risk Country
Severity: Medium
Action: Detect

Conditions:
- Remote Address Country: RU, CN, KP, IR (example)
- Remote Port: ANY
- Connection Type: Outbound

Note: Use threat intel to define risky destinations</div>
                    </div>

                    <h4>File Write Rules</h4>
                    <div class="ioa-card">
                        <h5>Detect Executable Drop in Temp</h5>
                        <div class="code-block">Rule Type: File Written
Name: Executable Written to Temp Directory
Severity: Medium
Action: Detect

Conditions:
- Target File Path CONTAINS: \Temp\, \AppData\Local\Temp\
- Target File Extension: .exe, .dll, .scr, .bat, .ps1

MITRE: T1105</div>
                    </div>

                    <h4>Registry Rules</h4>
                    <div class="ioa-card">
                        <h5>Detect Run Key Modification</h5>
                        <div class="code-block">Rule Type: Registry
Name: Registry Run Key Persistence
Severity: High
Action: Detect

Conditions:
- Registry Path CONTAINS: \CurrentVersion\Run
- Registry Operation: SetValue
- Image File Name NOT: legitimate_installers

MITRE: T1547.001</div>
                    </div>

                    <h4>DNS Rules</h4>
                    <div class="ioa-card">
                        <h5>Detect Long DNS Queries</h5>
                        <div class="code-block">Rule Type: DNS Request
Name: Potentially Encoded DNS Query
Severity: Medium
Action: Detect

Conditions:
- Domain Name Length > 50
- Excludes: known CDN domains

MITRE: T1071.004</div>
                    </div>
                </div>

                <!-- Rule Operators -->
                <h2><i class="fas fa-code"></i> Rule Condition Operators</h2>
                <div class="config-section">
                    <table class="styled-table">
                        <thead>
                            <tr><th>Operator</th><th>Description</th><th>Example</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>EQUALS</strong></td>
                                <td>Exact match</td>
                                <td>Image File Name EQUALS cmd.exe</td>
                            </tr>
                            <tr>
                                <td><strong>CONTAINS</strong></td>
                                <td>Substring match</td>
                                <td>Command Line CONTAINS -enc</td>
                            </tr>
                            <tr>
                                <td><strong>STARTS WITH</strong></td>
                                <td>Prefix match</td>
                                <td>File Path STARTS WITH C:\Users\</td>
                            </tr>
                            <tr>
                                <td><strong>ENDS WITH</strong></td>
                                <td>Suffix match</td>
                                <td>File Name ENDS WITH .exe</td>
                            </tr>
                            <tr>
                                <td><strong>REGEX</strong></td>
                                <td>Regular expression</td>
                                <td>Command Line REGEX .*-[eE]nc.*</td>
                            </tr>
                            <tr>
                                <td><strong>IN</strong></td>
                                <td>Match any in list</td>
                                <td>Port IN (80, 443, 8080)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Combining Conditions</h4>
                    <div class="code-block">AND Logic (all conditions must match):
- Condition 1: Image File Name EQUALS powershell.exe
  AND
- Condition 2: Command Line CONTAINS -enc
  AND
- Condition 3: Parent Image EQUALS winword.exe

OR Logic (use multiple rule variants):
Create separate rules for each OR condition,
group them in the same Rule Group</div>
                </div>

                <!-- Rule Groups -->
                <h2><i class="fas fa-folder"></i> IOA Rule Groups</h2>
                <div class="config-section">
                    <p>Rules are organized into Rule Groups that can be assigned to Host Groups.</p>
                    <p><span class="console-path">Configuration → Custom IOA Rule Groups</span></p>

                    <h4>Rule Group Best Practices</h4>
                    <ul style="color: #8b949e;">
                        <li><strong>Organize by use case:</strong> Malware, Persistence, Lateral Movement</li>
                        <li><strong>Start in Detect mode:</strong> Test before enabling Block</li>
                        <li><strong>Use descriptive names:</strong> Include MITRE technique</li>
                        <li><strong>Version control:</strong> Export and track changes</li>
                    </ul>

                    <h4>Rule Group Assignment</h4>
                    <div class="code-block">Assignment Options:

All Hosts:
└─ Rule group applies to entire environment

Specific Host Groups:
└─ Target rules to specific systems
   - Servers only
   - Workstations only
   - High-value assets

Platform-Specific:
└─ Windows, macOS, Linux rules separate</div>
                </div>

                <!-- IOC Management -->
                <h2><i class="fas fa-database"></i> IOC Management</h2>
                <div class="config-section">
                    <p><span class="console-path">Configuration → IOC Management</span></p>

                    <h4>IOC Types</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Type</th><th>Format</th><th>Action Options</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>SHA256</strong></td>
                                <td>64-character hash</td>
                                <td>Detect, Block, No Action</td>
                            </tr>
                            <tr>
                                <td><strong>MD5</strong></td>
                                <td>32-character hash</td>
                                <td>Detect, Block, No Action</td>
                            </tr>
                            <tr>
                                <td><strong>Domain</strong></td>
                                <td>malicious.com</td>
                                <td>Detect, Block</td>
                            </tr>
                            <tr>
                                <td><strong>IPv4</strong></td>
                                <td>1.2.3.4</td>
                                <td>Detect, Block</td>
                            </tr>
                            <tr>
                                <td><strong>IPv6</strong></td>
                                <td>2001:db8::1</td>
                                <td>Detect, Block</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>IOC Upload</h4>
                    <div class="code-block">CSV Format for Bulk Upload:

type,value,action,platforms,severity,description,source
sha256,abc123...,block,windows,high,Emotet dropper,TI-Feed
domain,malicious.com,detect,windows;mac;linux,medium,C2 domain,Manual
ipv4,1.2.3.4,block,windows,high,Known C2,IR-2024-001</div>

                    <h4>IOC Expiration</h4>
                    <ul style="color: #8b949e;">
                        <li>Set expiration dates for temporary IOCs</li>
                        <li>Review and clean up old IOCs regularly</li>
                        <li>Use source tagging to track IOC origin</li>
                    </ul>
                </div>

                <!-- ML Exclusions -->
                <h2><i class="fas fa-brain"></i> Machine Learning Exclusions</h2>
                <div class="config-section">
                    <p><span class="console-path">Configuration → Machine Learning Exclusions</span></p>

                    <h4>Exclusion Types</h4>
                    <div class="code-block">File Path Exclusions:
- Exclude specific directories
- Example: C:\Program Files\CustomApp\*

Hash Exclusions:
- Whitelist specific file hashes
- Use for known-good files flagged by ML

Process Path + Command Line:
- More specific exclusions
- Reduces over-exclusion risk</div>

                    <h4>Best Practices for Exclusions</h4>
                    <ul style="color: #8b949e;">
                        <li><strong>Be specific:</strong> Exclude narrow paths, not broad directories</li>
                        <li><strong>Document reason:</strong> Track why exclusion was created</li>
                        <li><strong>Review regularly:</strong> Audit exclusions quarterly</li>
                        <li><strong>Hash over path:</strong> Prefer hash exclusions when possible</li>
                    </ul>
                </div>

                <!-- Prevention Policies -->
                <h2><i class="fas fa-cog"></i> Prevention Policies</h2>
                <div class="config-section">
                    <p><span class="console-path">Configuration → Prevention Policies</span></p>

                    <h4>Policy Components</h4>
                    <div class="code-block">Prevention Policy Settings:

Cloud Machine Learning:
├─ Detection: Cautious / Moderate / Aggressive / Extra Aggressive
└─ Prevention: Cautious / Moderate / Aggressive / Extra Aggressive

Sensor Machine Learning:
├─ Detection: Disabled / Cautious / Moderate / Aggressive
└─ Prevention: Disabled / Cautious / Moderate / Aggressive

Behavioral Analysis:
├─ Detect suspicious scripts
├─ Prevent suspicious scripts
├─ Detect credential theft
├─ Prevent credential theft
└─ ... many more options

Quarantine:
├─ Enable quarantine
├─ Quarantine on write
└─ Quarantine on execute</div>

                    <h4>Policy Recommendations by Environment</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Environment</th><th>ML Detection</th><th>ML Prevention</th><th>Notes</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Servers - Production</td>
                                <td>Aggressive</td>
                                <td>Moderate</td>
                                <td>Balance security and stability</td>
                            </tr>
                            <tr>
                                <td>Workstations - Standard</td>
                                <td>Aggressive</td>
                                <td>Aggressive</td>
                                <td>Maximum protection for users</td>
                            </tr>
                            <tr>
                                <td>Development/Test</td>
                                <td>Moderate</td>
                                <td>Cautious</td>
                                <td>Allow dev tools, more FPs expected</td>
                            </tr>
                            <tr>
                                <td>High-Value Assets</td>
                                <td>Extra Aggressive</td>
                                <td>Aggressive</td>
                                <td>Maximum scrutiny</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Testing Detections -->
                <h2><i class="fas fa-vial"></i> Testing Custom Detections</h2>
                <div class="config-section">
                    <h4>Testing Workflow</h4>
                    <div class="code-block">1. Create Rule in Detect Mode
   - Don't enable Block initially
   - Assign to test host group

2. Generate Test Activity
   - Use Atomic Red Team
   - Manual simulation on test endpoint
   - Document test procedure

3. Verify Detection
   - Check for alert in console
   - Verify alert details are correct
   - Check severity and description

4. Tune if Needed
   - Adjust conditions if too broad/narrow
   - Add exclusions for false positives

5. Enable Block Mode (if appropriate)
   - Only after thorough testing
   - Start with limited host group

6. Monitor in Production
   - Watch for unexpected false positives
   - Track detection rate</div>

                    <h4>Atomic Red Team Tests</h4>
                    <div class="code-block">Example tests for common IOA rules:

# T1059.001 - PowerShell Encoded Command
powershell -enc [base64_string]

# T1218.011 - Rundll32
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication"

# T1547.001 - Registry Run Keys
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v Test /d "cmd.exe"

# T1003.001 - LSASS Access (careful - may trigger prevention)
procdump -ma lsass.exe lsass.dmp</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you create a custom detection in CrowdStrike?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Identify the behavior:</strong> What attack technique to detect?</li>
                                <li><strong>Choose rule type:</strong> Process, Network, File, Registry, DNS</li>
                                <li><strong>Define conditions:</strong> Use operators to match behavior</li>
                                <li><strong>Set severity and action:</strong> Detection level and response</li>
                                <li><strong>Test in Detect mode:</strong> Verify on test systems</li>
                                <li><strong>Deploy to production:</strong> Assign to host groups</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between IOAs and IOCs?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>IOCs (Indicators of Compromise):</strong> Static indicators like hashes, IPs, domains. Known-bad artifacts from previous attacks.</li>
                                <li><strong>IOAs (Indicators of Attack):</strong> Behavioral patterns like process chains, command lines, actions. Detect techniques regardless of specific malware.</li>
                            </ul>
                            <p style="margin-top: 12px;"><strong>Key difference:</strong> IOCs detect known threats; IOAs detect behaviors and can catch new/unknown threats using the same techniques.</p>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you handle false positives in CrowdStrike?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Investigate thoroughly:</strong> Confirm it's truly benign</li>
                                <li><strong>Create targeted exclusion:</strong> Specific path/hash, not broad</li>
                                <li><strong>Document the exclusion:</strong> Record reason and ticket</li>
                                <li><strong>For custom rules:</strong> Tune conditions to be more specific</li>
                                <li><strong>Review periodically:</strong> Audit exclusions regularly</li>
                            </ol>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>