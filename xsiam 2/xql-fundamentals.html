<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XQL Fundamentals | Cortex XSIAM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body>
    <div class="app-container">
        <main class="main-content">
            <a href="../index.html" class="back-home"><i class="fas fa-arrow-left"></i> Nik's SIEM</a>
            
            <div class="breadcrumb">
                <a href="../index.html">Home</a>
                <span class="separator">/</span>
                <a href="index.html">XSIAM</a>
                <span class="separator">/</span>
                <span class="current">XQL Fundamentals</span>
            </div>

<h1><i class="fas fa-terminal"></i> XQL Fundamentals</h1>
                <p class="lead">Master the fundamentals of XQL (XSIAM Query Language). Learn query structure, operators, functions, and build your first hunting queries step by step.</p>

                <!-- XQL Overview -->
                <h2><i class="fas fa-info-circle"></i> XQL Overview</h2>
                <div class="config-section">
                    <h4>What is XQL?</h4>
                    <div class="code-block">XQL (XSIAM Query Language):

PURPOSE:
├── Query data across all XSIAM datasets
├── Threat hunting and investigation
├── Create custom alerts and dashboards
├── Data exploration and analysis
└── Automation and reporting

XQL vs OTHER QUERY LANGUAGES:
┌────────────────────────────────────────────────────────────┐
│  XQL          │  KQL (Microsoft)  │  SPL (Splunk)         │
├───────────────┼───────────────────┼───────────────────────┤
│  dataset =    │  TableName        │  index=               │
│  | filter     │  | where          │  | search / where     │
│  | fields     │  | project        │  | fields / table     │
│  | comp       │  | summarize      │  | stats              │
│  | sort       │  | order by       │  | sort               │
│  | limit      │  | take           │  | head               │
└───────────────┴───────────────────┴───────────────────────┘

QUERY INTERFACE:
Path: Investigation → Query Center
├── Query Editor
├── Dataset Browser
├── Saved Queries
├── Query History
└── Results Visualization</div>

                    <h4>Basic Query Structure</h4>
                    <div class="code-block">XQL QUERY ANATOMY:

┌─────────────────────────────────────────────────────────────┐
│                    XQL QUERY STRUCTURE                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  dataset = xdr_data                    ← DATA SOURCE        │
│  | filter event_type = ENUM.PROCESS    ← FILTERING          │
│  | filter action_process_image_name    ← FILTERING          │
│        contains "powershell"                                │
│  | fields timestamp, agent_hostname,   ← SELECT FIELDS      │
│          action_process_image_name,                         │
│          action_process_command_line                        │
│  | sort desc timestamp                 ← ORDERING           │
│  | limit 100                           ← ROW LIMIT          │
│                                                             │
└─────────────────────────────────────────────────────────────┘

KEY COMPONENTS:
├── dataset: Specifies data source (required)
├── filter: Conditions to match (like WHERE)
├── fields: Columns to return (like SELECT)
├── comp: Aggregations (like GROUP BY)
├── sort: Order results
├── limit: Restrict row count
└── Pipe (|): Chains operations together

EXECUTION ORDER:
1. dataset → Select data source
2. filter → Apply conditions (can be multiple)
3. fields → Select output columns
4. comp → Perform aggregations
5. sort → Order results
6. limit → Restrict output</div>
                </div>

                <!-- Datasets -->
                <h2><i class="fas fa-database"></i> Datasets</h2>
                <div class="config-section">
                    <h4>Core Datasets</h4>
                    <div class="code-block">XSIAM DATASETS:

ENDPOINT DATA:
├── xdr_data: Primary endpoint telemetry
│   ├── Process events
│   ├── Network connections
│   ├── File events
│   ├── Registry events
│   └── Module loads
├── endpoints: Endpoint inventory
└── endpoint_groups: Group membership

ALERT AND INCIDENT DATA:
├── alerts: All alerts
├── incidents: Correlated incidents
└── alert_raw_data: Raw alert details

NETWORK AND CLOUD:
├── cloud_audit_logs: Cloud provider logs
├── network_logs: Firewall/network data
└── identity_logs: Authentication events

THIRD-PARTY:
├── panw_ngfw_traffic: Palo Alto firewall
├── panw_ngfw_threat: Firewall threats
└── [custom datasets]: Your ingested data

EXPLORING DATASETS:
// List available fields in dataset
dataset = xdr_data
| fields *
| limit 1

// Check data freshness
dataset = xdr_data
| comp latest_timestamp = max(timestamp)

// Count records per event type
dataset = xdr_data
| comp count() by event_type</div>

                    <h4>Common Fields in xdr_data</h4>
                    <div class="code-block">XDR_DATA KEY FIELDS:

EVENT IDENTIFICATION:
├── event_id: Unique event identifier
├── event_type: Type (PROCESS, FILE, NETWORK, etc.)
├── event_sub_type: Sub-category
└── timestamp: Event time (Unix epoch)

ENDPOINT INFORMATION:
├── agent_hostname: Device name
├── agent_ip_addresses: Device IP(s)
├── agent_os_type: Windows/Linux/macOS
├── agent_os_sub_type: Version details
└── agent_id: Unique agent identifier

PROCESS FIELDS:
├── action_process_image_name: Process filename
├── action_process_image_path: Full path
├── action_process_command_line: Command line
├── action_process_image_sha256: File hash
├── action_process_signature_status: Signed/Unsigned
├── actor_process_image_name: Parent process
├── actor_process_command_line: Parent command line
└── causality_actor_process_image_name: Root process

NETWORK FIELDS:
├── action_remote_ip: Destination IP
├── action_remote_port: Destination port
├── action_local_ip: Source IP
├── action_local_port: Source port
└── action_external_hostname: DNS name

FILE FIELDS:
├── action_file_name: Filename
├── action_file_path: Full path
├── action_file_sha256: File hash
└── action_file_size: Size in bytes

USER FIELDS:
├── actor_effective_username: User executing
├── actor_primary_username: Primary user
└── auth_domain: Domain name</div>
                </div>

                <!-- Filter Operations -->
                <h2><i class="fas fa-filter"></i> Filter Operations</h2>
                <div class="config-section">
                    <h4>Comparison Operators</h4>
                    <div class="code-block">COMPARISON OPERATORS:

EQUALITY:
= or ~=        Equal (case-insensitive with ~=)
!= or ~!=      Not equal

// Example
| filter action_process_image_name = "powershell.exe"
| filter actor_effective_username ~= "admin"  // case-insensitive

NUMERIC COMPARISONS:
< > <= >=      Less/greater than

// Example
| filter action_file_size > 1000000  // Files > 1MB
| filter action_remote_port < 1024   // Privileged ports

STRING MATCHING:
contains       Contains substring (case-sensitive)
~contains      Contains (case-insensitive)
!contains      Does not contain

// Example
| filter action_process_command_line ~contains "download"
| filter action_file_path contains "\\Temp\\"

PATTERN MATCHING:
~= "pattern"   Regex match

// Example
| filter action_process_image_name ~= "^cmd\.exe$"
| filter action_remote_ip ~= "^10\\..*"

NULL CHECKS:
= null         Is null/empty
!= null        Is not null

// Example
| filter action_process_command_line != null</div>

                    <h4>Logical Operators</h4>
                    <div class="code-block">LOGICAL OPERATORS:

AND (implicit when chaining filters):
| filter event_type = ENUM.PROCESS
| filter action_process_image_name = "powershell.exe"
// Both conditions must be true

OR (explicit):
| filter action_process_image_name = "powershell.exe" 
    or action_process_image_name = "cmd.exe"

// Alternative with in()
| filter action_process_image_name in ("powershell.exe", "cmd.exe")

NOT:
| filter action_process_image_name not in ("explorer.exe", "svchost.exe")

COMBINED EXAMPLE:
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| filter (action_process_image_name = "powershell.exe" 
    or action_process_image_name = "cmd.exe")
| filter action_process_command_line ~contains "download"
| filter actor_effective_username not in ("SYSTEM", "LOCAL SERVICE")

ENUM VALUES:
// Use ENUM for typed values
| filter event_type = ENUM.PROCESS
| filter event_type = ENUM.NETWORK
| filter event_type = ENUM.FILE
| filter event_type = ENUM.REGISTRY</div>
                </div>

                <!-- Aggregations -->
                <h2><i class="fas fa-chart-bar"></i> Aggregations with comp</h2>
                <div class="config-section">
                    <h4>Basic Aggregations</h4>
                    <div class="code-block">AGGREGATION FUNCTIONS:

COUNT:
count()        Count all rows
count(field)   Count non-null values

// Example
| comp count() by action_process_image_name
| comp total = count(), unique_hosts = count_distinct(agent_hostname)

DISTINCT COUNT:
count_distinct(field)   Unique values

// Example
| comp unique_ips = count_distinct(action_remote_ip)

NUMERIC AGGREGATIONS:
sum(field)     Sum values
avg(field)     Average
min(field)     Minimum
max(field)     Maximum

// Example
| comp total_bytes = sum(action_file_size),
       avg_bytes = avg(action_file_size)

STRING AGGREGATIONS:
values(field)       Collect unique values (array)
first(field)        First value
last(field)         Last value

// Example
| comp hostnames = values(agent_hostname),
       first_seen = min(timestamp),
       last_seen = max(timestamp)
  by action_remote_ip</div>

                    <h4>Grouping with comp</h4>
                    <div class="code-block">GROUPING EXAMPLES:

// Count by single field
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| comp count() by action_process_image_name
| sort desc count()
| limit 20

// Count by multiple fields
dataset = xdr_data
| filter event_type = ENUM.NETWORK
| comp count() by agent_hostname, action_remote_ip, action_remote_port
| sort desc count()

// Time-based grouping
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| comp count() by bin(timestamp, 1h)
| sort asc _bin_timestamp

// Complex aggregation
dataset = xdr_data
| filter event_type = ENUM.NETWORK
| filter action_remote_port = 443
| comp 
    connection_count = count(),
    unique_hosts = count_distinct(agent_hostname),
    first_seen = min(timestamp),
    last_seen = max(timestamp)
  by action_remote_ip
| filter connection_count > 100
| sort desc connection_count</div>
                </div>

                <!-- Common Query Patterns -->
                <h2><i class="fas fa-code"></i> Common Query Patterns</h2>
                <div class="config-section">
                    <h4>Process Hunting</h4>
                    <div class="code-block">// Find PowerShell execution
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| filter action_process_image_name ~contains "powershell"
| fields timestamp, agent_hostname, actor_effective_username,
        action_process_image_name, action_process_command_line
| sort desc timestamp
| limit 100

// Encoded command detection
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| filter action_process_image_name ~contains "powershell"
| filter action_process_command_line ~contains "-enc"
| fields timestamp, agent_hostname, action_process_command_line
| sort desc timestamp

// Process execution from temp folders
dataset = xdr_data
| filter event_type = ENUM.PROCESS
| filter action_process_image_path ~contains "\\Temp\\"
    or action_process_image_path ~contains "\\tmp\\"
| comp count() by action_process_image_name, action_process_image_path
| sort desc count()</div>

                    <h4>Network Hunting</h4>
                    <div class="code-block">// External connections
dataset = xdr_data
| filter event_type = ENUM.NETWORK
| filter action_remote_ip != null
| filter action_remote_ip not ~= "^(10\\.|172\\.(1[6-9]|2[0-9]|3[01])\\.|192\\.168\\.)"
| comp count() by agent_hostname, action_remote_ip, action_remote_port
| sort desc count()
| limit 100

// Connections on non-standard ports
dataset = xdr_data
| filter event_type = ENUM.NETWORK
| filter action_remote_port not in (80, 443, 53, 22, 25, 587, 993)
| comp count() by action_remote_ip, action_remote_port
| sort desc count()

// Process making network connections
dataset = xdr_data
| filter event_type = ENUM.NETWORK
| filter action_process_image_name = "powershell.exe"
| comp unique_destinations = count_distinct(action_remote_ip),
       total_connections = count()
  by agent_hostname
| filter unique_destinations > 5</div>

                    <h4>File Activity</h4>
                    <div class="code-block">// Files created in suspicious locations
dataset = xdr_data
| filter event_type = ENUM.FILE
| filter event_sub_type = ENUM.FILE_CREATE_NEW
| filter action_file_path ~contains "\\Users\\Public\\"
    or action_file_path ~contains "\\Temp\\"
| fields timestamp, agent_hostname, action_file_name, action_file_path
| sort desc timestamp

// Executable file creation
dataset = xdr_data
| filter event_type = ENUM.FILE
| filter event_sub_type = ENUM.FILE_CREATE_NEW
| filter action_file_name ~= "\\.(exe|dll|bat|ps1|vbs|js)$"
| comp count() by agent_hostname, action_file_path
| sort desc count()</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What is the basic structure of an XQL query?</button>
                        <div class="qa-answer">
                            <div class="code-block">dataset = xdr_data           // Data source
| filter event_type = ENUM.X   // Conditions
| fields field1, field2        // Select columns
| comp count() by field1       // Aggregations
| sort desc count()            // Ordering
| limit 100                    // Row limit</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you filter for PowerShell with encoded commands?</button>
                        <div class="qa-answer">
                            <div class="code-block">dataset = xdr_data
| filter event_type = ENUM.PROCESS
| filter action_process_image_name ~contains "powershell"
| filter action_process_command_line ~contains "-enc"
| fields timestamp, agent_hostname, action_process_command_line</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: What are the key datasets in XSIAM?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>xdr_data:</strong> Primary endpoint telemetry (process, network, file)</li>
                                <li><strong>alerts:</strong> All security alerts</li>
                                <li><strong>incidents:</strong> Correlated incidents</li>
                                <li><strong>endpoints:</strong> Endpoint inventory</li>
                                <li><strong>cloud_audit_logs:</strong> Cloud provider logs</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb"></i> Q: How do you aggregate data in XQL?</button>
                        <div class="qa-answer">
                            <div class="code-block">// Use comp with aggregation functions
| comp count() by field_name
| comp sum(bytes), avg(bytes) by hostname
| comp unique_values = count_distinct(ip) by user</div>
                            <p>Functions: count(), count_distinct(), sum(), avg(), min(), max(), values()</p>
                        </div>
                    </div>
                </div>

        </main>
    </div>
    <script>
        // Q&A toggle functionality
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                if (!isOpen) { answer.style.display = 'block'; }
            });
        });
    </script>
</body>
</html>