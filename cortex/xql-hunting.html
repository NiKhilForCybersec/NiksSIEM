<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XQL Threat Hunting | Cortex XDR</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
    <style>
        .config-section { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin: 16px 0; }
        .code-block { background: #0d1117; border: 1px solid #30363d; border-radius: 8px; padding: 16px; margin: 12px 0; font-family: 'Fira Code', monospace; font-size: 0.85rem; overflow-x: auto; white-space: pre; }
        .console-path { background: #0d1117; padding: 8px 12px; border-radius: 4px; font-family: monospace; font-size: 0.85rem; color: #f97316; margin: 8px 0; display: inline-block; }
        .mitre-tag { background: #1f6feb; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; color: white; margin-right: 4px; }
        .hunt-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 20px; margin: 16px 0; border-left: 4px solid #f97316; }
    </style>
</head>
<body>
    <div class="app-container">
                                                                                <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="sidebar-brand">
                    <div class="brand-icon"><i class="fas fa-shield-halved"></i></div>
                    <div class="brand-text">
                        <span class="brand-title">Nik's SIEM</span>
                        <span class="brand-subtitle">Security Operations</span>
                    </div>
                </a>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Cortex XDR</div>
                    <a href="index.html" class="nav-link"><i class="fas fa-home"></i> Overview</a>
                    <a href="agent-deployment.html" class="nav-link"><i class="fas fa-download"></i> Agent Deployment</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Detection</div>
                    <a href="bioc-rules.html" class="nav-link"><i class="fas fa-project-diagram"></i> BIOC Rules</a>
                    <a href="analytics.html" class="nav-link"><i class="fas fa-brain"></i> Analytics (ML)</a>
                    <a href="causality.html" class="nav-link"><i class="fas fa-sitemap"></i> Causality Analysis</a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Hunting & Response</div>
                    <a href="xql-hunting.html" class="nav-link active"><i class="fas fa-search"></i> XQL Hunting</a>
                    <a href="xql-reference.html" class="nav-link"><i class="fas fa-book"></i> XQL Reference</a>
                    <a href="response-actions.html" class="nav-link"><i class="fas fa-hand-paper"></i> Response Actions</a>
                </div>
            </nav>
        </aside>
        <div class="main-wrapper">
            <header class="top-bar">
                <div class="breadcrumb">
                    <a href="../index.html">Home</a><span class="separator">/</span>
                    <a href="index.html">Cortex XDR</a><span class="separator">/</span>
                    <span class="current">XQL Threat Hunting</span>
                </div>
            </header>
            <main class="main-content">
                <h1><i class="fas fa-crosshairs"></i> XQL Threat Hunting</h1>
                <p class="lead">Use XQL (Extended Query Language) to hunt for threats across Cortex XDR endpoint telemetry. Access process, network, file, and registry events for proactive threat detection.</p>

                <!-- Accessing Query Center -->
                <h2><i class="fas fa-terminal"></i> Accessing Query Center</h2>
                <div class="config-section">
                    <p><span class="console-path">Cortex XDR → Investigation → Query Center</span></p>
                    
                    <h4>Key Datasets</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Dataset</th><th>Description</th><th>Key Fields</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>xdr_data</td>
                                <td>All XDR endpoint events</td>
                                <td>event_type, host_name, user_name, _time</td>
                            </tr>
                            <tr>
                                <td>endpoints</td>
                                <td>Endpoint inventory</td>
                                <td>endpoint_name, os_type, agent_version</td>
                            </tr>
                            <tr>
                                <td>xdr_alerts</td>
                                <td>XDR alerts</td>
                                <td>alert_name, severity, host_name</td>
                            </tr>
                            <tr>
                                <td>xdr_incidents</td>
                                <td>XDR incidents</td>
                                <td>incident_id, status, severity</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Event Types in xdr_data</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>event_type</th><th>Description</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>process_execution</td><td>Process creation events</td></tr>
                            <tr><td>network_connection</td><td>Network connections</td></tr>
                            <tr><td>file_event</td><td>File creation/modification/deletion</td></tr>
                            <tr><td>registry_event</td><td>Registry operations</td></tr>
                            <tr><td>dns_query</td><td>DNS lookups</td></tr>
                            <tr><td>module_load</td><td>DLL/module loading</td></tr>
                            <tr><td>authentication</td><td>Logon events</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- XQL Syntax Basics -->
                <h2><i class="fas fa-code"></i> XQL Syntax Basics</h2>
                <div class="config-section">
                    <h4>Basic Query Structure</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name = "powershell.exe"
| fields _time, host_name, user_name, process_command_line
| sort desc _time
| limit 100</div>

                    <h4>Filter Operators</h4>
                    <div class="code-block">// Exact match
| filter process_name = "cmd.exe"

// Not equal
| filter process_name != "explorer.exe"

// Contains (case-insensitive)
| filter process_command_line contains "-enc"

// Regex match
| filter process_command_line ~= "(?i)-enc"

// In list
| filter process_name in ("cmd.exe", "powershell.exe", "wscript.exe")

// Not in list
| filter process_name not in ("explorer.exe", "svchost.exe")

// Null check
| filter user_name != null

// Wildcard
| filter process_name = "power*"</div>

                    <h4>Aggregation</h4>
                    <div class="code-block">// Count
| comp count() as event_count by host_name

// Multiple aggregations
| comp 
    count() as total,
    count_distinct(host_name) as unique_hosts,
    min(_time) as first_seen,
    max(_time) as last_seen
    by process_name

// With time window
| comp count() by host_name over 1h</div>

                    <h4>Time Filtering</h4>
                    <div class="code-block">// Last 24 hours
| filter _time > ago("24h")

// Last 7 days
| filter _time > ago("7d")

// Specific range
| filter _time between "2024-01-15T00:00:00Z" and "2024-01-16T00:00:00Z"

// Using preset (in Query Center UI)</div>
                </div>

                <!-- Execution Hunting -->
                <h2><i class="fas fa-play"></i> Execution Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1059.001</span> PowerShell Encoded Commands</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("powershell.exe", "pwsh.exe")
| filter process_command_line ~= "(?i)-e(nc|ncodedcommand)"
| fields _time, host_name, user_name, process_command_line, parent_process_name
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1059.001</span> PowerShell Download Activity</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("powershell.exe", "pwsh.exe")
| filter process_command_line ~= "(?i)(downloadstring|downloadfile|invoke-webrequest|net\.webclient|start-bitstransfer|iwr |wget |curl )"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1218</span> LOLBin Execution with Network Activity</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("certutil.exe", "mshta.exe", "regsvr32.exe", "rundll32.exe", "msiexec.exe", "cmstp.exe", "wmic.exe")
| filter process_command_line ~= "(?i)(http|https|ftp|\\\\\\\\)"
| fields _time, host_name, user_name, process_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1059</span> Office Application Spawning Shell</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter parent_process_name in ("WINWORD.EXE", "EXCEL.EXE", "POWERPNT.EXE", "OUTLOOK.EXE")
| filter process_name in ("cmd.exe", "powershell.exe", "wscript.exe", "cscript.exe", "mshta.exe")
| fields _time, host_name, user_name, parent_process_name, process_name, process_command_line
| sort desc _time</div>
                </div>

                <!-- Persistence Hunting -->
                <h2><i class="fas fa-anchor"></i> Persistence Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1547.001</span> Registry Run Key Modification</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "registry_event"
| filter registry_key ~= "(?i)\\\\CurrentVersion\\\\Run"
| filter registry_value_data ~= "(?i)\\.(exe|dll|bat|ps1|vbs|cmd)"
| fields _time, host_name, user_name, registry_key, registry_value_name, registry_value_data
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1053.005</span> Scheduled Task Creation</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name = "schtasks.exe"
| filter process_command_line contains "/create"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1543.003</span> Service Creation</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name = "sc.exe"
| filter process_command_line contains "create"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <!-- Credential Access Hunting -->
                <h2><i class="fas fa-key"></i> Credential Access Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1003.001</span> LSASS Access Indicators</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_command_line ~= "(?i)(mimikatz|sekurlsa|lsass|procdump.*lsass|minidump)"
| fields _time, host_name, user_name, process_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1003.002</span> SAM/SYSTEM File Access</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_command_line ~= "(?i)(\\\\SAM|\\\\SYSTEM|\\\\SECURITY|reg.*save.*sam|reg.*save.*system)"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1003.003</span> NTDS.dit Access</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_command_line ~= "(?i)(ntds\\.dit|ntdsutil|vssadmin.*shadow)"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <!-- Lateral Movement Hunting -->
                <h2><i class="fas fa-arrows-alt"></i> Lateral Movement Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1021.002</span> SMB Connection Spread</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_port = 445
| filter dst_ip_is_private = true
| comp count_distinct(dst_ip) as unique_targets by host_name, user_name over 30m
| filter unique_targets >= 5
| sort desc unique_targets</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1021.001</span> RDP Connections</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_port = 3389
| fields _time, host_name, user_name, dst_ip, process_name
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1047</span> WMI Remote Execution</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name = "wmic.exe"
| filter process_command_line contains "/node:"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1570</span> PsExec Usage</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("psexec.exe", "psexec64.exe", "PSEXESVC.exe")
| fields _time, host_name, user_name, process_name, process_command_line
| sort desc _time</div>
                </div>

                <!-- Defense Evasion Hunting -->
                <h2><i class="fas fa-eye-slash"></i> Defense Evasion Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1070.001</span> Event Log Clearing</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter (process_name = "wevtutil.exe" and process_command_line ~= "(?i)(cl|clear)")
    or (process_name in ("powershell.exe", "pwsh.exe") and process_command_line contains "Clear-EventLog")
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1562.001</span> Security Tool Tampering</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_command_line ~= "(?i)(set-mppreference.*disable|sc.*stop.*windefend|net.*stop.*windefend|disable.*realtimemonitoring)"
| fields _time, host_name, user_name, process_command_line
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1036</span> Process Masquerading</h3>
                    <div class="code-block">// System binaries running from wrong paths
dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("cmd.exe", "powershell.exe", "svchost.exe", "lsass.exe", "csrss.exe")
| filter process_path not contains "C:\\Windows"
| fields _time, host_name, process_name, process_path, process_command_line
| sort desc _time</div>
                </div>

                <!-- Network Hunting -->
                <h2><i class="fas fa-network-wired"></i> Network Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1071</span> Connections to Rare Destinations</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_ip_is_private = false
| comp 
    count() as connection_count,
    count_distinct(host_name) as unique_hosts
    by dst_ip
| filter connection_count < 5 and unique_hosts < 3
| sort asc connection_count</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1571</span> Non-Standard Ports</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_ip_is_private = false
| filter dst_port not in (80, 443, 8080, 8443, 53, 21, 22, 25, 110, 143)
| filter dst_port < 49152
| comp count() by dst_ip, dst_port, process_name
| filter count() > 10
| sort desc count()</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1048</span> Large Outbound Transfers</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_ip_is_private = false
| comp sum(bytes_sent) as total_bytes by host_name, dst_ip, process_name over 1h
| filter total_bytes > 104857600  // > 100 MB
| alter MB_sent = round(total_bytes / 1048576, 2)
| sort desc MB_sent</div>
                </div>

                <!-- DNS Hunting -->
                <h2><i class="fas fa-globe"></i> DNS Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1071.004</span> Suspicious DNS Queries</h3>
                    <div class="code-block">// High-entropy domain names (potential DGA)
dataset = xdr_data
| filter event_type = "dns_query"
| filter dns_query_name ~= "^[a-z0-9]{15,}\\."
| fields _time, host_name, dns_query_name, process_name
| sort desc _time

// Queries to suspicious TLDs
dataset = xdr_data
| filter event_type = "dns_query"
| filter dns_query_name ~= "\\.(tk|ml|ga|cf|gq|top|xyz|pw)$"
| fields _time, host_name, dns_query_name, process_name
| sort desc _time</div>
                </div>

                <!-- Investigation Workflow -->
                <h2><i class="fas fa-search-plus"></i> Investigation Workflow</h2>
                <div class="config-section">
                    <h4>Full Host Timeline</h4>
                    <div class="code-block">dataset = xdr_data
| filter host_name = "SUSPECT-HOST"
| filter _time > ago("24h")
| fields _time, event_type, process_name, process_command_line, dst_ip, dst_port, file_path
| sort asc _time</div>

                    <h4>Process Tree Investigation</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter host_name = "SUSPECT-HOST"
| filter _time > ago("24h")
| fields _time, process_name, process_command_line, parent_process_name, user_name, process_pid
| sort asc _time</div>

                    <h4>Network Activity for Specific Process</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter host_name = "SUSPECT-HOST"
| filter process_name = "suspicious.exe"
| fields _time, dst_ip, dst_port, bytes_sent, bytes_received
| sort asc _time</div>
                </div>

                <!-- Interview Questions -->
                <h2><i class="fas fa-comments"></i> Interview Questions</h2>
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How does XQL compare to SPL and KQL?</button>
                        <div class="qa-answer">
                            <table class="styled-table">
                                <thead>
                                    <tr><th>Aspect</th><th>XQL (Cortex)</th><th>SPL (Splunk)</th><th>KQL (Microsoft)</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>Pipe character</td><td>|</td><td>|</td><td>|</td></tr>
                                    <tr><td>Filter keyword</td><td>filter</td><td>where/search</td><td>where</td></tr>
                                    <tr><td>Aggregation</td><td>comp</td><td>stats</td><td>summarize</td></tr>
                                    <tr><td>Regex match</td><td>~=</td><td>match()</td><td>matches regex</td></tr>
                                    <tr><td>Select fields</td><td>fields</td><td>table/fields</td><td>project</td></tr>
                                    <tr><td>Data source</td><td>dataset =</td><td>index=</td><td>TableName</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you hunt for lateral movement in Cortex XDR?</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Network connections:</strong> Look for connections on SMB (445), RDP (3389), WinRM (5985/5986)</li>
                                <li><strong>Remote execution:</strong> Search for PsExec, WMI /node:, PowerShell remoting</li>
                                <li><strong>Authentication:</strong> Check authentication events from multiple sources</li>
                                <li><strong>Process patterns:</strong> wmiprvse.exe or services.exe spawning processes remotely</li>
                            </ol>
                            <div class="code-block">// Quick lateral movement hunt
dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_port in (445, 3389, 5985)
| comp count_distinct(dst_ip) as targets by host_name
| filter targets > 5</div>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between xdr_data and xdr_alerts?</button>
                        <div class="qa-answer">
                            <ul>
                                <li><strong>xdr_data:</strong> Raw endpoint telemetry (process, network, file, registry events). This is the data you hunt in.</li>
                                <li><strong>xdr_alerts:</strong> Alerts generated by XDR detection engine (BIOC rules, Analytics BIOC, etc.). These are already-detected suspicious activities.</li>
                            </ul>
                            <p>For hunting, primarily use <code>xdr_data</code>. Use <code>xdr_alerts</code> for alert investigation and metrics.</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>

                <!-- File-Based Hunting -->
                <h2><i class="fas fa-file"></i> File-Based Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1105</span> Suspicious File Drops</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "file_event"
| filter file_action = "create"
| filter file_path ~= "(?i)(\\\\temp\\\\|\\\\appdata\\\\|\\\\programdata\\\\|\\\\users\\\\public)"
| filter file_name ~= "(?i)\\.(exe|dll|ps1|bat|vbs|js|hta)$"
| fields _time, host_name, file_path, file_name, file_sha256, process_name
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1027</span> Double Extension Files</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "file_event"
| filter file_action = "create"
| filter file_name ~= "\\.\\w{2,4}\\.(exe|dll|scr|bat|cmd|ps1|vbs|js)$"
| fields _time, host_name, file_path, file_name, process_name
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1486</span> Mass File Modifications (Ransomware)</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "file_event"
| filter file_action in ("modify", "rename")
| comp 
    count() as modified_count,
    count_distinct(file_name) as unique_files
    by host_name, process_name
    over 5m
| filter modified_count > 100
| sort desc modified_count</div>
                </div>

                <!-- Module/DLL Hunting -->
                <h2><i class="fas fa-puzzle-piece"></i> Module/DLL Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1574.001</span> DLL Search Order Hijacking</h3>
                    <div class="code-block">// Known hijackable DLLs from unusual locations
dataset = xdr_data
| filter event_type = "module_load"
| filter module_name in ("version.dll", "cryptsp.dll", "cryptbase.dll", "wldp.dll", "dwmapi.dll")
| filter module_path not contains "C:\\Windows\\System32"
| filter module_path not contains "C:\\Windows\\SysWOW64"
| fields _time, host_name, module_name, module_path, process_name, module_sha256
| sort desc _time</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1055</span> Unsigned DLLs in System Processes</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "module_load"
| filter process_name in ("svchost.exe", "services.exe", "lsass.exe")
| filter module_is_signed = false
| fields _time, host_name, process_name, module_name, module_path, module_sha256
| sort desc _time</div>
                </div>

                <!-- Authentication Hunting -->
                <h2><i class="fas fa-user-shield"></i> Authentication Hunting</h2>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1110</span> Brute Force Detection</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "authentication"
| filter auth_result = "failure"
| comp 
    count() as failed_attempts,
    count_distinct(target_user) as unique_users
    by src_ip, host_name
    over 10m
| filter failed_attempts > 10 or unique_users > 5
| sort desc failed_attempts</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1078</span> Successful Login After Failures</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "authentication"
| comp 
    countif(auth_result = "failure") as failures,
    countif(auth_result = "success") as successes
    by src_ip, target_user
    over 30m
| filter failures > 5 and successes > 0
| sort desc failures</div>
                </div>

                <div class="hunt-card">
                    <h3><span class="mitre-tag">T1078</span> Off-Hours Authentication</h3>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "authentication"
| filter auth_result = "success"
| alter hour = timestamp_extract(_time, "HOUR")
| alter day = timestamp_extract(_time, "DAYOFWEEK")
| filter hour < 6 or hour > 22 or day in (0, 6)  // Outside 6AM-10PM or weekends
| fields _time, host_name, target_user, src_ip, auth_type
| sort desc _time</div>
                </div>

                <!-- Advanced XQL Techniques -->
                <h2><i class="fas fa-magic"></i> Advanced XQL Techniques</h2>
                <div class="config-section">
                    <h4>Using alter for Calculated Fields</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| alter 
    mb_sent = round(bytes_sent / 1048576, 2),
    mb_received = round(bytes_received / 1048576, 2),
    is_internal = if(dst_ip_is_private = true, "Internal", "External")
| fields _time, host_name, dst_ip, is_internal, mb_sent, mb_received</div>

                    <h4>Using arrayconcat for Collecting Values</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| comp 
    arrayconcat(process_command_line) as all_commands,
    count() as execution_count
    by host_name, user_name
    over 1h
| filter execution_count > 10</div>

                    <h4>Using join for Correlation</h4>
                    <div class="code-block">// Join process events with network events
dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name = "powershell.exe"
| join type=inner (
    dataset = xdr_data
    | filter event_type = "network_connection"
    | filter dst_ip_is_private = false
) as network on host_name = network.host_name and process_pid = network.process_pid
| fields _time, host_name, process_command_line, network.dst_ip, network.dst_port</div>

                    <h4>Using union for Multiple Datasets</h4>
                    <div class="code-block">// Combine alerts and raw events
dataset = xdr_alerts
| filter severity in ("high", "critical")
| fields _time, alert_name, host_name, severity
| union (
    dataset = xdr_data
    | filter event_type = "process_execution"
    | filter process_name = "mimikatz.exe"
    | fields _time, host_name
    | alter alert_name = "Custom: Mimikatz Detected", severity = "critical"
)
| sort desc _time</div>
                </div>

                <!-- BIOC Rule Development -->
                <h2><i class="fas fa-shield-alt"></i> From Hunt to BIOC Rule</h2>
                <div class="config-section">
                    <p>Convert successful hunts into BIOC (Behavioral Indicator of Compromise) rules:</p>
                    
                    <h4>Hunt Query</h4>
                    <div class="code-block">dataset = xdr_data
| filter event_type = "process_execution"
| filter process_name in ("powershell.exe", "pwsh.exe")
| filter process_command_line ~= "(?i)-e(nc|ncodedcommand)"
| filter parent_process_name not in ("explorer.exe", "sccm.exe")</div>

                    <h4>Equivalent BIOC Rule (YAML)</h4>
                    <div class="code-block">name: PowerShell Encoded Command - Suspicious Parent
description: Detects PowerShell with encoded command from suspicious parent
os: windows
rule_type: process
severity: high
mitre:
  - T1059.001

process:
  name:
    - powershell.exe
    - pwsh.exe
  command_line:
    pattern: "-e(nc|ncodedcommand)"
    case_sensitive: false

parent_process:
  name:
    exclude:
      - explorer.exe
      - sccm.exe
      - services.exe

action: alert</div>
                </div>

                <!-- Hunting Methodology -->
                <h2><i class="fas fa-map"></i> Hunting Methodology</h2>
                <div class="config-section">
                    <h4>Hypothesis-Driven Approach</h4>
                    <ol style="color: #8b949e;">
                        <li><strong>Form Hypothesis:</strong> Based on threat intel, MITRE ATT&CK, or incidents</li>
                        <li><strong>Identify Data:</strong> Which event types contain relevant telemetry?</li>
                        <li><strong>Build Query:</strong> Start broad, then narrow based on results</li>
                        <li><strong>Execute & Analyze:</strong> Review results, investigate anomalies</li>
                        <li><strong>Document:</strong> Record findings, create detection rules</li>
                    </ol>

                    <h4>Recommended Hunt Schedule</h4>
                    <table class="styled-table">
                        <thead>
                            <tr><th>Hunt Category</th><th>Frequency</th><th>Priority</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Credential access indicators</td><td>Daily</td><td>Critical</td></tr>
                            <tr><td>PowerShell suspicious activity</td><td>Daily</td><td>High</td></tr>
                            <tr><td>Persistence mechanisms</td><td>Daily</td><td>High</td></tr>
                            <tr><td>Lateral movement patterns</td><td>Daily</td><td>High</td></tr>
                            <tr><td>Data exfiltration indicators</td><td>Daily</td><td>High</td></tr>
                            <tr><td>LOLBin abuse</td><td>Weekly</td><td>Medium</td></tr>
                            <tr><td>Rare process execution</td><td>Weekly</td><td>Medium</td></tr>
                            <tr><td>DLL hijacking</td><td>Weekly</td><td>Medium</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Additional Interview Questions -->
                <div class="qa-section">
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: Walk me through investigating a suspicious PowerShell alert in Cortex XDR.</button>
                        <div class="qa-answer">
                            <ol>
                                <li><strong>Review alert details:</strong> Check alert name, severity, host, user, and MITRE mapping</li>
                                <li><strong>Examine causality chain:</strong> In Cortex UI, view the causality chain to see parent process and subsequent actions</li>
                                <li><strong>Query for context:</strong>
                                    <div class="code-block">dataset = xdr_data
| filter host_name = "AFFECTED-HOST"
| filter _time between (alert_time - 30m) and (alert_time + 30m)
| sort asc _time</div>
                                </li>
                                <li><strong>Check network activity:</strong> Did PowerShell make any outbound connections?</li>
                                <li><strong>Check file activity:</strong> Did it drop or modify files?</li>
                                <li><strong>Scope the incident:</strong> Search for same IOCs across all endpoints</li>
                                <li><strong>Respond:</strong> If confirmed malicious, isolate host, collect evidence</li>
                            </ol>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: How do you identify beaconing behavior in Cortex XDR?</button>
                        <div class="qa-answer">
                            <p>Beaconing is characterized by regular, periodic connections to external hosts:</p>
                            <div class="code-block">dataset = xdr_data
| filter event_type = "network_connection"
| filter dst_ip_is_private = false
| comp 
    count() as connection_count,
    arrayconcat(_time) as timestamps
    by host_name, dst_ip, process_name
    over 24h
| filter connection_count > 20
// Look for regular intervals in timestamps
| sort desc connection_count</div>
                            <p style="margin-top: 12px;">Key indicators:</p>
                            <ul>
                                <li>Regular connection intervals (every 60s, 5m, etc.)</li>
                                <li>Consistent packet sizes</li>
                                <li>Connections to rare external IPs</li>
                                <li>Non-browser process making web connections</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-item">
                        <button class="qa-question"><i class="fas fa-lightbulb" style="color: #d29922;"></i> Q: What's the difference between Analytics BIOC and Standard BIOC rules?</button>
                        <div class="qa-answer">
                            <p><strong>Standard BIOC:</strong></p>
                            <ul>
                                <li>Single-event detection (one process, one file, etc.)</li>
                                <li>Pattern matching on specific fields</li>
                                <li>Real-time detection</li>
                                <li>Good for: known-bad indicators, specific attack patterns</li>
                            </ul>
                            <p><strong>Analytics BIOC:</strong></p>
                            <ul>
                                <li>Multi-event correlation over time</li>
                                <li>Sequence detection (A then B then C)</li>
                                <li>Threshold-based detection</li>
                                <li>Good for: behavioral patterns, attack chains</li>
                            </ul>
                            <p>Example: Standard BIOC detects "mimikatz.exe execution". Analytics BIOC detects "5+ failed logins followed by successful login followed by sensitive file access".</p>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>
    <script>

            </main>
        </div>
    </div>
    <script>

                <!-- Quick Reference -->
                <h2><i class="fas fa-bookmark"></i> XQL Quick Reference</h2>
                <div class="config-section">
                    <table class="styled-table">
                        <thead>
                            <tr><th>Operation</th><th>XQL Syntax</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Select dataset</td><td><code>dataset = xdr_data</code></td></tr>
                            <tr><td>Filter rows</td><td><code>| filter field = "value"</code></td></tr>
                            <tr><td>Select fields</td><td><code>| fields field1, field2</code></td></tr>
                            <tr><td>Aggregate</td><td><code>| comp count() by field</code></td></tr>
                            <tr><td>Sort results</td><td><code>| sort desc field</code></td></tr>
                            <tr><td>Limit results</td><td><code>| limit 100</code></td></tr>
                            <tr><td>Regex match</td><td><code>| filter field ~= "pattern"</code></td></tr>
                            <tr><td>Time filter</td><td><code>| filter _time > ago("24h")</code></td></tr>
                            <tr><td>Contains</td><td><code>| filter field contains "text"</code></td></tr>
                            <tr><td>In list</td><td><code>| filter field in ("a", "b")</code></td></tr>
                        </tbody>
                    </table>
                </div>

            </main>
        </div>
    </div>
    <script>
        document.querySelectorAll('.qa-question').forEach(btn => {
            btn.addEventListener('click', () => {
                const answer = btn.nextElementSibling;
                const isOpen = answer.style.display === 'block';
                document.querySelectorAll('.qa-answer').forEach(a => a.style.display = 'none');
                document.querySelectorAll('.qa-question').forEach(b => b.classList.remove('active'));
                if (!isOpen) { answer.style.display = 'block'; btn.classList.add('active'); }
            });
        });
    </script>
</body>
</html>
